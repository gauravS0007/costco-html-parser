// For license information, see `https://assets.adobedtm.com/db2abc551d12/237ca126a76b/launch-01eecb8ff534.js`.
window._satellite=window._satellite||{},window._satellite.container={buildInfo:{minified:!0,buildDate:"2025-06-11T22:30:55Z",turbineBuildDate:"2024-08-22T17:32:44Z",turbineVersion:"28.0.0"},environment:{id:"EN922cf6870119435bba48b633922bcab5",stage:"production"},dataElements:{"Syndigo Src: bdusen":{modulePath:"core/src/lib/dataElements/constant.js",settings:{value:"https://content.syndigo.com/site/99aad5e1-c6ff-4dbf-a1b7-a567854f1fc4/tag.js?cv="}},"Report Suite - Staging":{defaultValue:"",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return{usbc:"cwcostcotest",cabc:"cwcostcocatest",usbd:"cwcostcobusdeliverytest",cabd:"cwcostcobusdeliverytest"}[_satellite.getVar("siteEnv")?.siteCountryStore]||"unknown"}}},"Is BC?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return!_satellite.getVar("Is BD?")}}},sessionPageViewCount:{modulePath:"core/src/lib/dataElements/visitorBehavior.js",settings:{attribute:"sessionPageViewCount"}},"Syndigo Src: bccafr":{modulePath:"core/src/lib/dataElements/constant.js",settings:{value:"https://content.syndigo.com/site/08d6877d-2959-40c7-9124-4695664bb192/tag.js?cv="}},analyticsForThisPage:{storageDuration:"pageview",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){let e=adobeopt.module("analytics"),n=["/BlankUtilView","/CompareProductsDisplay","/cmpp","/cmpps","/immunizations-vaccinations.html","/member-prescription-program-frequently-asked-questions.html","/cmpp-buying-guide.html","/cmpp-elanco-interceptor-plus-information.html","/CMPPDrugListDisplayView","/pet-medications.html","/optical.html","/hearing-aid-center.html","/hearing-aid-faqs.html","/hearing-aid-styles.html","/hearing-aid-accessories.html","/hearing-aid-batteries.html","/hearing-aid-screening.html","/rexton.html","/jabra-hearing-aids.html","/philips-hearing-aids.html"],t=!0;return n.indexOf(window.location.pathname)>-1?(e.log("analyticsForThisPage:excluded by pathname"),t=!1):document.querySelectorAll("ol.crumbs a, #crumbs_ul a").forEach((function(r){let o=r.getAttribute("href");if("string"==typeof o){if(o.indexOf("//")>-1){let e=o.split("/",4);o="/"+e.pop()}n.indexOf(o)>-1&&(e.log("pageFilter:excluded by crumb",o),t=!1)}})),t&&document.querySelectorAll('img.bc-logo[alt="Costco Pharmacy homepage"]').length>0&&(e.log("analyticsForThisPage:excluded by rx logo"),t=!1),t&&"string"==typeof window.location.search&&window.location.search.indexOf("ignoreAnalytics=YES")>-1&&(e.log("analyticsForThisPage:excluded by qsp ignoreAnalytics"),t=!1),e.log("analyticsForThisPage:result:",t),t}}},siteEnv:{storageDuration:"pageview",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){let e={siteReleaseEnv:"nonprod",tagsEnvironmentStage:_satellite.environment?.stage||"unknown",siteLang:"en",siteStore:"unknown",siteCountry:"unknown",authStatus:"Authenticated",appPlatform:"browser"},n=window.location.hostname.toLowerCase();"localhost"===n&&(n=localStorage.getItem("aoptLocalhostMapping")||"unknown");let t=window?.digitalData?.siteLang;switch(e.siteLang="string"==typeof t?t.slice(0,2):document.cookie.indexOf("selectedLanguage=-25")>-1?"fr":"en",window?.digitalData?.authStatus?e.authStatus=window?.digitalData?.authStatus:e.authStatus=document.cookie.indexOf("hashedUserId")>-1?"Authenticated":"Unauthenticated",n){case"www.costco.com":e.siteReleaseEnv="prod",e.siteCountry="us",e.siteStore="bc";break;case"www.costco.ca":e.siteReleaseEnv="prod",e.siteCountry="ca",e.siteStore="bc";break;case"www.costcobusinessdelivery.com":e.siteReleaseEnv="prod",e.siteCountry="us",e.siteStore="bd";break;case"www.costcobusinesscentre.ca":e.siteReleaseEnv="prod",e.siteCountry="ca",e.siteStore="bd";break;case"ca-stage.ecom.costco.com":case"www-vqa4.costco.ca":case"www-vqa8.costco.ca":e.siteReleaseEnv="nonprod",e.siteCountry="ca",e.siteStore="bc";break;case"www-vqa4.costco.com":case"www-vqa8.costco.com":e.siteReleaseEnv="nonprod",e.siteCountry="us",e.siteStore="bc";break;default:if(e.siteReleaseEnv="nonprod",e.siteCountry=window?.digitalData?.siteCountry||"unknown",e.siteStore=window?.digitalData?.siteStore||"unknown","unknown"==e.siteCountry||"unknown"==e.siteStore){let n=document.querySelector("script[data-domain-script]")?.getAttribute("data-domain-script");switch("string"==typeof n&&(n=n.replace("-test","")),n){case"2653cf4b-5c84-40d7-a99b-fa6e1592503b":e.siteCountry="us",e.siteStore="bc";break;case"4325a455-ccf4-4ed6-854d-e9f4af4f7c2b":e.siteCountry="ca",e.siteStore="bc";break;case"5f812302-3833-47ab-8d40-4ee9060c2f41":e.siteCountry="us",e.siteStore="bd";break;case"d0af1630-fb74-4e09-969b-ae4f627acea8":e.siteCountry="ca",e.siteStore="bd"}}}e.appVersion=localStorage.getItem("aopt-appPlatform");try{const n=new URLSearchParams(window.location.search).get("COSTID")||"";(n.startsWith("androidapp")||n.startsWith("iosapp"))&&(e.appVersion=n,localStorage.setItem("aopt-appPlatform",n))}catch(e){_satellite.logger.error(e)}"string"==typeof e.appVersion?(e.appVersion.startsWith("androidapp")&&(e.appPlatform="androidapp"),e.appVersion.startsWith("iosapp")&&(e.appPlatform="iosapp")):void 0!==window.Android?(e.appPlatform="androidapp",e.appVersion="androidapp (detected)"):void 0!==window.webkit&&(e.appPlatform="iosapp",e.appVersion="iosapp (detected)"),e.siteCountryStore=e.siteCountry+e.siteStore,e.siteCountryStoreLang=e.siteCountryStore+e.siteLang,e.siteStoreCountry=e.siteStore+e.siteCountry,e.siteStoreCountryLang=e.siteStore+e.siteCountry+e.siteLang,e.flags={};let r=[["prod","nonprod"],["tags_development","tags_staging","tags_production"],["us","ca"],["en","fr"],["bc","bd"],["usbc","usbd","cabc","cabd"],["authenticated","unauthenticated"],["browser","androidapp","iosapp"]];return r.forEach((n=>n.forEach((n=>{e.flags[n]=!1})))),e.flags[e.siteReleaseEnv]=!0,e.flags["tags_"+e.tagsEnvironmentStage]=!0,e.flags.tags_notproduction="production"!==e.tagsEnvironmentStage,e.flags[e.siteCountry]=!0,e.flags[e.siteStore]=!0,e.flags[e.siteCountryStore]=!0,e.flags[e.siteLang]=!0,e.flags[e.appPlatform]=!0,e.flags[e.authStatus.toLowerCase()]=!0,r.forEach((n=>{let t=0;n.forEach((n=>{t+=1==e.flags[n]?1:0})),1!==t&&_satellite.logger.warn("siteEnv:flagSet does not have exactly one true",n)})),"unknown"==e.siteStore&&_satellite.logger.warn("siteEnv.siteStore unknown"),"unknown"==e.siteCountry&&_satellite.logger.warn("siteEnv.siteCountry unknown"),e.applyEnvConfig=function(n){for(let t=1;t<arguments.length;t++){let r=arguments[t];for(let t in r)t in e.flags?1==e.flags[t]&&e.applyEnvConfig(n,r[t]):n[t]=r[t]}return n},e}}},trafficSource:{modulePath:"core/src/lib/dataElements/visitorBehavior.js",settings:{attribute:"trafficSource"}},"Report Suite":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv").flags.tags_production?_satellite.getVar("Report Suite - Production"):_satellite.getVar("Report Suite - Staging")}}},"store-lang-env":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return digitalDataEx.siteStore+"-"+digitalDataEx.siteLang+"-"+digitalDataEx.siteReleaseEnv}}},siteCountryStore:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv")?.siteCountryStore||"unknown"}}},targetWOA4TDataStreamId:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return"prod"==window?.digitalDataEx?.serverReleaseEnv?(console.warn("need to configure data stream prod value"),"e616b98d-d9d6-4359-b6e2-f581ac93fc7d"):"e616b98d-d9d6-4359-b6e2-f581ac93fc7d"}}},TrackingServer:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=window.location.hostname.toLowerCase(),n=_satellite.getVar("Is BD?"),t=".ca"==e.slice(-3);return n?t?"metrics.costcobusinesscentre.ca":"metrics.costcobusinessdelivery.com":t?"metrics.costco.ca":"metrics.costco.com"}}},"Report Suite - Production":{defaultValue:"",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return{usbc:"cwcostcocomprod",cabc:"cwcostcocaprod",usbd:"cwcostcobusdeliveryprod",cabd:"cwcostcobusdeliverycaprod"}[_satellite.getVar("siteEnv")?.siteCountryStore]||"unknown"}}},satelliteProperty:{modulePath:"core/src/lib/dataElements/constant.js",settings:{value:"Costco BC BD"}},useAlloyTarget:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){let e=window.location.search;const n="aoptUseAlloyTarget";return e.indexOf(n+"=yes")>-1?localStorage.removeItem(n):e.indexOf(n+"=no")>-1&&localStorage.setItem(n,"no"),"no"!==localStorage.getItem(n)}}},appEnv:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv").applyEnvConfig({},{usbc:{iosapp:{tags_notproduction:{appRSIDPurchase:"cwcios-us-dev"},tags_production:{appRSIDPurchase:"cwcios-us-prod"}},androidapp:{tags_notproduction:{appRSIDPurchase:"cwcandroid-us-dev"},tags_production:{appRSIDPurchase:"cwcandroid-us-prod"}}},cabc:{iosapp:{tags_notproduction:{appRSIDPurchase:"cwcios-us-dev"},tags_production:{appRSIDPurchase:"cwcios-us-prod"}},androidapp:{tags_notproduction:{appRSIDPurchase:"cwcandroid-us-dev"},tags_production:{appRSIDPurchase:"cwcandroid-us-prod"}}}})}}},"biInspector?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return window.biInspectEnabled="boolean"==typeof window.biInspectEnabled?biInspectEnabled:null!==sessionStorage.getItem("biInspectEnabled")||null!==localStorage.getItem("biInspectEnabled")}}},"Is Pharmacy?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return window.location.href.toLowerCase().indexOf("/pharmacy/")>-1||$('#header-widget a[href="/pharmacy/home-delivery"],#header-widget a[href="/Pharmacy/home-delivery"]').length>0||"/transfer-warehouse-location"==window.location.pathname}}},"is costco.com?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return window.location.host.toLowerCase().indexOf("costco.com")>-1&&1!=_satellite.getVar("is bd.com?")}}},"Is BD?":{storageDuration:"session",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=window.location.hostname.toLowerCase();return"costcobusinessdelivery.com"==e.slice(-26)||"costcobusinesscentre.ca"==e.slice(-23)||"bd-"==e.slice(0,3)||"wcs."==e.slice(0,4)}}},"OneTrust Opt Out?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return!_satellite.getVar("OneTrust Opt In?")}}},"is French?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return"fr"==wcs.locale.slice(0,2)}}},"is bd.com?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=window.location.hostname.toLowerCase();return".com"==e.slice(-4)&&("costcobusinessdelivery.com"==e.slice(-26)||"bd-"==e.slice(0,3)||"wcs."==e.slice(0,4))}}},siteReleaseEnv:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv")?.siteReleaseEnv||"nonprod"}}},"dataStream - Production":{defaultValue:"",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return{usbc:"998fca04-5ec4-40f4-b8b3-904e5ae8c3dd",usbd:"0814504a-158f-4515-9ef9-5d0872eb9457",cabc:"0814504a-158f-4515-9ef9-5d0872eb9457",cabd:"0814504a-158f-4515-9ef9-5d0872eb9457"}[_satellite.getVar("siteCountryStore")]||"unknown"}}},"dataStream - Staging":{defaultValue:"",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return{usbc:"b25719b0-eb39-4161-bf03-0232afdc4c83",usbd:"82d619d1-d8ac-497d-9fc3-79d2a9b07fd3",cabc:"7efe5138-f026-4e50-866f-e26074166aef",cabd:"7efe5138-f026-4e50-866f-e26074166aef"}[_satellite.getVar("siteCountryStore")]||"unknown"}}},"OneTrust Opt In?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=_satellite.cookie.get("OptanonConsent");if("string"==typeof e){if(e.indexOf("C0004:0")>-1)return!1;if(e.indexOf("C0004:1")>-1)return!0}return"ca"!=digitalDataEx.siteCountry}}},"is bd.ca?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=window.location.hostname.toLowerCase();return".ca"==e.slice(-3)&&("costcobusinesscentre.ca"==e.slice(-23)||"bd-"==e.slice(0,3)||"wcs."==e.slice(0,4))}}},"Adobe ECID Permissions":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("OptIn OneTrust?")?{aa:!0,target:!0,ecid:!0}:{aa:!1,target:!1,ecid:!1}}}},landingPage:{modulePath:"core/src/lib/dataElements/visitorBehavior.js",settings:{attribute:"landingPage"}},"is English?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return"en"==wcs.locale.slice(0,2)}}},"Syndigo Src: bccaen":{modulePath:"core/src/lib/dataElements/constant.js",settings:{value:"https://content.syndigo.com/site/2c8a7f73-fb04-4144-8886-5649472b75bd/tag.js?cv="}},TrackingServerSSL:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){var e=window.location.hostname.toLowerCase(),n=_satellite.getVar("Is BD?"),t=".ca"==e.slice(-3);return n?t?"smetrics.costcobusinesscentre.ca":"smetrics.costcobusinessdelivery.com":t?"smetrics.costco.ca":"smetrics.costco.com"}}},"OptIn OneTrust?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("OneTrust Opt In?")}}},useAlloy:{defaultValue:"no",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){let e=window.location.search;return e.indexOf("aoptUseAlloy=yes")>-1?localStorage.removeItem("aoptUseAlloy"):e.indexOf("aoptUseAlloy=no")>-1&&localStorage.setItem("aoptUseAlloy","no"),"no"!==localStorage.getItem("aoptUseAlloy")}}},storeCountryLang:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv")?.siteStoreCountryLang||"unknown"}}},sessionCount:{modulePath:"core/src/lib/dataElements/visitorBehavior.js",settings:{attribute:"sessionCount"}},"is costco.ca?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return window.location.host.toLowerCase().indexOf("costco.ca")>-1}}},"Build Number":{defaultValue:"",modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return $("meta[name='currentBuildNumber']").attr("content")+" "+_satellite.environment.stage.slice(0,3)}}},"Syndigo Src: bcusen":{modulePath:"core/src/lib/dataElements/constant.js",settings:{value:"https://content.syndigo.com/site/08b9b8e2-abe6-42d5-af6d-995ce9ff38e5/tag.js?cv="}},launchEnvStage:{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return _satellite.getVar("siteEnv")?.tagsEnvironmentStage||"unknown"}}},"isPageModernized?":{modulePath:"core/src/lib/dataElements/customCode.js",settings:{source:function(){return"react"===window.digitalData?.pagePlatform||"react"===window.digitalData?.sitePlatform||"true"===sessionStorage.getItem("aopt-isPageModernized")}}}},extensions:{"adobe-alloy":{displayName:"Adobe Experience Platform Web SDK",hostedLibFilesBaseUrl:"https://assets.adobedtm.com/extensions/EPfd9384fb1051462faec6c7a7a08b91fb/",settings:{instances:[{name:"alloy",edgeDomain:"smetrics.costco.com",edgeConfigId:"%dataStream - Production%",edgeConfigOverrides:{staging:{com_adobe_analytics:{reportSuites:["%Report Suite - Staging%"]}},production:{com_adobe_analytics:{reportSuites:["%Report Suite - Production%"]}},development:{com_adobe_analytics:{reportSuites:["%Report Suite - Staging%"]}}},stagingEdgeConfigId:"%dataStream - Staging%",clickCollectionEnabled:!1,targetMigrationEnabled:!0,developmentEdgeConfigId:"%dataStream - Staging%"}]},modules:{"adobe-alloy/dist/lib/instanceManager/index.js":{script:function(e,n,t,r){"use strict";var o,a=t("../alloy"),i=a.createInstance,s=a.createEventMergeId,c=t("./createInstanceManager"),d=t("./injectWrapOnBeforeEventSend"),l=t("../utils/createGetConfigOverrides"),u=d({version:"2.25.0"});e.exports=c({turbine:r,window:window,createInstance:i,createEventMergeId:s,orgId:_satellite.company.orgId,wrapOnBeforeEventSend:u,getConfigOverrides:l(null===(o=r.environment)||void 0===o?void 0:o.stage)})}},"adobe-alloy/dist/lib/alloy.js":{script:function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,n){if(null==e)return{};var t,r,o=a(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||{}.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function a(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(n.indexOf(r)>=0)continue;t[r]=e[r]}return t}function i(e,n){return d(e)||c(e,n)||h(e,n)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,i,s=[],c=!0,d=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(s.push(r.value),s.length!==n);c=!0);}catch(e){d=!0,o=e}finally{try{if(!c&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(d)throw o}}return s}}function d(e){if(Array.isArray(e))return e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){p(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n,t){return(n=f(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function f(e){var n=m(e,"string");return"symbol"==E(n)?n:n+""}function m(e,n){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function g(e){return b(e)||y(e)||h(e)||v()}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,n){if(e){if("string"==typeof e)return w(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(e,n):void 0}}function y(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function b(e){if(Array.isArray(e))return w(e)}function w(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function S(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)e[r]=t[r]}return e}function x(e,n){function t(t,r,o){if("undefined"!=typeof document){"number"==typeof(o=S({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var i in o)o[i]&&(a+="; "+i,!0!==o[i]&&(a+="="+o[i].split(";")[0]));return document.cookie=t+"="+e.write(r,t)+a}}function r(n){if("undefined"!=typeof document&&(!arguments.length||n)){for(var t=document.cookie?document.cookie.split("; "):[],r={},o=0;o<t.length;o++){var a=t[o].split("="),i=a.slice(1).join("=");try{var s=decodeURIComponent(a[0]);if(r[s]=e.read(i,s),n===s)break}catch(e){}}return n?r[n]:r}}return Object.create({set:t,get:r,remove:function(e,n){t(e,"",S({},n,{expires:-1}))},withAttributes:function(e){return x(this.converter,S({},this.attributes,e))},withConverter:function(e){return x(S({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(e)}})}function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function P(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(It[e[n+0]]+It[e[n+1]]+It[e[n+2]]+It[e[n+3]]+"-"+It[e[n+4]]+It[e[n+5]]+"-"+It[e[n+6]]+It[e[n+7]]+"-"+It[e[n+8]]+It[e[n+9]]+"-"+It[e[n+10]]+It[e[n+11]]+It[e[n+12]]+It[e[n+13]]+It[e[n+14]]+It[e[n+15]]).toLowerCase()}function I(){if(!fe&&!(fe="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fe(Dt)}function k(e,n,t){if(Tt.randomUUID&&!n&&!e)return Tt.randomUUID();var r=(e=e||{}).random||(e.rng||I)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){t=t||0;for(var o=0;o<16;++o)n[t+o]=r[o];return n}return P(r)}function D(e){return"object"===E(e)||void 0===e}function T(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&r===String(t[o]).toLowerCase())return!0;return!1}}}function O(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&r===String(t[o]).toLowerCase())return!1;return!0}}}function N(){return{matches:function(e,n){return void 0!==e[n]&&null!==e[n]}}}function R(){return{matches:function(e,n){return void 0===e[n]||null===e[n]}}}function j(e){return"number"==typeof e}function A(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e[n];if(!j(r))return!1;for(var o=0;o<t.length;o+=1)if(j(t[o])&&r>t[o])return!0;return!1}}}function _(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e[n];if(!j(r))return!1;for(var o=0;o<t.length;o+=1)if(j(t[o])&&r>=t[o])return!0;return!1}}}function L(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e[n];if(!j(r))return!1;for(var o=0;o<t.length;o+=1)if(j(t[o])&&r<t[o])return!0;return!1}}}function V(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e[n];if(!j(r))return!1;for(var o=0;o<t.length;o+=1)if(j(t[o])&&r<=t[o])return!0;return!1}}}function M(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&-1!==r.indexOf(String(t[o]).toLowerCase()))return!0;return!1}}}function U(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&-1!==r.indexOf(String(t[o]).toLowerCase()))return!1;return!0}}}function q(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&r.startsWith(String(t[o]).toLowerCase()))return!0;return!1}}}function F(){return{matches:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(D(e[n]))return!1;for(var r=String(e[n]).toLowerCase(),o=0;o<t.length;o+=1)if(!D(t[o])&&r.endsWith(t[o].toLowerCase()))return!0;return!1}}}function B(e){return Zl[e]}function H(e){return void 0===e}function W(e,n,t){switch(n){case Kl.GREATER_THAN:return e>t;case Kl.GREATER_THAN_OR_EQUAL_TO:return e>=t;case Kl.LESS_THAN:return e<t;case Kl.LESS_THAN_OR_EQUAL_TO:return e<=t;case Kl.EQUALS:return e===t;case Kl.NOT_EQUALS:return e!==t;default:return!1}}function z(e,n){for(var t=0;t<n.length;t+=1)if(!H(e[n[t]]))return e[n[t]]}function Q(e,n){for(var t=Object.keys(e),r=0;r<t.length;r+=1){var o=t[r],a=n.event;if((void 0===a?{}:a)[t[r]]!==e[o])return!1}return!0}function J(e,n,t,r){return e.reduce((function(e,o){var a=z(o,eu);if(!a)return e;var i=n.events[a];if(!i)return e;var s=z(o,nu);if(!s)return e;var c=i[s];if(!c)return e;if(!Q(o,c))return e;var d=c.count,l=void 0===d?1:d;return H(t)||H(r)||c.timestamp>=t&&c.timestamp<=r?e+l:e}),0)}function $(e,n,t,r){var o=t;return e.every((function(e){var t=z(e,eu);if(!t)return!1;var a=n.events[t];if(!a)return!1;var i=z(e,nu);if(!i)return!1;var s=a[i];if(!Q(e,s))return!1;if(null===s||H(s)||0===s.count)return!1;var c=(H(o)||s.timestamp>=o)&&(H(r)||s.timestamp<=r);return o=s.timestamp,c}))?1:0}function G(e,n){for(var t=!0,r=0;r<n.length;r+=1)t=t&&n[r].evaluate(e);return t}function K(e,n){for(var t=!1,r=0;r<n.length;r+=1)if(t=t||n[r].evaluate(e))return!0;return!1}function X(e,n){return{version:e,rules:n}}function Y(e,n){return{execute:function(t){return e.evaluate(t)?n:[]},toString:function(){return"Rule{condition=".concat(e,", consequences=").concat(n,"}")}}}function Z(e,n){return{evaluate:function(e){return n.evaluate(e)},toString:function(){return"Condition{type=".concat(e,", definition=").concat(n,"}")}}}function ee(e,n,t){return{id:e,type:n,detail:t}}function ne(e,n){return{evaluate:function(t){return Xl.AND===e?G(t,n):Xl.OR===e&&K(t,n)}}}function te(e,n,t){return{evaluate:function(r){var o=B(n);return!!o&&o.matches(r,e,t)}}}function re(e,n,t,r,o,a){return{evaluate:function(i){return W(Yl.ORDERED===a?$(e,i,r,o):J(e,i,r,o),n,t)}}}function oe(e){return te(e.key,e.matcher,e.values)}function ae(e){return ne(e.logic,e.conditions.map(se))}function ie(e){var n=e.events,t=e.from,r=e.to;return re(n,e.matcher,e.value,t,r,e.searchType)}function se(e){var n=e.type,t=e.definition;if(Gl.MATCHER===n)return Z(n,oe(t));if(Gl.GROUP===n)return Z(n,ae(t));if(Gl.HISTORICAL===n)return Z(n,ie(t));throw new Error("Can not parse condition")}function ce(e){return ee(e.id,e.type,e.detail)}function de(e){var n=e.condition,t=e.consequences;return Y(se(n),t.map(ce))}function le(e){return X(e.version,e.rules.map(de))}function ue(e){var n=le(e),t=n.version,r=n.rules;return{execute:function(e){return r.map((function(n){return n.execute(e)})).filter((function(e){return e.length>0}))},getVersion:function(){return t},numRules:function(){return r.length}}}Object.defineProperty(n,"__esModule",{value:!0}),n.deepAssign=n.createInstance=n.createEventMergeId=void 0;for(var pe,fe,me=r(t("@adobe/reactor-object-assign")),ge=r(t("@adobe/reactor-query-string")),ve=r(t("@adobe/reactor-load-script")),he=["xdm","data","documentUnloading","type","mergeId","datasetId","edgeConfigOverrides"],ye=["datastreamId"],be=["priority"],we=["trackingLabel","scopeType"],Ee=["standard","version"],Se=["edgeConfigOverrides"],xe="Chrome",Ce="Edge",Pe="EdgeChromium",Ie="Firefox",ke="IE",De="Safari",Te="Unknown",Oe=function(e,n){return-1!==e.indexOf(n)},Ne=[xe,Ce,Pe,ke,Te],Re=function(e){return Oe(Ne,e)},je=function(e){return null==e},Ae=function(e){return!je(e)&&!Array.isArray(e)&&"object"===E(e)},_e=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.length<2?me.default.apply(void 0,n):n.reduce((function(e,n){return Ae(n)&&Object.keys(n).forEach((function(t){var r;Array.isArray(n[t])?Array.isArray(e[t])?(r=e[t]).push.apply(r,g(n[t])):e[t]=g(n[t]):e[t]=n[t]})),e}))},Le=x({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),Ve={get:Le.get,set:Le.set,remove:Le.remove,withConverter:Le.withConverter},Me=function e(n,t){Object.keys(t).forEach((function(r){Ae(n[r])&&Ae(t[r])?e(n[r],t[r]):n[r]=t[r]}))},Ue=n.deepAssign=function(e){if(je(e))throw new TypeError('deepAssign "target" cannot be null or undefined');for(var n=Object(e),t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return r.forEach((function(e){return Me(n,Object(e))})),n},qe=function(e,n){return function(t){var r=n.split(".").reduce((function(e,n){return e[n]=e[n]||{},e[n]}),e);Ue(r,t)}},Fe=function(){var e=[];return{add:function(n){e.push(n)},call:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Promise.all(e.map((function(e){return e.apply(void 0,t)})))}}},Be=function(e){var n=e.logger,t=e.cookieJar;return u(u({},t),{},{set:function(e,r,o){n.info("Setting cookie",u({name:e,value:r},o)),t.set(e,r,o)}})},He=function(){var e=0,n=Promise.resolve();return{addTask:function(t){e+=1;var r=function(){return t().finally((function(){e-=1}))};return n=n.then(r,r)},get length(){return e}}},We=function(){for(var e=[],n=0;n<256;n++){for(var t=n,r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e.push(t)}return function(n,t){n=unescape(encodeURIComponent(n)),t||(t=0),t=~t;for(var r=0;r<n.length;r++){var o=255&(t^n.charCodeAt(r));t=t>>>8^e[o]}return(t=~t)>>>0}}(),ze=function(){var e={};return e.promise=new Promise((function(n,t){e.resolve=n,e.reject=t})),e},Qe=function(e,n){return e===n},Je=function(e,n,t){for(var r=0;r<e.length;r+=1)if(t(e[r],n))return r;return-1},$e=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qe;return e.filter((function(t,r){return Je(e,t,n)===r}))},Ge=function(e,n){return e.substr(-n.length)===n},Ke=function(e,n){for(var t=0;t<e.length;t+=1){var r=e[t];if(n(r,t,e))return r}},Xe=function(e,n){return e.appendChild(n)},Ye=function(e,n){Object.keys(n).forEach((function(t){if("style"===t&&Ae(n[t])){var r=n[t];Object.keys(r).forEach((function(n){e.style[n]=r[n]}))}else e[t]=n[t]}))},Ze=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:document).createElement(e);return Object.keys(n).forEach((function(e){o.setAttribute(e,n[e])})),Ye(o,t),r.forEach((function(e){return Xe(o,e)})),o},en="BODY",nn="IFRAME",tn="IMG",rn="DIV",on="STYLE",an="SCRIPT",sn="HEAD",cn=function(e){var n=e.src,t=e.currentDocument,r=void 0===t?document:t;return new Promise((function(e,t){Ze(tn,{src:n},{onload:e,onerror:t,onabort:t},[],r)}))},dn=function(e){return"function"==typeof e},ln=function(e){return Array.isArray(e)&&e.length>0},un=function(e){return Array.isArray(e)?e:null==e?[]:[].slice.call(e)},pn=/^\s*>/,fn=function(e,n){if(!pn.test(n))return un(e.querySelectorAll(n));var t="alloy-".concat(Date.now());try{return e.classList.add(t),un(e.querySelectorAll(".".concat(t," ").concat(n)))}finally{e.classList.remove(t)}},mn=function(e,n){return e.substr(0,n.length)===n},gn=":shadow",vn=function(e){return e.split(gn)},hn=function(e,n){var t=n;if(!mn(t,">"))return t;if(window.document.documentMode)return t.substring(1).trim();var r=e instanceof Element||e instanceof HTMLDocument?":scope":":host";return"".concat(r," ").concat(t)},yn=function(e,n){if(!window.document.documentElement.attachShadow)return fn(e,n.replace(gn,""));var t=vn(n);if(t.length<2)return fn(e,n);for(var r=e,o=0;o<t.length;o+=1){var a=t[o].trim();if(""===a&&r.shadowRoot)r=r.shadowRoot;else{var i=hn(r,a),s=fn(r,i);if(0===s.length||!s[0]||!s[0].shadowRoot)return s;r=s[0].shadowRoot}}},bn=function(e){return-1!==e.indexOf(gn)},wn=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return bn(e)?yn(n,e):fn(n,e)},En="MutationObserver",Sn="requestAnimationFrame",xn={childList:!0,subtree:!0},Cn="visibilityState",Pn="visible",In=100,kn=5e3,Dn=function(e){return new Error("Could not find: ".concat(e))},Tn=function(e){return new Promise(e)},On=function(e){return dn(e[En])},Nn=function(e,n,t,r,o){return Tn((function(a,i){var s,c=new e[En]((function(){var e=o(t);ln(e)&&(c.disconnect(),s&&clearTimeout(s),a(e))}));s=setTimeout((function(){c.disconnect(),i(Dn(t))}),r),c.observe(n,xn)}))},Rn=function(e){return e[Cn]===Pn},jn=function(e,n,t,r){return Tn((function(o,a){(function t(){var a=r(n);ln(a)?o(a):e[Sn](t)})(),setTimeout((function(){a(Dn(n))}),t)}))},An=function(e,n,t){return Tn((function(r,o){(function n(){var o=t(e);ln(o)?r(o):setTimeout(n,In)})(),setTimeout((function(){o(Dn(e))}),n)}))},_n=function(e){
var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wn,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kn,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,a=n(e);return ln(a)?Promise.resolve(a):On(r)?Nn(r,o,e,t,n):Rn(o)?jn(r,e,t,n):An(e,t,n)},Ln=function(e,n){return n.matches?n.matches(e):n.msMatchesSelector(e)},Vn=function(e){var n=e.parentNode;return n?n.removeChild(e):null},Mn={name:"Adobe Alloy"},Un={style:{display:"none",width:0,height:0}},qn=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.appendNode,r=void 0===t?Xe:t,o=n.awaitSelector,a=void 0===o?_n:o,s=n.createNode,c=void 0===s?Ze:s,d=n.fireImage,l=void 0===d?cn:d,u=l,p=function(){return a(en).then((function(n){var t=i(n,1)[0];return e||(e=c(nn,Mn,Un),r(t,e))}))},f=function(e){var n=e.src;return p().then((function(e){var t=e.contentWindow.document;return l({src:n,currentDocument:t})}))};return function(e){var n=e.hideReferrer,t=e.url;return n?f({src:t}):u({src:t})}},Fn=function(e){return Ae(e)&&0===Object.keys(e).length},Bn=function e(n,t){return je(n)||!Ae(n)?n:Object.keys(n).reduce((function(r,o){var a=n[o];if(Ae(a)){var i=e(a,t);return Fn(i)?r:u(u({},r),{},p({},o,i))}return t(a)?u(u({},r),{},p({},o,a)):r}),{})},Hn=function(e,n){return Array.prototype.concat.apply([],e.map(n))},Wn="com.adobe.alloy.",zn=function(e,n){return e.slice(-n)},Qn="".concat(Wn,"getTld"),Jn=function(e,n){for(var t="",r=e.location.hostname.toLowerCase().split("."),o=1;o<r.length&&!n.get(Qn);)t=zn(r,o+=1).join("."),n.set(Qn,Qn,{domain:t});return n.remove(Qn,{domain:t}),t},$n="kndctr",Gn=function(e){return e.replace("@","_")},Kn=function(e,n){return"".concat($n,"_").concat(Gn(e),"_").concat(n)},Xn=function(e,n){var t={};return e.forEach((function(e){var r=n(e);t[r]||(t[r]=[]),t[r].push(e)})),t},Yn="identity",Zn="consent",et="cluster",nt=function(e){var n=e.orgId,t=Kn(n,Yn);return function(){return Boolean(Ve.get(t))}},tt=function(e,n,t){return{getItem:function(r){try{return e[n].getItem(t+r)}catch(e){return null}},setItem:function(r,o){try{return e[n].setItem(t+r,o),!0}catch(e){return!1}},clear:function(){try{return Object.keys(e[n]).forEach((function(r){mn(r,t)&&e[n].removeItem(r)})),!0}catch(e){return!1}}}},rt=function(e){return function(n){var t=Wn+n;return{session:tt(e,"sessionStorage",t),persistent:tt(e,"localStorage",t)}}},ot=function(e,n){return e.filter((function(e){return Oe(n,e)}))},at=function(e){return"boolean"==typeof e},it=function(e){return"number"==typeof e&&!isNaN(e)},st=function(e){var n=parseInt(e,10);return it(n)&&e===n},ct=function(e,n){return 0===n.indexOf("".concat($n,"_").concat(Gn(e),"_"))},dt=function(e){return"string"==typeof e},lt=function(e){return dt(e)&&e.length>0},ut=function(e){var n=new Map;return function(){var t=arguments.length<=0?void 0:arguments[0];if(n.has(t))return n.get(t);var r=e.apply(void 0,arguments);return n.set(t,r),r}},pt=function(){},ft=function(e,n,t){var r=String(e),o=String(t);if(r.length>=n||0===o.length)return r;for(var a=n-r.length;a>o.length;)o+=o;return o.slice(0,a)+r},mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},gt=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){for(var t={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?))?((((?:[^?#/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@/]*@)([^:/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=t.parser[n.strictMode?"strict":"loose"].exec(e),o={},a=14;a--;)o[t.key[a]]=r[a]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,(function(e,n,r){n&&(o[t.q.name][n]=r)})),o}},vt=C(gt),ht=function(e){var n={},t=e.split(".");switch(t.length){case 1:n.subdomain="",n.domain=e,n.topLevelDomain="";break;case 2:n.subdomain="",n.domain=e,n.topLevelDomain=t[1];break;case 3:n.subdomain="www"===t[0]?"":t[0],n.domain=e,n.topLevelDomain=t[2];break;case 4:n.subdomain="www"===t[0]?"":t[0],n.domain=e,n.topLevelDomain="".concat(t[2],".").concat(t[3])}return n},yt=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ht;dt(e)||(e="");var t=vt(e)||{},r=t.host,o=void 0===r?"":r,a=t.path,i=void 0===a?"":a,s=t.query,c=void 0===s?"":s,d=t.anchor;return u({path:i,query:c,fragment:void 0===d?"":d},n(o))},bt=function(e){if(je(e)||"object"!==E(e))return null;var n=Bn(e,(function(e){return!(je(e)||!at(e)&&!it(e)&&!lt(e)&&!ln(e))}));return Fn(n)?null:n},wt=function(e){return e instanceof Error?e:new Error(e)},Et=function(e){var n=e.error,t=e.message;try{n.message=t}catch(e){}},St=function(e){var n=e.error,t=e.message,r=wt(n),o="".concat(t,"\nCaused by: ").concat(r.message);return Et({error:r,message:o}),r},xt=function(e){return dt(e)&&"true"===e.toLowerCase()},Ct=function(e,n){if(it(e)||dt(e)){var t=Math.round(Number(e));if(!isNaN(t))return t}return n},Pt=function(e){var n=e.getFullYear(),t=ft(e.getMonth()+1,2,"0"),r=ft(e.getDate(),2,"0"),o=ft(e.getHours(),2,"0"),a=ft(e.getMinutes(),2,"0"),i=ft(e.getSeconds(),2,"0"),s=ft(e.getMilliseconds(),3,"0"),c=Ct(e.getTimezoneOffset(),0),d=c>0?"-":"+",l=ft(Math.floor(Math.abs(c)/60),2,"0"),u=ft(Math.abs(c)%60,2,"0");return"".concat(n,"-").concat(t,"-").concat(r,"T").concat(o,":").concat(a,":").concat(i,".").concat(s).concat(d).concat(l,":").concat(u)},It=[],kt=0;kt<256;++kt)It.push((kt+256).toString(16).slice(1));var Dt=new Uint8Array(16),Tt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},Ot=function(e){return function(n,t){return null==n?n:e.call(this,n,t)}},Nt=function(e,n){return function(t,r){return n.call(this,e.call(this,t,r),r)}},Rt=function(e,n){return function(t,r){var o=this,a=[],i=[e,n].reduce((function(e,n){try{return n.call(o,e,r)}catch(n){return a.push(n),e}}),t);if(a.length)throw new Error(a.join("\n"));return i}},jt=function(e,n,t){return(0,me.default)(Nt(e,n),e,t)},At=function(e,n,t){return(0,me.default)(Nt(e,Ot(n)),e,t)},_t=function(e,n,t){return(0,me.default)(Rt(Ot(n),e),e,t)},Lt=function(e,n,t,r){if(!e)throw new Error("'".concat(t,"': Expected ").concat(r,", but got ").concat(JSON.stringify(n),"."))},Vt=function(e,n){return Lt(at(e),e,n,"true or false"),e},Mt=function(e,n){return Lt(dn(e),e,n,"a function"),e},Ut=function(e,n){return function(t,r){var o,a=this,i=Ke(e,(function(e){try{return o=e.call(a,t,r),!0}catch(e){return!1}}));return Lt(i,t,r,n),o}},qt=function(e){return function(n,t){var r=this;Lt(Array.isArray(n),n,t,"an array");var o=[],a=n.map((function(a,i){try{return e.call(r,a,"".concat(t,"[").concat(i,"]"),n)}catch(e){return void o.push(e.message)}}));if(o.length)throw new Error(o.join("\n"));return a}},Ft=function(e){return function(n){return null==n?e:n}},Bt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"This field has been deprecated";return function(n,t){var r=e;return void 0!==n&&(t&&(r="'".concat(t,"': ").concat(r)),this&&this.logger&&this.logger.warn(r)),n}},Ht=function(e){return function(n,t){return Lt(n===e,n,t,"".concat(e)),n}},Wt=function(e){return function(n,t){var r=this;Lt(Ae(n),n,t,"an object");var o=[],a={};if(Object.keys(n).forEach((function(i){var s=n[i],c=t?"".concat(t,".").concat(i):i;try{var d=e.call(r,s,c);void 0!==d&&(a[i]=d)}catch(e){o.push(e.message)}})),o.length)throw new Error(o.join("\n"));return a}},zt=function(e,n){return function(t,r){return Lt(t>=n,t,r,"".concat(e," greater than or equal to ").concat(n)),t}},Qt=function(e,n){return function(t,r){return Lt(t<=n,t,r,"".concat(e," less than or equal to ").concat(n)),t}},Jt=function(e){return function(n,t){var r=[];if(Object.keys(n).forEach((function(n){if(!e[n]){var o=t?"".concat(t,".").concat(n):n;r.push("'".concat(o,"': Unknown field."))}})),r.length)throw new Error(r.join("\n"));return n}},$t=function(e){return function(n,t){return Ae(n)?Lt(!Fn(n),n,t,e):Lt(n.length>0,n,t,e),n}},Gt=function(e){return function(n,t){var r=this;Lt(Ae(n),n,t,"an object");var o=[],a={};if(Object.keys(e).forEach((function(i){var s=n[i],c=e[i],d=t?"".concat(t,".").concat(i):i;try{var l=c.call(r,s,d);void 0!==l&&(a[i]=l)}catch(e){o.push(e.message)}})),Object.keys(n).forEach((function(e){Object.prototype.hasOwnProperty.call(a,e)||(a[e]=n[e])})),o.length)throw new Error(o.join("\n"));return a}},Kt=function(e,n,t){return function(r,a){Lt(Ae(r),r,a,"an object");var i=r[e],s=r[t],c=o(r,[e,t].map(f)),d=n(i,a);if(void 0!==d){var l="The field '".concat(e,"' is deprecated. Use '").concat(t,"' instead.");if(a&&(l="'".concat(a,"': ").concat(l)),void 0!==s&&s!==d)throw new Error(l);this&&this.logger&&this.logger.warn(l)}return u(p({},t,s||d),c)}},Xt=function(){var e=[];return function(n,t){return Lt(-1===e.indexOf(n),n,t,"a unique value across instances"),e.push(n),n}},Yt=function(e){for(var n=Object.create(null),t=0;t<e.length;t+=1){var r=e[t];if(r in n)return!1;n[r]=!0}return!0},Zt=function(){return function(e,n){Lt(Yt(e),e,n,"array values to be unique")}},er=/^[a-z0-9.-]{1,}$/i,nr=function(e,n){return Lt(er.test(e),e,n,"a valid domain"),e},tr=function(e,n){return Lt(st(e),e,n,"an integer"),e},rr=function(e,n){return Lt(it(e),e,n,"a number"),e},or=function(e){try{return null!==RegExp(e)}catch(e){return!1}},ar=function(e,n){return Lt(or(e),e,n,"a regular expression"),e},ir=function(e,n){if(null==e)throw new Error("'".concat(n,"' is a required option"));return e},sr=function(e,n){return Lt(dt(e),e,n,"a string"),e},cr=function(e){return function(n,t){return Lt(e.test(n),n,t,"does not match the ".concat(e.toString())),n}},dr=function(e){return e};dr.default=function(e){return jt(this,Ft(e))},dr.required=function(){return jt(this,ir)},dr.deprecated=function(e){return jt(this,Bt(e))};var lr=function(){return At(this,nr)},ur=function(e){return At(this,zt("an integer",e))},pr=function(e){return At(this,zt("a number",e))},fr=function(e){return At(this,Qt("a number",e))},mr=function(){return At(this,tr,{minimum:ur})},gr=function(){return At(this,$t("a non-empty string"))},vr=function(){return At(this,$t("a non-empty array"))},hr=function(){return At(this,$t("a non-empty object"))},yr=function(){return At(this,ar)},br=function(e){return At(this,cr(e))},wr=function(){return At(this,Xt())},Er=function(){return At(this,Zt())},Sr=function(){return this},xr=function(e){return At(this,qt(e),{nonEmpty:vr,uniqueItems:Er})},Cr=function(){return At(this,Vt)},Pr=function(){return At(this,Mt)},Ir=function(e){return At(this,Ht(e))},kr=function(){return At(this,rr,{minimum:pr,maximum:fr,integer:mr,unique:wr})},Dr=function(e){return At(this,Wt(e),{nonEmpty:hr})},Tr=function e(n){return{noUnknownFields:function(){return At(this,Jt(n))},nonEmpty:hr,concat:function(t){var r=u(u({},n),t.schema);return At(this,t,e(r))},renamed:function(e,n,t){return _t(this,Kt(e,n,t))},schema:n}},Or=function(e){return At(this,Gt(e),Tr(e))},Nr=function(){return At(this,sr,{regexp:yr,domain:lr,nonEmpty:gr,unique:wr,matches:br})},Rr=function(e,n){return jt(this,Ut(e,n))}.bind(dr),jr=Sr.bind(dr),Ar=xr.bind(dr),_r=Cr.bind(dr),Lr=Pr.bind(dr),Vr=Ir.bind(dr),Mr=kr.bind(dr),Ur=Dr.bind(dr),qr=Or.bind(dr),Fr=Nr.bind(dr),Br=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return Rr(n.map(Vr),"one of these values: [".concat(JSON.stringify(n),"]"))},Hr=Ur(Ar(qr({authenticatedState:Br("ambiguous","authenticated","loggedOut"),id:Fr(),namespace:qr({code:Fr()}).noUnknownFields(),primary:_r(),xid:Fr()}).noUnknownFields()).required()),Wr=qr({}),zr=function(e){return Object.keys(e).map((function(n){return e[n]}))},Qr="alloy_debug",Jr=function(e){var n=e.console,t=e.locationSearch,r=e.createLogger,o=e.instanceName,a=e.createNamespacedStorage,i=e.getMonitors,s=ge.default.parse(t),c=a("instance.".concat(o,".")),d=c.session.getItem("debug"),l="true"===d,u=null===d,p=function(){return l},f=function(e,n){var t=n.fromConfig;t&&!u||(l=e),t||(c.session.setItem("debug",e.toString()),u=!1)};return void 0!==s[Qr]&&f(xt(s[Qr]),{fromConfig:!1}),{setDebugEnabled:f,logger:r({getDebugEnabled:p,context:{instanceName:o},getMonitors:i,console:n}),createComponentLogger:function(e){return r({getDebugEnabled:p,context:{instanceName:o,componentName:e},getMonitors:i,console:n})}}},$r=["onComponentsRegistered","onBeforeEvent","onBeforeRequest","onResponse","onRequestFailure","onClick","onDecision"],Gr=function(e,n){return function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Promise.all(e.getLifecycleCallbacks(n).map((function(e){return new Promise((function(n){n(e.apply(void 0,r))}))})))}},Kr=function(e){return function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Promise.resolve().then((function(){return e.apply(void 0,t)}))}},Xr=function(e){return $r.reduce((function(n,t){return n[t]=Kr(Gr(e,t)),n}),{})},Yr=function(e,n){return function(){var t;try{t=e.apply(void 0,arguments)}catch(e){throw St({error:e,message:n})}return t instanceof Promise&&(t=t.catch((function(e){throw St({error:e,message:n})}))),t}},Zr=function(){var e={},n={},t={},r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=ot(Object.keys(n),Object.keys(t));if(r.length)throw new Error("[ComponentRegistry] Could not register ".concat(e," ")+"because it has existing command(s): ".concat(r.join(",")));Object.keys(t).forEach((function(r){var o=t[r];o.commandName=r,o.run=Yr(o.run,"[".concat(e,"] An error occurred while executing the ").concat(r," command.")),n[r]=o}))},o=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(n).forEach((function(r){t[r]=t[r]||[],t[r].push(Yr(n[r],"[".concat(e,"] An error occurred while executing the ").concat(r," lifecycle hook.")))}))};return{register:function(n,t){var a=t.commands,i=t.lifecycle;r(n,a),o(n,i),e[n]=t},getCommand:function(e){return n[e]},getCommandNames:function(){return Object.keys(n)},getLifecycleCallbacks:function(e){return t[e]||[]},getComponentNames:function(){return Object.keys(e)}}},eo=function(e){var n=e.logger,t=e.sendFetchRequest,r=e.sendBeaconRequest,o=e.isRequestRetryable,a=e.getRequestRetryDelay;return function(e){var i=e.requestId,s=e.url,c=e.payload,d=e.useSendBeacon,l=JSON.stringify(c),p=JSON.parse(l);n.logOnBeforeNetworkRequest({url:s,requestId:i,payload:p});var f=function e(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(d?r:t)(s,l).then((function(t){var r;if(o({response:t,retriesAttempted:c})){var d=a({response:t,retriesAttempted:c});return new Promise((function(n){setTimeout((function(){n(e(c+1))}),d)}))}try{r=JSON.parse(t.body)}catch(e){}return n.logOnNetworkResponse(u(u({requestId:i,url:s,payload:p},t),{},{parsedBody:r,retriesAttempted:c})),{statusCode:t.statusCode,body:t.body,parsedBody:r,getHeader:t.getHeader}}))};return f().catch((function(e){throw n.logOnNetworkError({requestId:i,url:s,payload:p,error:e}),St({error:e,message:"Network request failed."})}))}},no=function(e){var n=e.logger;return function(e){if(e){var t=e.split(";");if(t.length>=2&&t[1].length>0)try{var r=parseInt(t[1],10);if(!isNaN(r))return{regionId:r}}catch(e){}n.warn('Invalid adobe edge: "'.concat(e,'"'))}return{}}},to="in",ro="out",oo="pending",ao="general",io="declinedConsent",so="default",co="initial",lo="new",uo=function(e){var n=new Error(e);return n.code=io,n.message=e,n},po=function(e){var n=e.logger,t=[],r=function(){for(;t.length;)t.shift().resolve()},o=function(){for(;t.length;)t.shift().reject(uo("The user declined consent."))},a=function(){return Promise.resolve()},i=function(){return Promise.resolve()},s=function(){return Promise.reject(uo("No consent preferences have been set."))},c=function(){return Promise.reject(uo("The user declined consent."))},d=function(e){if(e)return Promise.reject(new Error("Consent is pending."));var n=ze();return t.push(n),n.promise};return{in:function(e){e===so?this.awaitConsent=a:(e===co?n.info("Loaded user consent preferences. The user previously consented."):e===lo&&this.awaitConsent!==i&&n.info("User consented."),r(),this.awaitConsent=i)},out:function(e){e===so?(n.warn("User consent preferences not found. Default consent of out will be used."),this.awaitConsent=s):(e===co?n.warn("Loaded user consent preferences. The user previously declined consent."):e===lo&&this.awaitConsent!==c&&n.warn("User declined consent."),o(),this.awaitConsent=c)},pending:function(e){e===so&&n.info("User consent preferences not found. Default consent of pending will be used. Some commands may be delayed."),this.awaitConsent=d},awaitConsent:function(){return Promise.reject(new Error("Consent has not been initialized."))},withConsent:function(){return this.awaitConsent(!0)},current:function(){switch(this.awaitConsent){case a:return{state:"in",wasSet:!1};case i:return{state:"in",wasSet:!0};case s:return{state:"out",wasSet:!1};case c:return{state:"out",wasSet:!0};case d:return{state:"pending",wasSet:!1};default:return{state:"in",wasSet:!1}}}}},fo=function(e){var n=e.generalConsentState,t=e.logger,r=function(e,r){switch(e[ao]){case to:n.in(r);break;case ro:n.out(r);break;case oo:n.pending(r);break;default:t.warn("Unknown consent value: ".concat(e[ao]))}};return{initializeConsent:function(e,n){n[ao]?r(n,co):r(e,so)},setConsent:function(e){r(e,lo)},suspend:function(){n.pending()},awaitConsent:function(){return n.awaitConsent()},withConsent:function(){return n.withConsent()},current:function(){return n.current()}}},mo=function(e){return e&&e._experience&&e._experience.decisioning&&ln(e._experience.decisioning.propositions)?e._experience.decisioning.propositions:[]},go=function(){var e,n,t={},r=!1,o=!1,a=!0,i=function(e){if(o)throw new Error("".concat(e," cannot be called after event is finalized."))},s={hasQuery:function(){return Object.prototype.hasOwnProperty.call(this.getContent(),"query")},getContent:function(){var r=JSON.parse(JSON.stringify(t));return e&&Ue(r,{xdm:e}),n&&Ue(r,{data:n}),r},setUserXdm:function(n){i("setUserXdm"),e=n},setUserData:function(e){i("setUserData"),n=e},mergeXdm:function(e){i("mergeXdm"),e&&Ue(t,{xdm:e})},mergeData:function(e){i("mergeData"),e&&Ue(t,{data:e})},mergeMeta:function(e){i("mergeMeta"),e&&Ue(t,{meta:e})},mergeQuery:function(e){i("mergeQuery"),e&&Ue(t,{query:e})},documentMayUnload:function(){r=!0},finalize:function(r){if(!o){var i=$e([].concat(g(mo(e)),g(mo(t.xdm))),(function(e,n){return e===n||e.id&&n.id&&e.id===n.id&&e.scope&&n.scope&&e.scope===n.scope}));if(e&&this.mergeXdm(e),i.length>0&&(t.xdm._experience.decisioning.propositions=i),n&&s.mergeData(n),o=!0,r){a=!1;var c={xdm:t.xdm||{},data:t.data||{}},d=r(c);a=!1!==d,t.xdm=c.xdm||{},t.data=c.data||{},Fn(t.xdm)&&delete t.xdm,Fn(t.data)&&delete t.data}}},getDocumentMayUnload:function(){return r},isEmpty:function(){return Fn(t)&&(!e||Fn(e))&&(!n||Fn(n))},shouldSend:function(){return a},getViewName:function(){if(e&&e.web&&e.web.webPageDetails)return e.web.webPageDetails.viewName},toJSON:function(){if(!o)throw new Error("toJSON called before finalize");return t}};return s},vo="Retry-After",ho="x-adobe-edge",yo=function(e){var n=e.extractEdgeInfo;return function(e){var t=e.content,r=void 0===t?{}:t,o=e.getHeader,a=r.handle,i=void 0===a?[]:a,s=r.errors,c=void 0===s?[]:s,d=r.warnings,l=void 0===d?[]:d;return{getPayloadsByType:function(e){return Hn(i.filter((function(n){return n.type===e})),(function(e){return e.payload}))},getErrors:function(){return c},getWarnings:function(){return l},getEdge:function(){return n(o(ho))},toJSON:function(){return r}}}},bo="configure",wo="setDebug",Eo=function(e){var n,t=e.logger,r=e.configureCommand,o=e.setDebugCommand,a=e.handleError,i=e.validateCommandOptions,s=function(e,a){var s;if(e===bo){if(n)throw new Error("The library has already been configured and may only be configured once.");s=function(){return(n=r(a)).then((function(){}))}}else{if(!n)throw new Error("The library must be configured first. Please do so by executing the configure command.");s=e===wo?function(){return o(a)}:function(){return n.then((function(n){var t=n.getCommand(e);if(!t||!dn(t.run)){var r=[bo,wo].concat(n.getCommandNames()).join(", ");throw new Error("The ".concat(e," command does not exist. List of available commands: ").concat(r,"."))}var o=i({command:t,options:a});return t.run(o)}),(function(){return t.warn("An error during configuration is preventing the ".concat(e," command from executing.")),new Promise((function(){}))}))}}return s};return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r){var o=s(e,n);t.logOnBeforeCommand({commandName:e,options:n}),r(o())})).catch((function(n){return a(n,"".concat(e," command"))})).catch((function(r){throw t.logOnCommandRejected({commandName:e,options:n,error:r}),r})).then((function(r){var o=Ae(r)?r:{};return t.logOnCommandResolved({commandName:e,options:n,result:o}),o}))}},So="https://adobe.ly/3sHgQHb",xo=function(e){var n=e.command,t=e.options,r=n.commandName,o=n.documentationUri,a=void 0===o?So:o,i=n.optionsValidator,s=t;if(i)try{s=i(t)}catch(e){var c="Invalid ".concat(r," command options:\n\t - ").concat(e," For command documentation see: ").concat(a);throw new Error(c)}return s},Co=function(e){var n=e.options;return qr({type:Fr(),xdm:qr({eventType:Fr(),identityMap:Hr}),data:qr({}),documentUnloading:_r(),renderDecisions:_r(),decisionScopes:Ar(Fr()).uniqueItems(),personalization:qr({decisionScopes:Ar(Fr()).uniqueItems(),surfaces:Ar(Fr()).uniqueItems(),sendDisplayEvent:_r().default(!0),includeRenderedPropositions:_r().default(!1),defaultPersonalizationEnabled:_r(),decisionContext:qr({})}).default({sendDisplayEvent:!0}),datasetId:Fr(),mergeId:Fr(),edgeConfigOverrides:Wr,initializePersonalization:_r()}).required().noUnknownFields()(n)},Po=function(e){var n=e.options;return qr({renderDecisions:_r(),responseHeaders:Ur(Fr().required()),responseBody:qr({handle:Ar(qr({type:Fr().required(),payload:jr().required()})).required()}).required(),personalization:qr({sendDisplayEvent:_r().default(!0),decisionContext:qr({})}).default({sendDisplayEvent:!0})}).noUnknownFields()(n)},Io=function(e){var n=e.eventManager,t=e.logger;return{commands:{sendEvent:{documentationUri:"https://adobe.ly/3GQ3Q7t",optionsValidator:function(e){return Co({options:e})},run:function(e){var r=e.xdm,a=e.data,i=e.documentUnloading,s=e.type,c=e.mergeId,d=e.datasetId,l=e.edgeConfigOverrides,u=o(e,he),p=n.createEvent();return i&&p.documentMayUnload(),p.setUserXdm(r),p.setUserData(a),s&&p.mergeXdm({eventType:s}),c&&p.mergeXdm({eventMergeId:c}),l&&(u.edgeConfigOverrides=l),d&&(t.warn("The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead."),u.edgeConfigOverrides=l||{},Ue(u.edgeConfigOverrides,{com_adobe_experience_platform:{datasets:{event:{datasetId:d}}}})),n.sendEvent(p,u)}},applyResponse:{documentationUri:"",optionsValidator:function(e){return Po({options:e})},run:function(e){var t=e.renderDecisions,r=void 0!==t&&t,o=e.decisionContext,a=void 0===o?{}:o,i=e.responseHeaders,s=void 0===i?{}:i,c=e.responseBody,d=void 0===c?{handle:[]}:c,l=e.personalization,u=n.createEvent();return n.applyResponse(u,{renderDecisions:r,decisionContext:a,responseHeaders:s,responseBody:d,personalization:l})}}}}};Io.namespace="DataCollector";var ko,Do=function(e){var n=e.eventManager,t=e.lifecycle,r=e.handleError;return function(e){if(e.s_fe)return Promise.resolve();var o=e.target,a=n.createEvent();return a.documentMayUnload(),t.onClick({event:a,clickedElement:o}).then((function(){return a.isEmpty()?Promise.resolve():n.sendEvent(a)})).then(pt).catch((function(e){r(e,"click collection")}))}},To=function(e){var n=e.eventManager,t=e.lifecycle,r=e.handleError,o=Do({eventManager:n,lifecycle:t,handleError:r});document.addEventListener("click",o,!0)},Oo=Fr().regexp().default("\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$"),No=qr({clickCollectionEnabled:_r().default(!0),clickCollection:qr({internalLinkEnabled:_r().default(!0),externalLinkEnabled:_r().default(!0),downloadLinkEnabled:_r().default(!0),sessionStorageEnabled:_r().default(!1),eventGroupingEnabled:_r().default(!1),filterClickProperties:Lr()}).default({internalLinkEnabled:!0,externalLinkEnabled:!0,downloadLinkEnabled:!0,sessionStorageEnabled:!1,eventGroupingEnabled:!1}),downloadLinkQualifier:Oo,onBeforeLinkClickSend:Lr().deprecated('The field "onBeforeLinkClickSend" has been deprecated. Use "clickCollection.filterClickDetails" instead.')}),Ro="cppXYctnr",jo=function(){return null!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).getElementById(Ro)},Ao=function(e){var n=e;return/^https?:\/\//i.test(n)||(n="".concat(window.location.protocol,"//").concat(e)),new URL(n).hostname},_o=function(e,n){return Ao(e)!==Ao(n)},Lo=function(e,n){return n&&("download"===n&&!e.downloadLinkEnabled||"exit"===n&&!e.externalLinkEnabled||"other"===n&&!e.internalLinkEnabled)},Vo=function(e){var n=e.config,t=e.logger,r=e.getClickedElementProperties,o=e.clickActivityStorage,a=n.clickCollectionEnabled,i=n.clickCollection;return a?function(e){var a=e.event,s=e.clickedElement,c=r({clickActivityStorage:o,clickedElement:s,config:n,logger:t}),d=c.linkType;jo()||(c.isValidLink()&&Lo(i,d)?t.info("Cancelling link click event due to clickCollection.".concat(d,"LinkEnabled = false.")):!c.isInternalLink()||!i.eventGroupingEnabled||n.onBeforeLinkClickSend&&!i.filterClickDetails||_o(window.location.hostname,c.linkUrl)?c.isValidLink()?(a.mergeXdm(c.xdm),a.mergeData(c.data),o.save({pageName:c.pageName,pageIDType:c.pageIDType})):c.isValidActivityMapData()&&o.save(c.properties):o.save(c.properties))}:function(){}},Mo=function(e){return{eventType:"web.webinteraction.linkClicks",web:{webInteraction:{name:e.linkName,region:e.linkRegion,type:e.linkType,URL:e.linkUrl,linkClicks:{value:1}}}}},Uo=function(e){return{__adobe:{analytics:{contextData:{a:{activitymap:{page:e.pageName,link:e.linkName,region:e.linkRegion,pageIDType:e.pageIDType}}}}}}},qo=function(e,n){var t=e.xdm,r=e.data,o=e.clickedElement;if(n.clickedElement=o,t&&t.web&&t.web.webInteraction){var a=t.web.webInteraction,i=a.name,s=a.region,c=a.type,d=a.URL;n.linkName=i,n.linkRegion=s,n.linkType=c,n.linkUrl=d}if(r&&r.__adobe&&r.__adobe.analytics){var l=r.__adobe.analytics.contextData;if(l&&l.a&&l.a.activitymap){var u=l.a.activitymap,p=u.page,f=u.link,m=u.region,g=u.pageIDType;n.pageName=p||n.pageName,n.linkName=f||n.linkName,n.linkRegion=m||n.linkRegion,void 0!==g&&(n.pageIDType=g)}}},Fo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.properties,t=e.logger,r=n||{};return{get pageName(){return r.pageName},set pageName(e){r.pageName=e},get linkName(){return r.linkName},set linkName(e){r.linkName=e},get linkRegion(){return r.linkRegion},set linkRegion(e){r.linkRegion=e},get linkType(){return r.linkType},set linkType(e){r.linkType=e},get linkUrl(){return r.linkUrl},set linkUrl(e){r.linkUrl=e},get pageIDType(){return r.pageIDType},set pageIDType(e){r.pageIDType=e},get clickedElement(){return r.clickedElement},set clickedElement(e){r.clickedElement=e},get properties(){return{pageName:r.pageName,linkName:r.linkName,linkRegion:r.linkRegion,linkType:r.linkType,linkUrl:r.linkUrl,pageIDType:r.pageIDType}},isValidLink:function(){return!!(r.linkUrl&&r.linkType&&r.linkName&&r.linkRegion)},isInternalLink:function(){return this.isValidLink()&&"other"===r.linkType},isValidActivityMapData:function(){return!!r.pageName&&!!r.linkName&&!!r.linkRegion&&void 0!==r.pageIDType},get xdm(){return r.filteredXdm?r.filteredXdm:Mo(this)},get data(){return r.filteredData?r.filteredData:Uo(this)},applyPropertyFilter:function(e){e&&!1===e(r)&&(t&&t.info("Clicked element properties were rejected by filter function: ".concat(JSON.stringify(this.properties,null,2))),r={})},applyOptionsFilter:function(e){var n=this.options;if(n&&n.clickedElement&&(n.xdm||n.data)){if(e&&!1===e(n))return t&&t.info("Clicked element properties were rejected by filter function: ".concat(JSON.stringify(this.properties,null,2))),void(this.options=void 0);this.options=n,r.filteredXdm=n.xdm,r.filteredData=n.data}},get options(){var e={};if(this.isValidLink()&&(e.xdm=this.xdm),this.isValidActivityMapData()&&(e.data=this.data),this.clickedElement&&(e.clickedElement=this.clickedElement),e.xdm||e.data)return e},set options(e){r={},e&&qo(e,r)}}},Bo=function(e){var n=e.clickActivityStorage;return function(e){if(!jo()){var t=n.load(),r=Fo({properties:t});if(r.isValidLink()||r.isValidActivityMapData()){if(r.isValidLink()){var o=r.xdm;delete o.eventType,e.mergeXdm(o)}r.isValidActivityMapData()&&e.mergeData(r.data),n.save({pageName:r.pageName,pageIDType:r.pageIDType})}}}},Ho=function(e){var n=e.window,t=e.getLinkName,r=e.getLinkRegion,o=e.getAbsoluteUrlFromAnchorElement,a=e.findClickableElement,i=e.determineLinkType;return function(e){var s=e.clickedElement,c=e.config,d=e.logger,l=e.clickActivityStorage,u=c.onBeforeLinkClickSend,p=c.clickCollection.filterClickDetails,f=Fo({logger:d});if(s){var m=a(s);if(m){f.clickedElement=s,f.linkUrl=o(n,m),f.linkType=i(n,c,f.linkUrl,m),f.linkRegion=r(m),f.linkName=t(m),f.pageIDType=0,f.pageName=n.location.href;var g=l.load();g&&g.pageName&&(f.pageName=g.pageName,f.pageIDType=1),p?f.applyPropertyFilter(p):u&&f.applyOptionsFilter(u)}}return f}},Wo="clickData",zo=function(e){var n=e.storage;return{save:function(e){var t=JSON.stringify(e);n.setItem(Wo,t)},load:function(){var e=null,t=n.getItem(Wo);return t&&(e=JSON.parse(t)),e},remove:function(){n.removeItem(Wo)}}},Qo=function(e){var n=e.clickActivityStorage;return function(e){n.save({pageName:e.getContent().xdm.web.webPageDetails.name,pageIDType:1})}},Jo=function(e){return e&&e.replace(/\s+/g," ").trim()},$o=/^(SCRIPT|STYLE|LINK|CANVAS|NOSCRIPT|#COMMENT)$/i,Go=function(e){return!(e&&e.nodeName&&e.nodeName.match($o))},Ko=function e(n){var t=[],r=!1;return Go(n)?(t.push(n),n.childNodes&&Array.prototype.slice.call(n.childNodes).forEach((function(n){var o=e(n);t=t.concat(o.supportedNodes),r=r||o.includesUnsupportedNodes}))):r=!0,{supportedNodes:t,includesUnsupportedNodes:r}},Xo=function(e,n,t){var r;return t&&t!==e.nodeName.toUpperCase()||(r=e.getAttribute(n)),r},Yo=function(e){var n={texts:[]};return e.supportedNodes.forEach((function(e){e.getAttribute&&(n.alt||(n.alt=Jo(e.getAttribute("alt"))),n.title||(n.title=Jo(e.getAttribute("title"))),n.inputValue||(n.inputValue=Jo(Xo(e,"value","INPUT"))),n.imgSrc||(n.imgSrc=Jo(Xo(e,"src","IMG")))),e.nodeValue&&n.texts.push(e.nodeValue)})),n},Zo=/^(HEADER|MAIN|FOOTER|NAV)$/i,ea=function(e){var n;return"region"===e.role&&lt(e["aria-label"])&&(n=e["aria-label"]),n},na=function(e){var n;return e&&e.nodeName&&e.nodeName.match(Zo)&&(n=e.nodeName),n},ta=function(e){return!!e&&/^[a-z0-9]+:\/\//i.test(e)},ra=function(e){return!(!e.href||"A"!==e.tagName&&"AREA"!==e.tagName||e.onclick&&e.protocol&&!(e.protocol.toLowerCase().indexOf("javascript")<0))},oa=function(e){return!!e&&!!e.onclick},aa=function(e){if("INPUT"===e.tagName){var n=e.getAttribute("type");if("submit"===n)return!0;if("image"===n&&e.src)return!0}return!1},ia=function(e){return"BUTTON"===e.tagName&&"submit"===e.type},sa=function(e){var n=e.indexOf("?"),t=e.indexOf("#");return n>=0&&(n<t||t<0)?e.substring(0,n):t>=0?e.substring(0,t):e},ca=function(e,n,t){var r=!1;if(n)if(t&&t.download)r=!0;else if(e){var o=new RegExp(e),a=sa(n).toLowerCase();r=o.test(a)}return r},da=function(e,n){var t=!1;if(n&&e.location.hostname){var r=e.location.hostname.toLowerCase();t=sa(n).toLowerCase().indexOf(r)<0}return t},la=function(e){var n=e.getContent();return void 0!==n.xdm&&void 0!==n.xdm.web&&void 0!==n.xdm.web.webPageDetails&&void 0!==n.xdm.web.webPageDetails.name},ua=function(){var e={};return{getItem:function(n){return e[n]},setItem:function(n,t){e[n]=t},removeItem:function(n){delete e[n]}}},pa=Ho({window:window,getLinkName:function(e){var n=Jo(e.innerText||e.textContent),t=Ko(e);if(!n||t.includesUnsupportedNodes){var r=Yo(t);(n=Jo(r.texts.join("")))||(n=r.alt||r.title||r.inputValue||r.imgSrc)}return n||""},getLinkRegion:function(e){for(var n,t=e.parentNode;t;){if(n=Jo(t.id||ea(t)||na(t)))return n;t=t.parentNode}return"BODY"},getAbsoluteUrlFromAnchorElement:function(e,n){var t=e.location,r=n.href||"";"string"!=typeof r&&(r="");var o=n.protocol,a=n.host;if(r&&!ta(r)){o||(o=t.protocol?t.protocol:""),o=o?"".concat(o,"//"):"",a||(a=t.host?t.host:"");var i=""
;if("/"!==r.substring(0,1)){var s=t.pathname.lastIndexOf("/");s=s<0?0:s,i=t.pathname.substring(0,s)}r="".concat(o).concat(a).concat(i,"/").concat(r)}return r},findClickableElement:function(e){for(var n=e;n;){if(ra(n)||oa(n)||aa(n)||ia(n))return n;n=n.parentNode}return null},determineLinkType:function(e,n,t,r){var o="other";return lt(t)&&(ca(n.downloadLinkQualifier,t,r)?o="download":da(e,t)&&(o="exit")),o}}),fa=function(e){var n=e.config,t=e.eventManager,r=e.handleError,o=e.logger,a=n.clickCollection,i=rt(window)(n.orgId||""),s=ua(),c=a.sessionStorageEnabled?i.session:s;ko=zo({storage:c});var d=Vo({config:n,logger:o,clickActivityStorage:ko,getClickedElementProperties:pa}),l=Bo({clickActivityStorage:ko}),u=Qo({clickActivityStorage:ko});return{lifecycle:{onComponentsRegistered:function(e){var n=e.lifecycle;To({eventManager:t,lifecycle:n,handleError:r})},onClick:function(e){var n=e.event,t=e.clickedElement;d({event:n,clickedElement:t})},onBeforeEvent:function(e){var n=e.event;la(n)&&(a.eventGroupingEnabled&&l(n),u(n,o,ko))}}}};fa.namespace="ActivityCollector",fa.configValidators=No,fa.buildOnInstanceConfiguredExtraParams=function(e){var n=e.config,t=e.logger;return{getLinkDetails:function(e){return pa({clickActivityStorage:ko,clickedElement:e,config:n,logger:t}).properties}}};var ma=function(e,n){return"ID sync ".concat(n?"succeeded":"failed",": ").concat(e.spec.url)},ga=function(e){var n=e.fireReferrerHideableImage,t=e.logger;return function(e){var r=e.filter((function(e){return"url"===e.type}));return r.length?Promise.all(r.map((function(e){return n(e.spec).then((function(){t.info(ma(e,!0))})).catch((function(){t.error(ma(e,!1))}))}))).then(pt):Promise.resolve()}},va=qr({thirdPartyCookiesEnabled:_r().default(!0),idMigrationEnabled:_r().default(!0)}),ha=qr({namespaces:Ar(Vr("ECID")).nonEmpty().uniqueItems().default(["ECID"]),edgeConfigOverrides:Wr}).noUnknownFields().default({namespaces:["ECID"]}),ya=qr({url:Fr().required().nonEmpty(),edgeConfigOverrides:Wr}).required().noUnknownFields(),ba=function(e){var n,t=e.addEcidQueryToPayload,r=e.addQueryStringIdentityToPayload,o=e.ensureSingleIdentity,a=e.setLegacyEcid,i=e.handleResponseForIdSyncs,s=e.getEcidFromResponse,c=e.getIdentity,d=e.consent,l=e.appendIdentityToUrl,u=e.logger,p={};return{lifecycle:{onBeforeRequest:function(e){var n=e.request,a=e.onResponse,i=e.onRequestFailure;return t(n.getPayload()),r(n.getPayload()),o({request:n,onResponse:a,onRequestFailure:i})},onResponse:function(e){var t=e.response;return n||(n=s(t))&&a(n),p=(0,me.default)(p,t.getEdge()),i(t)}},commands:{getIdentity:{optionsValidator:ha,run:function(e){return d.awaitConsent().then((function(){return n?void 0:c(e)})).then((function(){return{identity:{ECID:n},edge:p}}))}},appendIdentityToUrl:{optionsValidator:ya,run:function(e){return d.withConsent().then((function(){return n?void 0:c(e)})).then((function(){return{url:l(n,e.url)}})).catch((function(n){return u.warn("Unable to append identity to url. ".concat(n.message)),e}))}}}}},wa=function(e){var n=e.config,t=e.getEcidFromVisitor,r=e.apexDomain,o=e.isPageSsl,a=e.cookieJar,i=n.idMigrationEnabled,s=n.orgId,c="AMCV_".concat(s),d=function(){var e=null,n="s_ecid",t=a.get(n)||a.get(c);if(t){var r=/(^|\|)MCMID\|(\d+)($|\|)/,o=t.match(r);o&&(e=o[2])}return e};return{getEcid:function(){if(i){var e=d();return e?Promise.resolve(e):t()}return Promise.resolve()},setEcid:function(e){if(i&&d()!==e){var n=o?{sameSite:"none",secure:!0}:{};a.set(c,"MCMID|".concat(e),u({domain:r,expires:390},n))}}}},Ea=function(e){var n=e.logger;return new Promise((function(e,t){if(Ae(window.adobe)&&Ae(window.adobe.optIn)){var r=window.adobe.optIn;n.info("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server."),r.fetchPermissions((function(){r.isApproved([r.Categories.ECID])?(n.info("Received legacy opt-in approval to let Visitor retrieve ECID from server."),e()):t(new Error("Legacy opt-in was declined."))}),!0)}else e()}))},Sa=function(e){var n=e.Visitor;return dn(n)&&dn(n.getInstance)&&n},xa=function(e){var n=e.logger,t=e.orgId,r=e.awaitVisitorOptIn;return function(){var e=Sa(window);return e?r({logger:n}).then((function(){return n.info("Delaying request while using Visitor to retrieve ECID from server."),new Promise((function(r){e.getInstance(t,{}).getMarketingCloudVisitorID((function(e){n.info("Resuming previously delayed request that was waiting for ECID from Visitor."),r(e)}),!0)}))})).catch((function(e){e?n.info("".concat(e.message,", retrieving ECID from experience edge")):n.info("An error occurred while obtaining the ECID from Visitor.")})):Promise.resolve()}},Ca=function(e){var n=e.processIdSyncs;return function(e){return n(e.getPayloadsByType("identity:exchange"))}},Pa=function(e){var n,t=e.doesIdentityCookieExist,r=e.setDomainForInitialIdentityPayload,o=e.addLegacyEcidToPayload,a=e.awaitIdentityCookie,i=e.logger,s=function(e){return r(e),o(e.getPayload())};return function(e){var r=e.request,o=e.onResponse,c=e.onRequestFailure;if(t())return r.setIsIdentityEstablished(),Promise.resolve();if(n){i.info("Delaying request while retrieving ECID from server.");var d=n;return n=d.catch((function(){return a({onResponse:o,onRequestFailure:c})})),d.then((function(){i.info("Resuming previously delayed request."),r.setIsIdentityEstablished()})).catch((function(){return s(r)}))}return(n=a({onResponse:o,onRequestFailure:c})).catch((function(){})),s(r)}},Ia="ECID",ka=function(e){e.mergeQuery({identity:{fetch:[Ia]}})},Da=function(e){return function(n){for(var t=Object.keys(e),r=0;r<t.length;r+=1){var o=t[r];if(e[o].test(n))return o}return Te}},Ta=ut((function(e){return Da(p(p(p(p(p(p({},Ce,/Edge\/([0-9\._]+)/),Pe,/Edg\/([0-9\.]+)/),xe,/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/),Ie,/Firefox\/([0-9\.]+)(?:\s|$)/),ke,/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/),De,/Version\/([0-9\._]+).*Safari/))(e.navigator.userAgent)})),Oa=function(e){var n=e.thirdPartyCookiesEnabled,t=e.areThirdPartyCookiesSupportedByDefault;return function(e){n&&t(Ta(window))&&e.setUseIdThirdPartyDomain()}},Na=function(e){var n=e.getLegacyEcid,t=e.addEcidToPayload;return function(e){return e.hasIdentity(Ia)?Promise.resolve():n().then((function(n){n&&t(e,n)}))}},Ra="adobe_mc",ja=300,Aa=function(e){var n=e.locationSearch,t=e.dateProvider,r=e.orgId,o=e.logger;return function(e){if(!e.hasIdentity(Ia)){var a=ge.default.parse(n)[Ra];if(void 0!==a){Array.isArray(a)&&(o.warn("Found multiple adobe_mc query string paramters, only using the last one."),a=a[a.length-1]);var s=a.split("|").reduce((function(e,n){var t=i(n.split("="),2),r=t[0],o=t[1];return e[r]=o,e}),{}),c=parseInt(s.TS,10),d=s.MCMID,l=decodeURIComponent(s.MCORGID);t().getTime()/1e3<=c+ja&&l===r&&d?(o.info("Found valid ECID identity ".concat(d," from the adobe_mc query string parameter.")),e.addIdentity(Ia,{id:d})):o.info("Detected invalid or expired adobe_mc query string parameter.")}}}},_a=function(e,n){e.addIdentity(Ia,{id:n})},La=function(e){var n=e.doesIdentityCookieExist,t=e.orgId,r=e.logger;return function(e){var o=e.onResponse,a=e.onRequestFailure;return new Promise((function(e,i){o((function(){n()?e():(r.warn("Identity cookie not found. This could be caused by any of the following issues:\n"+"\t* The org ID ".concat(t," configured in Alloy doesn't match the org ID specified in the edge configuration.\n")+"\t* Experience edge was not able to set the identity cookie due to domain or cookie restrictions.\n\t* The request was canceled by the browser and not fully processed."),i(new Error("Identity cookie not found.")))})),a((function(){n()?e():i(new Error("Identity cookie not found."))}))}))}},Va=function(e){var n=e.getPayloadsByType("identity:result"),t=Ke(n,(function(e){return e.namespace&&e.namespace.code===Ia}));return t?t.id:void 0},Ma=function(e){return function(n,t){e.xdm=e.xdm||{},e.xdm.identityMap=e.xdm.identityMap||{},e.xdm.identityMap[n]=e.xdm.identityMap[n]||[],e.xdm.identityMap[n].push(t)}},Ua=function(e){var n=e.payload,t=e.getAction,r=e.getUseSendBeacon,o=e.datastreamIdOverride,a=e.edgeSubPath,i=k(),s=!1,c=!1;return{getId:function(){return i},getPayload:function(){return n},getAction:function(){return t({isIdentityEstablished:c})},getDatastreamIdOverride:function(){return o},getUseSendBeacon:function(){return r({isIdentityEstablished:c})},getEdgeSubPath:function(){return a||""},getUseIdThirdPartyDomain:function(){return s},setUseIdThirdPartyDomain:function(){s=!0},setIsIdentityEstablished:function(){c=!0}}},qa=function(e){var n=e.payload,t=e.datastreamIdOverride,r=function(e){var t=e.isIdentityEstablished;return n.getDocumentMayUnload()&&t};return Ua({payload:n,getAction:function(e){var n=e.isIdentityEstablished;return r({isIdentityEstablished:n})?"collect":"interact"},getUseSendBeacon:r,datastreamIdOverride:t})},Fa=function(e){var n=e.content,t=e.addIdentity,r=e.hasIdentity,o=qe(n,"meta.configOverrides");return{mergeMeta:qe(n,"meta"),mergeState:qe(n,"meta.state"),mergeQuery:qe(n,"query"),mergeConfigOverride:function(e){return o(bt(e))},addIdentity:t,hasIdentity:r,toJSON:function(){return n}}},Ba=function(e){return function(n){return void 0!==(e.xdm&&e.xdm.identityMap&&e.xdm.identityMap[n])}},Ha=function(){var e={},n=Fa({content:e,addIdentity:Ma(e),hasIdentity:Ba(e)});return n.addEvent=function(n){e.events=e.events||[],e.events.push(n)},n.getDocumentMayUnload=function(){return(e.events||[]).some((function(e){return e.getDocumentMayUnload()}))},n},Wa=function(e){var n=e.localConfigOverrides,t=e.globalConfigOverrides,r=e.payload,a={payload:r},i=n||{},s=i.datastreamId,c=o(i,ye);return s&&(a.datastreamIdOverride=s),r.mergeConfigOverride(t),r.mergeConfigOverride(c),a},za="adb_validation_sessionid",Qa="validation.",Ja="clientId",$a=function(e){var n=e.persistent.getItem(Ja);return n||(n=k(),e.persistent.setItem(Ja,n)),n},Ga=function(e){var n=e.window,t=(0,e.createNamespacedStorage)(Qa);return function(){var e=ge.default.parse(n.location.search)[za];if(!e)return"";var r=$a(t),o="".concat(e,"|").concat(r);return"&".concat(ge.default.stringify({adobeAepValidationToken:o}))}},Ka=function(e){var n=e.sendEdgeNetworkRequest,t=e.createIdentityRequestPayload,r=e.createIdentityRequest,o=e.globalConfigOverrides;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.namespaces,i=e.edgeConfigOverrides,s=Wa({payload:t(a),globalConfigOverrides:o,localConfigOverrides:i}),c=r(s);return n({request:c})}},Xa=function(e){var n=e.payload,t=e.datastreamIdOverride;return Ua({payload:n,datastreamIdOverride:t,getAction:function(){return"identity/acquire"},getUseSendBeacon:function(){return!1}})},Ya=function(e){var n={query:{identity:{fetch:e}}};return Fa({content:n,addIdentity:Ma(n),hasIdentity:Ba(n)})},Za=/^([^?#]*)(\??[^#]*)(#?.*)$/,ei=function(e){return""===e?"?":"?"===e?"":"&"},ni=function(e){var n=e.dateProvider,t=e.orgId;return function(e,r){var o=Math.round(n().getTime()/1e3),a=encodeURIComponent("TS=".concat(o,"|MCMID=").concat(e,"|MCORGID=").concat(encodeURIComponent(t))),s=i(r.match(Za),4),c=s[1],d=s[2],l=s[3],u=ei(d);return"".concat(c).concat(d).concat(u,"adobe_mc=").concat(a).concat(l)}},ti=function(e){var n=e.config,t=e.logger,r=e.consent,o=e.fireReferrerHideableImage,a=e.sendEdgeNetworkRequest,i=e.apexDomain,s=n.orgId,c=n.thirdPartyCookiesEnabled,d=n.edgeConfigOverrides,l=xa({logger:t,orgId:s,awaitVisitorOptIn:Ea}),u=Be({logger:t,cookieJar:Ve}),p=wa({config:n,getEcidFromVisitor:l,apexDomain:i,cookieJar:u,isPageSsl:"https:"===window.location.protocol}),f=nt({orgId:s}),m=Ka({sendEdgeNetworkRequest:a,createIdentityRequestPayload:Ya,createIdentityRequest:Xa,globalConfigOverrides:d}),g=Oa({thirdPartyCookiesEnabled:c,areThirdPartyCookiesSupportedByDefault:Re}),v=Na({getLegacyEcid:p.getEcid,addEcidToPayload:_a}),h=Aa({locationSearch:window.document.location.search,dateProvider:function(){return new Date},orgId:s,logger:t}),y=La({doesIdentityCookieExist:f,orgId:s,logger:t}),b=Pa({doesIdentityCookieExist:f,setDomainForInitialIdentityPayload:g,addLegacyEcidToPayload:v,awaitIdentityCookie:y,logger:t}),w=ga({fireReferrerHideableImage:o,logger:t}),E=Ca({processIdSyncs:w}),S=ni({dateProvider:function(){return new Date},orgId:s,globalConfigOverrides:d});return ba({addEcidQueryToPayload:ka,addQueryStringIdentityToPayload:h,ensureSingleIdentity:b,setLegacyEcid:p.setEcid,handleResponseForIdSyncs:E,getEcidFromResponse:Va,getIdentity:m,consent:r,appendIdentityToUrl:S,logger:t,config:n})};ti.namespace="Identity",ti.configValidators=va;var ri=function(e){return"URL destination ".concat("succeeded",": ",e.spec.url)},oi=function(e){var n=e.fireReferrerHideableImage,t=e.logger,r=e.cookieJar,o=e.isPageSsl?{sameSite:"none",secure:!0}:{},a=function(e){e.filter((function(e){return"cookie"===e.type})).forEach((function(e){var n=e.spec,t=n.name,a=n.value,i=n.domain,s=n.ttlDays;r.set(t,a||"",u({domain:i||"",expires:s||10},o))}))},i=function(e){var r=e.filter((function(e){return"url"===e.type}));return Promise.all(r.map((function(e){return n(e.spec).then((function(){t.info(ri(e))})).catch((function(){}))}))).then(pt)};return function(e){return a(e),i(e)}},ai=function(e){var n=e.processDestinations,t=function(e){var t=e.response.getPayloadsByType("activation:push");return n(t)},r=function(e){return{destinations:e.response.getPayloadsByType("activation:pull")}};return function(e){var n=e.response;return t({response:n}).then((function(){return r({response:n})}))}},ii=function(e){var n=e.logger,t=e.fireReferrerHideableImage,r=Ve.withConverter({write:function(e){return encodeURIComponent(e)}}),o=Be({logger:n,cookieJar:r}),a=oi({fireReferrerHideableImage:t,logger:n,cookieJar:o,isPageSsl:"https:"===window.location.protocol});return{lifecycle:{onResponse:ai({processDestinations:a})},commands:{}}};ii.namespace="Audiences";var si="web",ci="webapp",di="://",li="#",ui=/^(\w+):\/\/([^/#]+)(\/[^#]*)?(#.*)?$/,pi=/^(?:.*@)?(?:[a-z\d\u00a1-\uffff.-]+|\[[a-f\d:]+])(?::\d+)?$/,fi=/^\/(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})*$/,mi=/^#(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})+$/,gi=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=e.length;n>0&&-1!=="/".indexOf(e.charAt(n-1));)n-=1;return e.substring(0,n)||"/"},vi=function(e){return lt(e)?e.toLowerCase():""},hi=function(e){return lt(e)?e.toLowerCase():""},yi=function(e){return lt(e)?gi(e):"/"},bi=function(e){var n=e.match(ui);return n?{surfaceType:vi(n[1]),authority:hi(n[2]),path:yi(n[3]),fragment:n[4]}:null},wi=function(e){return"".concat(e.surfaceType).concat(di).concat(e.authority).concat(e.path||"").concat(e.fragment||"")},Ei=function(e){var n=e(),t=n.host.toLowerCase(),r=n.pathname;return si+di+t+gi(r)},Si=function(e,n){return mn(e,li)?Ei(n)+e:e},xi=function(e,n,t){var r=function(e){return t.warn(e),null};if(!lt(e))return r("Invalid surface: ".concat(e));var o=Si(e,n),a=bi(o);return null===a?r("Invalid surface: ".concat(e)):Oe([si,ci],a.surfaceType)?a.authority&&pi.test(a.authority)?a.path&&!fi.test(a.path)?r("Invalid path ".concat(a.path," in surface: ").concat(e)):a.fragment&&!mi.test(a.fragment)?r("Invalid fragment ".concat(a.fragment," in surface: ").concat(e)):a:r("Invalid authority ".concat(a.authority," in surface: ").concat(e)):r("Unsupported surface type ".concat(a.surfaceType," in surface: ").concat(e))},Ci=function(e){return!!e&&0===e.indexOf(si+di)&&-1===e.indexOf(li)},Pi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return e.map((function(e){return xi(e,n,t)})).filter((function(e){return!je(e)})).map(wi)},Ii="__view__",ki="https://ns.adobe.com/personalization/default-content-item",Di="https://ns.adobe.com/personalization/dom-action",Ti="https://ns.adobe.com/personalization/html-content-item",Oi="https://ns.adobe.com/personalization/json-content-item",Ni="https://ns.adobe.com/personalization/ruleset-item",Ri="https://ns.adobe.com/personalization/redirect-item",ji="https://ns.adobe.com/personalization/message/in-app",Ai="https://ns.adobe.com/personalization/message/feed-item",_i=function(e){Oe(e,Ii)||e.push(Ii)},Li=function(e,n){var t=Ei(n);Oe(e,t)||e.push(t)},Vi=function(e){return e.filter((function(n,t){return e.indexOf(n)===t}))},Mi=function(e){var n=e.getPageLocation,t=e.renderDecisions,r=e.decisionScopes,o=e.personalization,a=e.event,i=e.isCacheInitialized,s=e.logger,c=a.getViewName();return{isRenderDecisions:function(){return t},isSendDisplayEvent:function(){return!!o.sendDisplayEvent},shouldIncludeRenderedPropositions:function(){return!!o.includeRenderedPropositions},getViewName:function(){return c},hasScopes:function(){return r.length>0||ln(o.decisionScopes)},hasSurfaces:function(){return ln(o.surfaces)},hasViewName:function(){return lt(c)},createQueryDetails:function(){var e=g(r);ln(o.decisionScopes)&&e.push.apply(e,g(o.decisionScopes));var t=Pi(o.surfaces,n,s);this.shouldRequestDefaultPersonalization()&&(_i(e),Li(t,n));var a=[ki,Ti,Oi,Ri,Ni,ji,Ai];return Oe(e,Ii)&&a.push(Di),{schemas:a,decisionScopes:Vi(e),surfaces:Vi(t)}},isCacheInitialized:function(){return i},shouldFetchData:function(){return this.hasScopes()||this.hasSurfaces()||this.shouldRequestDefaultPersonalization()},shouldUseCachedData:function(){return this.hasViewName()&&!this.shouldFetchData()},shouldRequestDefaultPersonalization:function(){return o.defaultPersonalizationEnabled||!this.isCacheInitialized()&&!1!==o.defaultPersonalizationEnabled}}},Ui="Rendering is disabled for authoring mode.",qi="decisioning.propositionDisplay",Fi="decisioning.propositionInteract",Bi="decisioning.propositionTrigger",Hi="decisioning.propositionDismiss",Wi=1,zi={DISPLAY:"display",INTERACT:"interact",TRIGGER:"trigger",DISMISS:"dismiss"},Qi=p(p(p(p({},qi,zi.DISPLAY),Fi,zi.INTERACT),Bi,zi.TRIGGER),Hi,zi.DISMISS),Ji=function(e){return Qi[e]},$i={propositions:[]},Gi=function(e){var n=e.logger,t=e.options,r=qr({propositions:Ar(qr({id:Fr().required(),scope:Fr().required(),scopeDetails:qr({decisionProvider:Fr().required()}).required(),items:Ar(qr({id:Fr().required(),schema:Fr().required(),data:jr().required()})).nonEmpty().required()}).required()).nonEmpty().required(),metadata:qr(jr()),viewName:Fr()}).required();try{return r(t)}catch(e){return n.warn("Invalid options for applyPropositions. No propositions will be applied.",e),$i}},Ki=function(e){var n=e.getPageLocation,t=e.logger,r=e.fetchDataHandler,o=e.viewChangeHandler,a=e.onClickHandler,i=e.isAuthoringModeEnabled,s=e.mergeQuery,c=e.viewCache,d=e.showContainers,l=e.applyPropositions,u=e.setTargetMigration,p=e.mergeDecisionsMeta,f=e.renderedPropositions,m=e.onDecisionHandler,g=e.handleConsentFlicker;return{lifecycle:{onComponentsRegistered:function(){g()},onDecision:m,onBeforeRequest:function(e){var n=e.request;return u(n),Promise.resolve()},onBeforeEvent:function(e){var a=e.event,l=e.renderDecisions,u=e.decisionScopes,m=void 0===u?[]:u,g=e.personalization,v=void 0===g?{}:g,h=e.onResponse,y=void 0===h?pt:h,b=e.onRequestFailure,w=void 0===b?pt:b;if(y((function(){return{propositions:[]}})),w((function(){return d()})),i())return t.warn(Ui),s(a,{enabled:!1}),Promise.resolve();var E=Mi({getPageLocation:n,renderDecisions:l,decisionScopes:m,personalization:v,event:a,isCacheInitialized:c.isInitialized(),logger:t}),S=[];if(E.shouldIncludeRenderedPropositions()&&S.push(f.clear()),E.shouldFetchData()){var x=c.createCacheUpdate(E.getViewName());w((function(){return x.cancel()})),r({cacheUpdate:x,personalizationDetails:E,event:a,onResponse:y})}else E.shouldUseCachedData()&&S.push(o({personalizationDetails:E,event:a,onResponse:y,onRequestFailure:w}));return Promise.all(S).then((function(e){var n=Hn(e,(function(e){return e}));ln(n)&&p(a,n,[zi.DISPLAY])}))},onClick:function(e){var n=e.event,t=e.clickedElement;a({event:n,clickedElement:t})}},commands:{applyPropositions:{optionsValidator:function(e){return Gi({logger:t,options:e})},run:l}}}},Xi=function(e){return Ze(rn,{},{innerHTML:e})},Yi={exports:{}};!function(e){var n,t;n=mt,t=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var n=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var n,t=String(e),r=t.length,o=-1,a="",i=t.charCodeAt(0);++o<r;)0!=(n=t.charCodeAt(o))?a+=n>=1&&n<=31||127==n||0==o&&n>=48&&n<=57||1==o&&n>=48&&n<=57&&45==i?"\\"+n.toString(16)+" ":0==o&&1==r&&45==n||!(n>=128||45==n||95==n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122)?"\\"+t.charAt(o):t.charAt(o):a+="\ufffd";return a};return e.CSS||(e.CSS={}),e.CSS.escape=n,n},e.exports=t(n)}(Yi);var Zi,es=C(Yi.exports),ns=":eq(",ts=/:eq\((\d+)\)/g,rs=function(e){return-1===e.indexOf(ns)},os=function(e){return e.split(ts).filter(lt)},as=/(#|\.)(-?\w+)/g,is=function(e,n,t){return"".concat(n).concat(es(t))},ss=function(e){return e.replace(as,is)},cs=function(e){for(var n=[],t=ss(e.trim()),r=os(t),o=r.length,a=0;a<o;){var i=r[a],s=r[a+1];s?n.push({sel:i,eq:Number(s)}):n.push({sel:i}),a+=2}return n},ds=function(e){var n=document;if(rs(e))return wn(e,n);for(var t=cs(e),r=t.length,o=[],a=n,s=0;s<r;){var c=t[s],d=c.sel,l=c.eq,u=wn(d,a),p=u.length;if(0===p)break;if(null!=l&&l>p-1)break;s<r-1&&(a=null==l?i(u,1)[0]:u[l]),s===r-1&&(o=null==l?u:[u[l]]),s+=1}return o},ls=function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).getElementById(e)},us=function(e,n,t){e.setAttribute(n,t)},ps=function(e,n){return e.getAttribute(n)},fs=function(e,n){e.removeAttribute(n)},ms=function(e,n,t,r){var o;o=r?"".concat(n,":").concat(t," !").concat(r,";"):"".concat(n,":").concat(t,";"),e.style.cssText+=";".concat(o)},gs=function(e){return e.parentNode},vs=function(e){return e.nextElementSibling},hs=function(e,n){if(e){var t=gs(e);t&&t.insertBefore(n,vs(e))}},ys=function(e,n){if(e){var t=gs(e);t&&t.insertBefore(n,e)}},bs=function(e){var n=e.children;return n?un(n):[]},ws=function(e){var n=e.childNodes;return n?un(n):[]},Es=function(e){return e.firstElementChild},Ss=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;if(void 0===Zi){var n=e.querySelector("[nonce]");Zi=n&&(n.nonce||n.getAttribute("nonce"))}return Zi},xs="src",Cs=function(e){return e.tagName===tn},Ps=function(e){return Ze(tn,{src:e})},Is=function(e){wn(tn,e).forEach((function(e){var n=ps(e,xs);n&&Ps(n)}))},ks=function(e,n){return e.tagName===n},Ds=function(e){return ks(e,on)&&!ps(e,xs)},Ts=function(e){var n=wn(on,e),t=n.length,r=Ss();if(r)for(var o=0;o<t;o+=1){var a=n[o];Ds(a)&&(a.nonce=r)}},Os=function(e,n){return!!e&&e.tagName===n},Ns=function(e){return Os(e,an)&&!ps(e,xs)},Rs=function(e){return Os(e,an)&&ps(e,xs)},js=function(e){for(var n=wn(an,e),t=[],r=n.length,o=Ss(),a=u({},o&&{nonce:o}),i=0;i<r;i+=1){var s=n[i];if(Ns(s)){var c=s.textContent;c&&t.push(Ze(an,a,{textContent:c}))}}return t},As=function(e){for(var n=wn(an,e),t=[],r=n.length,o=0;o<r;o+=1){var a=n[o];if(Rs(a)){var i=ps(a,xs);i&&t.push(i)}}return t},_s=function(e,n){n.forEach((function(n){e.appendChild(n),e.removeChild(n)}))},Ls=function(e){return Promise.all(e.map(ve.default))},Vs=function(e,n,t){var r=Xi(n);Ts(r);var o=ws(r),a=js(r),i=As(r);return Is(r),o.forEach((function(n){Xe(e,n)})),t(e),_s(e,a),Ls(i)},Ms=function(e){ws(e).forEach(Vn)},Us=function(e,n,t){return Ms(e),Vs(e,n,t)},qs=function(e,n,t){var r=Xi(n);Ts(r);var o=ws(r),a=js(r),i=As(r),s=o.length-1;for(Is(r);s>=0;){var c=o[s];t(c);var d=Es(e);d?ys(d,c):Xe(e,c),s-=1}return _s(e,a),Ls(i)},Fs="alloy-prehiding",Bs="{ visibility: hidden }",Hs={},Ws=function(e){if(!Hs[e]){var n=Ss(),t=u({},n&&{nonce:n}),r={textContent:"".concat(e," ").concat(Bs)},o=Ze(on,t,r);Xe(document.head,o),Hs[e]=o}},zs=function(e){var n=Hs[e];n&&(Vn(n),delete Hs[e])},Qs=function(e){if(e&&!ls(Fs)){var n=Ss(),t=u({id:Fs},n&&{nonce:n}),r=Ze(on,t,{textContent:e});Xe(document.head,r)}},Js=function(){var e=ls(Fs);e&&Vn(e)},$s=function(e,n,t){t(e),e.textContent=n},Gs=function(e,n,t){var r=Xi(n);Ts(r);var o=ws(r),a=js(r),i=As(r);return Is(r),o.forEach((function(n){t(n),ys(e,n)})),_s(e,a),Ls(i)},Ks=function(e,n,t){return Gs(e,n,t).then((function(){Vn(e)}))},Xs=function(e,n,t){var r=Xi(n);Ts(r);var o=ws(r),a=js(r),i=As(r);Is(r);var s=e;return o.forEach((function(e){t(e),hs(s,e),s=e})),_s(e,a),Ls(i)},Ys=function(e,n,t){var r=n.priority,a=o(n,be);Object.keys(a).forEach((function(n){ms(e,n,a[n],r)})),t(e)},Zs=function(e,n,t){Object.keys(n).forEach((function(t){us(e,t,n[t])})),t(e)},ec=function(e,n,t){Cs(e)&&(Ps(n),t(e),fs(e,xs),us(e,xs,n))},nc=function(e,n,t){var r=n.from,o=n.to,a=bs(e),i=a[r],s=a[o];i&&s&&(r<o?hs(s,i):ys(s,i),t(s),t(i))},tc=function(e,n,t,r){var o=e.map((function(e){return r(e,n,t)}));return Promise.all(o)},rc=function(e){return function(n,t){var r=n.selector,o=n.prehidingSelector,a=n.content;return Ws(o),_n(r,ds).then((function(n){return tc(n,a,t,e)})).then((function(){zs(o)}),(function(e){throw zs(o),e}))}},oc=function(e,n,t){t(e)},ac="setHtml",ic="customCode",sc="setText",cc="setAttribute",dc="setImageSource",lc="setStyle",uc="move",pc="resize",fc="rearrange",mc="remove",gc="insertAfter",vc="insertBefore",hc="replaceHtml",yc="prependHtml",bc="appendHtml",wc="click",Ec="collectInteractions",Sc=function(){var e;return p(p(p(p(p(p(p(p(p(p(e={},ac,rc(Us)),ic,rc(qs)),sc,rc($s)),cc,rc(Zs)),dc,rc(ec)),lc,rc(Ys)),uc,rc(Ys)),pc,rc(Ys)),fc,rc(nc)),mc,rc(Vn)),p(p(p(p(p(p(e,gc,rc(Xs)),vc,rc(Gs)),hc,rc(Ks)),yc,rc(qs)),bc,rc(Vs)),Ec,rc(oc))},xc=function(e){var n=e.eventManager,t=e.mergeDecisionsMeta;return function(e){var r=e.decisionsMeta,o=void 0===r?[]:r,a=e.propositionAction,i=e.documentMayUnload,s=void 0!==i&&i,c=e.eventType,d=void 0===c?qi:c,l=e.propositionEventTypes,u=void 0===l?[Ji(d)]:l,p=e.viewName,f=n.createEvent(),m={eventType:d};return p&&(m.web={webPageDetails:{viewName:p}}),ln(o)&&t(f,o,u,a),f.mergeXdm(m),s&&f.documentMayUnload(),n.sendEvent(f)}},Cc="personalization:decisions",Pc=function(e){var n=e.prehidingStyle,t=e.showContainers,r=e.hideContainers,o=e.mergeQuery,a=e.processPropositions,i=e.createProposition,s=e.notificationHandler,c=e.consent;return function(e){var d=e.cacheUpdate,l=e.personalizationDetails,u=e.event,p=e.onResponse,f=c.current(),m=f.state,v=f.wasSet;"out"===m&&v||(l.isRenderDecisions()?r(n):t()),o(u,l.createQueryDetails());var h=s(l.isRenderDecisions(),l.isSendDisplayEvent(),l.getViewName());p((function(e){var n,r,o,s=e.response.getPayloadsByType(Cc).map((function(e){return i(e)})),c=Xn(s,(function(e){return e.getScopeType()})),u=c.page,p=void 0===u?[]:u,f=c.view,m=void 0===f?[]:f,v=c.proposition,y=void 0===v?[]:v,b=d.update(m);if(l.isRenderDecisions()){var w=a([].concat(g(p),g(b)),y);n=w.render,r=w.returnedPropositions,o=w.returnedDecisions,n().then(h),t()}else{var E=a([],[].concat(g(p),g(b),g(y)));r=E.returnedPropositions,o=E.returnedDecisions}return{propositions:r,decisions:o}}))}},Ic=function(e,n){if(rs(e))return Ln(e,n);for(var t=ds(e),r=!1,o=0;o<t.length;o+=1)if(t[o]===n){r=!0;break}return r},kc="view",Dc="page",Tc="proposition",Oc=function(e){return e.map((function(e){return e.trackingLabel,e.scopeType,o(e,we)}))},Nc=function(e){return e.filter((function(n,t){var r=JSON.stringify(n);return t===e.findIndex((function(e){return JSON.stringify(e)===r}))}))},Rc=function(e,n,t){for(var r=document.documentElement,o=e,a=0;o&&o!==r;){if(Ic(n,o)){var i=t(n),s={metas:i},c=i.find((function(e){return e.trackingLabel}));c&&(s.label=c.trackingLabel,s.weight=a);var d=i.find((function(e){return e.scopeType===kc}));return d&&(s.viewName=d.scope,s.weight=a),s}o=o.parentNode,a+=1}return{metas:null}},jc=function(e,n,t){for(var r,o=[],a="",i=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,c=0;c<n.length;c+=1){var d=Rc(e,n[c],t),l=d.metas,u=d.label,p=d.weight,f=d.viewName;l&&(u&&p<=i&&(a=u,i=p),f&&p<=s&&(r=f,s=p),o.push.apply(o,g(Oc(l))))}return{decisionsMeta:Nc(o),propositionActionLabel:a,propositionActionToken:void 0,viewName:r}},Ac=function(){return-1!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).location.href.indexOf("adobe_authoring_enabled")},_c=function(e,n,t,r){if(0!==n.length){var o={};t.forEach((function(e){o[e]=Wi}));var a={_experience:{decisioning:{propositions:n,propositionEventType:o}}};r&&(a._experience.decisioning.propositionAction=r),e.mergeXdm(a)}},Lc=function(e,n){e.mergeQuery({personalization:u({},n)})},Vc=function(e,n){if(n||e){var t={};return e&&(t.label=e),n&&(t.tokens=[n]),t}},Mc=function(e){var n=e.mergeDecisionsMeta,t=e.collectInteractions,r=e.collectClicks,o=e.getInteractionMetas,a=e.getClickMetas,i=e.getClickSelectors,s=e.autoCollectPropositionInteractions;return function(e){var c,d,l,u=e.event,p=e.clickedElement,f=[];if([t(p,o,s),r(p,i(),a)].forEach((function(e){var n=e.decisionsMeta,t=e.propositionActionLabel,r=e.propositionActionToken,o=e.viewName;Array.prototype.push.apply(f,n),!c&&t&&(c=t),!d&&r&&(d=r),!l&&o&&(l=o)})),ln(f)){var m={eventType:Fi};l&&(m.web={webPageDetails:{viewName:l}}),u.mergeXdm(m),n(u,f,[zi.INTERACT],Vc(c,d))}}},Uc=function(e){var n=e.createProposition,t=!1,r=Promise.resolve({}),o=function(e,t){var r=e[t.toLowerCase()];return r&&r.length>0?r:[n({scope:t,scopeDetails:{characteristics:{scopeType:kc}},items:[{schema:ki}]},!1)]};return{createCacheUpdate:function(e){var n=ze();return t=!0,r=r.then((function(e){return n.promise.then((function(n){return(0,me.default)({},e,n)})).catch((function(){return e}))})),{update:function(t){var r=t.filter((function(e){return e.getScope()})),a=Xn(r,(function(e){return e.getScope().toLowerCase()}));return n.resolve(a),e?o(a,e):[]},cancel:function(){n.reject()}}},getView:function(e){return r.then((function(n){return o(n,e)}))},isInitialized:function(){return t}}},qc=function(e){var n=e.processPropositions,t=e.viewCache;return function(e){var r,o,a=e.personalizationDetails,i=e.onResponse,s=a.getViewName();return i((function(){return{propositions:r,decisions:o}})),t.getView(s).then((function(e){var t;if(a.isRenderDecisions()){var i=n(e);return t=i.render,r=i.returnedPropositions,o=i.returnedDecisions,t()}var s=n([],e);return r=s.returnedPropositions,o=s.returnedDecisions,[]}))}},Fc=function(e){return Object.keys(e).map((function(n){return u({id:n},e[n])}))},Bc=function(){var e={};return{storeClickMeta:function(n){var t=n.selector,r=n.meta,o=r.id,a=r.scope,i=r.scopeDetails,s=r.trackingLabel,c=r.scopeType;e[t]||(e[t]={}),e[t][o]={scope:a,scopeDetails:i,trackingLabel:s,scopeType:c}},getClickSelectors:function(){return Object.keys(e)},getClickMetas:function(n){return e[n]?Fc(e[n]):{}}}},Hc=function(){var e={},n={};return{storeInteractionMeta:function(t,r,o,a,i){i=parseInt(i,10),e[i]||(e[i]={},n[i]={}),n[i][t]||(n[i][t]=new Set),n[i][t].add(r),e[i][t]=u(u({},a),{},{scopeType:o})},getInteractionMetas:function(t){return Array.isArray(t)&&0!==t.length?Object.values(t.map((function(e){return parseInt(e,10)})).reduce((function(t,r){return Object.keys(e[r]||{}).forEach((function(o){t[o]||(t[o]={proposition:e[r][o],items:new Set}),t[o].items=new Set([].concat(g(t[o].items),g(n[r][o])))})),t}),{})).map((function(e){var n=e.proposition,t=e.items;return u(u({},n),{},{items:Array.from(t).map((function(e){return{id:e}}))})})):[]}}},Wc=function(e,n){return e===Oi&&n===Ec},zc=p(p(p(p({},Di,(function(){return!0})),Ti,(function(){return!0})),Oi,Wc),ji,(function(){return!0})),Qc=function(e,n){return"function"==typeof zc[e]&&zc[e](e,n)},Jc=function(e){var n=e.processPropositions,t=e.createProposition,r=e.renderedPropositions,o=e.viewCache,a=function(e){var n=e.items,t=e.metadataForScope,r=void 0===t?{}:t,o=r.actionType,a=r.selector;return n.filter((function(e){return Qc(e.schema,o)})).map((function(e){var n=e.schema;return n===Ti||Wc(n,o)?Fn(r)?void 0:u(u({},e),{},{schema:Wc(n,o)?Di:n,data:u(u({},e.data),{},{selector:a,type:o})}):u({},e)})).filter((function(e){return e}))},i=function(e){return!(e.scope===Ii&&e.renderAttempted)},s=function(e){var n=e.propositions,t=e.metadata;return n.filter(i).map((function(e){return ln(e.items)?{id:e.id,scope:e.scope,scopeDetails:e.scopeDetails,items:a({items:e.items,metadataForScope:t[e.scope]})}:e})).filter((function(e){return ln(e.items)}))};return function(e){var a=e.propositions,i=void 0===a?[]:a,c=e.metadata,d=void 0===c?{}:c,l=e.viewName,u=ze();r.concat(u.promise);var p=s({propositions:i,metadata:d}).map((function(e){return t(e)}));return Promise.resolve().then((function(){return l?o.getView(l):[]})).then((function(e){var t=n([].concat(g(p),g(e))),r=t.render,o=t.returnedPropositions;return r().then(u.resolve),{propositions:o}}))}},$c=function(e){var n=e.window;return function(){return n.location}},Gc=function(e){return e.targetMigrationEnabled?function(e){e.getPayload().mergeMeta({target:{migration:!0}})}:pt},Kc="BODY > *:eq(0)",Xc=function(e){var n=e.selector;return e.type!==ic||n!==Kc?e:(0,me.default)({},e,{selector:"BODY"})},Yc=function(e){return!dt(e)||!e.trim()
},Zc="SCRIPT,LINK,STYLE",ed=function(e){var n=Xi(e);return wn(Zc,n).map((function(e){return e.outerHTML})).join("")},nd=function(e){var n=(0,me.default)({},e),t=n.content,r=n.selector;if(Yc(t))return n;if(null==r)return n;var o=ds(r);return Os(o[0],sn)?(n.type=bc,n.content=ed(t),n):n},td=function(e){return function(n){return n?e.reduce((function(e,n){return(0,me.default)(e,n(e))}),n):n}},rd=function(e){var n=e.preprocess,t=e.isPageWideSurface,r=function(e,t){var r=e.id,o=e.schema,a=e.data,i=e.characteristics,s=(void 0===i?{}:i).trackingLabel,c=a?a.type:void 0,d=n(a);return{getId:function(){return r},getSchema:function(){return o},getSchemaType:function(){return c},getData:function(){return d},getProposition:function(){return t},getTrackingLabel:function(){return s},getOriginalItem:function(){return e},toString:function(){return JSON.stringify(e)},toJSON:function(){return e}}};return function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=e.id,a=e.scope,i=e.scopeDetails,s=e.items,c=void 0===s?[]:s,d=(i||{}).characteristics,l=(void 0===d?{}:d).scopeType;return{getScope:function(){return a||a},getScopeType:function(){return a===Ii||t(a)?Dc:l===kc?kc:Tc},getItems:function(){var e=this;return c.map((function(n){return r(n,e)}))},getNotification:function(){return{id:o,scope:a,scopeDetails:i}},getId:function(){return o},toJSON:function(){return e},addToReturnValues:function(t,r,o,a){n&&(t.push(u(u({},e),{},{items:o.map((function(e){return e.getOriginalItem()})),renderAttempted:a})),a||r.push(u(u({},e),{},{items:o.map((function(e){return e.getOriginalItem()}))})))}}}},od=function(){var e=Promise.resolve([]);return{concat:function(n){e=e.then((function(e){return n.then((function(n){return e.concat(n)})).catch((function(){return e}))}))},clear:function(){var n=e;return e=Promise.resolve([]),n}}},ad=function(){return{setRenderAttempted:!0,includeInNotification:!0}},id="always",sd="never",cd="decoratedElementsOnly",dd=[id,sd,cd],ld="data-aep-interact-id",ud="data-aep-click-label",pd="data-aep-click-token",fd=0,md=function(e,n){return n?parseInt(n,10):++fd},gd=function(e,n){return!!e&&!!e[n]&&Oe([id,cd],e[n])},vd=function(e,n,t,r,o,a,i,s){var c=i.scopeDetails,d=(void 0===c?{}:c).decisionProvider;return gd(e,d)||n===wc?function(e){if(e.tagName){var n=md(t,ps(e,ld));s(t,r,a,i,n),us(e,ld,n),o&&!ps(e,ud)&&us(e,ud,o)}}:pt},hd=function(e){var n=e.modules,t=e.logger,r=e.storeInteractionMeta,o=e.storeClickMeta,a=e.autoCollectPropositionInteractions;return function(e){var i=e.getData()||{},s=i.type,c=i.selector;if(!s)return t.warn("Invalid DOM action data: missing type.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};if(s===wc)return c?(o({selector:c,meta:u(u({},e.getProposition().getNotification()),{},{trackingLabel:e.getTrackingLabel(),scopeType:e.getProposition().getScopeType()})}),{setRenderAttempted:!0,includeInNotification:!1}):(t.warn("Invalid DOM action data: missing selector.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1});if(!n[s])return t.warn("Invalid DOM action data: unknown type.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};var d=vd(a,s,e.getProposition().getId(),e.getId(),e.getTrackingLabel(),e.getProposition().getScopeType(),e.getProposition().getNotification(),r);return{render:function(){return n[s](e.getData(),d)},setRenderAttempted:!0,includeInNotification:!0}}},yd=function(e){var n=e.modules,t=e.logger,r=e.storeInteractionMeta,o=e.autoCollectPropositionInteractions;return function(e){var a=e.getData()||{},i=a.type;if(!a.selector||!i)return{setRenderAttempted:!1,includeInNotification:!1};if(!n[i])return t.warn("Invalid HTML content data",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};var s=vd(o,i,e.getProposition().getId(),e.getId(),e.getTrackingLabel(),e.getProposition().getScopeType(),e.getProposition().getNotification(),r);return{render:function(){return n[i](e.getData(),s)},setRenderAttempted:!0,includeInNotification:!0}}},bd=function(e){var n=e.logger,t=e.executeRedirect,r=e.collect;return function(e){var o=(e.getData()||{}).content;return o?{render:function(){return r({decisionsMeta:[e.getProposition().getNotification()],documentMayUnload:!0}).then((function(){return t(o)}))},setRenderAttempted:!0,onlyRenderThis:!0}:(n.warn("Invalid Redirect data",e.getData()),{})}},wd=function(e){var n=e.schemaProcessors,t=e.logger,r=function(e,n){return function(){return Promise.resolve().then(e).then((function(){return t.enabled&&t.info("Action ".concat(n.toString()," executed.")),!0})).catch((function(e){if(t.enabled){var r=e.message,o=e.stack,a="Failed to execute action ".concat(n.toString(),". ").concat(r," ").concat(o);t.warn(a)}return!1}))}},o=function(e,n){return Promise.all(e.map((function(e){return e()}))).then((function(e){if(e.includes(!0))return n}))},a=function(e){var t=n[e.getSchema()];return t?t(e):{}},i=function(e){for(var n,t,i,s,c=e.renderers,d=e.returnedPropositions,l=e.returnedDecisions,u=e.items,p=e.proposition,f=g(c),m=g(d),v=g(l),h=[],y=[],b=[],w=!1,E=!1,S=0;u.length>S;){s=u[S];var x=a(s);if(n=x.render,t=x.setRenderAttempted,i=x.includeInNotification,E=x.onlyRenderThis){m=[],v=[],t?(h=[s],y=[]):(h=[],y=[s]),f=[],b=[n],w=i;break}n&&b.push(r(n,s)),i&&(w=!0),t?h.push(s):y.push(s),S+=1}if(b.length>0){var C=w?p.getNotification():void 0;f.push((function(){return o(b,C)}))}else w&&f.push((function(){return Promise.resolve(p.getNotification())}));return h.length>0&&p.addToReturnValues(m,v,h,!0),y.length>0&&p.addToReturnValues(m,v,y,!1),{renderers:f,returnedPropositions:m,returnedDecisions:v,onlyRenderThis:E}};return function(e){for(var n,t,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[],s=[],c=[],d=0;e.length>d;){r=(t=e[d]).getItems();var l=i({renderers:a,returnedPropositions:s,returnedDecisions:c,items:r,proposition:t});if(a=l.renderers,s=l.returnedPropositions,c=l.returnedDecisions,n=l.onlyRenderThis)break;d+=1}return n&&e.forEach((function(e,n){n!==d&&e.addToReturnValues(s,c,e.getItems(),!1)})),o.forEach((function(e){e.addToReturnValues(s,c,e.getItems(),!1)})),{returnedPropositions:s,returnedDecisions:c,render:function(){return Promise.all(a.map((function(e){return e()}))).then((function(e){return e.filter((function(e){return e}))}))}}}},Ed=function(e){var n=e.processPropositions,t=e.createProposition,r=e.notificationHandler;return function(e){var o=e.renderDecisions,a=e.propositions,i=e.event,s=e.personalization,c=void 0===s?{}:s;if(!o)return Promise.resolve();var d=c.sendDisplayEvent,l=void 0===d||d,u=i?i.getViewName():void 0,p=a.map((function(e){return t(e,!0)})),f=n(p),m=f.render,g=f.returnedPropositions,v=r(o,l,u);return m().then(v),Promise.resolve({propositions:g})}},Sd="text/html",xd="application/json",Cd="defaultContent",Pd=["content","contentType"],Id=["mobileParameters","webParameters","html"],kd=function(e,n){for(var t=0;t<Pd.length;t+=1){var r=Pd[t];if(!Object.prototype.hasOwnProperty.call(e,r))return n.warn("Invalid in-app message data: missing property '".concat(r,"'."),e),!1}var o=e.content;if(e.contentType===xd)for(var a=0;a<Id.length;a+=1){var i=Id[a];if(!Object.prototype.hasOwnProperty.call(o,i))return n.warn("Invalid in-app message data.content: missing property '".concat(i,"'."),e),!1}return!0},Dd=function(e){var n=e.modules,t=e.logger;return function(e){var r=e.getData(),o=u({},e.getProposition().getNotification());if(!r)return t.warn("Invalid in-app message data: undefined.",r),{};var a=r.type,i=void 0===a?Cd:a;return n[i]?kd(r,t)?o?{render:function(){return n[i](u(u({},r),{},{meta:o}))},setRenderAttempted:!0,includeInNotification:!0}:(t.warn("Invalid in-app message meta: undefined.",o),{}):{}:(t.warn("Invalid in-app message data: unknown type.",r),{})}},Td=function(e){var n=wn("#".concat(e),document);n&&n.length>0&&Vn(n[0])},Od=function(e){var n={};if(!e||"a"!==e.tagName.toLowerCase())return n;var t=e.href;if(!t||!mn(t,"adbinapp://"))return n;var r,o,a=t.split("?"),i=a[0].split("://")[1],s=e.innerText,c=e.getAttribute("data-uuid")||"";if(ln(a)){var d=ge.default.parse(a[1]);r=d.interaction||"",o=decodeURIComponent(d.link||"")}return{action:i,interaction:r,link:o,label:s,uuid:c}},Nd=function(e){return function(n){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.location.href=n:e.location.replace(n),new Promise((function(){}))}},Rd="alloy-messaging-container",jd="alloy-overlay-container",Ad="alloy-content-iframe",_d=function(){return[Rd,jd].forEach(Td)},Ld=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nd(window);return function(t){t.preventDefault(),t.stopImmediatePropagation();var r=t.target,o="a"===r.tagName.toLowerCase()?r:r.closest("a");if(o){var a=Od(o),i=a.action,s=a.interaction,c=a.link,d=a.label,l=a.uuid;e(i,{label:d,id:s,uuid:l,link:c}),"dismiss"===i&&_d(),lt(c)&&c.length>0&&n(c,!0)}}},Vd=function(e,n){var t=(new DOMParser).parseFromString(e,Sd),r=t.querySelector("script");r&&r.setAttribute("nonce",Ss());var o=Ze("iframe",{src:URL.createObjectURL(new Blob([t.documentElement.outerHTML],{type:"text/html"})),id:Ad});return o.addEventListener("load",(function(){(0,(o.contentDocument||o.contentWindow.document).addEventListener)("click",n)})),o},Md=function(e,n,t,r){[{id:jd,element:r},{id:Rd,element:t},{id:Ad,element:e}].forEach((function(e){var t=e.id,r=e.element,o=n[t],a=o.style,i=void 0===a?{}:a,s=o.params,c=void 0===s?{}:s;(0,me.default)(r.style,i);var d=c.parentElement,l=void 0===d?"body":d,u=c.insertionMethod,p=void 0===u?"appendChild":u,f=c.enabled,m=void 0===f||f,g=document.querySelector(l);m&&g&&"function"==typeof g[p]&&g[p](r)}))},Ud=function(e){var n=e.verticalAlign,t=e.width,r=e.horizontalAlign,o=e.backdropColor,a=e.height,i=e.cornerRadius,s=e.horizontalInset,c=e.verticalInset,d=e.uiTakeover,l=void 0!==d&&d,u={width:t?"".concat(t,"%"):"100%",backgroundColor:o||"rgba(0, 0, 0, 0.5)",borderRadius:i?"".concat(i,"px"):"0px",border:"none",position:l?"fixed":"relative",overflow:"hidden"};return"left"===r?u.left=s?"".concat(s,"%"):"0":"right"===r?u.right=s?"".concat(s,"%"):"0":"center"===r&&(u.left="50%",u.transform="translateX(-50%)"),"top"===n?u.top=c?"".concat(c,"%"):"0":"bottom"===n?(u.position="fixed",u.bottom=c?"".concat(c,"%"):"0"):"center"===n&&(u.top="50%",u.transform="".concat("center"===r?"".concat(u.transform," "):"","translateY(-50%)"),u.display="flex",u.alignItems="center",u.justifyContent="center"),u.height=a?"".concat(a,"vh"):"100%",u},qd=function(e){return{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"transparent",opacity:e.backdropOpacity||.5,backgroundColor:e.backdropColor||"#FFFFFF"}},Fd=["enabled","parentElement","insertionMethod"],Bd=function(e){if(!e)return!1;var n=Object.keys(e);if(!Oe(n,Rd))return!1;if(!Oe(n,jd))return!1;for(var t=zr(e),r=0;r<t.length;r+=1){if(!qr(t[r],"style"))return!1;if(!qr(t[r],"params"))return!1;for(var o=0;o<Fd.length;o+=1)if(!qr(t[r].params,Fd[o]))return!1}return!0},Hd=function(e){if(e){var n=e.uiTakeover,t=void 0!==n&&n;return p(p(p({},Ad,{style:{border:"none",width:"100%",height:"100%"},params:{enabled:!0,parentElement:"#alloy-messaging-container",insertionMethod:"appendChild"}}),Rd,{style:Ud(e),params:{enabled:!0,parentElement:"body",insertionMethod:"appendChild"}}),jd,{style:qd(e),params:{enabled:!0===t,parentElement:"body",insertionMethod:"appendChild"}})}},Wd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;_d();var t=e.content,r=e.contentType,o=e.mobileParameters,a=e.webParameters;if(r===Sd){var i=Ze("div",{id:Rd}),s=Vd(t,Ld(n)),c=Ze("div",{id:jd});Bd(a)||(a=Hd(o)),a&&Md(s,a,i,c)}},zd=function(e,n){return new Promise((function(t){var r=e.meta;Wd(e,(function(e,t){var o={};o[zi.INTERACT]=Wi,-1!==Object.values(zi).indexOf(e)&&(o[e]=Wi),n({decisionsMeta:[r],propositionAction:t,eventType:Fi,propositionEventTypes:Object.keys(o)})})),t({meta:r})}))},Qd=function(e){return{defaultContent:function(n){return zd(n,e)}}},Jd=function(e,n){return function(t,r,o){if(!t)return function(){};if(!r){var a=ze();return n.concat(a.promise),a.resolve}return function(n){n.length>0&&e({decisionsMeta:n,viewName:o})}}},$d=function(e){var n=e.showContainers,t=e.consent;return function(){var e=t.current(),r=e.state,o=e.wasSet;r===ro&&o?n():t.awaitConsent().catch(n)}},Gd=function(e){for(var n,t,r=document.documentElement,o=e,a=new Set;o&&o!==r;){var i=ps(o,ld);i&&a.add(i),n=n||ps(o,ud),t=t||ps(o,pd),o=o.parentNode}return{interactIds:g(a),clickLabel:n,clickToken:t}},Kd=function(e){var n=e.find((function(e){return e.scopeType===kc}));return n?n.scope:void 0},Xd=function(e,n,t){return function(r){var o=r.scopeDetails,a=(void 0===o?{}:o).decisionProvider;return e[a]===id||e[a]===cd&&(n||t)}},Yd=function(e,n,t){var r=Gd(e),o=r.interactIds,a=r.clickLabel,i=void 0===a?"":a,s=r.clickToken,c=Xd(t,i,s);if(0===o.length)return{};var d=n(o).filter(c);return{decisionsMeta:Oc(d),propositionActionLabel:i,propositionActionToken:s,viewName:Kd(d)}},Zd="AJO",el="TGT",nl=function(e){var n=e.config,t=e.logger,r=e.eventManager,o=e.consent,a=n.targetMigrationEnabled,i=n.prehidingStyle,s=n.autoCollectPropositionInteractions,c=xc({eventManager:r,mergeDecisionsMeta:_c}),d=Hc(),l=d.storeInteractionMeta,u=d.getInteractionMetas,f=Bc(),m=f.storeClickMeta,g=f.getClickSelectors,v=f.getClickMetas,h=$c({window:window}),y=Sc(),b=td([nd,Xc]),w=rd({preprocess:b,isPageWideSurface:Ci}),E=Uc({createProposition:w}),S=Nd(window),x=p(p(p(p(p({},ki,ad),Di,hd({modules:y,logger:t,storeInteractionMeta:l,storeClickMeta:m,autoCollectPropositionInteractions:s})),Ti,yd({modules:y,logger:t,storeInteractionMeta:l,autoCollectPropositionInteractions:s})),Ri,bd({logger:t,executeRedirect:S,collect:c})),ji,Dd({modules:Qd(c),logger:t})),C=wd({schemaProcessors:x,logger:t}),P=od(),I=Jd(c,P),k=Pc({prehidingStyle:i,showContainers:Js,hideContainers:Qs,mergeQuery:Lc,processPropositions:C,createProposition:w,notificationHandler:I,consent:o}),D=Mc({mergeDecisionsMeta:_c,collectInteractions:Yd,collectClicks:jc,getInteractionMetas:u,getClickMetas:v,getClickSelectors:g,autoCollectPropositionInteractions:s}),T=qc({processPropositions:C,viewCache:E}),O=Jc({processPropositions:C,createProposition:w,renderedPropositions:P,viewCache:E}),N=Gc({targetMigrationEnabled:a}),R=Ed({processPropositions:C,createProposition:w,notificationHandler:I}),j=$d({showContainers:Js,consent:o});return Ki({getPageLocation:h,logger:t,fetchDataHandler:k,viewChangeHandler:T,onClickHandler:D,isAuthoringModeEnabled:Ac,mergeQuery:Lc,viewCache:E,showContainers:Js,applyPropositions:O,setTargetMigration:N,mergeDecisionsMeta:_c,renderedPropositions:P,onDecisionHandler:R,handleConsentFlicker:j})};nl.namespace="Personalization";var tl=dd.map((function(e){return Vr(e)}));nl.configValidators=qr({prehidingStyle:Fr().nonEmpty(),targetMigrationEnabled:_r().default(!1),autoCollectPropositionInteractions:qr(p(p({},Zd,Rr(tl).default(id)),el,Rr(tl).default(sd))).default(p(p({},Zd,id),el,sd)).noUnknownFields()});var rl=function(e){return function(n){var t={webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:e.document.referrer}};Ue(n,{web:t})}},ol=function(e){var n=e.screen.orientation;if(null==n||null==n.type)return null;var t=n.type.split("-");return 0===t.length||"portrait"!==t[0]&&"landscape"!==t[0]?null:t[0]},al=function(e){if(dn(e.matchMedia)){if(e.matchMedia("(orientation: portrait)").matches)return"portrait";if(e.matchMedia("(orientation: landscape)").matches)return"landscape"}return null},il=function(e){return function(n){var t=e.screen,r=t.width,o=t.height,a={},i=Ct(o);i>=0&&(a.screenHeight=i);var s=Ct(r);s>=0&&(a.screenWidth=s);var c=ol(e)||al(e);c&&(a.screenOrientation=c),Object.keys(a).length>0&&Ue(n,{device:a})}},sl=function(e){return function(n){var t=e.document.documentElement,r=void 0===t?{}:t,o=r.clientWidth,a=r.clientHeight,i={type:"browser"},s=Ct(o);s>=0&&(i.browserDetails={viewportWidth:s});var c=Ct(a);c>=0&&(i.browserDetails=i.browserDetails||{},i.browserDetails.viewportHeight=c),Ue(n,{environment:i})}},cl=function(e){return function(n){var t=e(),r={},o=Ct(t.getTimezoneOffset());void 0!==o&&(r.localTimezoneOffset=o),(void 0===o||Math.abs(o)<6e3)&&(r.localTime=Pt(t)),Ue(n,{placeContext:r})}},dl=function(e){return function(n){var t=e().toISOString();Ue(n,{timestamp:t})}},ll="https://ns.adobe.com/experience/alloy",ul="2.21.1",pl=function(e){var n={name:ll,version:ul,environment:"browser"};Ue(e,{implementationDetails:n})},fl=function(e,n,t,r){var o=e.context,a=Hn(o,(function(e,r){return t[e]?[t[e]]:(n.warn("Invalid context[".concat(r,"]: '").concat(e,"' is not available.")),[])})).concat(r);return{namespace:"Context",lifecycle:{onBeforeEvent:function(e){var t=e.event,r={};return Promise.all(a.map((function(e){return Promise.resolve(e(r,n))}))).then((function(){return t.mergeXdm(r)}))}}}},ml=[["architecture","string"],["bitness","string"],["model","string"],["platformVersion","string"],["wow64","boolean"]],gl=function(e){return void 0!==e.userAgentData},vl=function(e){return gl(e)?function(n,t){try{return e.userAgentData.getHighEntropyValues(ml.map((function(e){return e[0]}))).then((function(e){var t={};ml.forEach((function(n){var r=i(n,2),o=r[0],a=r[1];Object.prototype.hasOwnProperty.call(e,o)&&E(e[o])===a&&(t[o]=e[o])})),Ue(n,{environment:{browserDetails:{userAgentClientHints:t}}})}))}catch(e){return t.warn("Unable to collect user-agent client hints. ".concat(e.message)),pt}}:pt},hl=rl(window),yl=il(window),bl=sl(window),wl=cl((function(){return new Date})),El=dl((function(){return new Date})),Sl={web:hl,device:yl,environment:bl,placeContext:wl},xl={highEntropyUserAgentHints:vl(navigator)},Cl=u(u({},Sl),xl),Pl=[El,pl],Il=function(e){var n=e.config,t=e.logger;return fl(n,t,Cl,Pl)};Il.namespace="Context",Il.configValidators=qr({context:Ar(Fr()).default(Object.keys(Sl))});var kl=function(e){var n=e.storedConsent,t=e.taskQueue,r=e.defaultConsent,o=e.consent,a=e.sendSetConsentRequest,i=e.validateSetConsentOptions,s=e.consentHashStore,c=e.doesIdentityCookieExist,d=p({},ao,r),l=n.read(),u=c(),f=void 0!==l[ao];u&&f||s.clear(),u||(n.clear(),l={}),o.initializeConsent(d,l);var m=function(){if(0===t.length){var e=n.read();void 0!==e[ao]&&o.setConsent(e)}};return{commands:{setConsent:{optionsValidator:i,run:function(e){var n=e.consent,r=e.identityMap,i=e.edgeConfigOverrides;o.suspend();var c=s.lookup(n);return t.addTask((function(){return c.isNew()?a({consentOptions:n,identityMap:r,edgeConfigOverrides:i}):Promise.resolve()})).then((function(){return c.save()})).finally(m)}}},lifecycle:{onResponse:m,onRequestFailure:m}}},Dl=function e(n){return Array.isArray(n)?n.map((function(n){return e(n)})):"object"===E(n)&&null!==n?Object.keys(n).sort().reduce((function(t,r){return t[r]=e(n[r]),t}),{}):n},Tl=function(e){return We(JSON.stringify(Dl(e)))},Ol=function(e){var n=e.standard,t=e.version;return"".concat(n,".").concat(t)},Nl=function(e){var n=e.storage;return{clear:function(){n.clear()},lookup:function(e){var t={},r=function(e){var n=Ol(e),r=(e.standard,e.version,o(e,Ee));return t[n]||(t[n]=Tl(r).toString()),t[n]};return{isNew:function(){return e.some((function(e){var t=Ol(e),o=n.getItem(t);return null===o||o!==r(e)}))},save:function(){e.forEach((function(e){var t=Ol(e);n.setItem(t,r(e))}))}}}}},Rl=function(){var e={},n=Fa({content:e,addIdentity:function(n,t){e.identityMap=e.identityMap||{},e.identityMap[n]=e.identityMap[n]||[],e.identityMap[n].push(t)},hasIdentity:function(n){return void 0!==(e.identityMap&&e.identityMap[n])}});return n.setConsent=function(n){e.consent=n},n},jl=function(e){var n=e.payload,t=e.datastreamIdOverride;return Ua({payload:n,datastreamIdOverride:t,getAction:function(){return"privacy/set-consent"},getUseSendBeacon:function(){return!1}})},Al=function(e){var n=e.parseConsentCookie,t=e.orgId,r=e.cookieJar,o=Kn(t,Zn);return{read:function(){var e=r.get(o);return e?n(e):{}},clear:function(){r.remove(o)}}},_l=function(e){var n=e.createConsentRequestPayload,t=e.createConsentRequest,r=e.sendEdgeNetworkRequest,o=e.edgeConfigOverrides;return function(e){var a=e.consentOptions,i=e.identityMap,s=e.edgeConfigOverrides,c=Wa({payload:n(),globalConfigOverrides:o,localConfigOverrides:s});c.payload.setConsent(a),Ae(i)&&Object.keys(i).forEach((function(e){i[e].forEach((function(n){c.payload.addIdentity(e,n)}))}));var d=t(c);return r({request:d}).then((function(){}))}},Ll=function(e){return e.split(";").reduce((function(e,n){var t=i(n.split("="),2),r=t[0],o=t[1];return e[r]=o,e}),{})},Vl=qr({consent:Ar(jr()).required().nonEmpty(),identityMap:Hr,edgeConfigOverrides:Wr}).noUnknownFields().required(),Ml=function(e){var n=e.config,t=e.consent,r=e.sendEdgeNetworkRequest,o=e.createNamespacedStorage,a=n.orgId,i=n.defaultConsent,s=Al({parseConsentCookie:Ll,orgId:a,cookieJar:Ve}),c=He(),d=_l({createConsentRequestPayload:Rl,createConsentRequest:jl,sendEdgeNetworkRequest:r,edgeConfigOverrides:n.edgeConfigOverrides}),l=o("".concat(Gn(a),".consentHashes.")),u=Nl({storage:l.persistent}),p=nt({orgId:a});return kl({storedConsent:s,taskQueue:c,defaultConsent:i,consent:t,sendSetConsentRequest:d,validateSetConsentOptions:Vl,consentHashStore:u,doesIdentityCookieExist:p})};Ml.namespace="Privacy";var Ul=n.createEventMergeId=function(){return{eventMergeId:k()}},ql=function(e){return{commands:{createEventMergeId:{run:e.createEventMergeId}}}},Fl=function(){return ql({createEventMergeId:Ul})};Fl.namespace="EventMerge";var Bl=function(e){var n=e.config,t=e.componentRegistry,r=[].concat(g(t.getCommandNames()),[bo,wo]).sort(),o=u({},n);Object.keys(n).forEach((function(e){var t=n[e];"function"==typeof t&&(o[e]=t.toString())}));var a=t.getComponentNames();return{version:ul,configs:o,commands:r,components:a}},Hl=function(e){var n=e.config,t=e.componentRegistry,r=Bl({config:n,componentRegistry:t});return{commands:{getLibraryInfo:{run:function(){return{libraryInfo:r}}}}}};Hl.namespace="LibraryInfo";var Wl="personalization:decisions",zl=function(e){return null!==e&&"object"===E(e)&&Object.getPrototypeOf(e)===Object.prototype},Ql=function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object.keys(n).forEach((function(o){zl(n[o])||Array.isArray(n[o])?e(n[o],t,[].concat(g(r),[o])):t[[].concat(g(r),[o]).join(".")]=n[o]})),t},Jl=function(e){return zl(e)?Ql(e):e},$l=function(e){var n=e.renderDecisions,t=e.decisionProvider,r=e.applyResponse,o=e.event,a=e.personalization,i=e.decisionContext,s=u(u({},Jl(o.getContent())),i);return function(e){var i=e.response;if(t.addPayloads(i.getPayloadsByType(Wl)),!o.hasQuery())return{propositions:[]};var c=t.evaluate(s);return r({renderDecisions:n,propositions:c,event:o,personalization:a})}},Gl={MATCHER:"matcher",GROUP:"group",HISTORICAL:"historical"},Kl={EQUALS:"eq",NOT_EQUALS:"ne",EXISTS:"ex",NOT_EXISTS:"nx",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL_TO:"ge",LESS_THAN:"lt",LESS_THAN_OR_EQUAL_TO:"le",CONTAINS:"co",NOT_CONTAINS:"nc",STARTS_WITH:"sw",ENDS_WITH:"ew"},Xl={AND:"and",OR:"or"},Yl={ANY:"any",ORDERED:"ordered"},Zl=(p(p(p(p(p(p(p(p(p(p(pe={},Kl.EQUALS,T()),Kl.NOT_EQUALS,O()),Kl.EXISTS,N()),Kl.NOT_EXISTS,R()),Kl.GREATER_THAN,A()),Kl.GREATER_THAN_OR_EQUAL_TO,_()),Kl.LESS_THAN,L()),Kl.LESS_THAN_OR_EQUAL_TO,V()),Kl.CONTAINS,M()),Kl.NOT_CONTAINS,U()),p(p(pe,Kl.STARTS_WITH,q()),Kl.ENDS_WITH,F())),eu=["iam.eventType","eventType","type"],nu=["iam.id","id"],tu=function(e,n){return function(t){var r=e.getItem(n);if(!r)return t;try{return JSON.parse(r)}catch(e){return t}}},ru=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return function(r){e.setItem(n,JSON.stringify(t(r)))}},ou=function(e){var n=new Date;return n.setDate(n.getDate()-e),n},au=function(e){var n=e.scopeDetails,t=(void 0===n?{}:n).activity;return(void 0===t?{}:t).id},iu=function(){var e={};return{getItem:function(n){return n in e?e[n]:null},setItem:function(n,t){e[n]=t}}},su=function(e){e.clear()},cu=function(e){var n=e.eventType,t=void 0===n?"":n,r=e._experience;return!(!t||""===t||!r||"object"!==E(r))},du=function(e){var n=e.scopeDetails;return(void 0===n?{}:n).decisionProvider},lu=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];return Array.isArray(n)?(n.forEach((function(n){Array.isArray(n)?t.push.apply(t,g(e(n))):t.push(n)})),t):n},uu=function(e,n,t){return{schema:t.schema,data:t.data,id:t.id||e}},pu="schema",fu=p(p({},"cjmiam",(function(e,n,t){var r=t.html,o=t.mobileParameters;return{schema:ji,data:{mobileParameters:o,webParameters:{},content:r,contentType:Sd},id:e}})),pu,uu),mu=function(){return function(e){var n=e.id,t=e.type,r=e.detail;return"function"==typeof fu[t]?fu[t](n,t,r):r}},gu=function(e){var n=e.schema,t=e.data;if(n===Ni)return!0;if(n!==Oi)return!1;try{var r="string"==typeof t.content?JSON.parse(t.content):t.content;return r&&Object.prototype.hasOwnProperty.call(r,"version")&&Object.prototype.hasOwnProperty.call(r,"rules")}catch(e){return!1}},vu=function(e,n,t){var r=mu(),o=au(e),a=[],i=function(e){var n=e.data,t=void 0===n?{}:n,r=e.schema===Ni?t:t.content;r&&a.push(ue("string"==typeof r?JSON.parse(r):r))},s=function(i){var s=n.getEvent(qi,o),c=s?s.firstTimestamp:void 0,d=lu(a.map((function(e){return e.execute(i)}))).map(r).map((function(e){var n=(t.recordQualified(o)||{}).firstTimestamp;return u(u({},e),{},{data:u(u({},e.data),{},{qualifiedDate:n,displayedDate:c})})}));return u(u({},e),{},{items:d})};return Array.isArray(e.items)&&e.items.filter(gu).forEach(i),{evaluate:s,isEvaluable:a.length>0}},hu=function(e){var n=e.eventRegistry;return{recordQualified:function(e){if(e)return n.addEvent({},zi.TRIGGER,e)}}},yu=function(e){var n=e.eventRegistry,t={},r=hu({eventRegistry:n}),o=function(e){var o=au(e);if(o){var a=vu(e,n,r);a.isEvaluable&&(t[o]=a)}},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.values(t).map((function(n){return n.evaluate(e)})).filter((function(e){return e.items.length>0}))};return{addPayload:o,addPayloads:function(e){e.forEach(o)},evaluate:a}},bu=function(e){return function(n){var t=n.renderDecisions,r=void 0!==t&&t,o=n.propositions,a=void 0===o?[]:o,i=n.event,s=n.personalization;return a.length>0&&e&&e.onDecision({renderDecisions:r,propositions:a,event:i,personalization:s}),{propositions:a}}},wu="events",Eu=1e3,Su=30,xu=function(e){return"iam.".concat(e)},Cu=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Eu,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Su;return function(t){var r={};return Object.keys(t).forEach((function(o){r[o]={},Object.values(t[o]).filter((function(e){return new Date(e.firstTimestamp)>=ou(n)})).sort((function(e,n){return e.firstTimestamp-n.firstTimestamp})).slice(-1*e).forEach((function(e){r[o][e.event[xu("id")]]=e}))})),r}},Pu=function(e){var n,t,r,o=e.storage,a=o,i=function(e){n=tu(a=e,wu),t=ru(a,wu,Cu(Eu,Su)),r=n({})};i(o);var s=function(e,n,o,a){if(n&&o){r[n]||(r[n]={});var i=r[n][o],s=i?i.count:0,c=(new Date).getTime(),d=i?i.firstTimestamp||i.timestamp:c;return r[n][o]={event:u(u({},e),{},p(p(p({},xu("id"),o),xu("eventType"),n),xu("action"),a)),firstTimestamp:d,timestamp:c,count:s+1},t(r),r[n][o]}};return{addExperienceEdgeEvent:function(e){var n=e.getContent().xdm,t=void 0===n?{}:n,r=t._experience;if(cu(t)){var o=r.decisioning,a=void 0===o?{}:o,i=a.propositionEventType,c=void 0===i?{}:i,d=a.propositionAction,l=void 0===d?{}:d,u=a.propositions,p=void 0===u?[]:u,f=Object.keys(c);if(0!==f.length){var m=function(e){return c[e]===Wi},g=l.id;f.filter(m).forEach((function(e){p.forEach((function(n){du(n)===Zd&&s({},e,au(n),g)}))}))}}},addEvent:s,getEvent:function(e,n){if(r[e])return r[e][n]},toJSON:function(){return r},setStorage:i}},Iu=function(e){var n=e.eventRegistry,t=e.window,r=(new Date).getTime(),o=function(){return u({title:t.title,url:t.url},yt(t.url))},a=function(){return u({url:t.referrer},yt(t.referrer))},i=function(){var e=new Date,n=e.getTime();return{pageLoadTimestamp:r,currentTimestamp:n,currentDate:e.getDate(),"~state.com.adobe.module.lifecycle/lifecyclecontextdata.dayofweek":e.getDay()+1,"~state.com.adobe.module.lifecycle/lifecyclecontextdata.hourofday":e.getHours(),currentMinute:e.getMinutes(),currentMonth:e.getMonth(),currentYear:e.getFullYear(),pageVisitDuration:n-r,"~timestampu":n/1e3,"~timestampz":e.toISOString()}},s=function(){return{height:t.height,width:t.width,scrollY:t.scrollY,scrollX:t.scrollX}},c={browser:{name:Ta(t)},page:o(),referringPage:a()},d=function(){return u(u(u({},c),i()),{},{window:s(),"~sdkver":ul})},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=u(u({},d()),e);return u(u({},Jl(t)),{},{events:n.toJSON()})};return{getContext:l}},ku=function(){for(var e=arguments.length,n=new Array(e>1?e-1:0),t=1;t<e;t++)n[t-1]=arguments[t];return n},Du=function(){return!0},Tu=function(){var e=ku,n=Du,t=0,r={},o=function(e){return function(){delete r[e]}},a=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return"function"!=typeof e?function(){}:(r[t+=1]={callback:e,params:n},o(t))},i=function(){for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];zr(r).forEach((function(t){var r=t.callback,a=t.params,i=e.apply(void 0,[a].concat(o));n.apply(void 0,[a].concat(g(i)))&&r.apply(void 0,g(i))}))};return{add:a,emit:i,hasSubscriptions:function(){return Object.keys(r).length>0},setEmissionPreprocessor:function(n){"function"==typeof n&&(e=n)},setEmissionCondition:function(e){"function"==typeof e&&(n=e)}}},Ou=function(e){var n=e.options;return qr({surfaces:Ar(Fr()).uniqueItems(),schemas:Ar(Fr()).uniqueItems(),callback:Lr().required()}).noUnknownFields()(n)},Nu=function(e,n){var t=e.surfacesFilter,r=e.schemasFilter;return[{propositions:n.filter((function(e){return!t||Oe(t,e.scope)})).map((function(e){var n=e.items,t=void 0===n?[]:n;return u(u({},e),{},{items:t.filter((function(e){return!r||Oe(r,e.schema)}))})})).filter((function(e){return e.items.length>0}))}]},Ru=function(e,n){return n.propositions.length>0},ju=function(){var e=Tu();e.setEmissionPreprocessor(Nu),e.setEmissionCondition(Ru);var n=function(n){var t=n.surfaces,r=n.schemas,o=n.callback,a=e.add(o,{surfacesFilter:t instanceof Array?t:void 0,schemasFilter:r instanceof Array?r:void 0});return Promise.resolve({unsubscribe:a})};return{refresh:function(n){e.hasSubscriptions()&&e.emit(n)},command:{optionsValidator:function(e){return Ou({options:e})},run:n}}},Au={TYPE:"~type",SOURCE:"~source"},_u={LIFECYCLE:"com.adobe.eventType.lifecycle",TRACK:"com.adobe.eventType.generic.track",EDGE:"com.adobe.eventType.edge",RULES_ENGINE:"com.adobe.eventType.rulesEngine"},Lu={LAUNCH:"com.adobe.eventSource.applicationLaunch",REQUEST:"com.adobe.eventSource.requestContent"},Vu=function(e){var n=e.options;return qr({renderDecisions:_r(),personalization:qr({decisionContext:qr({})})}).noUnknownFields()(n)},Mu=function(e){var n=e.contextProvider,t=e.decisionProvider;return{optionsValidator:function(e){return Vu({options:e})},run:function(e){var r=e.renderDecisions,o=e.decisionContext;return(0,e.applyResponse)({renderDecisions:r,propositions:t.evaluate(n.getContext(o))})}}},Uu=function(e){var n=e.config,t=e.createNamespacedStorage,r=e.consent,o=n.orgId,a=n.personalizationStorageEnabled,i=t("".concat(Gn(o),".decisioning."));a||su(i.persistent);var s,c=Pu({storage:iu()}),d=yu({eventRegistry:c}),l=Iu({eventRegistry:c,window:window}),f=Mu({contextProvider:l,decisionProvider:d}),m=ju();return{lifecycle:{onDecision:function(e){var n=e.propositions;m.refresh(n)},onComponentsRegistered:function(e){s=bu(e.lifecycle),a&&r.awaitConsent().then((function(){c.setStorage(i.persistent)})).catch((function(){i&&su(i.persistent)}))},onBeforeEvent:function(e){var n=e.event,t=e.renderDecisions,r=e.personalization,o=void 0===r?{}:r,a=e.onResponse,i=void 0===a?pt:a,f=o.decisionContext,m=void 0===f?{}:f;i($l({renderDecisions:t,decisionProvider:d,applyResponse:s,event:n,personalization:o,decisionContext:l.getContext(u(p(p({},Au.TYPE,_u.EDGE),Au.SOURCE,Lu.REQUEST),m))})),c.addExperienceEdgeEvent(n)}},commands:{evaluateRulesets:{run:function(e){var n=e.renderDecisions,t=e.personalization,r=(void 0===t?{}:t).decisionContext,o=void 0===r?{}:r;return f.run({renderDecisions:n,decisionContext:u(p(p({},Au.TYPE,_u.RULES_ENGINE),Au.SOURCE,Lu.REQUEST),o),applyResponse:s})},optionsValidator:f.optionsValidator},subscribeRulesetItems:m.command}}};Uu.namespace="DecisioningEngine",Uu.configValidators=qr({personalizationStorageEnabled:_r().default(!1)});var qu=function(e){return{inferences:e.response.getPayloadsByType("rtml:inferences")}},Fu=function(){return{lifecycle:{onResponse:qu},commands:{}}};Fu.namespace="MachineLearning";var Bu={MAIN:"main",AD:"ad",COMPLETED:"completed"},Hu=function(){var e
;return{getSession:function(n){return e[n]||{}},storeSession:function(n){var t=n.playerId,r=n.sessionDetails;void 0===e&&(e={}),e[t]=r},stopPing:function(n){var t=n.playerId,r=e[t];r&&(clearTimeout(r.pingId),r.pingId=null,r.playbackState=Bu.COMPLETED)},savePing:function(n){var t=n.playerId,r=n.pingId,o=n.playbackState;e[t]&&(e[t].pingId&&clearTimeout(e[t].pingId),e[t].pingId=r,e[t].playbackState=o)}}},Wu={PAUSE:"media.pauseStart",PLAY:"media.play",BUFFER_START:"media.bufferStart",AD_START:"media.adStart",Ad_BREAK_START:"media.adBreakStart",SESSION_END:"media.sessionEnd",SESSION_START:"media.sessionStart",SESSION_COMPLETE:"media.sessionComplete",PING:"media.ping",AD_BREAK_COMPLETE:"media.adBreakComplete",AD_COMPLETE:"media.adComplete",AD_SKIP:"media.adSkip",BITRATE_CHANGE:"media.bitrateChange",CHAPTER_COMPLETE:"media.chapterComplete",CHAPTER_SKIP:"media.chapterSkip",CHAPTER_START:"media.chapterStart",ERROR:"media.error",STATES_UPDATE:"media.statesUpdate"},zu=function(e){var n=e.mediaRequestPayload,t=e.action;return Ua({payload:n,edgeSubPath:"/va",getAction:function(){return t},getUseSendBeacon:function(){return!1}})},Qu=function(e){var n=e.config,t=e.eventManager,r=e.consent,o=e.sendEdgeNetworkRequest,a=e.setTimestamp;return{createMediaEvent:function(e){var r=e.options,o=t.createEvent(),i=r.xdm;if(a(i),o.setUserXdm(i),i.eventType===Wu.AD_START){var s=r.xdm.mediaCollection.advertisingDetails;o.mergeXdm({mediaCollection:{advertisingDetails:{playerName:s.playerName||n.streamingMedia.playerName}}})}return o},createMediaSession:function(e){var r=n.streamingMedia,o=r.playerName,a=r.channel,i=r.appVersion,s=t.createEvent(),c=e.xdm.mediaCollection.sessionDetails;return s.setUserXdm(e.xdm),s.mergeXdm({eventType:Wu.SESSION_START,mediaCollection:{sessionDetails:{playerName:c.playerName||o,channel:c.channel||a,appVersion:c.appVersion||i}}}),s},augmentMediaEvent:function(e){var n=e.event,t=e.playerId,r=e.getPlayerDetails,o=e.sessionID;if(!t||!r)return n;var a=r({playerId:t}),i=a.playhead,s=a.qoeDataDetails;return n.mergeXdm({mediaCollection:{playhead:Ct(i),qoeDataDetails:s,sessionID:o}}),n},trackMediaSession:function(e){var n=e.event,r=e.mediaOptions;return t.sendEvent(n,{mediaOptions:r})},trackMediaEvent:function(e){var n=e.event,t=e.action,a=Ha(),i=zu({mediaRequestPayload:a,action:t});return a.addEvent(n),n.finalize(),r.awaitConsent().then((function(){return o({request:i}).then((function(){return{}}))}))}}},Ju=function(e,n){return e===Wu.AD_START||e===Wu.Ad_BREAK_START||e===Wu.AD_SKIP||e===Wu.AD_COMPLETE?"ad":e===Wu.AD_BREAK_COMPLETE||e===Wu.CHAPTER_COMPLETE||e===Wu.CHAPTER_START||e===Wu.CHAPTER_SKIP||e===Wu.SESSION_START?"main":e===Wu.SESSION_END||e===Wu.SESSION_COMPLETE?"completed":n},$u=function(e){var n=e.mediaEventManager,t=e.mediaSessionCacheManager,r=e.config,o=function e(o){var a=n.createMediaEvent({options:o}),i=o.playerId,s=o.xdm.eventType,c=s.split(".")[1],d=t.getSession(i),l=d.getPlayerDetails,u=d.sessionPromise,p=d.playbackState;return u.then((function(o){return o.sessionId?(n.augmentMediaEvent({event:a,eventType:s,playerId:i,getPlayerDetails:l,sessionID:o.sessionId}),n.trackMediaEvent({event:a,action:c}).then((function(){if(i)if(s===Wu.SESSION_COMPLETE||s===Wu.SESSION_END)t.stopPing({playerId:i});else{var n=Ju(s,p);if("completed"===n)return;var o="ad"===n?r.streamingMedia.adPingInterval:r.streamingMedia.mainPingInterval,a=setTimeout((function(){var n={playerId:i,xdm:{eventType:Wu.PING}};e(n)}),1e3*o);t.savePing({playerId:i,pingId:a,playbackState:n})}}))):Promise.reject(new Error("Failed to trigger media event: ".concat(s,". Session ID is not available for playerId: ").concat(i,".")))}))};return function(e){return o(e)}},Gu=qr({streamingMedia:qr({channel:Fr().nonEmpty().required(),playerName:Fr().nonEmpty().required(),appVersion:Fr(),mainPingInterval:Mr().minimum(10).maximum(50).default(10),adPingInterval:Mr().minimum(1).maximum(10).default(10)}).noUnknownFields()}),Ku=function(e){var n=e.options;return Rr([qr({playerId:Fr().required(),getPlayerDetails:Lr().required(),xdm:qr({mediaCollection:qr({sessionDetails:qr(jr()).required()})})}).required(),qr({xdm:qr({mediaCollection:qr({playhead:Mr().required(),sessionDetails:qr(jr()).required()})})}).required()],"Error validating the createMediaSession command options.")(n)},Xu=function(e){var n=e.options;return Rr([qr({playerId:Fr().required(),xdm:qr({eventType:Br.apply(void 0,g(Object.values(Wu))).required(),mediaCollection:qr(jr())}).required()}).required(),qr({xdm:qr({eventType:Br.apply(void 0,g(Object.values(Wu))).required(),mediaCollection:qr({playhead:Mr().integer().required(),sessionID:Fr().required()}).required()}).required()}).required()],"Error validating the sendMediaEvent command options.")(n)},Yu=function(e){var n=e.config,t=e.trackMediaEvent,r=e.trackMediaSession,o=e.mediaResponseHandler;return{lifecycle:{onBeforeEvent:function(e){var n=e.mediaOptions,t=e.onResponse,r=void 0===t?pt:t;if(n){var a=n.legacy,i=n.playerId,s=n.getPlayerDetails;a||r((function(e){var n=e.response;return o({playerId:i,getPlayerDetails:s,response:n})}))}}},commands:{createMediaSession:{optionsValidator:function(e){return Ku({options:e})},run:r},sendMediaEvent:{optionsValidator:function(e){return Xu({options:e})},run:function(e){return n.streamingMedia?t(e):Promise.reject(new Error("Streaming media is not configured."))}}}}},Zu=function(e){var n=e.config,t=e.mediaEventManager,r=e.mediaSessionCacheManager,o=e.legacy,a=void 0!==o&&o;return function(e){if(!n.streamingMedia)return Promise.reject(new Error("Streaming media is not configured."));var o=e.playerId,i=e.getPlayerDetails,s=t.createMediaSession(e);t.augmentMediaEvent({event:s,playerId:o,getPlayerDetails:i});var c=t.trackMediaSession({event:s,mediaOptions:{playerId:o,getPlayerDetails:i,legacy:a}});return r.storeSession({playerId:o,sessionDetails:{sessionPromise:c,getPlayerDetails:i,playbackState:Bu.MAIN}}),c}},ep=function(e){var n=e.mediaSessionCacheManager,t=e.config,r=e.trackMediaEvent;return function(e){var o=e.response,a=e.playerId,i=e.getPlayerDetails,s=o.getPayloadsByType("media-analytics:new-session");if(ln(s)){var c=s[0].sessionId;if(Yc(c))return{};if(!a||!i)return{sessionId:c};var d=setTimeout((function(){r({playerId:a,xdm:{eventType:Wu.PING}})}),1e3*t.streamingMedia.mainPingInterval);return n.savePing({playerId:a,pingId:d,playbackState:Bu.MAIN}),{sessionId:c}}return{}}},np=function(e){var n=e.config,t=e.logger,r=e.eventManager,o=e.sendEdgeNetworkRequest,a=e.consent,i=Hu(),s=Qu({config:n,eventManager:r,logger:t,consent:a,sendEdgeNetworkRequest:o,setTimestamp:dl((function(){return new Date}))}),c=$u({mediaSessionCacheManager:i,mediaEventManager:s,config:n}),d=Zu({config:n,mediaEventManager:s,mediaSessionCacheManager:i}),l=ep({mediaSessionCacheManager:i,config:n,trackMediaEvent:c});return Yu({config:n,trackMediaEvent:c,mediaEventManager:s,mediaResponseHandler:l,trackMediaSession:d})};np.namespace="Streaming media",np.configValidators=Gu;var tp={Video:"video",Audio:"audio"},rp={VOD:"vod",Live:"live",Linear:"linear",Podcast:"podcast",Audiobook:"audiobook",AOD:"aod"},op={FullScreen:"fullScreen",ClosedCaption:"closedCaptioning",Mute:"mute",PictureInPicture:"pictureInPicture",InFocus:"inFocus"},ap={AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",BufferComplete:"bufferComplete",BitrateChange:"bitrateChange",StateStart:"stateStart",StateEnd:"stateEnd"},ip={SessionStart:"sessionStart",SessionEnd:"sessionEnd",SessionComplete:"sessionComplete",Play:"play",Pause:"pauseStart",Error:"error",StateUpdate:"statesUpdate"},sp={MediaResumed:"media.resumed",GranularAdTracking:"media.granularadtracking"},cp={Show:"a.media.show",Season:"a.media.season",Episode:"a.media.episode",AssetId:"a.media.asset",Genre:"a.media.genre",FirstAirDate:"a.media.airDate",FirstDigitalDate:"a.media.digitalDate",Rating:"a.media.rating",Originator:"a.media.originator",Network:"a.media.network",ShowType:"a.media.type",AdLoad:"a.media.adLoad",MVPD:"a.media.pass.mvpd",Authorized:"a.media.pass.auth",DayPart:"a.media.dayPart",Feed:"a.media.feed",StreamFormat:"a.media.format"},dp={Artist:"a.media.artist",Album:"a.media.album",Label:"a.media.label",Author:"a.media.author",Station:"a.media.station",Publisher:"a.media.publisher"},lp={Advertiser:"a.media.ad.advertiser",CampaignId:"a.media.ad.campaign",CreativeId:"a.media.ad.creative",PlacementId:"a.media.ad.placement",SiteId:"a.media.ad.site",CreativeUrl:"a.media.ad.creativeURL"},up=function(e){var n=e.trackMediaEvent,t=e.trackMediaSession,r=e.mediaResponseHandler,o=e.logger,a=e.createMediaHelper,i=e.createGetInstance,s=e.config;return{lifecycle:{onBeforeEvent:function(e){var n=e.mediaOptions,t=e.onResponse,o=void 0===t?pt:t;if(n){var a=n.legacy,i=n.playerId,s=n.getPlayerDetails;a&&o((function(e){var n=e.response;return r({playerId:i,getPlayerDetails:s,response:n})}))}}},commands:{getMediaAnalyticsTracker:{run:function(){if(!s.streamingMedia)return Promise.reject(new Error("Streaming media is not configured."));o.info("Streaming media is configured in legacy mode.");var e=a({logger:o});return Promise.resolve(u({getInstance:function(){return i({logger:o,trackMediaEvent:n,trackMediaSession:t,uuid:k})},Event:ap,MediaType:tp,PlayerState:op,StreamType:rp,MediaObjectKey:sp,VideoMetadataKeys:cp,AudioMetadataKeys:dp,AdMetadataKeys:lp},e))}}}}},pp=function(e){var n=e.logger;return{createMediaObject:function(e,t,r,o,a){var i={friendlyName:e,name:t,length:r,streamType:a,contentType:o},s=qr({friendlyName:Fr().nonEmpty(),name:Fr().nonEmpty(),length:Mr().required(),streamType:Fr().nonEmpty(),contentType:Fr().nonEmpty()});try{var c=s(i);return{sessionDetails:{name:c.name,friendlyName:c.friendlyName,length:c.length,streamType:c.streamType,contentType:c.contentType}}}catch(e){return n.warn("An error occurred while creating the Media Object.",e),{}}},createAdBreakObject:function(e,t,r){var o={friendlyName:e,offset:t,index:r},a=qr({friendlyName:Fr().nonEmpty(),offset:Mr(),index:Mr()});try{var i=a(o);return{advertisingPodDetails:{friendlyName:i.friendlyName,offset:i.offset,index:i.index}}}catch(e){return n.warn("An error occurred while creating the Ad Break Object.",e),{}}},createAdObject:function(e,t,r,o){var a={friendlyName:e,name:t,podPosition:r,length:o},i=qr({friendlyName:Fr().nonEmpty(),name:Fr().nonEmpty(),podPosition:Mr(),length:Mr()});try{var s=i(a);return{advertisingDetails:{friendlyName:s.friendlyName,name:s.name,podPosition:s.podPosition,length:s.length}}}catch(e){return n.warn("An error occurred while creating the Advertising Object.",e),{}}},createChapterObject:function(e,t,r,o){var a={friendlyName:e,offset:t,length:r,index:o},i=qr({friendlyName:Fr().nonEmpty(),offset:Mr(),length:Mr(),index:Mr()});try{var s=i(a);return{chapterDetails:{friendlyName:s.friendlyName,offset:s.offset,index:s.index,length:s.length}}}catch(e){return n.warn("An error occurred while creating the Chapter Object.",e),{}}},createStateObject:function(e){var t=/^[a-zA-Z0-9_]{1,64}$/,r=Fr().matches(t,"This is not a valid state name.");try{return{name:r(e)}}catch(e){return n.warn("An error occurred while creating the State Object.",e),{}}},createQoEObject:function(e,t,r,o){var a={bitrate:e,droppedFrames:t,fps:r,startupTime:o},i=qr({bitrate:Mr(),droppedFrames:Mr(),fps:Mr(),startupTime:Mr()});try{var s=i(a);return{bitrate:s.bitrate,droppedFrames:s.droppedFrames,framesPerSecond:s.fps,timeToStart:s.startupTime}}catch(e){return n.warn("An error occurred while creating the QOE Object.",e),{}}}}},fp={"a.media.show":"show","a.media.season":"season","a.media.episode":"episode","a.media.asset":"assetID","a.media.genre":"genre","a.media.airDate":"firstAirDate","a.media.digitalDate":"firstDigitalDate","a.media.rating":"rating","a.media.originator":"originator","a.media.network":"network","a.media.type":"showType","a.media.adLoad":"adLoad","a.media.pass.mvpd":"mvpd","a.media.pass.auth":"authorized","a.media.dayPart":"dayPart","a.media.feed":"feed","a.media.format":"streamFormat","a.media.artist":"artist","a.media.album":"album","a.media.label":"label","a.media.author":"author","a.media.station":"station","a.media.publisher":"publisher","media.resumed":"hasResume"},mp={"a.media.ad.advertiser":"advertiser","a.media.ad.campaign":"campaignID","a.media.ad.creative":"creativeID","a.media.ad.placement":"placementID","a.media.ad.site":"siteID","a.media.ad.creativeURL":"creativeURL"},gp=function(e){var n=e.logger,t=e.trackMediaSession,r=e.trackMediaEvent,o=e.uuid,a=null,i=function(){a={qoe:null,lastPlayhead:0,playerId:o()}},s=function(e){var n=e.eventType;return n===ap.BufferComplete||n===ap.SeekComplete?ip.Play:n===ap.StateStart||n===ap.StateEnd?ip.StateUpdate:n===ap.SeekStart?ip.Pause:n},c=function(e){var n=e.eventType,t=e.mediaDetails,r=void 0===t?{}:t,o=e.contextData,a=void 0===o?[]:o,i=s({eventType:n});if(n===ap.StateStart)return{eventType:"media.".concat(i),mediaCollection:{statesStart:[r]}};if(n===ap.StateEnd)return{eventType:"media.".concat(i),mediaCollection:{statesEnd:[r]}};var c={eventType:"media.".concat(i),mediaCollection:u({},r)},d=[];return Object.keys(a).forEach((function(e){fp[e]?c.mediaCollection.sessionDetails[fp[e]]=a[e]:mp[e]?c.mediaCollection.advertisingDetails[mp[e]]=a[e]:d.push({name:e,value:a[e]})})),ln(d)&&(c.mediaCollection.customMetadata=d),c};return{trackSessionStart:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(je(e)||Fn(e))return n.warn("Invalid media object"),{};null===a&&(n.warn("The Media Session was completed. Restarting a new session."),i());var o=c({eventType:ip.SessionStart,mediaDetails:e,contextData:r});return t({playerId:a.playerId,getPlayerDetails:function(){return{playhead:a.lastPlayhead,qoeDataDetails:a.qoe}},xdm:o})},trackPlay:function(){if(null===a)return n.warn("The Media Session was completed."),{};var e=c({eventType:ip.Play});return r({playerId:a.playerId,xdm:e})},trackPause:function(){if(null===a)return n.warn("The Media Session was completed."),{};var e=c({eventType:ip.Pause});return r({playerId:a.playerId,xdm:e})},trackSessionEnd:function(){if(null===a)return n.warn("The Media Session was completed."),{};var e=c({eventType:ip.SessionEnd});return r({playerId:a.playerId,xdm:e})},trackComplete:function(){if(null===a)return n.warn("The Media Session was completed."),{};var e=c({eventType:ip.SessionComplete});return r({playerId:a.playerId,xdm:e})},trackError:function(e){if(n.warn("trackError(".concat(e,")")),null===a)return n.warn("The Media Session was completed."),{};var t={name:e,source:"player"},o=c({eventType:ip.Error,mediaDetails:{errorDetails:t}});return r({playerId:a.playerId,xdm:o})},trackEvent:function(e,t,o){if(Fn(t))return n.warn("Invalid media object."),{};if(null===a)return n.warn("The Media Session was completed."),{};if(!Oe(Object.values(ap),e))return n.warn("Invalid event type"),{};var i=c({eventType:e,mediaDetails:t,contextData:o});return r({playerId:a.playerId,xdm:i})},updatePlayhead:function(e){null!==a?it(e)&&(a.lastPlayhead=parseInt(e,10)):n.warn("The Media Session was completed.")},updateQoEObject:function(e){null!==a?e&&(a.qoe=e):n.warn("The Media Session was completed.")},destroy:function(){n.warn("Destroy called, destroying the tracker."),a=null}}},vp=function(e){var n=e.eventManager,t=e.sendEdgeNetworkRequest,r=e.config,o=e.logger,a=e.consent,i=Hu(),s=Qu({sendEdgeNetworkRequest:t,config:r,consent:a,eventManager:n,setTimestamp:dl((function(){return new Date}))}),c=$u({mediaSessionCacheManager:i,mediaEventManager:s,config:r}),d=Zu({config:r,mediaEventManager:s,mediaSessionCacheManager:i,legacy:!0}),l=ep({mediaSessionCacheManager:i,config:r,trackMediaEvent:c});return up({mediaResponseHandler:l,trackMediaSession:d,trackMediaEvent:c,createMediaHelper:pp,createGetInstance:gp,logger:o,config:r})};vp.namespace="Legacy Media Analytics";var hp=[Io,fa,ti,ii,nl,Il,Ml,Fl,Hl,Fu,Uu,vp,np],yp="https://adobe.ly/3sHh553",bp=function(e){var n=e.combinedConfigValidator,t=e.options,r=e.logger;try{return n.noUnknownFields().required().call({logger:r},t)}catch(e){throw new Error("Resolve these configuration problems:\n\t - ".concat(e.message.split("\n").join("\n\t - "),"\nFor configuration documentation see: ").concat(yp))}},wp=function(e,n,t){return t.reduce((function(t,r){var o=r.buildOnInstanceConfiguredExtraParams;return o&&(0,me.default)(t,o({config:e,logger:n})),t}),{})},Ep=function(e){var n=[],t={get enabled(){return e.enabled},flush:function(){n.forEach((function(n){var t=n.method,r=n.args;return e[t].apply(e,g(r))}))}};return Object.keys(e).filter((function(n){return"function"==typeof e[n]})).forEach((function(e){t[e]=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];n.push({method:e,args:r})}})),t},Sp=function(e){var n=e.options,t=e.componentCreators,r=e.coreConfigValidators,o=e.createConfig,a=e.logger,i=e.setDebugEnabled,s=Ep(a),c=t.map((function(e){return e.configValidators})).filter((function(e){return e})).reduce((function(e,n){return e.concat(n)}),r),d=o(bp({combinedConfigValidator:c,options:n,logger:s}));i(d.debugEnabled,{fromConfig:!0}),s.flush();var l=wp(d,a,t);return a.logOnInstanceConfigured(u(u({},l),{},{config:d})),d},xp=function(e){var n=e.componentCreators,t=e.lifecycle,r=e.componentRegistry,o=e.getImmediatelyAvailableTools;return n.forEach((function(e){var n,t=e.namespace,a=o(t);try{n=e(a)}catch(e){throw St({error:e,message:"[".concat(t,"] An error occurred during component creation.")})}r.register(t,n)})),t.onComponentsRegistered({lifecycle:t}).then((function(){return r}))},Cp=function(e){return(0,me.default)({},e)},Pp="edge.adobedc.net",Ip="adobedc.demdex.net",kp="ee",Dp=function(){return qr({debugEnabled:_r().default(!1),defaultConsent:Br(to,ro,oo).default(to),datastreamId:Fr().unique().required(),edgeDomain:Fr().domain().default(Pp),edgeBasePath:Fr().nonEmpty().default(kp),orgId:Fr().unique().required(),onBeforeEventSend:Lr().default(pt),edgeConfigOverrides:Wr}).renamed("edgeConfigId",Fr().unique(),"datastreamId")},Tp=function(e){var n=e.errorPrefix,t=e.logger;return function(e,r){var o=wt(e);if(o.code===io)return t.warn("The ".concat(r," could not fully complete. ").concat(o.message)),{};throw Et({error:o,message:"".concat(n," ").concat(o.message)}),o}},Op=function(e){var n=e.fetch;return function(e,t){return n(e,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrerPolicy:"no-referrer-when-downgrade",body:t}).then((function(e){return e.text().then((function(n){return{statusCode:e.status,getHeader:function(n){return e.headers.get(n)},body:n}}))}))}},Np=function(e){var n=e.XMLHttpRequest;return function(e,t){return new Promise((function(r,o){var a=new n;a.onreadystatechange=function(){4===a.readyState&&(0===a.status?o(new Error("Request aborted.")):r({statusCode:a.status,getHeader:function(e){return a.getResponseHeader(e)},body:a.responseText}))},a.onloadstart=function(){a.responseType="text"},a.open("POST",e,!0),a.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),a.withCredentials=!0,a.onerror=o,a.onabort=o,a.send(t)}))}},Rp=function(e){var n=e.sendBeacon,t=e.sendFetchRequest,r=e.logger;return function(e,o){var a=new Blob([o],{type:"text/plain; charset=UTF-8"});return n(e,a)?Promise.resolve({statusCode:204,getHeader:function(){return null},body:""}):(r.info("Unable to use `sendBeacon`; falling back to `fetch`."),t(e,o))}},jp=function(e){var n=e.getDebugEnabled,t=e.console,r=e.getMonitors,o=e.context,a="[".concat(o.instanceName,"]");o.componentName&&(a+=" [".concat(o.componentName,"]"));var i=function(e,n){var t=r();if(t.length>0){var a=(0,me.default)({},o,n);t.forEach((function(n){n[e]&&n[e](a)}))}},s=function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];i("onBeforeLog",{level:e,arguments:o}),n()&&t[e].apply(t,[a].concat(o))};return{get enabled(){return r().length>0||n()},logOnInstanceCreated:function(e){i("onInstanceCreated",e),s("info","Instance initialized.")},logOnInstanceConfigured:function(e){i("onInstanceConfigured",e),s("info","Instance configured. Computed configuration:",e.config)},logOnBeforeCommand:function(e){i("onBeforeCommand",e),s("info","Executing ".concat(e.commandName," command. Options:"),e.options)},logOnCommandResolved:function(e){i("onCommandResolved",e),s("info","".concat(e.commandName," command resolved. Result:"),e.result)},logOnCommandRejected:function(e){i("onCommandRejected",e),s("error","".concat(e.commandName," command was rejected. Error:"),e.error)},logOnBeforeNetworkRequest:function(e){i("onBeforeNetworkRequest",e),s("info","Request ".concat(e.requestId,": Sending request."),e.payload)},logOnNetworkResponse:function(e){i("onNetworkResponse",e);var n=e.parsedBody||e.body?"response body:":"no response body.";s("info","Request ".concat(e.requestId,": Received response with status code ").concat(e.statusCode," and ").concat(n),e.parsedBody||e.body)},logOnNetworkError:function(e){i("onNetworkError",e),s("error","Request ".concat(e.requestId,": Network request failed."),e.error)},info:s.bind(null,"info"),warn:s.bind(null,"warn"),error:s.bind(null,"error")}},Ap="Event was canceled because the onBeforeEventSend callback returned false.",_p=function(e){var n=e.config,t=e.logger,r=e.lifecycle,a=e.consent,i=e.createEvent,s=e.createDataCollectionRequestPayload,c=e.createDataCollectionRequest,d=e.sendEdgeNetworkRequest,l=e.applyResponse,p=n.onBeforeEventSend,f=n.edgeConfigOverrides;return{createEvent:i,sendEvent:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.edgeConfigOverrides,l=o(n,Se),m=Wa({payload:s(),localConfigOverrides:i,globalConfigOverrides:f}),g=c(m),v=Fe(),h=Fe();return r.onBeforeEvent(u(u({},l),{},{event:e,onResponse:v.add,onRequestFailure:h.add})).then((function(){return m.payload.addEvent(e),a.awaitConsent()})).then((function(){try{e.finalize(p)}catch(o){var n=function(){throw o};return h.add(r.onRequestFailure),h.call({error:o}).then(n,n)}if(!e.shouldSend()){h.add(r.onRequestFailure),t.info(Ap);var o=new Error(Ap);return h.call({error:o}).then((function(){}))}return d({request:g,runOnResponseCallbacks:v.call,runOnRequestFailureCallbacks:h.call})}))},applyResponse:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.renderDecisions,o=void 0!==t&&t,a=n.decisionContext,i=void 0===a?{}:a,d=n.responseHeaders,u=void 0===d?{}:d,p=n.responseBody,f=void 0===p?{handle:[]}:p,m=n.personalization,g=s(),v=c({payload:g}),h=Fe();return r.onBeforeEvent({event:e,renderDecisions:o,decisionContext:i,decisionScopes:[Ii],personalization:m,onResponse:h.add,onRequestFailure:pt}).then((function(){return g.addEvent(e),l({request:v,responseHeaders:u,responseBody:f,runOnResponseCallbacks:h.call})}))}}},Lp="state:store",Vp=function(e){var n=e.cookieJar,t=e.shouldTransferCookie,r=e.apexDomain,o=e.dateProvider;return{cookiesToPayload:function(e,o){var a=Ge(o,r),i={domain:r,cookiesEnabled:!0};if(!a){var s=n.get(),c=Object.keys(s).filter(t).map((function(e){return{key:e,value:s[e]}}));c.length&&(i.entries=c)}e.mergeState(i)},responseToCookies:function(e){e.getPayloadsByType(Lp).forEach((function(e){var t={domain:r},a=e.attrs&&e.attrs.SameSite&&e.attrs.SameSite.toLowerCase();void 0!==e.maxAge&&(t.expires=new Date(o().getTime()+1e3*e.maxAge)),void 0!==a&&(t.sameSite=a),"none"===a&&(t.secure=!0),n.set(e.key,e.value,t)}))}}},Mp="mboxEdgeCluster",Up="at_qa_mode",qp="mbox",Fp=function(e){var n=e.orgId,t=e.targetMigrationEnabled;return function(e){return ct(n,e)||e===Up||t&&e===qp}},Bp="v1",Hp=function(e){var n=e.shift()||[],t=e.shift()||[],r=e;return _e.apply(void 0,[{}].concat(g(n),g(t),g(r)))},Wp=function(e){return function(n){var t=function(){throw n};return e.call({error:n}).then(t,t)}},zp=function(e){var n=e.config,t=e.lifecycle,r=e.cookieTransfer,o=e.sendNetworkRequest,a=e.createResponse,i=e.processWarningsAndErrors,s=e.getLocationHint,c=e.getAssuranceValidationTokenParams,d=n.edgeDomain,l=n.edgeBasePath,u=n.datastreamId;return function(e){var n=e.request,p=e.runOnResponseCallbacks,f=void 0===p?pt:p,m=e.runOnRequestFailureCallbacks,g=void 0===m?pt:m,v=Fe();v.add(t.onResponse),v.add(f);var h=Fe();return h.add(t.onRequestFailure),h.add(g),t.onBeforeRequest({request:n,onResponse:v.add,onRequestFailure:h.add}).then((function(){var e=n.getUseIdThirdPartyDomain()?Ip:d,t=s(),a=t?"".concat(l,"/").concat(t).concat(n.getEdgeSubPath()):"".concat(l).concat(n.getEdgeSubPath()),i=n.getDatastreamIdOverride()||u,p=n.getPayload();i!==u&&p.mergeMeta({sdkConfig:{datastream:{original:u}}});var f="https://".concat(e,"/").concat(a,"/").concat(Bp,"/").concat(n.getAction(),"?configId=").concat(i,"&requestId=").concat(n.getId()).concat(c());return r.cookiesToPayload(p,e),o({requestId:n.getId(),url:f,payload:p,useSendBeacon:n.getUseSendBeacon()})})).then((function(e){return i(e),e})).catch(Wp(h)).then((function(e){var n=e.parsedBody,t=e.getHeader,o=a({content:n,getHeader:t});return r.responseToCookies(o),v.call({response:o}).then(Hp)}))}},Qp=204,Jp="The server responded with a",$p=function(e){var n=e.logger;return function(e){var t=e.statusCode,r=e.body,o=e.parsedBody;if(t<200||t>=300||!o&&t!==Qp||o&&!Array.isArray(o.handle)){var a=o?JSON.stringify(o,null,2):r,i=a?"response body:\n".concat(a):"no response body.";throw new Error("".concat(Jp," status code ").concat(t," and ").concat(i))}if(o){var s=o.warnings,c=void 0===s?[]:s,d=o.errors,l=void 0===d?[]:d;c.forEach((function(e){n.warn("".concat(Jp," warning:"),e)})),l.forEach((function(e){n.error("".concat(Jp," non-fatal error:"),e)}))}}},Gp=function(e){var n=e.orgId,t=e.cookieJar,r=Kn(n,et),o=function(){return t.get(r)},a=function(){var e=t.get(Mp);if(e)return"t".concat(e)};return function(){return o()||a()}},Kp=3,Xp=[429,503,502,504],Yp=function(e){var n=e.response;return e.retriesAttempted<Kp&&Oe(Xp,n.statusCode)},Zp=1e3,ef=1e3,nf=.3,tf=function(e){var n=Zp+e*ef,t=n*nf,r=n-t,o=n+t;return Math.round(r+Math.random()*(o-r))},rf=function(e){var n,t=e.getHeader(vo);if(t){var r=parseInt(t,10);n=st(r)?1e3*r:Math.max(0,new Date(t).getTime()-(new Date).getTime())}return n},of=function(e){var n=e.response,t=e.retriesAttempted,r=rf(n);return void 0===r&&(r=tf(t)),r},af=200,sf=function(e){var n=e.cookieTransfer,t=e.lifecycle,r=e.createResponse,o=e.processWarningsAndErrors;return function(e){var a=e.request,i=e.responseHeaders,s=e.responseBody,c=e.runOnResponseCallbacks,d=void 0===c?pt:c,l=e.runOnRequestFailureCallbacks,u=void 0===l?pt:l,p=Fe();p.add(t.onResponse),p.add(d);var f=Fe();f.add(t.onRequestFailure),f.add(u);var m=function(e){return i[e]};return t.onBeforeRequest({request:a,onResponse:p.add,onRequestFailure:f.add}).then((function(){return o({statusCode:af,getHeader:m,body:JSON.stringify(s),parsedBody:s})})).catch(Wp(f)).then((function(){var e=r({content:s,getHeader:m});return n.responseToCookies(e),p.call({response:e}).then(Hp)}))}},cf=rt(window),df=window,lf=(df.console,df.fetch),uf=df.navigator,pf=df.XMLHttpRequest,ff=Dp(),mf=Jn(window,Ve),gf=dn(lf)?Op({fetch:lf}):Np({XMLHttpRequest:pf}),vf=qn(),hf=Ga({window:window,createNamespacedStorage:cf}),yf=function(e){var n=e.instanceName,t=e.logController,r=t.setDebugEnabled,o=t.logger,a=t.createComponentLogger,i=Zr(),s=Xr(i),c=function(e){r(e.enabled,{fromConfig:!1})},d=Be({logger:o,cookieJar:Ve}),l=function(e){var t=Sp({options:e,componentCreators:hp,coreConfigValidators:ff,createConfig:Cp,logger:o,setDebugEnabled:r}),c=t.orgId,l=t.targetMigrationEnabled,u=Fp({orgId:c,targetMigrationEnabled:l}),p=Vp({cookieJar:d,shouldTransferCookie:u,apexDomain:mf,dateProvider:function(){return new Date}}),f=dn(uf.sendBeacon)?Rp({sendBeacon:uf.sendBeacon.bind(uf),sendFetchRequest:gf,logger:o}):gf,m=eo({logger:o,sendFetchRequest:gf,sendBeaconRequest:f,isRequestRetryable:Yp,getRequestRetryDelay:of}),g=$p({logger:o}),v=no({logger:o}),h=yo({extractEdgeInfo:v}),y=Gp({orgId:c,cookieJar:Ve}),b=zp({config:t,lifecycle:s,cookieTransfer:p,sendNetworkRequest:m,createResponse:h,processWarningsAndErrors:g,getLocationHint:y,getAssuranceValidationTokenParams:hf}),w=sf({lifecycle:s,cookieTransfer:p,createResponse:h,processWarningsAndErrors:g}),E=po({logger:o}),S=fo({generalConsentState:E,logger:o}),x=_p({config:t,logger:o,lifecycle:s,consent:S,createEvent:go,createDataCollectionRequestPayload:Ha,createDataCollectionRequest:qa,sendEdgeNetworkRequest:b,applyResponse:w});return xp({componentCreators:hp,lifecycle:s,componentRegistry:i,getImmediatelyAvailableTools:function(e){var r=a(e);return{config:t,componentRegistry:i,consent:S,eventManager:x,fireReferrerHideableImage:vf,logger:r,lifecycle:s,sendEdgeNetworkRequest:b,handleError:Tp({errorPrefix:"[".concat(n,"] [").concat(e,"]"),logger:r}),createNamespacedStorage:cf,apexDomain:mf}}})},u=Tp({errorPrefix:"[".concat(n,"]"),logger:o});return Eo({logger:o,configureCommand:l,setDebugCommand:c,handleError:u,validateCommandOptions:xo})},bf=window.console,wf=rt(window);n.createInstance=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=qr({name:Fr().default("alloy"),monitors:Ar(qr({})).default([])}).noUnknownFields()(e),t=n.name,r=n.monitors,o=function(){return(window.__alloyMonitors||[]).concat(r)},a=Jr({console:bf,locationSearch:window.location.search,createLogger:jp,instanceName:t,createNamespacedStorage:wf,getMonitors:o}),i=yf({instanceName:t,logController:a});return a.logger.logOnInstanceCreated({instance:i}),i}}},"adobe-alloy/dist/lib/instanceManager/createInstanceManager.js":{script:function(e){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function r(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n,t){return(n=a(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""}function i(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function s(e,n){if(null==e)return{};var t,r,o=c(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||{}.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function c(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(n.indexOf(r)>=0)continue;t[r]=e[r]}return t}var d=["name","edgeConfigId","stagingEdgeConfigId","developmentEdgeConfigId","onBeforeEventSend"];e.exports=function(e){var n=e.turbine,t=e.window,o=e.createInstance,a=e.createEventMergeId,i=e.orgId,c=e.wrapOnBeforeEventSend,l=e.getConfigOverrides,u=n.getExtensionSettings().instances,p={};return u.forEach((function(e){var a=e.name,u=e.edgeConfigId,f=e.stagingEdgeConfigId,m=e.developmentEdgeConfigId,g=e.onBeforeEventSend,v=s(e,d),h=o({name:a});t[a]=h,t.__alloyNS||(t.__alloyNS=[]),t.__alloyNS.push(a),p[a]=h;var y=n.environment&&n.environment.stage,b="development"===y&&m||"staging"===y&&f||u;v.edgeConfigOverrides=l(v),h("configure",r(r({},v),{},{datastreamId:b,debugEnabled:n.debugEnabled,orgId:v.orgId||i,onBeforeEventSend:c(g)})),n.onDebugChanged((function(e){h("setDebug",{enabled:e})}))})),{getInstance:function(e){return p[e]},createEventMergeId:function(){return a()}}}}},"adobe-alloy/dist/lib/instanceManager/injectWrapOnBeforeEventSend.js":{script:function(e){"use strict";e.exports=function(e){var n=e.version;return function(e){return function(t){if(t.xdm.implementationDetails.name="".concat(t.xdm.implementationDetails.name,"/reactor"),t.xdm.implementationDetails.version="".concat(t.xdm.implementationDetails.version,"+").concat(n),e)return e(t)}}}}},"adobe-alloy/dist/lib/utils/createGetConfigOverrides.js":{script:function(e){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){
return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function r(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n,t){return(n=a(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""}function i(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var s=function(e){return function(n){var t,o,a,i,s,c=n.edgeConfigOverrides;if(c){if(c[e])s=r({},c[e]);else{if(c.development||c.staging||c.production)return;s=c}if(0!==Object.keys(s).length){if((null===(t=s.com_adobe_analytics)||void 0===t||null===(t=t.reportSuites)||void 0===t?void 0:t.length)>0&&(s.com_adobe_analytics.reportSuites=s.com_adobe_analytics.reportSuites.flatMap((function(e){return e.includes(",")?e.split(/,\s*/gi):e})).map((function(e){return e.trim()})).filter(Boolean)),void 0!==(null===(o=s.com_adobe_identity)||void 0===o?void 0:o.idSyncContainerId)&&null!==(null===(a=s.com_adobe_identity)||void 0===a?void 0:a.idSyncContainerId)&&"string"==typeof(null===(i=s.com_adobe_identity)||void 0===i?void 0:i.idSyncContainerId)){var d=parseInt(s.com_adobe_identity.idSyncContainerId.trim(),10);if(Number.isNaN(d))throw new Error('The ID sync container ID "'.concat(s.com_adobe_identity.idSyncContainerId,'" is not a valid integer.'));s.com_adobe_identity.idSyncContainerId=d}return s}}}};e.exports=s}}}},core:{displayName:"Core",hostedLibFilesBaseUrl:"https://assets.adobedtm.com/extensions/EP1fdd2a6ec2ae468fb1d2cac08df65f83/",modules:{"core/src/lib/dataElements/constant.js":{name:"constant",displayName:"Constant",script:function(e){"use strict";e.exports=function(e){return e.value}}},"core/src/lib/dataElements/customCode.js":{name:"custom-code",displayName:"Custom Code",script:function(e){"use strict";e.exports=function(e,n){return e.source(n)}}},"core/src/lib/dataElements/visitorBehavior.js":{name:"visitor-behavior",displayName:"Visitor Behavior",script:function(e,n,t){"use strict";var r=t("../helpers/visitorTracking");e.exports=function(e){switch(e.attribute){case"landingPage":return r.getLandingPage();case"trafficSource":return r.getTrafficSource();case"minutesOnSite":return r.getMinutesOnSite();case"sessionCount":return r.getSessionCount();case"sessionPageViewCount":return r.getSessionPageViewCount();case"lifetimePageViewCount":return r.getLifetimePageViewCount();case"isNewVisitor":return r.getIsNewVisitor()}}}},"core/src/lib/conditions/valueComparison.js":{name:"value-comparison",displayName:"Value Comparison",script:function(e,n,t){"use strict";var r=t("../helpers/stringAndNumberUtils").isString,o=t("../helpers/stringAndNumberUtils").isNumber,a=t("../helpers/stringAndNumberUtils").castToStringIfNumber,i=t("../helpers/stringAndNumberUtils").castToNumberIfString,s=function(e,n){return n&&r(e)?e.toLowerCase():e},c=function(e){return function(n,t,o){return n=a(n),t=a(t),r(n)&&r(t)&&e(n,t,o)}},d=function(e){return function(n,t){return n=i(n),t=i(t),o(n)&&o(t)&&e(n,t)}},l=function(e){return function(n,t,r){return e(s(n,r),s(t,r))}},u={equals:l((function(e,n){return e==n})),doesNotEqual:function(){return!u.equals.apply(null,arguments)},contains:c(l((function(e,n){return-1!==e.indexOf(n)}))),doesNotContain:function(){return!u.contains.apply(null,arguments)},startsWith:c(l((function(e,n){return 0===e.indexOf(n)}))),doesNotStartWith:function(){return!u.startsWith.apply(null,arguments)},endsWith:c(l((function(e,n){return e.substring(e.length-n.length,e.length)===n}))),doesNotEndWith:function(){return!u.endsWith.apply(null,arguments)},matchesRegex:c((function(e,n,t){return new RegExp(n,t?"i":"").test(e)})),doesNotMatchRegex:function(){return!u.matchesRegex.apply(null,arguments)},lessThan:d((function(e,n){return e<n})),lessThanOrEqual:d((function(e,n){return e<=n})),greaterThan:d((function(e,n){return e>n})),greaterThanOrEqual:d((function(e,n){return e>=n})),isTrue:function(e){return!0===e},isTruthy:function(e){return Boolean(e)},isFalse:function(e){return!1===e},isFalsy:function(e){return!e}};e.exports=function(e){return u[e.comparison.operator](e.leftOperand,e.rightOperand,Boolean(e.comparison.caseInsensitive))}}},"core/src/lib/conditions/customCode.js":{name:"custom-code",displayName:"Custom Code",script:function(e){"use strict";e.exports=function(e,n){return e.source.call(n.element,n,n.target)}}},"core/src/lib/events/directCall.js":{name:"direct-call",displayName:"Direct Call",script:function(e,n,t,r){"use strict";var o={};window._satellite=window._satellite||{},window._satellite.track=function(e,n){e=e.trim();var t=o[e];if(t){var a={identifier:e,detail:n};t.forEach((function(e){e(a)}));var i=['Rules using the direct call event type with identifier "'+e+'" have been triggered'+(n?" with additional detail:":".")];n&&i.push(n),r.logger.log.apply(r.logger,i)}else r.logger.log('"'+e+'" does not match any direct call identifiers.')},e.exports=function(e,n){var t=o[e.identifier];t||(t=o[e.identifier]=[]),t.push(n)}}},"core/src/lib/actions/customCode.js":{name:"custom-code",displayName:"Custom Code",script:function(e,n,t,r){"use strict";var o,a,i,s,c=t("@adobe/reactor-document"),d=t("@adobe/reactor-promise"),l=t("./helpers/decorateCode"),u=t("./helpers/loadCodeSequentially"),p=t("../../../node_modules/postscribe/dist/postscribe"),f=t("./helpers/unescapeHtmlCode"),m=t("../helpers/findPageScript").getTurbine,g=(a=function(e){p(c.body,e,{beforeWriteToken:function(e){var n=e.tagName&&e.tagName.toLowerCase();return o&&"script"===n&&(e.attrs.nonce=o),"script"!==n&&"style"!==n||(Object.keys(e.attrs||{}).forEach((function(n){e.attrs[n]=f(e.attrs[n])})),e.src&&(e.src=f(e.src))),e},error:function(e){r.logger.error(e.msg)}})},i=[],s=function(){if(c.body)for(;i.length;)a(i.shift());else setTimeout(s,20)},function(e){i.push(e),s()}),v=function(){if(c.currentScript)return c.currentScript.async;var e=m();return!e||e.async}();e.exports=function(e,n){var t;o=r.getExtensionSettings().cspNonce;var a={settings:e,event:n},i=a.settings.source;if(i)return a.settings.isExternal?u(i).then((function(e){return e?(t=l(a,e),g(t.code),t.promise):d.resolve()})):(t=l(a,i),v||"loading"!==c.readyState?g(t.code):c.write&&!1===r.propertySettings.ruleComponentSequencingEnabled?c.write(t.code):g(t.code),t.promise)}}},"core/src/lib/events/domReady.js":{name:"dom-ready",displayName:"DOM Ready",script:function(e,n,t){"use strict";var r=t("./helpers/pageLifecycleEvents");e.exports=function(e,n){r.registerDomReadyTrigger(n)}}},"core/src/lib/conditions/path.js":{name:"path",displayName:"Path Without Query String",script:function(e,n,t){"use strict";var r=t("@adobe/reactor-document"),o=t("../helpers/textMatch");e.exports=function(e){var n=r.location.pathname;return e.paths.some((function(e){var t=e.valueIsRegex?new RegExp(e.value,"i"):e.value;return o(n,t)}))}}},"core/src/lib/events/libraryLoaded.js":{name:"library-loaded",displayName:"Library Loaded (Page Top)",script:function(e,n,t){"use strict";var r=t("./helpers/pageLifecycleEvents");e.exports=function(e,n){r.registerLibraryLoadedTrigger(n)}}},"core/src/lib/events/windowLoaded.js":{name:"window-loaded",displayName:"Window Loaded",script:function(e,n,t){"use strict";var r=t("./helpers/pageLifecycleEvents");e.exports=function(e,n){r.registerWindowLoadedTrigger(n)}}},"core/src/lib/helpers/visitorTracking.js":{script:function(e,n,t){"use strict";var r,o=t("@adobe/reactor-document"),a=t("@adobe/reactor-window"),i=t("./getNamespacedStorage"),s="visitorTracking",c=i("localStorage",s),d=i("sessionStorage",s),l=function(){var e=d.getItem("landingPage");return e||(d.setItem("landingPage",a.location.href),d.setItem("landingTime",(new Date).getTime())),!e},u=function(){return d.getItem("landingPage")},p=function(){return Number(d.getItem("landingTime"))},f=function(){return Number(c.getItem("sessionCount"))},m=function(){return Number(c.getItem("pagesViewed"))},g=function(){var e=(new Date).getTime();return Math.floor((e-p())/1e3/60)},v=function(){return d.getItem("trafficSource")},h=function(){return Number(d.getItem("pagesViewed"))},y=function(){return 1===f()},b=function(e){e&&c.setItem("sessionCount",f()+1)},w=function(){d.setItem("pagesViewed",h()+1)},E=function(){c.setItem("pagesViewed",m()+1)},S=function(){d.getItem("trafficSource")||d.setItem("trafficSource",o.referrer)};r=l(),b(r),E(),w(),S(),e.exports={getLandingPage:u,getLandingTime:p,getMinutesOnSite:g,getSessionCount:f,getLifetimePageViewCount:m,getSessionPageViewCount:h,getTrafficSource:v,getIsNewVisitor:y}}},"core/src/lib/helpers/getNamespacedStorage.js":{script:function(e,n,t,r){"use strict";var o=t("@adobe/reactor-window"),a="com.adobe.reactor.core";e.exports=function(e,n){var t='"'+e+'" is not available on the window object.',i=a+"."+n;return{getItem:function(n){try{return o[e].getItem(i+"."+n)}catch(e){return r.logger.warn(t),null}},setItem:function(n,a){try{return o[e].setItem(i+"."+n,a),!0}catch(e){return r.logger.warn(t),!1}}}}}},"core/src/lib/helpers/stringAndNumberUtils.js":{script:function(e){"use strict";var n=function(e){return"number"==typeof e&&isFinite(e)},t=function(e){return"string"==typeof e||e instanceof String},r=function(e){return n(e)?String(e):e},o=function(e){return t(e)?Number(e):e};e.exports={isNumber:n,isString:t,castToStringIfNumber:r,castToNumberIfString:o}}},"core/src/lib/actions/helpers/decorateCode.js":{script:function(e,n,t){"use strict";var r=t("./decorators/decorateGlobalJavaScriptCode"),o=t("./decorators/decorateNonGlobalJavaScriptCode"),a={javascript:function(e,n){return e.settings.global?r(e,n):o(e,n)},html:t("./decorators/decorateHtmlCode")};e.exports=function(e,n){return a[e.settings.language](e,n)}}},"core/src/lib/actions/helpers/loadCodeSequentially.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-promise"),o=t("./getSourceByUrl"),a=r.resolve();e.exports=function(e){var n=new r((function(n){var t=o(e);r.all([t,a]).then((function(e){var t=e[0];n(t)}))}));return a=n,n}}},"core/node_modules/postscribe/dist/postscribe.js":{script:function(e,n){var t,r;t=this,r=function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=r(t(1));e.exports=o.default},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}function o(e){return e&&e.__esModule?e:{default:e}}function a(){}function i(){var e=m.shift();if(e){var n=u.last(e);n.afterDequeue(),e.stream=s.apply(void 0,e),n.afterStreamStart()}}function s(e,n,t){function r(e){e=t.beforeWrite(e),g.write(e),t.afterWrite(e)}(g=new l.default(e,t)).id=f++,g.name=t.name||g.id,c.streams[g.name]=g;var o=e.ownerDocument,s={close:o.close,open:o.open,write:o.write,writeln:o.writeln};d(o,{close:a,open:a,write:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return r(n.join(""))},writeln:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return r(n.join("")+"\n")}});var u=g.win.onerror||a;return g.win.onerror=function(e,n,r){t.error({msg:e+" - "+n+": "+r}),u.apply(g.win,[e,n,r])},g.write(n,(function(){d(o,s),g.win.onerror=u,t.done(),g=null,i()})),g}function c(e,n,t){if(u.isFunction(t))t={done:t};else if("clear"===t)return m=[],g=null,void(f=0);t=u.defaults(t,p);var r=[e=/^#/.test(e)?window.document.getElementById(e.substr(1)):e.jquery?e[0]:e,n,t];return e.postscribe={cancel:function(){r.stream?r.stream.abort():r[1]=a}},t.beforeEnqueue(r),m.push(r),g||i(),e.postscribe}n.__esModule=!0;var d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};n.default=c;var l=o(t(2)),u=r(t(4)),p={afterAsync:a,afterDequeue:a,afterStreamStart:a,afterWrite:a,autoFix:!0,beforeEnqueue:a,beforeWriteToken:function(e){return e},beforeWrite:function(e){return e},done:a,error:function(e){throw new Error(e.msg)},releaseAsync:!1},f=0,m=[],g=null;d(c,{streams:{},queue:m,WriteStream:l.default})},function(e,n,t){"use strict";function r(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}function o(e){return e&&e.__esModule?e:{default:e}}function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){var t=p+n,r=e.getAttribute(t);return l.existy(r)?String(r):r}function s(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=p+n;l.existy(t)&&""!==t?e.setAttribute(r,t):e.removeAttribute(r)}n.__esModule=!0;var c=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},d=o(t(3)),l=r(t(4)),u=!1,p="data-ps-",f="ps-style",m="ps-script",g=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.root=n,this.options=t,this.doc=n.ownerDocument,this.win=this.doc.defaultView||this.doc.parentWindow,this.parser=new d.default("",{autoFix:t.autoFix}),this.actuals=[n],this.proxyHistory="",this.proxyRoot=this.doc.createElement(n.nodeName),this.scriptStack=[],this.writeQueue=[],s(this.proxyRoot,"proxyof",0)}return e.prototype.write=function(){var e;for((e=this.writeQueue).push.apply(e,arguments);!this.deferredRemote&&this.writeQueue.length;){var n=this.writeQueue.shift();l.isFunction(n)?this._callFunction(n):this._writeImpl(n)}},e.prototype._callFunction=function(e){var n={type:"function",value:e.name||e.toString()};this._onScriptStart(n),e.call(this.win,this.doc),this._onScriptDone(n)},e.prototype._writeImpl=function(e){this.parser.append(e);for(var n=void 0,t=void 0,r=void 0,o=[];(n=this.parser.readToken())&&!(t=l.isScript(n))&&!(r=l.isStyle(n));)(n=this.options.beforeWriteToken(n))&&o.push(n);o.length>0&&this._writeStaticTokens(o),t&&this._handleScriptToken(n),r&&this._handleStyleToken(n)},e.prototype._writeStaticTokens=function(e){var n=this._buildChunk(e);return n.actual?(n.html=this.proxyHistory+n.actual,this.proxyHistory+=n.proxy,this.proxyRoot.innerHTML=n.html,u&&(n.proxyInnerHTML=this.proxyRoot.innerHTML),this._walkChunk(),u&&(n.actualInnerHTML=this.root.innerHTML),n):null},e.prototype._buildChunk=function(e){for(var n=this.actuals.length,t=[],r=[],o=[],a=e.length,i=0;i<a;i++){var s=e[i],c=s.toString();if(t.push(c),s.attrs){if(!/^noscript$/i.test(s.tagName)){var d=n++;r.push(c.replace(/(\/?>)/," "+p+"id="+d+" $1")),s.attrs.id!==m&&s.attrs.id!==f&&o.push("atomicTag"===s.type?"":"<"+s.tagName+" "+p+"proxyof="+d+(s.unary?" />":">"))}}else r.push(c),o.push("endTag"===s.type?c:"")}return{tokens:e,raw:t.join(""),actual:r.join(""),proxy:o.join("")}},e.prototype._walkChunk=function(){for(var e=void 0,n=[this.proxyRoot];l.existy(e=n.shift());){var t=1===e.nodeType;if(!t||!i(e,"proxyof")){t&&(this.actuals[i(e,"id")]=e,s(e,"id"));var r=e.parentNode&&i(e.parentNode,"proxyof");r&&this.actuals[r].appendChild(e)}n.unshift.apply(n,l.toArray(e.childNodes))}},e.prototype._handleScriptToken=function(e){var n=this,t=this.parser.clear();t&&this.writeQueue.unshift(t),e.src=e.attrs.src||e.attrs.SRC,(e=this.options.beforeWriteToken(e))&&(e.src&&this.scriptStack.length?this.deferredRemote=e:this._onScriptStart(e),this._writeScriptToken(e,(function(){n._onScriptDone(e)})))},e.prototype._handleStyleToken=function(e){var n=this.parser.clear();n&&this.writeQueue.unshift(n),e.type=e.attrs.type||e.attrs.TYPE||"text/css",(e=this.options.beforeWriteToken(e))&&this._writeStyleToken(e),n&&this.write()},e.prototype._writeStyleToken=function(e){var n=this._buildStyle(e);this._insertCursor(n,f),e.content&&(n.styleSheet&&!n.sheet?n.styleSheet.cssText=e.content:n.appendChild(this.doc.createTextNode(e.content)))},e.prototype._buildStyle=function(e){var n=this.doc.createElement(e.tagName);return n.setAttribute("type",e.type),l.eachKey(e.attrs,(function(e,t){n.setAttribute(e,t)})),n},e.prototype._insertCursor=function(e,n){this._writeImpl('<span id="'+n+'"/>');var t=this.doc.getElementById(n);t&&t.parentNode.replaceChild(e,t)},e.prototype._onScriptStart=function(e){e.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(e)},e.prototype._onScriptDone=function(e){e===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,e.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this._onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({msg:"Bad script nesting or script finished twice"})},e.prototype._writeScriptToken=function(e,n){var t=this._buildScript(e),r=this._shouldRelease(t),o=this.options.afterAsync;e.src&&(t.src=e.src,this._scriptLoadHandler(t,r?o:function(){n(),o()}));try{this._insertCursor(t,m),t.src&&!r||n()}catch(e){this.options.error(e),n()}},e.prototype._buildScript=function(e){var n=this.doc.createElement(e.tagName);return l.eachKey(e.attrs,(function(e,t){n.setAttribute(e,t)})),e.content&&(n.text=e.content),n},e.prototype._scriptLoadHandler=function(e,n){function t(){e=e.onload=e.onreadystatechange=e.onerror=null}function r(){t(),null!=n&&n(),n=null}function o(e){t(),i(e),null!=n&&n(),n=null}function a(e,n){var t=e["on"+n];null!=t&&(e["_on"+n]=t)}var i=this.options.error;a(e,"load"),a(e,"error"),c(e,{onload:function(){if(e._onload)try{e._onload.apply(this,Array.prototype.slice.call(arguments,0))}catch(n){o({msg:"onload handler failed "+n+" @ "+e.src})}r()},onerror:function(){if(e._onerror)try{e._onerror.apply(this,Array.prototype.slice.call(arguments,0))}catch(n){return void o({msg:"onerror handler failed "+n+" @ "+e.src})}o({msg:"remote script failed "+e.src})},onreadystatechange:function(){/^(loaded|complete)$/.test(e.readyState)&&r()}})},e.prototype._shouldRelease=function(e){return!/^script$/i.test(e.nodeName)||!!(this.options.releaseAsync&&e.src&&e.hasAttribute("async"))},e}();n.default=g},function(e){var n;n=function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=r(t(1));e.exports=o.default},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var i=o(t(2)),s=o(t(3)),c=r(t(6)),d=t(5),l={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},u=function(){function e(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.stream=t;var o=!1,s={};for(var d in i)i.hasOwnProperty(d)&&(r.autoFix&&(s[d+"Fix"]=!0),o=o||s[d+"Fix"]);o?(this._readToken=(0,c.default)(this,s,(function(){return n._readTokenImpl()})),this._peekToken=(0,c.default)(this,s,(function(){return n._peekTokenImpl()}))):(this._readToken=this._readTokenImpl,this._peekToken=this._peekTokenImpl)}return e.prototype.append=function(e){this.stream+=e},e.prototype.prepend=function(e){this.stream=e+this.stream},e.prototype._readTokenImpl=function(){var e=this._peekTokenImpl();if(e)return this.stream=this.stream.slice(e.length),e},e.prototype._peekTokenImpl=function(){for(var e in l)if(l.hasOwnProperty(e)&&l[e].test(this.stream)){var n=s[e](this.stream);if(n)return"startTag"===n.type&&/script|style/i.test(n.tagName)?null:(n.text=this.stream.substr(0,n.length),n)}},e.prototype.peekToken=function(){return this._peekToken()},e.prototype.readToken=function(){return this._readToken()},e.prototype.readTokens=function(e){for(var n=void 0;n=this.readToken();)if(e[n.type]&&!1===e[n.type](n))return},e.prototype.clear=function(){var e=this.stream;return this.stream="",e},e.prototype.rest=function(){return this.stream},e}();for(var p in n.default=u,u.tokenToString=function(e){return e.toString()},u.escapeAttributes=function(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=(0,d.escapeQuotes)(e[t],null));return n},u.supports=i,i)i.hasOwnProperty(p)&&(u.browserHasFlaw=u.browserHasFlaw||!i[p]&&p)},function(e,n){"use strict";n.__esModule=!0;var t=!1,r=!1,o=window.document.createElement("div");try{var a="<P><I></P></I>";o.innerHTML=a,n.tagSoup=t=o.innerHTML!==a}catch(e){n.tagSoup=t=!1}try{o.innerHTML="<P><i><P></P></i></P>",n.selfClose=r=2===o.childNodes.length}catch(e){n.selfClose=r=!1}o=null,n.tagSoup=t,n.selfClose=r},function(e,n,t){"use strict";function r(e){var n=e.indexOf("-->");if(n>=0)return new d.CommentToken(e.substr(4,n-1),n+3)}function o(e){var n=e.indexOf("<");return new d.CharsToken(n>=0?n:e.length)}function a(e){var n,t,r;if(-1!==e.indexOf(">")){var o=e.match(l.startTag);if(o){var a=(n={},t={},r=o[2],o[2].replace(l.attr,(function(e,o){arguments[2]||arguments[3]||arguments[4]||arguments[5]?arguments[5]?(n[arguments[5]]="",t[arguments[5]]=!0):n[o]=arguments[2]||arguments[3]||arguments[4]||l.fillAttr.test(o)&&o||"":n[o]="",r=r.replace(e,"")})),{v:new d.StartTagToken(o[1],o[0].length,n,t,!!o[3],r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))});if("object"===(void 0===a?"undefined":c(a)))return a.v}}}function i(e){var n=a(e);if(n){var t=e.slice(n.length);if(t.match(new RegExp("</\\s*"+n.tagName+"\\s*>","i"))){var r=t.match(new RegExp("([\\s\\S]*?)</\\s*"+n.tagName+"\\s*>","i"));if(r)return new d.AtomicTagToken(n.tagName,r[0].length+n.length,n.attrs,n.booleanAttrs,r[1])}}}function s(e){var n=e.match(l.endTag);if(n)return new d.EndTagToken(n[1],n[0].length)}n.__esModule=!0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.comment=r,n.chars=o,n.startTag=a,n.atomicTag=i,n.endTag=s;var d=t(4),l={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i}},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0,n.EndTagToken=n.AtomicTagToken=n.StartTagToken=n.TagToken=n.CharsToken=n.CommentToken=n.Token=void 0;var o=t(5),a=(n.Token=function e(n,t){r(this,e),this.type=n,this.length=t,this.text=""},n.CommentToken=function(){function e(n,t){r(this,e),this.type="comment",this.length=t||(n?n.length:0),this.text="",this.content=n}return e.prototype.toString=function(){return"<!--"+this.content},e}(),n.CharsToken=function(){function e(n){r(this,e),this.type="chars",this.length=n,this.text=""}return e.prototype.toString=function(){return this.text},e}(),n.TagToken=function(){function e(n,t,o,a,i){r(this,e),this.type=n,this.length=o,this.text="",this.tagName=t,this.attrs=a,this.booleanAttrs=i,this.unary=!1,this.html5Unary=!1}return e.formatTag=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t="<"+e.tagName;for(var r in e.attrs)if(e.attrs.hasOwnProperty(r)){t+=" "+r;var a=e.attrs[r];void 0!==e.booleanAttrs&&void 0!==e.booleanAttrs[r]||(t+='="'+(0,o.escapeQuotes)(a)+'"')}return e.rest&&(t+=" "+e.rest),e.unary&&!e.html5Unary?t+="/>":t+=">",null!=n&&(t+=n+"</"+e.tagName+">"),t},e}());n.StartTagToken=function(){function e(n,t,o,a,i,s){r(this,e),this.type="startTag",this.length=t,this.text="",this.tagName=n,this.attrs=o,this.booleanAttrs=a,this.html5Unary=!1,this.unary=i,this.rest=s}return e.prototype.toString=function(){return a.formatTag(this)},e}(),n.AtomicTagToken=function(){function e(n,t,o,a,i){r(this,e),this.type="atomicTag",this.length=t,this.text="",this.tagName=n,this.attrs=o,this.booleanAttrs=a,this.unary=!1,this.html5Unary=!1,this.content=i}return e.prototype.toString=function(){return a.formatTag(this,this.content)},e}(),n.EndTagToken=function(){function e(n,t){r(this,e),this.type="endTag",this.length=t,this.text="",this.tagName=n}return e.prototype.toString=function(){return"</"+this.tagName+">"},e}()},function(e,n){"use strict";function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?e.replace(/([^"]*)"/g,(function(e,n){return/\\/.test(n)?n+'"':n+'\\"'})):n}n.__esModule=!0,n.escapeQuotes=t},function(e,n){"use strict";function t(e){return e&&"startTag"===e.type&&(e.unary=s.test(e.tagName)||e.unary,e.html5Unary=!/\/>$/.test(e.text)),e}function r(e,n){var r=e.stream,o=t(n());return e.stream=r,o}function o(e,n){var t=n.pop();e.prepend("</"+t.tagName+">")}function a(){var e=[];return e.last=function(){return this[this.length-1]},e.lastTagNameEq=function(e){var n=this.last();return n&&n.tagName&&n.tagName.toUpperCase()===e.toUpperCase()},e.containsTagName=function(e){for(var n,t=0;n=this[t];t++)if(n.tagName===e)return!0;return!1},e}function i(e,n,i){function s(){var n=r(e,i);n&&l[n.type]&&l[n.type](n)}var d=a(),l={startTag:function(t){var r=t.tagName;"TR"===r.toUpperCase()&&d.lastTagNameEq("TABLE")?(e.prepend("<TBODY>"),s()):n.selfCloseFix&&c.test(r)&&d.containsTagName(r)?d.lastTagNameEq(r)?o(e,d):(e.prepend("</"+t.tagName+">"),s()):t.unary||d.push(t)},endTag:function(t){d.last()?n.tagSoupFix&&!d.lastTagNameEq(t.tagName)?o(e,d):d.pop():n.tagSoupFix&&(i(),s())}};return function(){return s(),t(i())}}n.__esModule=!0,n.default=i;var s=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,c=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i}])},e.exports=n()},function(e,n){"use strict";function t(e){return null!=e}function r(e){return"function"==typeof e}function o(e,n,t){var r=void 0,o=e&&e.length||0;for(r=0;r<o;r++)n.call(t,e[r],r)}function a(e,n,t){for(var r in e)e.hasOwnProperty(r)&&n.call(t,r,e[r])}function i(e,n){return e=e||{},a(n,(function(n,r){t(e[n])||(e[n]=r)})),e}function s(e){try{return Array.prototype.slice.call(e)}catch(r){var n=(t=[],o(e,(function(e){t.push(e)})),{v:t});if("object"===(void 0===n?"undefined":p(n)))return n.v}var t}function c(e){return e[e.length-1]}function d(e,n){return!(!e||"startTag"!==e.type&&"atomicTag"!==e.type||!("tagName"in e)||!~e.tagName.toLowerCase().indexOf(n))}function l(e){return d(e,"script")}function u(e){return d(e,"style")}n.__esModule=!0;var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.existy=t,n.isFunction=r,n.each=o,n.eachKey=a,n.defaults=i,n.toArray=s,n.last=c,n.isTag=d,n.isScript=l,n.isStyle=u}])},"object"==typeof n&&"object"==typeof e?e.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.postscribe=r():t.postscribe=r()}},"core/src/lib/actions/helpers/unescapeHtmlCode.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-document").createElement("div");e.exports=function(e){return r.innerHTML=e,r.textContent||r.innerText||e}}},"core/src/lib/helpers/findPageScript.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-document"),o=function(e){for(var n=r.querySelectorAll("script"),t=0;t<n.length;t++){var o=n[t];if(e.test(o.src))return o}},a=function(){return o(new RegExp(/(launch|satelliteLib)-[^\/]+.js(\?.*)?$/))};e.exports={getTurbine:a,byRegexPattern:o}}},"core/src/lib/actions/helpers/decorators/decorateGlobalJavaScriptCode.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-promise");e.exports=function(e,n){return{code:"<script>\n"+n+"\n</script>",promise:r.resolve()}}}},"core/src/lib/actions/helpers/decorators/decorateNonGlobalJavaScriptCode.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-promise"),o=0;e.exports=function(e,n){var t="_runScript"+ ++o,a=new r((function(n,o){_satellite[t]=function(a){delete _satellite[t],new r((function(n){n(a.call(e.event.element,e.event,e.event.target,r))})).then(n,o)}}));return{code:'<script>_satellite["'+t+'"](function(event, target, Promise) {\n'+n+"\n});</script>",promise:a}}}},"core/src/lib/actions/helpers/decorators/decorateHtmlCode.js":{script:function(e,n,t,r){"use strict";var o=t("@adobe/reactor-promise"),a=0,i={};window._satellite=window._satellite||{},window._satellite._onCustomCodeSuccess=function(e){var n=i[e];n&&(delete i[e],n.resolve())},window._satellite._onCustomCodeFailure=function(e){var n=i[e];n&&(delete i[e],n.reject())};var s=function(e){return-1!==e.indexOf("${reactorCallbackId}")},c=function(e,n){return e.replace(/\${reactorCallbackId}/g,n)},d=function(e){return e.settings.isExternal};e.exports=function(e,n){var t;return d(e)&&(n=r.replaceTokens(n,e.event)),s(n)?(t=new o((function(e,n){i[String(a)]={resolve:e,reject:n}})),n=c(n,a),a+=1):t=o.resolve(),{code:n,promise:t}}}},"core/src/lib/actions/helpers/getSourceByUrl.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-load-script"),o=t("@adobe/reactor-promise"),a=t("../../helpers/findPageScript").byRegexPattern,i={},s={},c=function(e){return s[e]||(s[e]=r(e)),s[e]};_satellite.__registerScript=function(e,n){var t;if(document.currentScript)t=document.currentScript.getAttribute("src");else{var r=new RegExp(".*"+e+".*");t=a(r).getAttribute("src")}i[t]=n},e.exports=function(e){return i[e]?o.resolve(i[e]):new o((function(n){c(e).then((function(){n(i[e])}),(function(){n()}))}))}}},"core/src/lib/events/helpers/pageLifecycleEvents.js":{script:function(e,n,t){"use strict";var r=t("@adobe/reactor-window"),o=t("@adobe/reactor-document"),a=-1!==r.navigator.appVersion.indexOf("MSIE 10"),i="WINDOW_LOADED",s="DOM_READY",c="PAGE_BOTTOM",d=[c,s,i],l=function(e,n){return{element:e,target:e,nativeEvent:n}},u={};d.forEach((function(e){u[e]=[]}));var p=function(e,n){d.slice(0,m(e)+1).forEach((function(e){g(n,e)}))},f=function(){return"complete"===o.readyState?i:"interactive"===o.readyState?a?null:s:void 0},m=function(e){return d.indexOf(e)},g=function(e,n){u[n].forEach((function(n){v(e,n)})),u[n]=[]},v=function(e,n){var t=n.trigger,r=n.syntheticEventFn;t(r?r(e):null)};r._satellite=r._satellite||{},r._satellite.pageBottom=p.bind(null,c),o.addEventListener("DOMContentLoaded",p.bind(null,s),!0),r.addEventListener("load",p.bind(null,i),!0),r.setTimeout((function(){var e=f();e&&p(e)}),0),e.exports={registerLibraryLoadedTrigger:function(e){e()},registerPageBottomTrigger:function(e){u[c].push({trigger:e})},registerDomReadyTrigger:function(e){u[s].push({trigger:e,syntheticEventFn:l.bind(null,o)})},registerWindowLoadedTrigger:function(e){u[i].push({trigger:e,syntheticEventFn:l.bind(null,r)})}}}},"core/src/lib/helpers/textMatch.js":{script:function(e){"use strict";e.exports=function(e,n){if(null==n)throw new Error("Illegal Argument: Pattern is not present");return null!=e&&("string"==typeof n?e===n:n instanceof RegExp&&n.test(e))}}}}}},company:{orgId:"97B21CFE5329614E0A490D45@AdobeOrg",dynamicCdnEnabled:!1},property:{name:"Costco BC BD",settings:{domains:["costcobusinessdelivery.com","costco.ca","costco.com","costcobusinesscentre.ca"],undefinedVarsReturnEmpty:!1,ruleComponentSequencingEnabled:!0},id:"PR64b6abbabd46461293262b6f5bd6e05e"},rules:[{id:"RL05f0250a2a2f4eb79965ca1165360a36",name:"OpinionLab US",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){function e(e,n){return e.slice(-n.length)==n}return loc=window.location,
!($('#header img[title="Costco Pharmacy"]').length>0||e(loc.host,".ca")||loc.href.indexOf("/employee-website.html")>-1||loc.href.indexOf("/CashCardBalanceForm")>-1)}},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%Is BD?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{global:!0,source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC857c2019be2a4edaac63bbc98623e714-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL07debf98c293426787a6d7e098ca968c",name:"Syndigo",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return null!=_satellite.getVar("Syndigo Src: "+_satellite.getVar("storeCountryLang"))}},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%enabled:syndigo%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCef6087003fd948e282d4c4a68a15dccb-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL200f8b78e8c74af5a6c79b5214d7de7c",name:"Target: Order Confirmation",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%OneTrust Opt In?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/CheckoutConfirmationView_v2"}]},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%useAlloyTarget%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCe92321f241914b41b86bf00b2796f299-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL2f9c6cf0851440a2bba4a0e16da695b1",name:"01 onload#01 diag:passive",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:1}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return window.adobeopt=window.adobeopt||{},window.adobeopt.isDiag=!1,window.adobeopt.isDiagCalc=function(){try{const e="aoptdiag",n=new URLSearchParams(window.location.search);let t=n.get(e),r=n.get("biInspect");if("string"==typeof r&&(t="off"==r||"clear"==r?"off":"inspect"),"string"==typeof t){if("off"===t||"exit"===t||""===t)return localStorage.removeItem(e),_satellite.logger.log("aopt_diag: exited"),!1;localStorage.setItem(e,t)}else t=localStorage.getItem(e);if("string"==typeof t)return window.adobeopt.diagOpts=t,_satellite.logger.log("aopt_diag: ",t),!0}catch(e){console.error("diag:passive condition",e)}return _satellite.logger.log("aopt_diag: no"),1==_satellite.getVar("biInspector?")||window.location.search.indexOf("biInspect=")>-1},window.adobeopt.isDiagCalc()}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{
source:'window.adobeopt = window.adobeopt || {};\nadobeopt.isDiag = true;\nconsole.warn(\'adobe/aopt/adobeopt: diagnostic logging enabled, to disable use the console command: adobeopt.nodiag()\');\nadobeopt.nodiag = function() {\n  localStorage.removeItem("aoptdiag");\n  _satellite.setDebug(false);\n  window.location.reload();\n}\nadobeopt.diagInit = function () {\n  \n    if ( typeof window.adobeopt.diagOpts !== "string" ) {\n      return;\n    }\n\n    if (window.adobeopt.diagOpts.indexOf("{") > -1) {\n        adobeopt.configs = adobeopt.json(window.adobeopt.diagOpts, adobeopt.configs);\n    } else if (window.adobeopt.diagOpts.indexOf(":") > -1) {\n        adobeopt.dictFromCssStr(window.adobeopt.diagOpts, adobeopt.configs);\n    } else {\n        adobeopt.configs[window.adobeopt.diagOpts] = "1";\n    }\n\n    _satellite.logger.log("adobeopt.diagInit", window.adobeopt.diagOpts);\n\n    let AoptModule = adobeopt.AoptModule;\n    adobeopt.diagInclude = adobeopt.reFilterStr(adobeopt.config("diagInclude"), true);\n    adobeopt.diagExclude = adobeopt.reFilterStr(adobeopt.config("diagExclude"), false);\n    adobeopt.diagTypes = {};\n    adobeopt.diagTypeEnabled = function (t) {\n        if (!adobeopt.diagTypes.hasOwnProperty(t)) {\n            adobeopt.diagTypes[t] = adobeopt.diagInclude.test(t) && (!adobeopt.diagExclude.test(t));\n        }\n        return adobeopt.diagTypes[t];\n    }\n    adobeopt.diagHandlerDefOut = function (f, a) { f.apply(null, a) };\n\n    AoptModule.prototype.ifdiag = function (fnc) {\n        let ret = fnc();\n        if (ret !== undefined) {\n            this.log(ret);\n        }\n    };\n    if (adobeopt.hasConfig("useconsole")) {\n        AoptModule.prototype.diag = console.log;\n        AoptModule.prototype.log = console.log;\n        AoptModule.prototype.inspect = console.log;\n        AoptModule.prototype.warn = console.warn;\n        AoptModule.prototype.error = console.error;\n    } else {\n        AoptModule.prototype.diag = function () {\n            try {\n                var isError = false;\n                var _type = this.modname;\n                var out = [];\n                for (var iarg = 0; iarg < arguments.length; iarg++) {\n                    var arg = arguments[iarg];\n                    if (iarg === 0) {\n                        if (typeof arg == "string") {\n                            _type += ":" + arg;\n                            if (_type.slice(-5) == "error") {\n                                isError = true;\n                            }\n                        }\n                        if (!adobeopt.diagTypeEnabled(_type)) {\n                            return\n                        }\n                        continue;\n                    }\n                    if (typeof arg === "function") {\n                        try { // good for optional functions & initialization\n                            arg = arg(out, module, args); // can push to out if needed\n                            if (!arg) {\n                                continue;\n                            }\n                        } catch (ex) { arg = ex }\n                    }\n                    if (typeof arg === "object") {\n                        out.push("\\n");\n                        if (arg instanceof Error) {\n                            isError = true;\n                        }\n                    }\n                    out.push(arg);\n                }\n                if (this.history === undefined) {\n                    this.history = [];\n                }\n                this.history.push(_type, out);\n                out.unshift("~aopt " + _type);\n                (isError ? console.error : console.log).apply(console, out);\n            } catch (e) { console.error(e) }\n        };\n    }\n\n    AoptModule.prototype.log = AoptModule.prototype.diag;\n    AoptModule.prototype.inspect = AoptModule.prototype.diag;\n    AoptModule.prototype.warn = AoptModule.prototype.diag;\n    AoptModule.prototype.error = function (type, details) {\n        this.diag(type + ":error", details);\n    };\n    if (adobeopt.hasConfig("allowexceptions")) {\n        // allow exceptions for debugging\n        AoptModule.prototype.trySafe = function (fncname, fnc) {\n            let aoptmod = this;\n            let result = fnc();\n            aoptmod.diag(fncname + ":returned", result || "");\n        };\n        AoptModule.prototype.tryWrap = function (fncname, fnc) {\n            let aoptmod = this;\n            return function () {\n                let result = fnc.apply(this, arguments);\n                aoptmod.diag(fncname + ":returned", result || "");\n                return result;\n            }\n        };\n    }\n    if ( adobeopt.hasConfig("debugRetValues") ) {\n        AoptModule.prototype.trySafe = function (fncname, fnc) {\n            let aoptmod = this;\n            try {\n                let result = fnc();\n                aoptmod.diag(fncname + ":returned", result || "");\n            } catch (ex) {\n                aoptmod.error(fncname, ex);\n                return ex;\n            }\n        };\n        AoptModule.prototype.tryWrap = function (fncname, fnc) {\n            let aoptmod = this;\n            return function () {\n                try {\n                    let result = fnc.apply(this, arguments);\n                    aoptmod.diag(fncname + ":returned", result || "");\n                    return result;\n                } catch (ex) {\n                    aoptmod.error(fncname, ex);\n                }\n            }\n        };\n    }\n  \n    adobeopt.ifConfig("launchevents", function () {\n        window._satellite._monitors = window._satellite._monitors || [];\n        window._satellite._monitors.push({\n            ruleTriggered: function (event) {\n                modLaunch.log(["rule", event.rule.name, "fired"].join(":"), event.rule);\n            },\n            ruleCompleted: function (event) {\n                modLaunch.log(["rule", event.rule.name, "completed"].join(":"), event.rule);\n            },\n            ruleConditionFailed: function (event) {\n                modLaunch.log(["rule", event.rule.name, "notmet"].join(":"), event.rule, event.condition);\n            }\n        });\n    });\n\n    if ( window.biInspectEnabled || adobeopt.hasConfig("analyticsbeacons") ) {\n\n        adobeopt.logBeacon = function ( beacon ) {\n\n            try {\n\n                let pcl = adobeopt.module("analytics");\n                let pmc = pcl;\n\n                var methods = {\n                    copy: function (oto, ofrom, nm) {\n                        if (ofrom[nm] != undefined && ofrom[nm] != "") {\n                            oto[nm] = ofrom[nm];\n                        }\n                    },\n                    nvpstr: function (oto, str, delim) {\n                        if (str !== undefined && str != "") {\n                            str.split(delim || ",").forEach(function (ev) {\n                                var nvp = ev.split("=");\n                                oto[nvp[0]] = nvp.length == 1 ? 1 : nvp[1];\n                            })\n                        }\n                    },\n                    nvpprop: function (oto, ofrom, nm, delim) {\n                        methods.nvpstr(oto, ofrom[nm], delim)\n                    },\n                    product: function (oto, prodstr) {\n                        var parts = prodstr.split(";");\n                        var map = { category: parts[0], id: parts[1], quantity: parts[2], price: parts[3] };\n                        var newprod = {};\n                        methods.copy(newprod, map, "category");\n                        methods.copy(newprod, map, "id");\n                        methods.copy(newprod, map, "name");\n                        methods.copy(newprod, map, "quantity");\n                        methods.copy(newprod, map, "price");\n                        methods.nvpstr(newprod, parts[4], "|"); // events\n                        methods.nvpstr(newprod, parts[5], "|"); // evars\n                        oto.products.push(newprod);\n                    },\n                    products: function (oto, ofrom, nm, delim) {\n                        oto.products = oto.products || [];\n                        ofrom[nm].split(delim || ",").forEach(function (pstr) { methods.product(oto, pstr) });\n                    }\n                }\n                var includeMethods = {\n                    "suite": "copy",\n                    "marketingCloudVisitorID": "copy",\n                    "eVar": "copy",\n                    "prop": "copy",\n                    "events": "nvpprop",\n                    "products": "products"\n                }\n                function copyValues(toObj, fromObj) {\n                    for (var k in fromObj) {\n                        let handlerName = k.replace(/[0-9]/g, \'\'); // variable name without digits \n                        var handler = includeMethods[handlerName];\n                        if (handler !== undefined && methods[handler] !== undefined && fromObj[k] !== undefined && fromObj[k] !== "") {\n                            methods[handler](toObj, fromObj, k)\n                        }\n                    }\n                }\n                // convert beacon to easier to read/validate format\n                // register with inspector\n                var obj = {\n                    _type: "analytics:beacon"\n                };\n\n                if ( window.s ) {\n                  copyValues(obj, s);\n                }\n                copyValues(obj, beacon);\n\n                if (window.biInspectEvents) {\n                    biInspectEvents.push( objSortedByPaddedKeys(obj) );\n                }\n\n            } catch (ex) { console.error(ex) }\n\n        }\n    }\n    adobeopt.newdiag = function (module) {\n        let aoptmod = adobeopt.module(module);\n        return function () { aoptmod.diag.apply(aoptmod, arguments) }; // closure with module\n    };\n\n    function paddedNumber(str) {\n        return str.replace(/\\d+/g, function(m){\n            return "000".substr(m.length - 1) + m;\n        });\n    \n    }\n    \n    function sortByPaddedNumber(a, b) {\n        a = paddedNumber(a); // REVIEW: seems super expensive\n        b = paddedNumber(b);\n        a = a.replace( "event", "_xxevent" ); // hack, sort to top\n        b = b.replace( "event", "_xxevent" ); // hack, sort to top\n        if (a > b) {\n          return 1;\n        } else if (a < b) {\n          return -1;\n        }\n        return 0;\n    }\n    \n    function objSortedByPaddedKeys( obj ) {\n        let sortedObject = {};\n        let keys = Object.keys(obj);\n        keys.sort( sortByPaddedNumber );\n        keys.forEach( (key) => {\n            sortedObject[key] = obj[key];\n        } );\n        return sortedObject;\n    }\n\n}\n\nif (_satellite.getVar("biInspector?") == true || window.location.search.indexOf("biInspect=") > -1) {\n    window.biInspect = {};\n\n    function extend(destObj /*, ...arg1, arg2 */) {\n        for (let i = 1; i < arguments.length; i++) {\n            if (typeof arguments[i] == "object") {\n                for (let key in arguments[i]) {\n                    destObj[key] = arguments[i][key];\n                }\n            }\n        }\n        return destObj;\n    }\n\n    biInspect.urlParams = new URLSearchParams(window.location.search);\n    const qsbiInspect = biInspect.urlParams.get("biInspect");\n\n    if (qsbiInspect == "clear") {\n        localStorage.removeItem("biInspectSettings");\n        sessionStorage.removeItem("biInspectSettings");\n    }\n    if (qsbiInspect == "clear" || qsbiInspect == "off") {\n        window.biInspectEnabled = false;\n        sessionStorage.removeItem("biInspectEnabled");\n        localStorage.removeItem("biInspectEnabled");\n        return;\n    }\n    window.biInspectEnabled = true;\n\n    biInspect.settingsStorage = sessionStorage;\n    if (sessionStorage.getItem("biInspectSettings") === null && localStorage.getItem("biInspectSettings") !== null) {\n        biInspect.settingsStorage = localStorage;\n    }\n    biInspect.switchStorage = sessionStorage;\n    if (sessionStorage.getItem("biInspectEnabled") === null && localStorage.getItem("biInspectEnabled") !== null) {\n        biInspect.switchStorage = localStorage;\n    }\n\n    biInspect.defaultSettings = { // includes all default settings\n        sessionPrefix: "biInspectEvent_",\n        sessionParams: ["qaid"],\n        inspectKey: 32, // ctl-spacebar\n        sessionKeepEvents: 40,\n        sessionKeepEventsFilter: null,\n        eventsToConsoleLog: true,\n        eventsToConsoleLogFilter: null,\n        eventFilter: null,\n        debugInspector: true,\n        presets: null\n    }\n    biInspect.settingsPresets = {\n        analytics: { eventFilter: { _def: false, "_type^=analytics": "include" } },\n        datalayer: { eventFilter: { _def: false, "_type^=digitalDataEvents": "include", "_type^=analytics": "include" } },\n        datalayerqa: { eventFilter: { _def: false, "_type^=digitalDataEvents": "include", "_type^=analytics": "include" }, eventsToConsoleLog: false, eventsToConsoleFancy: true },\n        grs: { eventFilter: { "_type^=grs:": "include" } },\n        alloy: { eventFilter: { _def: false, "_type^=alloy": "include" } },\n        automation: { eventFilter: { _def: false, "_type^=analytics:beacon": "include" } },\n        all: { eventFilter: { _def: true } },\n        reco: { eventFilter: { _def: false, "_type^=reco": "include" } }\n    }\n    function loadSettings() {\n        extend(biInspect.settings, objFromJsonStr(biInspect.settingsStorage.getItem("biInspectSettings")));\n    }\n    function initSettings(qsValue) {\n        biInspect.settings = extend({}, biInspect.defaultSettings);\n\n        if (typeof qsValue == "string" && qsbiInspect != "on" && qsbiInspect != "") {\n            saveSettings({ presets: qsbiInspect });\n        }\n        loadSettings();\n\n        if (typeof biInspect.settings.presets == "string" && biInspect.settings.presets != "") {\n            biInspect.settings.presets.split(",").forEach(function (presetname) {\n                if (presetname == "keepon") {\n                    biInspect.switchStorage = biInspect.settingsStorage = localStorage;\n                    return;\n                }\n                try {\n                    // review: does this need to be deep copy?\n                    extend(biInspect.settings, biInspect.settingsPresets[presetname])\n                } catch (e) { console.error("biInspect: bad preset", presetname) }\n            });\n        }\n        biInspect.switchStorage.setItem("biInspectEnabled", "true");\n    }\n    function saveSettings(newSettings, useLocalStorage) {\n        localStorage.removeItem("biInspectSettings");\n        sessionStorage.removeItem("biInspectSettings");\n        if (typeof newSettings != "string") {\n            newSettings = JSON.stringify(newSettings);\n        }\n        biInspect.settingsStorage = useLocalStorage ? localStorage : biInspect.settingsStorage;\n        biInspect.settingsStorage.setItem("biInspectSettings", newSettings);\n    }\n    biInspect.applySettings = function (newSettings, useLocalStorage) {\n        saveSettings(newSettings, useLocalStorage);\n        initSettings();\n    }\n    biInspect.modifySettings = function (addedSettings) {\n        if (typeof addedSettings != "string") {\n            addedSettings = JSON.stringify(addedSettings);\n        }\n        // review: does this need to be deep copy?\n        var newSettings = extend(objFromJsonStr(biInspect.settingsStorage.getItem("biInspectSettings"), addedSettings));\n        saveSettings(newSettings);\n        initSettings();\n    }\n    initSettings(qsbiInspect);\n    var settings = biInspect.settings;\n\n    biInspect.wrapErrorHandling = function (f) {\n        if (settings.debugInspector) {\n            return f;\n        }\n        return function () {\n            try {\n                return f.apply(this, arguments);\n            } catch (e) {\n                console.error(e);\n            }\n        }\n    }\n\n    biInspect.addHandler = function (name, condition, f) {\n        if (condition) {\n            biInspect[name] = biInspect.wrapErrorHandling(f);\n        }\n    }\n\n    biInspect.setSessionParam = function (obj, paramName) {\n        var sessionParamName = "biInspectSession-" + paramName;\n        if (biInspect.urlParams.has(paramName)) {\n            sessionStorage.setItem(sessionParamName, biInspect.urlParams.get(paramName));\n        }\n        var paramValue = sessionStorage.getItem(sessionParamName);\n        if (param) {\n            obj["_" + paramName] = paramValue;\n        }\n    }\n\n    biInspect.setSessionParams = function (obj) {\n        settings.sessionParams.forEach(param => { biInspect.setSessionParam(obj, param) });\n    }\n\n    biInspect.propDesc = {};\n    biInspect.history = [];\n    biInspect.listeners = [];\n\n    var tempBiInspectListeners = window.biInspectListeners;\n    window.biInspectListeners = {\n        push: function (listener, fullHistory) {\n            biInspect.listeners.push(biInspect.wrapErrorHandling(listener));\n            if (fullHistory != false) { // default is to catch up\n                biInspect.history.forEach(event => { // post the history of events to this new listener\n                    listener(event);\n                });\n            }\n        }\n    }\n    if (Array.isArray(tempBiInspectListeners)) {\n        tempBiInspectListeners.forEach(listener => { biInspectListeners.push(listener, false) })\n    }\n\n    var tempBiInspectEvents = window.biInspectEvents;\n    window.biInspectEvents = {\n        push: function (event) {\n            if (!testObjectMatches(event, biInspect.settings.eventFilter, true)) {\n                return; // excluded\n            }\n            biInspect.listeners.forEach(listener => {\n                var fnc = typeof listener == "function" ? listener : listener[event["_type"]] || listener["all"];\n                if (fnc) {\n                    listener(event);\n                }\n            });\n            biInspect.history.push(event);\n        }\n    }\n\n    // post any queued events to catch up\n    if (Array.isArray(tempBiInspectEvents)) {\n        tempBiInspectEvents.forEach(event => { biInspectEvents.push(event) })\n    }\n\n    const reTestProp = /(?<name>[\\[\\]\\w\\._-]+)((?<operator>(==|\\*=|\\^=|\\$=))(?<comp>.*))?/;\n    var compareOperators = {\n        "==": function (v1, m) {\n            return v1 == m.groups.comp;\n        },\n        "*=": function (v1, m) {\n            return v1.includes(m.groups.comp);\n        },\n        "^=": function (v1, m) {\n            return v1.startsWith(m.groups.comp);\n        },\n        "$=": function (v1, m) {\n            return v1.endsWith(m.groups.comp);\n        },\n        "defined": function (v1, m) {\n            return v1 !== undefined;\n        }\n    }\n\n    function testObjectMatches(event, filter, def) {\n        if (filter == null || filter == undefined) {\n            return true;\n        }\n        if (filter === "all") {\n            return true;\n        }\n        if (filter === "none") {\n            return false;\n        }\n        def = def !== undefined ? def : -1;\n        var result = -1; // undecided\n        if (filter == undefined) {\n            return def;\n        }\n        for (var k in filter) {\n            if (k == "_def") {\n                def = filter[k];\n                continue;\n            }\n            let m = k.match(reTestProp);\n            if (m != null) {\n                var operator = m.groups.operator || "defined";\n                if (!compareOperators.hasOwnProperty(operator)) {\n                    // bad name/operator\n                    continue;\n                }\n                let testresult = compareOperators[m.groups.operator || "defined"](event[m.groups.name], m);\n                let testThen = filter[k];\n                if (testresult === true && (testThen === true || testThen === "include")) {\n                    result = true;\n                    continue;\n                }\n                if (testresult === true && (testThen === false || testThen === "exclude")) {\n                    result = false;\n                    continue;\n                }\n                // result = testObjectMatches( event, testThen ); // nested rules\n            }\n        }\n        return result == -1 ? def : result;\n    }\n\n    // event history list\n    if (settings.sessionKeepEvents > 0) {\n        biInspectListeners.push(function (event) {\n\n            if (!testObjectMatches(event, settings.sessionKeepEventsFilter, true)) {\n                return;\n            }\n\n            var sessionName = settings.sessionPrefix + (new Date).getTime();\n            sessionStorage.setItem(sessionName, JSON.stringify(event, jsonReplacer));\n\n            // trim storage back to limit\n            var sessionEventKeys = Object.keys(sessionStorage).filter(e => { return e.startsWith(settings.sessionPrefix) }).sort();\n            while (sessionEventKeys.length > biInspect.settings.sessionKeepEvents) {\n                sessionStorage.removeItem(sessionEventKeys.shift()); // remove the oldest one\n            }\n            localStorage.setItem("biInspectEventLast", Date.now()); // trigger storage event for other windows\n        });\n        biInspect.getSessionEvents = function (filter, maxcount) {\n            var results = [];\n\n            // sort and reverse so they are in reverse chronological order\n            var sessionEventKeys = Object.keys(sessionStorage).filter(e => { return e.startsWith(settings.sessionPrefix) }).sort().reverse();\n            if (maxcount !== undefined) {\n                sessionEventKeys = slice(0, maxcount);\n            }\n            sessionEventKeys.forEach(key => {\n                try {\n                    results.push(JSON.parse(sessionStorage.getItem(key)));\n                } catch (ex) { }\n            });\n            if (typeof filter == "function") {\n                results = results.filter(filter);\n            } else if (filter !== undefined) {\n                results = results.filter(item => { return testObjectMatches(item, filter, false) });\n            }\n            return results.reverse(); // reverse so they are in chronological\n        };\n        biInspect.clearSessionEvents = function () {\n            var sessionEventKeys = Object.keys(sessionStorage).filter(e => { return e.startsWith(settings.sessionPrefix) });\n            while (sessionEventKeys.length > 0) {\n                sessionStorage.removeItem(sessionEventKeys.shift());\n            }\n        };\n\n    }\n\n    if (settings.inspectKey !== undefined) {\n        document.onkeydown = function (e) {\n            var evtobj = window.event ? event : e;\n            if (evtobj.keyCode == settings.inspectKey && evtobj.ctrlKey) {\n                var element = $(\':hover\');\n                if (element.length) {\n                    $(element).trigger("taginspect");\n                }\n            }\n        }\n    }\n\n    if (settings.eventsToConsoleLog) {\n        // log events to console json\n\n        biInspectListeners.push(function (event) {\n\n            if (!testObjectMatches(event, settings.eventsToConsoleLogFilter || settings.eventsFilter, true)) {\n                return;\n            }\n\n            function itemDescription(key, element, mapItem) {\n                var out = "          ".slice(0, options.i * 2);\n                if (mapItem.n != "") {\n                    out += " (" + mapItem.n + ")"\n                }\n                out += ": " + element + "\\n";\n            }\n\n            console.log("~~biInspect", JSON.stringify(event, jsonReplacer, 2));\n\n        });\n    }\n\n    if (settings.eventsToConsoleFancy) {\n        // log events to console formatted\n\n        biInspectListeners.push(function (event) {\n\n            let format = [ "~~biInspect\\n" ];\n            let values = [];\n            Object.keys(event).forEach( (key) => { \n              let keyDesc = key;\n              if ( key in adobeopt.diagBeaconDesc ) {\n                keyDesc += " " + adobeopt.diagBeaconDesc[key];\n              }\n              format.push( "%c%s: %c%o\\n" ), values.push("color:gray", keyDesc, "black", event[key] ) \n            } );\n            values.unshift( format.join("") )\n            console.log.apply( console, values );\n\n        });\n    }\n\n    function jsonReplacer(key, value) {\n        switch (key) {\n            case "event":\n            case "element":\n                return "{" + key + " object}";\n        }\n        return value\n    }\n\n    function objFromJsonStr(json) {\n        try {\n            return JSON.parse(json);\n        } catch (e) { }\n        return {};\n    }\n\n}\n\nadobeopt.diagBeaconDesc = {\n\t"event1": "Page View",\n\t"event2": "Logins",\n\t"event3": "Registration",\n\t"event4": "UNUSED",\n\t"event5": "E-spot link Click",\n\t"event6": "Navigation Click",\n\t"event7": "UNUSED",\n\t"event8": "Browse Refinement",\n\t"event9": "Membership Cancellation",\n\t"event10": "Search",\n\t"event11": "Zero Search Result",\n\t"event12": "Search Refinement",\n\t"event13": "Search Result Clickthrough",\n\t"event14": "Interface Interaction",\n\t"event15": "Compare",\n\t"event16": "Compare",\n\t"event17": "Product Page View",\n\t"event18": "UNUSED",\n\t"event19": "UNUSED",\n\t"event20": "UNUSED",\n\t"event21": "UNUSED",\n\t"event22": "UNUSED",\n\t"event23": "List Add Location",\n\t"event24": "Cart Add",\n\t"event25": "Cart Removal",\n\t"event26": "Checkout",\n\t"event27": "Pickup in Warehouse Cart Add",\n\t"event28": "DMC Visable to User",\n\t"event29": "Quantity Added to Cart",\n\t"event30": "Email Clickthrough",\n\t"event31": "External Referral Clickthrough",\n\t"event32": "Costco Referral Clickthrough",\n\t"event33": "Social Referral Clickthrough",\n\t"event34": "QR Code Referral",\n\t"event35": "UNUSED",\n\t"event36": "UNUSED",\n\t"event37": "User Interface Message Initiation",\n\t"event38": "UNUSED",\n\t"event39": "BazaarVoice Event",\n\t"event40": "Warehouse Locator Searche",\n\t"event41": "UNUSED",\n\t"event42": "Warehouse Details View",\n\t"event43": "Warehouse Directions View",\n\t"event44": "Email Signup",\n\t"event45": "Cash Card Balance Check",\n\t"event46": "UNUSED",\n\t"event47": "UNUSED",\n\t"event48": "Ink & Toner Search",\n\t"event49": "UNUSED",\n\t"event50": "Social Share",\n\t"event51": "UNUSED",\n\t"event52": "Shop Card Dollars Added to Costco Balance",\n\t"event53": "Shop Card Adds to Costco Balance",\n\t"event54": "Costco Balance Enablement Event",\n\t"event55": "UNUSED",\n\t"event56": "Checkout Events Triggered",\n\t"event57": "UNUSED",\n\t"event58": "Error Page Load",\n\t"event59": "UNUSED",\n\t"event60": "UNUSED",\n\t"event61": "UNUSED",\n\t"event62": "UNUSED",\n\t"event63": "UNUSED",\n\t"event64": "UNUSED",\n\t"event65": "UNUSED",\n\t"event66": "Diagnostic Message",\n\t"event67": "Opinion Feedback Click",\n\t"event68": "Product Recommendation Click",\n\t"event69": "Grocery Order",\n\t"event70": "Grocery Revenue",\n\t"event71": "Grocery Unit",\n\t"event72": "Product Rec Impression",\n\t"event73": "UNUSED",\n\t"event74": "UNUSED",\n\t"event75": "UNUSED",\n\t"event76": "UNUSED",\n\t"event77": "UNUSED",\n\t"event78": "UNUSED",\n\t"event79": "UNUSED",\n\t"event80": "Regular Search Result",\n\t"event81": "Corrected Search Result",\n\t"event82": "Semantic Search Result",\n\t"event83": "Loosened Search Result",\n\t"event84": "Searches Redirected",\n\t"event85": "Searched Item Number Unavailable",\n\t"event86": "UNUSED",\n\t"event87": "UNUSED",\n\t"event88": "Costco Pay Payment Method",\n\t"event89": "Promo Code Applied",\n\t"event90": "UNUSED",\n\t"event91": "UNUSED",\n\t"event92": "UNUSED",\n\t"event93": "UNUSED",\n\t"event94": "UNUSED",\n\t"event95": "UNUSED",\n\t"event96": "UNUSED",\n\t"event97": "UNUSED",\n\t"event98": "UNUSED",\n\t"event99": "UNUSED",\n\t"event100": "UNUSED",\n\t"event101": "UNUSED",\n\t"event102": "UNUSED",\n\t"event103": "UNUSED",\n\t"event104": "Traffic From Native App",\n\t"event105": "Native App eSpot Click",\n\t"event106": "UNUSED",\n\t"event107": "Push & Inbox Clickthrough",\n\t"event108": "Unchecked Browse Refinement",\n\t"event109": "My Warehouse Select",\n\t"event110": "UNUSED",\n\t"event111": "Click to Call Warehouse Initiation",\n\t"event112": "Get Directions Click",\n\t"event113": "Hero Click",\n\t"event114": "Click to Email Support",\n\t"event115": "Click to Call Support",\n\t"event116": "Coupon View",\n\t"event117": "Coupon Clip",\n\t"event118": "Coupon Remove",\n\t"event119": "UNUSED",\n\t"event120": "UNUSED",\n\t"event121": "UNUSED",\n\t"event122": "Related Offers View",\n\t"event123": "Notification Click-Through",\n\t"event124": "UNUSED",\n\t"event125": "Warehouse Event Page Load",\n\t"event126": "Share Click",\n\t"event127": "Shopping List Number",\n\t"event128": "Warehouse Detail Click",\n\t"event129": "Interaction Click",\n\t"event130": "UNUSED",\n\t"event131": "UNUSED",\n\t"event132": "Notification Sent",\n\t"event133": "UNUSED",\n\t"event134": "UNUSED",\n\t"event135": "UNUSED",\n\t"event136": "Modal Prompt",\n\t"eVar1": "Page Name",\n\t"eVar2": "Page Type",\n\t"eVar3": "Page Platform",\n\t"eVar4": "Language",\n\t"eVar5": "Espot Link Name",\n\t"eVar6": "Navigation Element",\n\t"eVar7": "Page Content Management System",\n\t"eVar8": "Browse Refinement Selection",\n\t"eVar9": "Browse Refinment Category",\n\t"eVar10": "Search Term",\n\t"eVar11": "Search Type",\n\t"eVar12": "Search Refinement Selection",\n\t"eVar13": "Search Refinement Category",\n\t"eVar14": "Interface Interaction",\n\t"eVar15": "Sort Type",\n\t"eVar16": "UNUSED",\n\t"eVar17": "UNUSED",\n\t"eVar18": "Product Detail Type",\n\t"eVar19": "Star Rating",\n\t"eVar20": "Product Membership Type",\n\t"eVar21": "Hashed Member ID",\n\t"eVar22": "Previous Page Name",\n\t"eVar23": "List Add Location",\n\t"eVar24": "Cart Add Location",\n\t"eVar25": "Member Status",\n\t"eVar26": "Authentication Status",\n\t"eVar27": "Save for Later",\n\t"eVar28": "Cart Add Quantity",\n\t"eVar29": "Cart Remove Location",\n\t"eVar30": "Email Tracking Code",\n\t"eVar31": "External Referral Code",\n\t"eVar32": "Costco Referral Code",\n\t"eVar33": "Social Referral Code",\n\t"eVar34": "QR Code",\n\t"eVar35": "Ad Butler ID",\n\t"eVar36": "Keep Me Signed In Status",\n\t"eVar37": "User Interface Message",\n\t"eVar38": "iPhone Screen Size",\n\t"eVar39": "BazaarVoice Events",\n\t"eVar40": "Warehouse Locator Search Term",\n\t"eVar41": "Warehouse Locator Source",\n\t"eVar42": "Warehouse Number",\n\t"eVar43": "Product Rec Target Experience",\n\t"eVar44": "Email Signup Source",\n\t"eVar45": "UNUSED",\n\t"eVar46": "Mobile App Present",\n\t"eVar47": "UNUSED",\n\t"eVar48": "Ink & Toner Search Term",\n\t"eVar49": "Delivery Zip Code",\n\t"eVar50": "Social Share Type",\n\t"eVar51": "UNUSED",\n\t"eVar52": "Product ID",\n\t"eVar53": "UNUSED",\n\t"eVar54": "Costco Balance Enablement",\n\t"eVar55": "SKU",\n\t"eVar56": "Checkout Event",\n\t"eVar57": "Payment Method",\n\t"eVar58": "Shipping Method",\n\t"eVar59": "Product Search Display Rank Num",\n\t"eVar60": "UNUSED",\n\t"eVar61": "UNUSED",\n\t"eVar62": "UNUSED",\n\t"eVar63": "Top Level Category",\n\t"eVar64": "Full Category String",\n\t"eVar65": "UNUSED",\n\t"eVar66": "Diagnostic Message",\n\t"eVar67": "UNUSED",\n\t"eVar68": "UNUSED",\n\t"eVar69": "Full URL",\n\t"eVar70": "Responsive State",\n\t"eVar71": "Site Name",\n\t"eVar72": "URL Query String",\n\t"eVar73": "Previous Page URL",\n\t"eVar74": "URL",\n\t"eVar75": "Build Number",\n\t"eVar76": "Product Recommendations",\n\t"eVar77": "UNUSED",\n\t"eVar78": "Product Recommendations Type",\n\t"eVar79": "UNUSED",\n\t"eVar80": "User Agent",\n\t"eVar81": "Recommendation Click Page Type",\n\t"eVar82": "Activity ID",\n\t"eVar83": "UNUSED",\n\t"eVar84": "Delivery Warehouse",\n\t"eVar85": "eSpot Link Name",\n\t"eVar86": "My Warehouse",\n\t"eVar87": "UNUSED",\n\t"eVar88": "UNUSED",\n\t"eVar89": "Promo Code",\n\t"eVar90": "Product Finding Method",\n\t"eVar91": "UNUSED",\n\t"eVar92": "Carousel Name",\n\t"eVar93": "Carousel Name Stacked",\n\t"eVar94": "Time Until Purchase",\n\t"eVar95": "Actual Search Term",\n\t"eVar96": "Corrected Search Term",\n\t"eVar97": "UNUSED",\n\t"eVar98": "UNUSED",\n\t"eVar99": "Inventory Status",\n\t"eVar100": "Testing ID",\n\t"eVar101": "UNUSED",\n\t"eVar102": "UNUSED",\n\t"eVar103": "Splash Page Duration",\n\t"eVar104": "Traffic From Native App",\n\t"eVar105": "Native App eSpot",\n\t"eVar106": "SMS Text Opt-in/Out",\n\t"eVar107": "Push & Inbox Code",\n\t"eVar108": "Unchecked Browse Refinement Selection",\n\t"eVar109": "Unchecked Browse Refinement Category",\n\t"eVar110": "UNUSED",\n\t"eVar111": "UNUSED",\n\t"eVar112": "Warehouse Dept Click to Call",\n\t"eVar113": "App Region Name",\n\t"eVar114": "Hero URL",\n\t"eVar115": "Support Department",\n\t"eVar116": "UNUSED",\n\t"eVar117": "Coupon Title",\n\t"eVar118": "Notifications Enabled",\n\t"eVar119": "Location Services Enabled",\n\t"eVar120": "UNUSED",\n\t"eVar121": "Batch Size",\n\t"eVar122": "Shopping List Keyword",\n\t"eVar123": "Notification Type",\n\t"eVar124": "UNUSED",\n\t"eVar125": "UNUSED",\n\t"eVar126": "Share Content Type",\n\t"eVar127": "Shopping List Number",\n\t"eVar128": "Biometric Login Enabled",\n\t"eVar129": "Interaction Click Name",\n\t"eVar130": "UNUSED",\n\t"eVar131": "3rd Party Tagging Opt-In/Out",\n\t"eVar132": "Notification Sent",\n\t"eVar133": "Personalized Ads Enabled",\n\t"eVar134": "Location Tracking Enabled",\n\t"eVar135": "Bluetooth",\n\t"eVar136": "Modal Name",\n\t"eVar137": "Build Version",\n    "prop11": "Lucidworks Query ID"\n}',
language:"javascript"},timeout:2e3,delayNext:!0}]},{id:"RL3580da36177b4ad4bba3e1141790d3ef",name:"01 onload#50 target shims",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%useAlloyTarget%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:'window.adobe = window.adobe || {};\nwindow.adobe.target = window.adobe.target || {};\nwindow.adobe.target.getOffer = function( options ) {\n    let pageParamsAll = window.targetPageParamsAll ? window.targetPageParamsAll() : {};\n    let sendEventParams = {\n        renderDecisions: false,\n         personalization: {\n           sendDisplayEvent: false\n        },\n        decisionScopes: [ options.mbox ],\n        type: "decisioning.propositionFetch",\n        data: {\n            "__adobe": {\n                "target": {\n                    ...pageParamsAll,\n                    ...options.params\n                }\n            }\n        }\n    };\n    adobeopt.alloy("sendEvent", sendEventParams).then( response=>{\n        if ( response?.decisions?.[0]?.items?.[0]?.schema == "https://ns.adobe.com/personalization/json-content-item" ) {\n            response = [{\n                "action": "setJson",\n                "content": [\n                  response?.decisions?.[0]?.items?.[0]?.data?.content\n                ]\n            }];\n        }\n        if ( response?.decisions?.[0]?.items?.[0]?.schema == "https://ns.adobe.com/personalization/html-content-item" ) {\n            response = [{\n                "action": "setContent",\n                "content": response?.decisions?.[0]?.items?.[0]?.data?.content\n            }];\n        }\n        options.success( response );\n    }).catch( error=>{\n        options.error( error );\n    });\n}\nwindow.adobe.target.getOffers = function (options) {\n  let pageParamsAll = window.targetPageParamsAll\n    ? window.targetPageParamsAll()\n    : {};\n  let scope = [];\n  let mboxParams = {};\n  options?.request?.execute?.mboxes.forEach((mbox) => {\n    const { name, parameters } = mbox;\n    scope.push(name);\n  });\n  let sendEventParams = {\n    renderDecisions: false,\n    personalization: {\n      sendDisplayEvent: false\n    },\n    type: "decisioning.propositionFetch",\n    decisionScopes: [...scope],\n    data: {\n      __adobe: {\n        target: {\n          ...pageParamsAll\n        },\n      },\n    },\n  };\n  adobeopt.alloy(\'sendEvent\', sendEventParams).then((response) => {\n    let meta = {};\n    if (\n      Array.isArray(response?.propositions) &&\n      response?.propositions.length > 0\n    ) {\n      let eventPropositions = response.propositions.filter((proposition) =>\n        scope.includes(proposition.scope)\n      );\n      eventPropositions.forEach((proposition) => {\n        let selector = \'\';\n        if (!proposition.scope.includes(\'data\')) {\n          try {\n            selector = \'[data-mboxph-name="\' + proposition.scope + \'"]\';\n            let mbxele = document.querySelector(selector);\n            if (mbxele != null) {\n              mbxele.dataset.mboxphStatus = \'applied\';\n              proposition.items[0].data.selector = selector;\n              proposition.items[0].data.type = \'insertAfter\';\n              const jsonMbox = {\n                name: proposition.scope,\n                options: [{ content: proposition.items[0].data.content }],\n              };\n              if (adobeopt.dom.handleJsonOffer(jsonMbox, mbxele, selector)) {\n                mbxele.dataset.mboxphStatusDet = \'jsonOffer\';\n                return;\n              }\n            }            \n          }\n          catch( ex ) { _satellite.logger.error( "mbox ph apply exception", ex ) }\n        } else {\n          selector = \'HEAD\';\n        }\n        meta[proposition.scope] = {\n          selector: selector,\n          actionType: \'appendHtml\',\n        };\n      });\n      alloy(\'applyPropositions\', {\n        propositions: eventPropositions,\n        metadata: meta,\n      }).then((response) => {\n        return response;\n      });\n    } else {\n      return response;\n    }\n  });\n};',language:"javascript"},timeout:2e3,delayNext:!0}]},{id:"RL3cbca30b3e924f0f936078ceca2bc37c",name:"BazaarVoice Order Confirmation Pixel BC-CA",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return".com"==window.location.hostname.slice(-4)&&window.location.pathname.indexOf("CheckoutConfirmationView")>-1}},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%is costco.ca?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCfdbb2dc0fff546fdbd5b9c951118f137-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL427075ac32f84f158c876a3dc431f143",name:"Analytics: CheckoutCartDisplayView",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/CheckoutCartDisplayView"}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC904ecc4bced64b8b99cce8ab61eade77-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL43f9552cd41a4ed597e1ab145f76d26b",name:"01 onload#02:My Account Rollout",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){!function(){let e=window.adobeoptMyAccountRedir={redirectApplied:!1,accountLinkHosts:["www-vqa8.costco.com","www-vqa8.costco.ca","bd-vqa5.costco.com","bd-vqa5.costco.ca","www.costco.com","www.costco.ca","www.costcobusinessdelivery.com","www.costcobusinesscentre.ca"],urlMap:{"https://www-vqa8.costco.com/myaccount/#/app/ade7213c-9a44-4b4f-909d-442cb79ec86a/accounthome":"https://www-vqa8.costco.com/my/AccountHomeView","https://www-vqa8.costco.ca/myaccount/#/app/3ae75d3d-83ec-48ab-9ceb-8509782ea7b8/accounthome":"https://www-vqa8.costco.ca/my/AccountHomeView","https://bd-vqa5.costco.com/myaccount/#/app/22d60ffe-cb9d-46f8-bab3-123fdc3b1fcc/accounthome":"https://bd-vqa5.costco.com/my/AccountHomeView","https://bd-vqa5.costco.ca/myaccount/#/app/56a1abe5-8d8d-4191-9561-4a6e5a29a195/accounthome":"https://bd-vqa5.costco.ca/my/AccountHomeView","https://www.costco.com/myaccount/#/app/4900eb1f-0c10-4bd9-99c3-c59e6c1ecebf/accounthome":"https://www.costco.com/my/AccountHomeView","https://www.costco.ca/myaccount/#/app/e442e6e6-2602-4a39-937b-8b28b4457ed3/accounthome":"https://www.costco.ca/my/AccountHomeView","https://www.costcobusinessdelivery.com/myaccount/#/app/2dd4b145-3bda-4669-ae6a-37b8cb6daf7f/accounthome":"https://www.costcobusinessdelivery.com/my/AccountHomeView","https://www.costcobusinesscentre.ca/myaccount/#/app/503fa4f8-f1ca-4086-a05c-0adc1e95135f/accounthome":"https://www.costcobusinesscentre.ca/my/AccountHomeView"},doRedirect:function(n,t){const r=e.urlMap[n];void 0!==r?(_satellite.logger.log("myaccountredir: redirecting to",r,t),document.body.style.display="none",setTimeout((function(){window.location.href=r}),0)):_satellite.logger.warn("myaccountredir: No redirection found for",n,t)},applyRedirect:function(){e.redirectApplied||(e.doRedirect(window.location.href,"pageload"),window.addEventListener("hashchange",(function(){e.doRedirect(window.location.href,"hashchange")})),e.accountLinkHosts.includes(window.location.hostname)&&document.addEventListener("click",(function(e){try{const n=e.target.closest("a");if(n){const t=n.getAttribute("href");t&&("/AccountHomeView"==t||t.endsWith("/accounthome"))&&(_satellite.logger.log("myaccountredir: redirecting link to '/my/AccountHomeView'"),e.preventDefault(),window.location.href="/my/AccountHomeView")}}catch(e){_satellite.logger.error("myaccountredir: error in click event handler",e)}})),e.redirectApplied=!0)}};"yes"===localStorage.getItem("aoptShowNewMyAccount")&&e.accountLinkHosts.includes(window.location.hostname)&&e.applyRedirect()}()}},timeout:2e3}],actions:[]},{id:"RL57505671e3444253a73d1533588e302a",name:"Reco:PDP OOS",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%is costco.com?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return"promote"==sessionStorage.getItem("aopt-pdp-oos-cos-1204")}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCbc0086bd0e4b448495d156bdc91bc6c0-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL5a37cada1c70489eb5aaf94caf19e423",name:"01 onload#05:adobeopt-core-common",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:5}],conditions:[],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{
source:'window.adobeopt = window.adobeopt || {};\nwindow.digitalDataEvents = window.digitalDataEvents || [];\n\nadobeopt.extend = function (destObj /*, ...arg1, arg2 */) {\n  for (let i = 1; i < arguments.length; i++) {\n    if (typeof arguments[i] == "object") {\n      for (let key in arguments[i]) {\n        destObj[key] = arguments[i][key];\n      }\n    }\n  }\n  return destObj;\n};\nfunction AoptModule(modname, props) {\n  this.modname = modname;\n  if (props !== undefined) {\n    adobeopt.addProps(props);\n  }\n}\nadobeopt.extend(AoptModule.prototype, {\n  addProps: function (props) {\n    adobeopt.extend(this, props);\n  },\n  ifdiag: function () { },\n  diag: function () { },\n  log: function () { },\n  inspect: function () { },\n  resolve: function () { },\n  warn: function () { },\n  error: function (type, details) {\n    console.error("~ aopt CAUGHT exception", type, details);\n  },\n  exception: function (mod, ex) {\n    this.error.apply(this, arguments);\n  },\n  trySafe: function (fncname, fnc) {\n    let aoptmod = this;\n    try {\n      return fnc();\n    } catch (ex) {\n      aoptmod.error(fncname, ex);\n    }\n  },\n  tryWrap: function (fncname, fnc) {\n    let aoptmod = this;\n    return function () {\n      try {\n        return fnc.apply(this, arguments);\n      } catch (ex) {\n        aoptmod.error(fncname, ex);\n      }\n    }\n  }\n});\nadobeopt.extend(adobeopt, {\n  AoptModule: AoptModule,\n  modules: {},\n  modulesByDesc: {},\n  fncNil: function () { },\n  fncTrue: function () { return true },\n  fncFalse: function () { return false },\n  configs: {},\n  msPageStart: Date.now(),\n  msSincePageStart: () => Date.now() - adobeopt.msPageStart,\n  isEmpty: function (val) {\n    return (val === undefined || val == null || val.length <= 0) ? true : false;\n  },\n  hasValue(v, fncTrue) {\n    switch (typeof v) {\n        case "string":\n            if (v.length == 0 || v == "na") {\n                return false;\n            }\n        case "number":\n        case "boolean":\n        case "bigint":\n            if (typeof fncTrue == "function") {\n                fncTrue(v);\n            }\n            return true;\n    }\n    return false;\n  },\n  reFilterStr: function (f, defVal) {\n    if (typeof f == "string" && f.length > 0) {\n      try {\n        f = "(" + f.split("*").join(".*").split("+").join(".+") + ")";\n        return RegExp(f);\n      } catch (e) { }\n    }\n    return { test: defVal ? adobeopt.fncTrue : adobeopt.fncFalse };\n  },\n  config: function (n, def) {\n    if (!adobeopt.configs.hasOwnProperty(n)) {\n      adobeopt.configs[n] = sessionStorage.getItem("aopt_" + n) || localStorage.getItem("aopt_" + n);\n    }\n    return adobeopt.configs[n];\n  },\n  setConfig: function (n, v, useSessionStorage) {\n    (useSessionStorage === true ? sessionStorage : localStorage).setItem("aopt_" + n, v);\n  },\n  hasConfig: function (n) {\n    return adobeopt.config(n) !== null;\n  },\n  ifConfig: function (n, fnc) {\n    return adobeopt.hasConfig(n) ? fnc(adobeopt.config(n)) : null;\n  },\n  newdiag: function () { return adobeopt.fncNil },\n  module: function (modname, modprops) {\n    let mod = adobeopt.modules[modname];\n    if (mod === undefined) {\n      mod = new AoptModule(modname);\n      adobeopt.modules[modname] = mod;\n    }\n    if (typeof modprops == "object") {\n      adobeopt.extend(mod, modprops);\n      if (mod.desc && !adobeopt.modulesByDesc.hasOwnProperty(mod.desc)) {\n        adobeopt.modulesByDesc[mod.desc] = mod;\n      }\n    }\n    return mod;\n  },\n  deepRef: function (obj, ref, def) {\n    return ref.split(".").reduce((obj, level) => obj && obj[level], obj) || def;\n  },\n  deepRefMake: function (obj, ref, def) {\n    def = typeof def !== "undefined" ? def : {};\n    let refList = ref.split(".");\n    let refParentProp = refList.pop();\n    let refParent = refList.reduce((obj, level) => {\n      if (typeof obj[level] !== "object") {\n        obj[level] = {};\n      }\n      return obj[level];\n    }, obj);\n    if ( typeof refParent[refParentProp] === "undefined" ) {\n      refParent[refParentProp] = def;\n    }\n    return refParent[refParentProp];\n  },\n  setDeepRef: function(obj, ref, value) {\n    if ( value === undefined ) {\n      return obj;\n    }\n    let refObj = obj;\n    let refParts = Array.isArray(ref) ? [...ref] : ref.split(".");\n    while (refParts.length) {\n      const refPart = refParts.shift();\n      const isLastPart = refParts.length === 0;\n      let nextObj = isLastPart ? value : {};\n      if ( refPart === "") {\n        throw new Error("Empty reference");\n      }\n      let propValue = refObj[refPart];\n      if ( refPart.endsWith("]" ) ) {\n        const [ arrayName, arrayPos ] = refPart.slice(0,-1).split("[",2);\n        if ( arrayPos === undefined) {\n          throw new Error("Bad Reference: " + refPart);\n        }\n        propValue = refObj[arrayName];\n        const arrayPosInt = parseInt(arrayPos);\n        if ( ! Array.isArray(propValue) || arrayPos == "replace" ) {\n          propValue = [];\n          refObj[arrayName] = propValue;\n        }\n        if ( arrayPos === "" || arrayPos ==="push" || arrayPos === "replace" ) {\n          propValue.push( nextObj );\n        } else if ( arrayPos ==="unshift" ) {\n          propValue.unshift( nextObj );\n        } else if ( !Number.isNaN( arrayPosInt ) ) {\n          propValue[arrayPosInt] = nextObj;\n        } else if ( arrayPos === "*" ) {\n          propValue.forEach( (item) => setDeepRef( item, refParts, value ) );\n          refParts = []; // done\n        } else {\n          throw new Error(`Invalid array position: ${arrayPos}`);\n        }\n      } else {\n        if ( propValue === undefined || isLastPart ) {\n          refObj[refPart] = nextObj;\n        } else {\n          nextObj = propValue;\n        }\n      }\n      refObj = nextObj;\n    }\n    return obj;\n  },\n  arraysHaveMutualElements: function (array1, array2) {\n    if (!Array.isArray(array1) || !Array.isArray(array2)) {\n      return false;\n    }\n    return array1.some(value => array2.includes(value));\n  },\n  fillin: function (destObj /*, ...arg1, arg2 */) {\n    for (let i = 1; i < arguments.length; i++) {\n      for (let key in arguments[i]) {\n        let v = destObj[key];\n        if (v == undefined) {\n          destObj[key] = arguments[i][key];\n        }\n      }\n    }\n    return destObj;\n  },\n  propGetOrSetDefault: function (obj, propname, def) {\n    if (!obj.hasOwnProperty(propname)) {\n      return (obj[propname] = def);\n    }\n    return obj[propname];\n  },\n  json: function (jsonStr, def) { // error catching json\n    if (typeof jsonStr === "string" && jsonStr !== "") {\n      try {\n        return JSON.parse(jsonStr);\n      } catch (ex) { }\n    }\n    return def || {};\n  },\n  jsonCookie: function (cookieName, def) {\n    return adobeopt.json(_satellite.cookie.get(cookieName), def);\n  },\n  jsonCookieRef: function (cookieName, ref, def) {\n    return adobeopt.deepRef(adobeopt.json(_satellite.cookie.get(cookieName)), ref, def);\n  },\n  reExtract(re, str, def) {\n    let match = str.match(re);\n    return match && match.length == 2 ? match[1] : def;\n  },\n  dictFromCssStr: function (str, destDict) {\n    destDict = destDict || {};\n    try {\n      if (typeof str === "string") {\n        str.split(";").forEach(function (prop) {\n          var nvp = prop.split(":", 2);\n          if (nvp.length == 2 && nvp[0].length > 0) {\n            destDict[nvp[0]] = nvp[1];\n          } else {\n            // report error\n          }\n        });\n      }\n    } catch (e) {\n      // report error\n    }\n    return destDict;\n  },\n  sessionIncCounter: function (name) {\n    try {\n      let ct = parseInt(sessionStorage.getItem(name)) || 0;\n      sessionStorage.setItem(name, ++ct);\n      return ct;\n    } catch (e) {\n      // fall through\n    }\n    return 0;\n  },\n  linkTag: function (l) {\n    l = l.toLowerCase().replace("https://", "").replace("http://", "");\n    var ich = l.indexOf("/");\n    if (ich === -1) {\n      return "";\n    }\n    return l.slice(ich + 1).replace(".html", "").replace(/[^a-z]+/g, "");\n  },\n  queryParam: function (paramName, def) {\n    const p = adobeopt.queryParamValues[paramName.toLowerCase()];\n    return typeof p == "string" && p !== \'\' ? p : def;\n  },\n  debounce: function (func, wait, immediate) {\n    var timeout;\n    return function () {\n      var context = this, args = arguments;\n      var later = function () {\n        timeout = null;\n        if (!immediate) func.apply(context, args);\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) func.apply(context, args);\n    };\n  },\n  cleanUrl: function (fromUrl) {\n    try {\n      const url = new URL(fromUrl, window.location.origin);\n      // remove encryted user context info, not useful\n      url.searchParams.delete("krypto");\n      // remove canonical info from path\n      if (url.pathname.indexOf(".product.") > -1) {\n        // strip canonical portion of path to keep v74 uniform\n        var myRegexp = /(\\.product\\..*\\.html)/g;\n        var match = myRegexp.exec(url.pathname);\n        if (match) {\n          url.pathname = "/" + match[1];\n        }\n      }\n      return url.toString();\n    } catch (ex) {\n      console.log(ex);\n      return fromUrl;\n    }\n  },\n  logBeacon: function () { }\n});\n\nlet amod = adobeopt.analytics = adobeopt.module("analytics");\nlet pmc = amod; // review: remove\nlet pcl = amod; // review: remove\nlet when = adobeopt.when = adobeopt.module("adobeopt.when");\nlet tag = adobeopt.tag = adobeopt.module("adobeopt.tag");\nlet dom = adobeopt.dom = adobeopt.module("adobeopt.dom");\nlet reco = adobeopt.reco = adobeopt.module("adobeopt.reco");\n\nadobeopt.when.poll = function (pollSettings /* optional */, func) {\n  if (arguments.length == 1 && typeof arguments[0] === "function") {\n      pollSettings = { func: arguments[0] };\n  }\n  let initSettings = adobeopt.extend({\n      func: func,\n      pollms: 250,\n      pollmax: 20,\n      intervalId: 0,\n      mod: adobeopt.when,\n      rejectOnTimeout: false\n  }, pollSettings);\n  pollSettings.name = pollSettings?.name || pollSettings?.mod?.name || "adobeopt.when.poll."+Date.now().toString();\n  function poll() {\n      let settings = this.settings;\n      let trace = [settings.pollmax];\n      settings.val = settings.func(settings);\n      if (settings.val !== undefined && settings.val !== null && settings.val !== false) {\n          trace.push("resolved");\n          settings.resolve(settings.val);\n      } else if (--settings.pollmax < 1) {\n          trace.push("rejected:timeout");\n          if (settings.rejectOnTimeout) {\n              settings.reject(new Error("timeout"));\n          }\n      } else {\n          if (settings.intervalId === 0) {\n              trace.push("setInterval");\n              settings.intervalId = setInterval(settings.nextPoll, settings.pollms);\n          } else {\n              trace.push("wait next interval");\n          }\n          settings.mod.diag(settings.name, trace);\n          return;\n      }\n      if (settings.intervalId) {\n          clearInterval(settings.intervalId);\n      }\n      settings.mod.diag(settings.name, trace);\n  }\n  function pollPromise(resolve, reject) {\n      initSettings.resolve = resolve;\n      initSettings.reject = reject;\n      initSettings.nextPoll = poll.bind({ settings: initSettings });\n      initSettings.nextPoll();\n  }\n  return new Promise(pollPromise);\n}\n\nadobeopt.when.elementExistsPoll = function (selector, settings) {\n  return adobeopt.when.poll(adobeopt.extend(settings || {}, { name: "adobeopt.when.elementReadyPoll", selector: selector }), function (settings) {\n      return document.querySelector(selector);\n  });\n};\n\n// adobeopt.when.elementExistsObserver = function (selector, settings) {\n//     settings = settings || {};\n//     return new Promise((resolve, reject) => {\n//         let el = document.querySelector(selector);\n//         if (el) {\n//             resolve(el);\n//             return;\n//         }\n//         new MutationObserver((mutationRecords, observer) => {\n//             // Query for elements matching the specified selector\n//             Array.from(document.querySelectorAll(selector)).forEach((element) => {\n//                 resolve(element);\n//                 //Once we have resolved we don\'t need the observer anymore.\n//                 observer.disconnect();\n//             });\n//         }).observe(document.documentElement, {\n//             childList: true,\n//             subtree: true\n//         });\n//     });\n// };\n\nadobeopt.when.elementExists = adobeopt.when.elementExistsPoll;\n\nadobeopt.when.refDefined = function (ref, pollsettings) {\n  return adobeopt.when.poll(adobeopt.extend(pollsettings || {}, { name: "adobeopt.when.refDefined", ref: ref }), function (settings) {\n      return adobeopt.deepRef(window, ref);\n  });\n};\n\nadobeopt.isJqueryLoaded = function () {\n  if (_satellite.getVar("isPageModernized?")) {\n      return false;\n  }\n  return (typeof window.jQuery == "function" || window.$.slick === undefined); // REVIEW\n}\n\nadobeopt.when.jQueryReady = function (fnc) {\n  let jQueryReadyPromise = null;\n  if (_satellite.getVar("isPageModernized?")) {\n      jQueryReadyPromise = new Promise(() => { });\n  } else {\n      jQueryReadyPromise = adobeopt.when.poll({ name: "adobeopt.when.jQueryReady" }, function (settings) {\n          if (typeof window.$ !== "function" || window.$.slick === undefined) { // REVIEW\n              return null;\n          }\n          return window.$;\n      });\n  }\n  if ( fnc ) { \n      return jQueryReadyPromise.then(fnc);\n  }\n  return jQueryReadyPromise;\n}\n\nadobeopt.when.domReady = function (fnc) {\n  let domReadyPromise = new Promise(resolve => {\n      if (document.readyState === "loading") {\n          document.addEventListener(\'DOMContentLoaded\', resolve)\n      } else {\n          resolve();\n      }\n  });\n  if ( fnc ) { \n      return domReadyPromise.then(fnc);\n  }\n  return domReadyPromise;\n}\n\nadobeopt.when.pageLoaded = function (fnc) {\n  let pageLoadedPromise = new Promise(resolve => {\n      if (document.readyState === "complete") {\n          window.addEventListener("load", resolve);\n      } else {\n          resolve();\n      }\n  });\n  if ( fnc ) { \n      return pageLoadedPromise.then(fnc);\n  }\n  return pageLoadedPromise;\n};\n\nadobeopt.when.targetReady = function (fnc) {\n  let targetReadyPromise = new Promise(resolve => {\n      if (adobeopt.deepRef(window, "adobe.target")) {\n          resolve();\n      } else {\n          document.addEventListener("at-library-loaded", function () {\n              resolve();\n          });\n      }\n  });\n  if ( fnc ) { \n      return targetReadyPromise.then(fnc);\n  }\n  return targetReadyPromise;\n}\n\n// adobeopt.extend( amod, {\n//   beacon: { },\n//   aaMetricsForAllEvents: {},\n//   clearBeacon: () => {\n//     amod.beacon = {\n//       aa: { events:{}, products:[], isPageView: false },\n//       data: {},\n//       xdm: {}\n//     };\n//   },\n//   addEvent: ( eventNum, val ) => { \n//     if ( typeof eventNum == "number" ) {\n//       eventNum = "event" + eventNum;\n//     }\n//     amod.beacon.aa.events[eventNum] = val || 1;\n//   },\n//   addEvar: ( eVarNum, val ) => {\n//     amod.beacon.aa["eVar" + eVarNum] = val;\n//   },\n//   addProp: ( propNum, val ) => {\n//     amod.beacon.aa["prop" + propNum] = val;\n//   },\n//   addMetric: ( metricName, val ) => {\n//     amod.beacon.aa[metricName] = val;\n//   },\n//   addProduct: ( product ) => {\n//     amod.beacon.products.push( product );\n//   },\n//   newProduct: ( product ) => {\n//     // use product class\n//   },\n//   setProdsFromDataLayerObj: ( dataLayerObj ) => {\n\n//   },\n//   setProductString: ( productString ) => {\n//     amod.beacon.productsLiteral = productString;\n//   },\n//   mergeXdmData: ( data ) => {\n//     // tbd\n//   },\n//   setBeaconRef: ( ref, val) => {\n//     adobeopt.setDeepRef( amod.beacon, ref, val );\n//   },\n//   fireBeacon: ( description ) => { // description only used on non-pageview events\n\n// if (pcl.beacon.defer === true) {\n//   delete pcl.beacon.defer;\n//   sessionStorage.setItem("aopt-analytics-deferred", JSON.stringify([pcl.beacon]));\n//   pcl.clearSObj();\n//   return;\n// }\n\n// if (pcl.beacon.isPageView === true) {\n//   pmc.fixUpReferrer(true);\n//   if (_satellite.getVar("useAlloy")) {\n//       let alloyEvent = {\n//           data: {\n//               __adobe: {\n//                   analytics: pcl.beacon\n//               }\n//           }\n//       };\n//       adobeopt.alloyFixUpXdmFromAnalytics(alloyEvent)\n//       alloy("sendEvent", alloyEvent);\n//   } else {\n//       msg = s.t(pcl.beacon);\n//   }\n//   pmc.pageLoadFired = true;\n// } else {\n//   pmc.fixUpReferrer(false);\n\n//   if (_satellite.getVar("useAlloy")) {\n//       pcl.beacon.linkType = "o";\n//       pcl.beacon.linkName = arguments[2] || "";\n//       pcl.beacon.linkUrl = window.location.href;\n//       let alloyEvent = {\n//           data: {\n//               __adobe: {\n//                   analytics: pcl.beacon\n//               }\n//           }\n//       };\n//       adobeopt.alloyFixUpXdmFromAnalytics(alloyEvent)\n//       alloy("sendEvent", alloyEvent);\n//   } else {\n//       msg = s.tl(arguments[0] || true, \'o\', arguments[2] || "", pcl.beacon);\n//   }\n// }\n// pcl.firedBeacons.push(pcl.beacon);\n// adobeopt.logBeacon(pcl.beacon, arguments.length === 2);\n// pcl.clearSObj();\n\n//     // tbd\n//   }\n// });\n// amod.clearBeacon();\n\nadobeopt.queryParamValues = {};\ntry {\n  const params = new URLSearchParams(window.location.search);\n  for (var value of params.keys()) {\n    adobeopt.queryParamValues[value.toLowerCase()] = params.get(value);\n  }\n} catch (ex) { console.error(ex) }\ntry {\n  let deferredQsParams = adobeopt.json(localStorage.getItem("aopt-deferred-attribution"));\n  if (Object.keys(deferredQsParams).length > 0) {\n    localStorage.removeItem("aopt-deferred-attribution");\n    for (let paramName in deferredQsParams) {\n      adobeopt.queryParamValues[paramName.toLowerCase()] = deferredQsParams[paramName];\n    }\n  }\n} catch (ex) { console.error(ex) }\n\nif (typeof adobeopt.diagInit == "function") {\n  adobeopt.diagInit(AoptModule);\n}\n\n// data layer\n\npmc.setFusionMetrics = function () {\n  let fusionQueryId = window?.digitalData?.fusionQueryId;\n  if (fusionQueryId !== undefined) {\n    pcl.addProp(11, fusionQueryId);\n  }\n\n  let searchTerm = window?.digitalData?.searchTerm;\n  let actualSearchTerm = window?.digitalData?.actualSearchTerm;\n  if (adobeopt.hasValue(actualSearchTerm) && actualSearchTerm !== searchTerm) {\n    pcl.addEvar(95, actualSearchTerm); // what they typed\n    pcl.addEvar(96, searchTerm); // what it was corrected to\n  }\n\n  let xfec = window?.digitalData?.xFusionExitCode?.toString?.();\n\n  switch (xfec) {\n    case "1":\n      pcl.addEvent(80);\n      break;\n    case "2":\n      pcl.addEvent(81);\n      break;\n    case "3":\n      pcl.addEvent(82);\n      // Expected output: "Mangoes and papayas are $2.79 a pound."\n      break;\n    case "4":\n      pcl.addEvent(83);\n      break;\n    case "5":\n      pcl.addEvent(84);\n      break;\n    case "6": // no results\n      pcl.addEvent(11);\n      break;\n    case "7":\n      pcl.addEvent(85);\n      break;\n  }\n}\n\npmc.searchFireDeferred = function () {\n  // report defered search initiation only if from previous page\n  try {\n    let searchInitJson = sessionStorage.getItem("aopt-searchinitiation");\n    if (searchInitJson != null) {\n      sessionStorage.removeItem("aopt-searchinitiation"); // now or never\n      let searchInit = JSON.parse(searchInitJson);\n      if (document.referrer !== searchInit.fromUrl) {\n        amod.log("searchDeferred: data found but referrer mismatch");\n      } else {\n        if (searchInit.searchKeyword == "[not found]") {\n          searchInit.searchKeyword = window?.digitalData?.actualSearchTerm || adobeopt.queryParam("keyword");\n        }\n        amod.log("searchDeferred: firing", searchInit);\n        pcl.addEvent(10);\n        pcl.addEvar(10, searchInit.searchKeyword);\n        pcl.addEvar(11, searchInit.searchType);\n        pcl.addEvar(79, searchInit.searchCat);\n        // pcl.addEvar( 95, adobeopt.deepRef( digitalData, "actualSearchTerm" ) );\n      }\n    }\n  } catch (ex) {\n    amod.exception(ex);\n  }\n}\n\npmc.pageViewTypeHandlers = {\n\n  "Search": function (data) {\n    // event10\n    // report the \n    pcl.addEvar(10, window?.digitalData?.actualSearchTerm);\n    if ( window?.digitalData?.searchProvider ) {\n      pcl.addEvar(112, window.digitalData.searchProvider);\n    }\n\n    // evar15 - REVIEW this should come from data layer\n    amod.trySafe("search-sort", function () {\n      let sortbyElement = adobeopt.dom.query("#Select_sort_by").firstNode();\n      let sortByText = sortbyElement?.options[sortbyElement.selectedIndex]?.text;\n      if (sortByText && sortByText != "") {\n        pcl.addEvar(15, sortByText);\n      }\n    });\n\n    if (window.location.search.indexOf("currentPage") == -1) { // only on first page of results\n      // generate product string from search results\n      var prodString = pmc.prodStrFromDataLayerObj(digitalData, "searchPageView");\n      pcl.setProductString(prodString);\n    }\n    pmc.setFusionMetrics();\n\n  },\n\n  "Product Detail": function (data) {\n    pcl.addEvent(17); // product detail page\n    pcl.addEvent("prodView"); // product detail page\n    var prodString = pmc.prodStrFromDataLayerObj(digitalData.product || {}, "productDetail");\n    pcl.setProductString(prodString);\n    // all products are costco next currently\n    pcl.addEvar(18, "Single SKU");\n    pcl.addEvar(20, "na");\n    pcl.addEvar(99, "in stock");\n\n    let pillElements = document.querySelectorAll(\'#product-details .pills-section .single-pill, [data-testid="product-description"] [data-testid^="PillBadge_"] [data-testid="Text"]\'); // legacy, modernized\n    let pillText = [];\n    pillElements.forEach( (e) => pillText.push( e.textContent.trim() ) );\n    if ( pillText.length > 0 ) {\n      pcl.addEvar(77, pillText.join(" | "));\n    }\n\n  }\n\n};\n\nfunction ifQueryStrParam(paramName, /* fnc or */ eventNum, evarNum, attribution, fnc) {\n  let paramVal = adobeopt.queryParam(paramName);\n  if (typeof paramVal === "string" && paramVal !== \'\') {\n    if (typeof arguments[1] === "function") {\n      fnc = arguments[1];\n    }\n    if (fnc) {\n      fnc(paramVal, arguments);\n    } else {\n      if (eventNum) {\n        pcl.addEvent(eventNum);\n      }\n      pcl.addEvar(evarNum, paramVal);\n      if (attribution) {\n        pcl.addEvar(28, attribution); // last touch attribution\n        pcl.addEvar(29, attribution); // first touch attribution\n        pmc.findingMethod = attribution;\n      }\n    }\n  }\n}\n\npmc.dlEventHandlers = {\n  "pageView": function (data, action) {\n    if (window.location.pathname == "/SinglePageCheckoutView") {\n      return;\n    }\n\n    if ( _satellite.getVar("isPageModernized?") == false ) {\n      // REVIEW: this is a hack to prevent double firing of page view\n      // only used by SinglePageCheckoutView, which is currently disabled because of errors\n      pmc.cartSinglePageCheckoutView(null, data); // set page name and type, then map\n\n      pcl.clearSObj();\n      pcl.addEvent(1);\n      let pageName = dlEventProp(data, "pageName", "pageView", "[not found]");\n      let pageType = adobeopt.deepRef(data, "pageType");\n      if (pageName.indexOf("|") > -1) {\n        if (pageType === undefined) {\n          pageType = pageName.split("|")[0].trim();\n        }\n      } else {\n        if (pageType === undefined) {\n          pageType = "[not found]";\n        } else {\n          pageName = pageType + " | " + pageName;\n        }\n      }\n      pmc.pageName = pageName;\n      pmc.pageType = pageType;\n      if (Array.isArray(data.pageCrumbs) && data.pageCrumbs.length > 0) {\n        pmc.V63BreadCrumbs = data.pageCrumbs[0];\n        pmc.V64BreadCrumbs = data.pageCrumbs.join(" | ");\n      }\n      pmc.varsForAllEvents();\n      pcl.addEvar(1, pageName);\n      pcl.addEvar(2, pageType);\n\n      // REVIEW: pick up visible data-bi-page?\n\n      adobeopt.hasValue( data.printNotifications, (v) => {\n        pcl.addEvent( 146 );\n        pcl.addEvar( 146, v );\n      });\n  \n      adobeopt.hasValue( data.emailNotifications, (v) => {\n        pcl.addEvent( 145 );\n        pcl.addEvar( 145, v );\n      });\n\n      pmc.fixUpReferrer(true);\n      pcl.submitToAnalytics();\n      return;\n    }\n\n    pcl.addEvent(1);\n    ifQueryStrParam("EMID", /* event */ 30, /* evar */ 30, "Email");\n    ifQueryStrParam("EXTID", 31, 31, "External link");\n    ifQueryStrParam("COSTID", 32, 32, "Costco link");\n    ifQueryStrParam("SOCID", 33, 33, "Social link");\n    ifQueryStrParam("QRID", 34, 34, "QR Code");\n    ifQueryStrParam("ADBUTLERID", 0, 35, "AdButler");\n    ifQueryStrParam("NATAPP", 104, 104);\n    ifQueryStrParam("NAE", 105, 105, "Native Home Espot");\n    ifQueryStrParam("PUSHID", 107, 107, "PushNotification");\n\n    adobeopt.hasValue( data.printNotifications, (v) => {\n      pcl.addEvent( 146 );\n      pcl.addEvar( 146, v );\n    });\n\n    adobeopt.hasValue( data.emailNotifications, (v) => {\n      pcl.addEvent( 145 );\n      pcl.addEvar( 145, v );\n    });\n\n    pmc.pageViewTypeHandlers?.[digitalData.pageType]?.(data);\n    pmc.searchFireDeferred(); // deferred search initiations\n    pcl.fireDeferred(); // other deferred events\n    pcl.fireEvt();\n  },\n  "search": function (data, action) { // search initiation\n\n    sessionStorage.setItem("aopt-searchinitiation", JSON.stringify({\n      fromUrl: window.location.href,\n      searchKeyword: dlEventProp(data, "searchTerm", "search", "[not found]"),\n      searchType: adobeopt.deepRef(data, "searchType", "typed"),\n      //            actualSearchTerm: adobeopt.deepRef( data, "actualSearchTerm", "[not found]" ),\n      //            fusionQueryId: adobeopt.deepRef( data, "fusionQueryId", "[not found]" ),\n      searchCat: "All Products"\n    }));\n\n    return;\n  },\n  "searchClick": function (data, action) {\n    pcl.addEvent(13); // searchClick\n    let prodString = pmc.prodStrFromDataLayerObj(data, "searchClick");\n    pcl.setProductString(prodString);\n    pmc.setFusionMetrics();\n    action.analyticsLink = \'dl:searchClick\';\n  },\n  "ui": function (data, action) {\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    pcl.addEvent(14);\n    pcl.addEvar(14, dlEventProp(data, "uiName", "ui", true));\n    action.analyticsLink = \'dl:ui\';\n    return;\n  },\n  "nav": function (data, action) {\n    // try {\n    //     if ( data.element.tagName === "A" ) {\n    //         data.linktext = cleanText( data.element.textContent );\n    //     }\n    // } catch ( ex ) { };\n    // data.navName = adobeopt.tag.resolveValue( data, dlEventProp( data, "navName", "nav", true ) );\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    //        pmc.navClick ( data.element, data.navName );\n\n    pcl.addEvent(6);\n    pcl.addEvar(6, dlEventProp(data, "navName", "nav", true));\n    action.analyticsLink = \'dl:nav\';\n\n    return;\n  },\n  "espot": function (data, action) {\n    pcl.addEvent(5);\n    pcl.addEvar(5, dlEventProp(data, "espotName", "espot", "[not found]"));\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    action.analyticsLink = \'eSpot click\';\n    return;\n  },\n  "whSearch": function (data, action) {\n    pcl.addEvent(40);\n    pcl.addEvar(40, dlEventProp(data, "whSearchTerm", "whSearch", "[not found]"));\n    pcl.addEvar(41, adobeopt.deepRef(data, "whSearchLoc", "[not found]"));\n    action.analyticsLink = \'dl:whSearch\';\n    return;\n  },\n  "uimsg": function (data, action) {\n    let uimsg = dlEventProp(data, "uimsgText", "uimsg", "[not found]");\n\n    // temporarily filter out swatch messages\n    let uimsgParts = uimsg.split(" | ");\n    if (uimsgParts.length > 1 && uimsgParts[0] === "Product Detail") {\n      if (uimsgParts[1] !== "Tooltip" && uimsgParts[1] !== "Pick-Up") {\n        return;\n      }\n    }\n\n    pcl.addEvent(37);\n    pcl.addEvar(37, uimsg);\n    if (pmc.pageLoadFired === true) {\n      action.analyticsLink = \'dl:uimsg\';\n    }\n    return;\n  },\n  "cartAdd": function (data, action) {\n\n    let prods = pmc.prodsFromDataLayerObj(data, [], "addToCart");\n    if (prods.length === 0) {\n      return;\n    }\n    pcl.addEvent(24);\n\n    var lastReco = localStorage.getItem("pmc-reco-last-clicked");\n    var lastRecoId = "";\n    var lastRecoCriteria = "";\n    var lastRecoPageType = "";\n    if (lastReco != undefined) {\n      lastReco = lastReco.split("|");\n      if (lastReco.length > 2) {\n        lastRecoId = lastReco[0];\n        lastRecoCriteria = lastReco[1];\n        lastRecoPageType = lastReco[2];\n      }\n    }\n    let cartAddLoc = dlEventProp(data, "cartAddLoc", "cartAdd", digitalData.pageType || "[not found]");\n    prods.forEach(function (prod) {\n      prod.addEvar(24, cartAddLoc);\n      if ( typeof data.channel == "string" ) {\n        prod.addEvar(16, data.channel);\n      }\n      if (prod.pid === lastRecoId) {\n        pcl.addEvar(77, lastRecoCriteria);\n        pcl.addEvar(78, lastRecoPageType);\n      }\n    });\n\n    // event can only fire with atc\n    if (data.pickupAdd !== undefined) {\n      pcl.addEvent(27);\n    }\n\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    action.analyticsLink = \'dl:cart add\';\n\n  },\n  "cartRemove": function (data, action) {\n\n    let prods = pmc.prodsFromDataLayerObj(data);\n    if (prods.length === 0) {\n      return;\n    }\n    pcl.addEvent(25);\n\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    action.analyticsLink = \'dl:cart remove\';\n  },\n  "cartSave": function (data, action) {\n\n    let prods = pmc.prodsFromDataLayerObj(data);\n    if (prods.length === 0) {\n      return;\n    }\n    let location = dlEventProp(data, "cartSaveLoc", "cartSave", digitalData.pageType || "[not found]"); // does this go in an evar?\n    pcl.addEvent(21);\n\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    action.analyticsLink = \'dl:cart save\';\n  },\n  "listRemove": function (data, action) {\n\n    let prods = pmc.prodsFromDataLayerObj(data);\n    if (prods.length === 0) {\n      return;\n    }\n    let location = dlEventProp(data, "listRemoveLoc", "listRemove", digitalData.pageType || "[not found]"); // does this go in an evar?\n    pcl.addEvent(22);\n\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    if (data.defer) {\n      pcl.beacon.defer = true;\n    }\n    action.analyticsLink = \'dl:list remove\';\n  },\n  "orderCancel": function (data, action) {\n\n    let prods = pmc.prodsFromDataLayerObj(data);\n    if (prods.length === 0) {\n      return;\n    }\n    pcl.addEvent(7);\n    pcl.addEvar(7, dlEventProp(data, "orderCancelLoc", "orderCancel", "[not found]"));\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    action.analyticsLink = \'dl:order cancel\';\n\n  },\n  "filter": function (data, action) {\n    let isSearch = data.isSearch;\n    if ( typeof isSearch === "undefined" ) {\n      isSearch = digitalDataEx.pageType?.startsWith?.("Search");\n    }\n\n    pcl.addEvent( isSearch ? 12 : 8);\n    pcl.addEvar( isSearch ? 12 : 8, typeof data.filterVal === "string" ? data.filterVal : "[not found]");\n    pcl.addEvar( isSearch ? 13 : 9, dlEventProp(data, "filterCat", "filter", "[not found]"));\n    action.analyticsLink = \'dl:filter applied\';\n\n  },\n  "filterRemove": function (data, action) {\n\n    pcl.addEvent(108);\n    pcl.addEvar(108, typeof data.filterVal === "string" ? data.filterVal : "[not found]");\n    pcl.addEvar(109, dlEventProp(data, "filterCat", "filterRemove", "[not found]"));\n    action.analyticsLink = \'dl:filter removed\';\n\n  },\n  "addListener": function (data, action) {\n    let values = data.addListener;\n    adobeopt.tag.addListener(values.on, values.dsel, values.fire);\n  },\n  "diag": function (data, action) {\n\n    pcl.addEvent(66);\n    pcl.addEvar(66, dlEventProp(data, "diagMsg", "diag", "[not found]"));\n    action.analyticsLink = \'dl:diag\';\n\n  },\n  "recoImpr": function (data, action) {\n\n    let activityId = data?.activityId || "[found found]";\n    let experienceId = data?.experienceId || "[found found]";\n    let pageType = data?.pageType || "[found found]";\n    let placementName = [activityId, experienceId, pageType].join("-");\n\n    pcl.addEvar(82, placementName);\n    pcl.addEvent(72);\n    action.analyticsLink = \'dl:recoImpr\';\n\n  },\n  "recoClick": function (data, action) {\n    let activityId = data?.activityId || "[found found]";\n    let experienceId = data?.experienceId || "[found found]";\n    let pageType = data?.pageType || "[found found]";\n    let placementName = [activityId, experienceId, pageType].join("-");\n    let findingMethod = ["TargetReco", activityId, experienceId, pageType].join(" | ");\n\n    let prods = pmc.prodsFromDataLayerObj(data, [], "recoClick");\n\n    prods.forEach((prod) => { // should be only one\n      prod.addEvar(43, experienceId);\n      prod.addEvar(83, "no"); // sponsored?\n      prod.addEvar(81, pageType);\n      pcl.addEvar(76, data.pid);\n    });\n\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    pcl.addEvar(90, findingMethod); // product finding method\n    pcl.addEvar(82, placementName);\n    pcl.addEvent(68);\n    action.analyticsLink = \'dl:recoClick\';\n\n    if (prods.length > 0) {\n      adobeopt.registerCarouselClick(data.pid, [activityId, experienceId].join("-"), pageType);\n    }\n\n  },\n  "emailSignup": function (data, action) {\n    pcl.addEvent(44);\n    pcl.addEvar(44, dlEventProp(data, "emailSignupLoc", "emailSignup", "[not found]"));\n    action.analyticsLink = \'dl:emailSignup\';\n  },\n  "checkoutEvent": function (data, action) {\n    pcl.addEvent(56);\n    pcl.addEvar(56, data.checkoutEvent);\n    action.analyticsLink = \'dl:checkoutEvent\';\n  },\n  "videoLinkClick": function (data, action) {\n    pcl.addEvent(55);\n    action.analyticsLink = \'dl:videoLinkClick\';\n  },\n  "costcoBalance": function (data, action) {\n    pcl.addEvent(54);\n    pcl.addEvar(54, dlEventProp(data, "costcoBalanceDesc", "costcoBalance", "[not found]"));\n    action.analyticsLink = \'dl:costcoBalance\';\n\n  },\n  "countBalance": function (data, action) {\n    let amt = dlEventProp(data, "dollarBalance", "countBalance", "0.00");\n    try {\n      if (typeof amt == "string") {\n        amt = parseFloat(amt);\n      } else if (typeof amt !== "number") {\n        amt = 0;\n      }\n      amt = amt.toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 2 });\n    } catch (ex) { }\n    pcl.addEvent(52, amt);\n    pcl.addEvent(53);\n    action.analyticsLink = \'dl:countBalance\';\n  },\n  "renewAuto": function (data, action) {\n    pcl.addEvent(120);\n    pcl.addEvar(120, dlEventProp(data, "renewAutoDesc", "renewAuto", "[not found]"));\n    action.analyticsLink = \'dl:costcoBalance\';\n\n  },\n  "bvTrack": function (data, action) {\n    pcl.addEvent(39);\n    pcl.addEvar(39, dlEventProp(data, "bvTrackDesc", "bvTrack", "[not found]"));\n    pcl.setProductString(pmc.prodStrFromDataLayerObj(window.digitalData || {}, "productDetail"));\n    action.analyticsLink = \'dl:bvTrack\';\n  },\n  "signIn": function (data, action) {\n    pcl.addEvent(2);\n    pcl.addEvar(65, dlEventProp(data, "signInMethod", "signIn", "[not found]") );\n    // future: when signInMethod is "New Account" fire event3\n    action.analyticsLink = \'dl:signIn\';\n  },\n  "loadBundle": function (data, action) {\n    let prods = pmc.prodsFromDataLayerObj(data, [], "loadBundle");\n    if (prods.length === 0) {\n      return;\n    }\n    pcl.setProductString(pmc.prodStrFromProds(prods));\n    pcl.addEvent(47);\n    action.analyticsLink = \'dl:signIn\';\n  }\n};\n\n/** ENDMODULE datalayer_ecom **/\n\n// DOM QUERY\n\ndom.isNodeList = function (elements) {\n  return NodeList.prototype.isPrototypeOf(elements);\n}\ndom.isNode = function (element) {\n  return Node.prototype.isPrototypeOf(element);\n}\nfunction QueryNodeList(nodeList) {\n  this.nodeLists = [];\n  this.length = 0;\n  if (nodeList) {\n      this.appendNodeList(nodeList);\n  }\n}\ndom.QueryNodeList = QueryNodeList;\nadobeopt.extend(QueryNodeList.prototype, {\n  appendNodeList: function (nodeList) {\n      if (adobeopt.dom.isNodeList(nodeList) && nodeList.length > 0) {\n          this.nodeLists.push(nodeList);\n          this.length = nodeList.length;\n      } else if (adobeopt.dom.isNode(nodeList)) {\n          this.nodeLists.push([nodeList]);\n          this.length += 1;\n      } else {\n          // warning?\n      }\n      return this;\n  },\n  forEach: function (fnc) {\n      let index = -1;\n      // REVIEW: we do this so that we don\'t need to keep converting nodeLists to arrays in order\n      // to concatenate them. The important thing is that .appendNodeList is used add them\n      // and .forEach is always used to enumerate them. With that we can swap out the implementation\n      // Array.forEach does not allow exiting early so we enumerate ourselves\n      for (let iNodeList = 0; iNodeList < this.nodeLists.length; iNodeList++) {\n          let nodeList = this.nodeLists[iNodeList];\n          for (let iNode = 0; iNode < nodeList.length; iNode++) {\n              let node = nodeList[iNode];\n              if (false === fnc(node, index++)) {\n                  return this;\n              }\n          }\n      }\n      return this;\n  },\n  each: function (fnc) { // compatible with jQuery\'s .each use of this in fnc call\n      return this.forEach(function (node, index) {\n          return fnc.call(node, index, node)\n      });\n  },\n  firstNode: function (fnc) {\n      let firstNode = this.nodeLists?.[0]?.[0];\n      if (fnc && firstNode) {\n          return fnc(firstNode);\n      }\n      return firstNode;\n  },\n  first: function () {\n      return new QueryNodeList(this.firstNode());\n  },\n  find: function (selector) {\n      let result = new QueryNodeList();\n      this.forEach((node) => result.appendNodeList(node.querySelectorAll(selector)));\n      return result;\n  },\n  closest: function (selector) {\n      let result = new QueryNodeList();\n      this.forEach((node) => result.appendNodeList(node.closest(selector)));\n      return result;\n  },\n  attr: function (attrName, attrValue) {\n      let node = this.firstNode();\n      if (node) {\n          if (attrValue !== undefined) {\n              node.setAttribute(attrName, attrValue);\n              return this;\n          } else {\n              return node.getAttribute(attrName, attrValue);\n          }\n      }\n      return undefined;\n  },\n  html: function (htmlValue) {\n      return this.firstNode((node) => {\n          if (htmlValue !== undefined) {\n              node.innerHTML = htmlValue;\n              return this;\n          }\n          return node.innerHTML;\n      });\n  },\n  outerHtml: function (htmlValue) {\n      return this.firstNode((node) => {\n          if (htmlValue !== undefined) {\n              node.outerHTML = htmlValue;\n              return this;\n          }\n          return node.outerHTML;\n      });\n  },\n  text: function (textValue) {\n      return this.firstNode((node) => {\n          if (textValue !== undefined) {\n              node.innerText = textValue;\n              return this;\n          }\n          return node.innerText;\n      });\n  },\n  closestAttr: function (attrName, def) {\n      let node = this.firstNode();\n      if (node) {\n          let attrNode = node.closest("[" + attrName + "]");\n          if (attrNode !== null) {\n              return attrNode.getAttribute(attrName);\n          }\n      }\n      return def;\n  },\n  css: function (propName, propValue) {\n      return this.forEach((node, index) => { node.style[propName] = propValue });\n  },\n  contains: function (text) { // like jQuery\'s :contains() selector\n      let result = new QueryNodeList();\n      this.forEach((node) => {\n          if (RegExp(text).test(node.textContent)) {\n              result.appendNodeList(node)\n          }\n      });\n      return result;\n  },\n  on: function (events /* , selector, data, handler */) { // like jQuerys .on() without data\n\n      return this;\n  }\n\n});\n\ndom.query = function (arg) {\n  if (typeof arg == "string") {\n      arg = document.querySelectorAll(arg);\n  }\n  return new QueryNodeList(arg);\n};\ndom.queryFirst = function (arg) {\n  if (typeof arg == "string") {\n      arg = document.querySelector(arg);\n  }\n  return new QueryNodeList(arg);\n};\n\n/** MODULE datalayer **/\n\nlet ddeCollectFromAttrib = pmc.ddeCollectFromAttrib = function (attrib, data) {\n\n  var trAttr = data.trAttr;\n  if (data.element && trAttr) {\n    if (trAttr.indexOf("data-bi-") != 0) {\n      trAttr = "data-bi-tr-" + trAttr;\n    }\n    var $element = null;\n    if (data.event) {\n      $element = dom.query(data.event.target);\n    } else if (data.element) {\n      $element = dom.query(data.element);\n    }\n    if ($element === null) {\n      return;\n    }\n    var tr = $element.attr(trAttr);\n    if (tr == undefined) { // avoid using selector unless it\'s not on the element\n      tr = $element.closest("[" + trAttr + "]").attr(trAttr);\n    }\n    if (tr != undefined) {\n      var trprops = pmc.parseDdeProps(tr);\n      for (var prop in trprops) {\n        if (!data.hasOwnProperty(prop)) { // data values override trAttrib values\n          data[prop] = trprops[prop];\n        }\n      }\n    }\n  }\n}\n\npmc.processDataLayerEventBlock = function (eventBlock) {\n\n  pcl.clearSObj();\n\n  let dlmod = adobeopt.module("datalayer");\n\n  // optionally collect values from an attribute of the element \n  if (eventBlock.hasOwnProperty("trAttr")) {\n    ddeCollectFromAttrib(eventBlock.trAttr, eventBlock);\n  }\n  // inspect with collected values\n  if (biInspectEnabled && biInspectEvents && !eventBlock.hasOwnProperty("addListener")) {\n    biInspectEvents.push(adobeopt.extend({ _type: "digitalDataEvents:push" }, eventBlock));\n  }\n\n  var eventName = eventBlock.event;\n  if (eventName !== undefined && pmc.dlEventHandlers[eventName] !== undefined && eventBlock[eventName] == undefined) {\n    eventBlock[eventName] = 1;\n  }\n  pmc.dataLayerEventBlock = eventBlock;\n  let action = {};\n  for (eventName in eventBlock) {\n    if (pmc.dlEventHandlers[eventName] !== undefined) {\n      dlmod.trySafe("processDataLayerEventBlock:" + eventName, function () {\n        pmc.dlEventHandlers[eventName](eventBlock, action);\n      });\n    }\n  }\n  if (action.analyticsLink !== undefined) {\n    pmc.fireEvt(true, \'o\', action.analyticsLink);\n  }\n  pmc.dataLayerEventBlock = undefined;\n};\n\nlet dlStrValue = pmc.dlStrValue = function (str, omit1) {\n  if ("string|boolean|number".indexOf(typeof str) > -1) {\n    str = str.toString();\n    if (omit1 == true && str == "1") {\n      return undefined;\n    }\n    if (str.length > 0) {\n      return str;\n    }\n  }\n  return undefined;\n}\n\nlet dlEventProp = pmc.dlEventProp = function (data, propName, evtName, def) {\n  var r = dlStrValue(data[propName]);\n  if (r !== undefined) {\n    return r;\n  }\n  var r = dlStrValue(data[evtName], true);\n  if (r !== undefined) {\n    return r;\n  }\n  return def;\n}\n\npmc.parseDdeProps = function (str, element) {\n  var dlo = {};\n  if (element) {\n    dlo.element = element;\n  }\n  var props = str.split(";");\n  props.forEach(function (prop, i) {\n    var args = prop.split(":", 2);\n    dlo[args[0]] = args.length == 2 ? args[1] : 1;\n    if (args[0] != "pageView" && pmc.dlEventHandlers.hasOwnProperty(args[0])) {\n      dlo["event"] = args[0];\n    }\n  });\n  return dlo;\n}\n\n// xdm fix up\n\nconst obfusProduct = {\n  "_id": "9999999",\n  "SKU": "9999999",\n  "currencyCode": "USD",\n  "name": "Generic Health Item",\n  "priceTotal": 0.00,\n  "productImageUrl": "https://" + window.location.hostname,\n  "quantity": 1,\n  "unitOfMeasure": "",\n  "product": "https://" + window.location.hostname\n};\nadobeopt.pageProductData = {}; // products on page by SKU\nadobeopt.pageProductDataByPid = {\n  \'9999999\': obfusProduct\n}; // by product id (sometimes we don\'t have sku)\n\nadobeopt.getPageProductData = function () {\n  if (Object.keys(adobeopt.pageProductData).length > 0) {\n    return adobeopt.pageProductData;\n  }\n  let productDataList = Object.entries(window).filter((nvp) => {\n    if (nvp[0].startsWith("adobeProductData")) {\n      if (Array.isArray(nvp[1])) {\n        nvp[1] = nvp[1][0];\n      }\n      nvp[0] = nvp[0].replace("adobeProductData", "");\n      if (nvp[0] == "" && nvp[1].SKU !== undefined) { // pdp\n        nvp[0] = nvp[1].SKU;\n      }\n      nvp[1] = { ...nvp[1] }; // shallow copy\n      return true;\n    }\n    return false;\n  });\n  productDataList.push([\'9999999\', obfusProduct]);\n  adobeopt.pageProductData = Object.fromEntries(productDataList); // by sku\n\n  try {\n    // scraping values on cart page\n    if (window.location.pathname == "/CheckoutCartDisplayView") {\n      for (const [sku, value] of Object.entries(adobeopt.pageProductData)) {\n        let $item = $(\'.order-item:has([data-orderitemnumber="\' + sku + \'"]\').first();\n        if ($item.length == 1) {\n          if (!$item.is("[data-bi-private]") && sku !== "9999999") {\n            value.productImageUrl = $item.find(".item-thumbnail img").attr("src");\n            value.product = $item.find(\'.product-title a\').attr(\'href\');\n          }\n        }\n      }\n    }\n\n    // scraping values on modernized search results/category page\n    if (digitalData?.pagePlatform == \'react\' && (digitalData?.pageType == \'Category\' || digitalData?.pageType == \'Search\')) {\n      adobeopt.dom.query(\'[data-testid^="ProductTile_"]\')?.forEach((tileNode) => {\n        let tile = adobeopt.dom.query(tileNode);\n        let attributes = {\n          _id: tile.attr("data-testid").replace("ProductTile_", ""),\n          name: tile.find(\'[data-testid="Link"] span\')?.text(),\n          product: tile.find(\'a[href*=".product."]\')?.attr("href"),\n          productImageUrl: tile.find(\'[data-testid^="ProductImage"] img\')?.attr("src")\n        };\n        if (adobeopt.pageProductDataByPid[attributes._id] === undefined) {\n          adobeopt.pageProductDataByPid[attributes._id] = attributes;\n        } else {\n          adobeopt.fillin(adobeopt.pageProductDataByPid[attributes._id], attributes);\n        }\n      });\n    }\n\n  } catch (ex) { }\n\n  return adobeopt.pageProductData;\n}\n\nadobeopt.parseNameValuePairs = function (str, obj, delim, assign, allowSingle) {\n  delim = delim || \',\';\n  assign = assign || \'=\';\n  allowSingle = typeof allowSingle == \'undefined\' ? false : allowSingle;\n  obj = obj || {};\n  str.split(delim).forEach((ev) => {\n    let nvp = ev.split(assign);\n    if (nvp.length == 2) {\n      obj[nvp[0]] = nvp[1];\n    } else if (allowSingle && nvp.length == 1) {\n      obj[nvp[0]] = 1;\n    }\n  });\n  return obj;\n};\n\nadobeopt.productsFromProductStr = function( prodstr ) {\n  if ( typeof prodstr !== "string" || prodstr.length == 0 ) {\n    return [];\n  }\n  return prodstr.split(\',\').map((product) => {\n    let productInfo = {\n      pid: \'\',\n      sku: \'\',\n      quantity: 1\n    };\n    let productParts = product.split(\';\');\n    productInfo.events = adobeopt.parseNameValuePairs( productParts[4], {}, \'|\', \'=\', true );\n    productInfo.evars = adobeopt.parseNameValuePairs( productParts[5], {}, \'|\', \'=\', false );\n    productInfo.sku = productInfo.evars.eVar55 || \'\';\n    productInfo.pid = productParts[1];\n    if (Number.isInteger(productParts[2])) {\n      productInfo.quantity = productParts[2]\n    }\n    return productInfo\n  });\n};\n\nadobeopt.eventsFromEventsStr = function( aaEventStr ) {\n  if ( typeof aaEventStr !== "string" || aaEventStr.length == 0 ) {\n    return [];\n  }\n  let aaEvents = {};\n  aaEventStr.split(",").forEach( (item) => {\n    let nvp = item.split("=", 2);\n    aaEvents[nvp[0]] = nvp[1] || 1;\n  });\n  return aaEvents;\n};\n\nadobeopt.getProductListItems = function (alloyEvent, eventList) {\n  // const eventsDigitalDataProduct = [\'event17\', \'event24\'];\n  const eventsDigitalDataCart = [\'event26\', \'event56\'];\n  const eventsProductString = [\'event7\', \'event25\'];\n  let productListItems = [];\n  //  if (eventList.some((event) => eventsDigitalDataProduct.includes(event))) {\n  //    let products = adobeopt.deepRef(window, \'digitalData.product\', []);\n  //    if (products.length > 0) {\n  //      productListItems = products.map((product) => {\n  //        return {\n  //          _id: product.id,\n  //          SKU: product.sku,\n  //          quantity: product.quantity,\n  //        };\n  //      });\n  //    }\n  //  } else \n  if (eventList.some((event) => eventsDigitalDataCart.includes(event))) {\n    let products = adobeopt.deepRef(window, \'digitalData.cart.products\', []);\n    if (products.length > 0) {\n      productListItems = products.map((product) => {\n        return {\n          _id: product.id,\n          SKU: product.itemNumber,\n          quantity: product.quantity,\n        };\n      });\n    }\n  }\n  if (productListItems.length < 1) {\n    let products = alloyEvent?.data?.__adobe?.analytics?.products || \'\';\n    if (products.length > 0) {\n      productListItems = products.split(\',\').map((product) => {\n        let productInfo = {\n          _id: \'\',\n          SKU: \'\',\n          quantity: 1\n        };\n        let productParts = product.split(\';\');\n        let productEvars = adobeopt.parseNameValuePairs(\n          productParts[5],\n          {},\n          \'|\',\n          \'=\',\n          false\n        );\n        productInfo.SKU = productEvars?.eVar55 || \'\';\n        if (!eventList.includes("event25")) {\n          productInfo._id = productParts[1];\n        }\n        if (Number.isInteger(productParts[2])) {\n          productInfo.quantity = productParts[2]\n        }\n        return productInfo\n      });\n    }\n  }\n  return productListItems;\n};\n\nadobeopt.alloyEventApplyEventType = function (alloyEvent) {\n  const eventMap = {\n  purchase: "commerce.purchases",\n  event7: "commerce.cancelOrder",\n  event26: "commerce.checkouts",\n  event25: "commerce.productListRemovals",\n  event41: "commerce.productListViews",\n  event24: "commerce.productListAdds",\n  event17: "commerce.productViews",\n  event1: "web.webpagedetails.pageViews",\n    event6: "web.webinteraction.linkClicks",\n    event5: "web.webinteraction.linkClicks",\n    event14: "web.webinteraction.linkClicks",\n  event56: "commerce.checkouts"\n};\n\n  const linkClickMap = {\n    event5: { name: "espot", eVar: "eVar5" },\n    event6: { name: "navigation", eVar: "eVar6" },\n    event14: { name: "interaction", eVar: "eVar14" }\n  }\n\n  let aaEvents = alloyEvent?.data?.__adobe?.analytics?.events || "";\n  let aaEventList = aaEvents.split(",").map((item) => item.split("=", 2)[0]); // strip any event values\n  let eventType, eventName;\n  for (const [key, value] of Object.entries(eventMap)) {\n    if (aaEventList.includes(key)) {\n      eventName = key;\n      eventType = eventMap[key];\n      break;\n    }\n  }\n  if (!eventType) {\n    return alloyEvent;\n  }\n\n  adobeopt.setDeepRef(alloyEvent, "xdm.eventType", eventType);\n  if (eventType === "web.webinteraction.linkClicks") {\n    let webInteractionInfo = {\n      linkClicks: {\n        "value": 1\n      },\n      type: "other",\n    }\n    let beacon = alloyEvent?.data?.__adobe?.analytics || "";\n    let { linkUrl, linkName } = beacon;\n    let targetEvar = linkClickMap?.[eventName]?.eVar;\n    if (targetEvar) {\n      let interactionName = linkClickMap[eventName].name;\n      webInteractionInfo.name = beacon[targetEvar] ? `${interactionName} - ${beacon[targetEvar]}` : interactionName;\n    }\n    if (linkUrl) { webInteractionInfo.URL = linkUrl; }\n    adobeopt.setDeepRef(alloyEvent, "xdm.web.webInteraction", webInteractionInfo)\n  }\n  return alloyEvent;\n}\n\nadobeopt.alloyEventApplyIdentityMap = function (alloyEvent) {\n  const amcvCookieKey = "AMCV_97B21CFE5329614E0A490D45@AdobeOrg";\n  let identityCookies = {\n    "costcoHashId": \'\',\n    "hashedUserId": \'\'\n  };\n\n  identityCookies[amcvCookieKey] = \'\';\n\n  const cookieValues = _satellite.cookie.get();\n\n  Object.keys(identityCookies).forEach(key => {\n    identityCookies[key] = cookieValues[key] || null;\n  });\n\n  if (!identityCookies[amcvCookieKey]) {\n    return alloyEvent;\n  }\n\n  const updateEcidIdentity = (state, primary) => {\n    identityMap.ECID = identityMap.ECID.map(identity => ({\n      ...identity,\n      authenticatedState: state,\n      primary: primary\n    }));\n  };\n\n  const parseAmcvCookie = (cookie) => {\n    let parts = decodeURI(cookie).split(\'|\');\n    let mcidIndex = parts.findIndex((part) => part === \'MCMID\');\n    return parts[mcidIndex + 1];\n  };\n\n  let identityMap = {\n    ECID: [\n      {\n        authenticatedState: \'ambiguous\',\n        id: parseAmcvCookie(identityCookies[amcvCookieKey]),\n        primary: true,\n      },\n    ],\n  };\n\n  const { costcoHashId, hashedUserId } = identityCookies;\n\n  if (costcoHashId && hashedUserId) {\n    identityMap.costcoHashedId = [\n      {\n        authenticatedState: \'authenticated\',\n        id: identityCookies.costcoHashId,\n        primary: true,\n      },\n    ];\n    updateEcidIdentity(\'authenticated\', false);\n  } else if (costcoHashId && !hashedUserId) {\n    updateEcidIdentity(\'loggedOut\', true);\n  }\n  adobeopt.setDeepRef(alloyEvent, \'xdm.identityMap\', identityMap);\n  return alloyEvent;\n};\n\nadobeopt.dataSetMap = {\n  staging: {\n    usbc: [\n      {\n        type: "events",\n        includeEvents: ["event1", "event2"],\n        dataSetId: "67607e0e51d3002aef7b88a4" // costco_usbc_websdk_other_events_dataset\n      },\n      {\n        type: "commerce",\n        includeEvents: ["event7", "event17", "event41", "event24", "event25", "event26", "purchase"], // removed "event56"\n        dataSetId: "67607d6e0c57542af0cf0e06", // costco_usbc_websdk_commerce_events_dataset\n      }\n    ],\n    usbd_disable: [\n      {\n        type: "all",\n        dataSetId: "67979e03431c392aee0e06d8" // DEV Costco USBD WebSDK Other Events Dataset\n      }\n    ]\n  },\n  production: {\n    usbc: [\n      {\n        type: "events",\n        includeEvents: ["event1", "event2"],\n        dataSetId: "6787ec752811472aeeebd2d4" // prod costco_usbc_websdk_other_events_dataset\n      },\n      {\n        type: "commerce",\n        includeEvents: ["event7", "event17", "event41", "event24", "event25", "event26", "purchase"], // removed "event56"\n        dataSetId: "6787ecf0b54ffd2aef4b506b", // prod costco_usbc_websdk_commerce_events_dataset\n      }\n    ],\n    usbd_disable: [\n      {\n        type: "all",\n        dataSetId: "67979e03431c392aee0e06d8" // DEV Costco USBD WebSDK Other Events Dataset\n      }\n    ]\n  }\n};\nadobeopt.dataSetMap.development = adobeopt.dataSetMap.staging;\n\nadobeopt.alloyEventConfigDataSetId = function (alloyEvent) {\n  let launchEnvStage = _satellite.getVar("launchEnvStage");\n  let siteCountryStore = _satellite.getVar("siteCountryStore");\n\n  let envDataSetMap = adobeopt.dataSetMap[launchEnvStage];\n  if (envDataSetMap == undefined) {\n    return;\n  }\n  let storeDataSetMap = envDataSetMap[siteCountryStore];\n  if (!Array.isArray(storeDataSetMap)) {\n    return;\n  }\n  let aaEvents = alloyEvent?.data?.__adobe?.analytics?.events || "";\n  let aaEventList = aaEvents.split(",").map((item) => item.split("=", 2)[0]); // strip any event values\n\n  storeDataSetMap.forEach((type) => {\n    if (type.type == "all") {\n      adobeopt.setDeepRef(alloyEvent, "edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId", type.dataSetId);\n    } else if (adobeopt.arraysHaveMutualElements(aaEventList, type.includeEvents)) {\n      adobeopt.setDeepRef(alloyEvent, "edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId", type.dataSetId);\n      if (type.type == "commerce" && !aaEventList.includes("purchase")) {\n        let productListItems = [];\n        try {\n          productListItems = adobeopt.getProductListItems(alloyEvent, aaEventList);\n          adobeopt.setDeepRef(alloyEvent, "xdm.productListItems", productListItems);\n        } catch (ex) {\n        }\n      }\n    }\n  });\n  return alloyEvent;\n}\n\nadobeopt.alloyFixUpXdmFromAA = function ( alloyEvent ) {\n  // On mobile purchase we send a secondary report suite call to the mobile rsid\n\n  const aa = adobeopt.deepRef( alloyEvent, "data.__adobe.analytics", {} );\n  const aaevents = adobeopt.eventsFromEventsStr( aa.events );\n\n  adobeopt.setDeepRef( alloyEvent, "gOrders", aaevents?.event69 );\n  adobeopt.setDeepRef( alloyEvent, "diagMsg", aa?.eVar66 );\n\n};\n\n\nadobeopt.alloyGrsDate = function () {\n  const date = new Date();\n  const offset = -date.getTimezoneOffset();\n  const sign = offset >= 0 ? \'+\' : \'-\';\n  const pad = num => String(num).padStart(2, \'0\');\n  const hours = pad(Math.floor(Math.abs(offset) / 60));\n  const minutes = pad(Math.abs(offset) % 60);\n\n  return date.toISOString().replace(\'Z\', `${sign}${hours}:${minutes}`);\n}\n\nadobeopt.alloyGrsEnvMap = {\n  usbc: {\n    entity: "costco-b2c-us",\n    clientId: "b0f629b5-990c-45fc-9a8c-50787b6f8091" // filter_id\n  },\n  usbd: {\n    entity: "costco-b2b-us",\n    clientId: "3dfbf515-aa56-4ef4-b124-3089be73ad90" // filter_id\n  },\n  cabc: {\n    entity: "costco-b2c-ca",\n    clientId: "9ad5a91e-4850-4aa8-9178-3244bbcc5f5b" // filter_id\n  },\n  cabd: {\n    entity: "costco-b2b-ca",\n    clientId: "ea280899-e43c-43e3-80f1-d0f100120dad" // filter_id\n  }\n};\n\nadobeopt.alloyGrsEventCommon = function (grsData, alloyEvent) {\n  let env = adobeopt.alloyGrsEnvMap[ _satellite.getVar("siteEnv").siteCountryStore ];\n  if ( env == undefined ) {\n    return;\n  }\n\n  adobeopt.extend( grsData, {\n      "visitorId": digitalDataEx.visitorECID,\n      "eventTime": adobeopt.alloyGrsDate(),\n      "experimentIds": [],\n      "userInfo": {\n          "userId": adobeopt.deepRef( alloyEvent, "data.__adobe.analytics.eVar21", "" ), // costcoHashedId\n          "userAgent": window.navigator.userAgent\n      },\n      "uri": adobeopt.cleanUrl( window.location.href ),\n      "referrerUri": adobeopt.cleanUrl( document.referrer ),\n      "pageViewId": adobeopt.cleanUrl( window.location.href ),\n      "entity": env.entity,\n      "clientId": env.clientId\n  });\n\n  if ( digitalData?.searchProvider == "GRS" ) {\n      adobeopt.extend( grsData, {\n        "experimentIds": digitalData.experimentIds || [],\n        "entity": digitalData.entity || env.entity,\n        "clientId": env.clientId,\n        "attributionToken": digitalData?.attributionToken || ""\n    });\n  }\n\n  return grsData;\n};\n\nadobeopt.alloyGrsEventPurchase = function (grsData, alloyEvent) {\n  let products = adobeopt.deepRef( window, \'digitalData.cart.products\', [] );\n  adobeopt.extend( grsData, {\n    "eventType": "purchase-complete",\n    "productDetails": products.map( (product) => (\n        {\n            "product": {\n                "id": product.id\n            },\n            "quantity": adobeopt.intFromVal( product.quantity, 1 )\n        }\n    )),\n    "purchaseTransaction": {\n        "revenue": adobeopt.deepRef( alloyEvent, "xdm.commerce.order.priceTotal", 0.00 ),\n        "currencyCode": _satellite.getVar("siteEnv").siteCountry == "us" ? \'USD\' : \'CAD\'\n    }\n  });\n};\nadobeopt.alloyGrsEventPdpView = function (grsData, alloyEvent) {\n  let products = adobeopt.deepRef( window, \'digitalData.product\', [] );\n  if ( digitalData.pagePlatform == "react" && ! Array.isArray(products) ) {\n    products = [ products ];\n  }\n  adobeopt.extend( grsData, {\n    "eventType": "detail-page-view",\n    "productDetails": products.map( (product) => (\n        {\n            "product": {\n                "id": product.pid\n            }\n        }\n    ))\n  });\n}\nadobeopt.alloyGrsEventCartAdd = function (grsData, alloyEvent) {\n  let products = adobeopt.productsFromProductStr( alloyEvent?.data?.__adobe?.analytics?.products );\n  adobeopt.extend( grsData, {\n    "eventType": "add-to-cart",\n    "productDetails": products.map( (product) => (\n      {\n        "product": {\n            "id": product.pid\n        },\n        "quantity": adobeopt.intFromVal( product.quantity, 1 )\n      }\n    ))\n  });\n};\n\nfunction strCsvWithQuotesFromArray(arr) {\n  let result = [];\n  for (let item of arr) {\n      if (item === "") continue;\n      result.push(\'"\' + item + \'"\');\n  }\n  return result.join(",");\n}\n\nfunction grsFilterFromLw() {\n  try {\n\n    let filtersResult = {};\n    let refine = decodeURIComponent( adobeopt.queryParam("refine") );\n    if (typeof refine !== "string" || refine.length === 0) {\n      return;\n    }\n    let filters = refine.split("||");\n    for (let filter of filters) {\n      let nvp = filter.split("-");\n      if (nvp.length !== 2) {\n        continue;\n      }\n      let key = nvp[0];\n      let val = nvp[1].replaceAll("+", " ").replaceAll("[", "").replaceAll("]", "").replaceAll("%", "");\n      if (key in filtersResult) {\n        filtersResult[key].push(val);\n      } else {\n        filtersResult[key] = [val];\n      }\n    }\n    let filterSet = [];\n    let fShow = false;\n    if ("item_location_pricing_salePrice" in filtersResult) {\n      let priceFilters = [];\n      for (let priceFilter of filtersResult["item_location_pricing_salePrice"]) {\n        let priceRangeStr = priceFilter.toLowerCase().trim();\n        if (!priceRangeStr.includes(" to ")) {\n          continue;\n        }\n        let priceRangePair = priceRangeStr.split(" to ");\n        if (priceRangePair.length !== 2) {\n          continue;\n        }\n        if (parseInt(priceRangePair[1]) < parseInt(priceRangePair[0])) {\n          continue;\n        }\n        if (parseInt(priceRangePair[1]) === 0) {\n          continue;\n        }\n        if (priceRangePair[0].trim() === "") {\n          continue;\n        }\n        if (priceRangePair[1].trim() === "") {\n          continue;\n        }\n        priceFilters.push("price: IN(" + priceRangePair[0] + "," + priceRangePair[1] + ")");\n      }\n      if (priceFilters.length === 1) {\n        filterSet.push(priceFilters[0]);\n      } else if (priceFilters.length > 1) {\n        fShow = true;\n        filterSet.push("( " + priceFilters.join(" OR ") + " )");\n      }\n    }\n    if ("Brand_attr" in filtersResult) {\n      let brands = filtersResult["Brand_attr"];\n      let brandsWithQuotes = [];\n      for (let brand of brands) {\n        brand = brand.trim();\n        if (brand === "") {\n          continue;\n        }\n        brandsWithQuotes.push(\'"\' + brand + \'"\');\n      }\n      filterSet.push(\'brands: ANY(\' + brandsWithQuotes.join(", ") + ")");\n    }\n    if ("Color_attr" in filtersResult) {\n      let colors = filtersResult["Color_attr"];\n      let colorsWithQuotes = [];\n      for (let color of colors) {\n        color = color.trim();\n        if (color === "") {\n          continue;\n        }\n        colorsWithQuotes.push(\'"\' + color + \'"\');\n      }\n      filterSet.push(\'colors: ANY(\' + colorsWithQuotes.join(", ") + ")");\n    }\n    if ("item_rating_value" in filtersResult) {\n      let minimumRating = 0;\n      let ratingSet = filtersResult["item_rating_value"];\n      for (let ratingStr of ratingSet) {\n        let parts = ratingStr.split(" ");\n        if (parts.length > 0) {\n          let rating = parseInt(parts[0]);\n          if (rating > minimumRating) {\n            minimumRating = rating;\n          }\n        }\n      }\n      if (minimumRating > 0) {\n        filterSet.push(\'rating: IN(\' + minimumRating + ",5)");\n      }\n    }\n    if ("Men_s_Size_attr" in filtersResult) {\n      filterSet.push(\'genders: ANY("male")\')\n    }\n    if ("Women_s_Size_attr" in filtersResult) {\n      filterSet.push(\'genders: ANY("female")\')\n    }\n    if ("item_program_eligibility" in filtersResult) {\n      let programSet = filtersResult["item_program_eligibility"];\n      if (programSet.length > 1) {\n        filterSet.push(\'attributes.program_types: ANY(\' + strCsvWithQuotesFromArray(programSet) + \')\');\n      }\n    }\n    return filterSet.join(" AND ");\n  } catch (e) {\n    amod.warn( "grsFilterFromLw:exception", e );\n  }\n  return "";\n}\n\nadobeopt.alloyGrsEventSearch = function (grsData, alloyEvent) {\n  let products = adobeopt.productsFromProductStr( alloyEvent?.data?.__adobe?.analytics?.products );\n  let offset = adobeopt.intFromVal( adobeopt.queryParam("currentpage"), 1 ) - 1;\n  adobeopt.extend( grsData, {\n    "eventType": "search",\n    "searchQuery": adobeopt.deepRef( alloyEvent, "data.__adobe.analytics.eVar10", "" ),\n    "productDetails": products.map( (product) => (\n      {\n          "product": {\n              "id": product.pid\n          }\n      }\n    )),\n    "offset": offset\n  });\n  if ( digitalData.searchProvider == "GRS" ) {\n    grsData.searchQuery = digitalData.actualSearchTerm || adobeopt.deepRef( alloyEvent, "data.__adobe.analytics.eVar10", "" );\n    grsData.filter = digitalData.filter.join(" AND ");\n  } else {\n    grsData.filter = grsFilterFromLw();\n  }\n\n  adobeopt.alloyGrsEventCommon( grsData, alloyEvent );\n};\n\nadobeopt.alloyGrsEvent = function (alloyEvent) {\n  try {\n    let grsData = {};\n    let aaEvents = adobeopt.eventsFromEventsStr( alloyEvent?.data?.__adobe?.analytics?.events );\n  \n    if ( (window.location.pathname == "/s" || window.location.pathname == "/CatalogSearch") && aaEvents.event1 ) {\n      adobeopt.alloyGrsEventSearch( grsData, alloyEvent );\n    } else if ( aaEvents.event17 ) {\n      adobeopt.alloyGrsEventPdpView( grsData, alloyEvent );\n    } else if ( aaEvents.event24 ) {\n      adobeopt.alloyGrsEventCartAdd( grsData, alloyEvent );\n    } else if ( aaEvents.purchase ) {\n      adobeopt.alloyGrsEventPurchase( grsData, alloyEvent );\n    } else {\n      return\n    }\n    if ( Object.keys( grsData ).length > 0 ) {\n      adobeopt.alloyGrsEventCommon( grsData, alloyEvent );\n      adobeopt.setDeepRef( alloyEvent, "data.grs", grsData );\n      adobeopt.module("grs").inspect("event", grsData);\n    }  \n  } catch ( ex ) {\n    adobeopt.module("grs").warn( "alloyGrsEvent:exception", ex );\n  }\n};\n\nadobeopt.alloyFixUpXdmFromAnalytics = function (alloyEvent) {\n  adobeopt.alloyEventApplyIdentityMap(alloyEvent);\n  adobeopt.alloyEventConfigDataSetId(alloyEvent);\n  adobeopt.alloyEventApplyEventType(alloyEvent);\n  adobeopt.alloyGrsEvent(alloyEvent);\n\n  // fix any type issues in xdm\n  try {\n    let pageProductData = adobeopt.getPageProductData();\n    if (Array.isArray(alloyEvent?.xdm?.productListItems)) {\n      alloyEvent.xdm.productListItems.forEach((prod) => {\n        if (pageProductData[prod.SKU]) {\n          adobeopt.fillin(prod, pageProductData[prod.SKU]); // augment products from pageProductData\n        } else if (adobeopt?.pageProductDataByPid[prod._id]) {\n          adobeopt.fillin(prod, adobeopt.pageProductDataByPid[prod._id]);\n        }\n        if (typeof prod.quantity == "string") {\n          prod.quantity = parseInt(prod.quantity) || 1;\n        }\n        if (typeof prod.priceTotal === "string") {\n          prod.priceTotal = adobeopt.currencyFromVal(prod.priceTotal);\n        }\n        if (prod.product === "www.costco.com") {\n          prod.product === "https://www.costco.com/";\n        }\n        if (prod.productImageUrl === "www.costco.com") {\n          prod.productImageUrl === "https://www.costco.com/";\n        }\n        if (typeof prod._id == "string") {\n          prod._id = prod._id.replace(/\\s/g, \'\'); // remove spaces etc. LINK FEE\n        }\n      });\n    }\n    let orderPriceTotal = alloyEvent?.xdm?.commerce?.order?.priceTotal;\n    if (typeof orderPriceTotal === "string") {\n      alloyEvent.xdm.commerce.order.priceTotal = adobeopt.currencyFromVal(orderPriceTotal);\n    }\n  } catch (ex) { }\n\n  try {\n    let eVar75List = [adobeopt.deepRef(alloyEvent, "data.__adobe.analytics.eVar75", "")];\n    eVar75List.push(_satellite.getVar("siteCountryStore"));\n    eVar75List.push(_satellite.getVar("launchEnvStage"));\n    eVar75List.push(_satellite.getVar("launchEnvStage") == "production" ? _satellite.getVar("dataStream - Production") : _satellite.getVar("dataStream - Staging"));\n    eVar75List.push(adobeopt.deepRef(alloyEvent, "edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId", "noDataSetIdOverride"));\n    adobeopt.setDeepRef(alloyEvent, "data.__adobe.analytics.eVar75", eVar75List.join(" "));\n  } catch (ex) { }\n\n  adobeopt.module("alloy").inspect("event:analytics", alloyEvent);\n  return alloyEvent;\n};\n\nadobeopt.currencyFromVal = function (val) {\n  try {\n    if (typeof val === \'string\') {\n      val = parseFloat(val);\n    }\n    val = parseFloat(val.toFixed(2));\n    return Number.isNaN(val) ? 0 : val;\n  } catch (ex) { }\n  return 0;\n};\n\nadobeopt.intFromVal = function (val, def) {\n  def = def == undefined ? 0 : def;\n  try {\n    if (typeof val === \'string\') {\n      val = parseInt(val);\n    } else if ( typeof val !== \'number\' ) {\n      return def;\n    }\n    return Number.isNaN(val) ? def : val;\n  } catch (ex) { }\n  return def;\n};\n\nadobeopt.registerCarouselClick = function (pid, placement, pagetype) {\n  function add(a, v) {\n    var pi = a.indexOf(v);\n    if (pi > -1) {\n      return pi;\n    }\n    return a.push(v) - 1;\n  }\n\n  if (placement.toLowerCase().indexOf("criteo") > -1) {\n    sessionStorage.setItem("analytics-findingmethod", "Criteo");\n  }\n\n  var ls = localStorage.getItem("merkle-caro-clk");\n  var jsEmpty = {\n    pt: [],\n    pl: [],\n    i: {}\n  };\n  var js = jsEmpty;\n\n  try {\n    if (ls != null) {\n      js = JSON.parse(ls);\n    }\n  } catch (e) {\n    js = jsEmpty;\n  }\n\n  // remove > 30 days\n  let msExpiredBefore = Date.now();\n  msExpiredBefore -= 2592000000; // 30 days\n  for (var k in js.i) {\n    if (js.i[k].w < msExpiredBefore) {\n      _satellite.logger.log("~~ removing", k);\n      delete js.i[k]; // remove from object\n    }\n  }\n\n  if (!js.i.hasOwnProperty(pid)) {\n    let pi = add(js.pl, placement);\n    let pt = add(js.pt, pagetype);\n    js.i[pid] = {\n      p: [pi],\n      t: pt,\n      w: Date.now()\n    }\n  } else {\n    let pi = add(js.pl, placement);\n    let carouselData = js.i[pid].p;\n    if (carouselData.indexOf(pi) == -1) { // only add if it hasn\'t been added from this carousel before\n      carouselData.push(pi);\n    }\n  }\n\n  localStorage.setItem("merkle-caro-clk", JSON.stringify(js));\n  //    if (biInspectEnabled) {\n  //        _satellite.logger.log(pmc.caroClickPurchEvars(pid), js);\n  //    }\n}\n\nadobeopt.caroClickPurchEvars = function (pid) {\n  var pstr = "";\n  caroClicks: try {\n    var ls = localStorage.getItem("merkle-caro-clk");\n\n    if (ls == null) {\n      break caroClicks;\n    }\n    js = JSON.parse(ls);\n    if (!js.i.hasOwnProperty(pid)) {\n      break caroClicks;\n    }\n    var item = js.i[pid];\n    var placement = [];\n    var now = Date.now();\n\n    // REVIEW: debug function to allow testing with future dates\n    var debugNow = localStorage.getItem("merkle-caro-test-now");\n    if (debugNow != null) {\n      now = Date.parse(debugNow);\n    }\n\n    item.p.forEach(function (ei) {\n      placement.push(js.pl[ei]);\n    });\n    placement = placement.join("-");\n    var msSinceFirstSeen = now - item.w;\n    var firstClick = "";\n    if (msSinceFirstSeen < 86400000) { // 1 day\n      // less than a day\n      var hours = Math.round(msSinceFirstSeen / 3600000); // hours\n      firstClick = hours.toString() + "h";\n    } else {\n      var days = Math.round(msSinceFirstSeen / 86400000); // 1 day\n      firstClick = days.toString() + "d";\n    }\n    pstr += "|eVar92=" + js.pl[item.p[0]];\n    pstr += "|eVar94=" + firstClick;\n    pstr += "|eVar93=" + placement;\n\n    return pstr;\n  } catch (ex) { }\n  return "";\n};\n\nwindow.aoptBvTrack = {\n  eVar39: "",\n  tl: function () {\n    digitalDataEvents.push({ bvTrack: window.aoptBvTrack.eVar39 });\n  }\n}',
language:"javascript"},timeout:2e3,delayNext:!0}]},{id:"RL68e6767562f140afaa6b01c86940d55e",name:"02 domready#40 analytics-page-default",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:40}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%enabled:analytics%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%analyticsForThisPage%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{global:!1,source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCc9359c27867d4ef7bf24d2031bd35e83-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL696f50953a8345eb827aa5007fa4b1a6",name:"OpinionLab CA",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){function e(e,n){return e.slice(-n.length)==n}return loc=window.location,!($('#header img[title="Costco Pharmacy"]').length>0||!e(loc.host,".ca")||loc.href.indexOf("/employee-website.html")>-1||loc.href.indexOf("/CashCardBalanceForm")>-1)}},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%Is BD?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%enabled:opinionlab%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{global:!0,source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC04f4495d16dc4d7d9b2654cf79993355-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL9aa4d2ec55bc4c04b858a910dd24f9a4",name:"Analytics:SinglePageCheckoutView",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/SinglePageCheckoutView"}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCd3cef28764ba4805ad924803864625fa-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL9b6efb7f40a64c39b272d3e6313de452",name:"Purchase Tracking",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"CheckoutConfirmationView_v2",valueIsRegex:!0}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC5995372de6de4d2f858bee00a88f736c-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RL9df8c5dc1caf493a8cc802f95e616a3a",name:"BazaarVoice Order Confirmation Pixel BC-US",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return".com"==window.location.hostname.slice(-4)&&window.location.pathname.indexOf("CheckoutConfirmationView")>-1}},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%is costco.com?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC8c7c2f22522b451c81929fc9eeefc5df-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLa94b1c1d6a674fb1bf68697e491c650f",name:"02 domready#30 target:websdk __view__",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:30}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%enabled:target%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%OneTrust Opt In?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%useAlloyTarget%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCefd72860ee2149539eb09a26212d790a-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLb2ba1045a9014e18b8a46acc1075a4cb",name:"02 domready#50 analytics-initdatalayer",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%analyticsForThisPage%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC57487e62f4cf436c8d7bf114deb35279-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLb36243576e2945188e66a513ddff40e1",name:"Util:Trigger Lazy domReady",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCe960cae0d495442a9a9cf8dcab5a0f5a-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLb69070d09f9b400d9225073a15cc3cfa",name:"hotfix: search private",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC4548e2c1c7ed4c3bbb6d6320810e8a1b-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLb77b97c643ab43bbb4d342658e1c3fa8",name:"Analytics: /RenewMembershipView",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/RenewMembershipView"}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC5768bb677fd946aa94e82e4ed6a73164-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLb9560deaaf4d42ce854492a52b7c4707",name:"Diag:Target:Exit Preview",events:[{modulePath:"core/src/lib/events/windowLoaded.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){try{return document.cookie.split(";").some((function(e){return e.trim().startsWith("at_qa_mode=")}))}catch(e){}return!1}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC5a892ac270c0414a8210f05d20f55a26-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLbc6c61d919b541129bb40570bc324c90",name:"Analytics:WIO",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%Is BD?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC7f996c39e6f94d40a64b386f31b4876c-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLc1046a908ab14332aaec112910ac11fc",name:"01 onload#02:queue-it vqa12",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return"www-vqa12.costco.com"==window.location.hostname}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:'<script type="text/javascript" src="//static.queue-it.net/script/queueclient.min.js"></script>\n<script\n data-queueit-intercept-domain="www-vqa12.costco.com"\n data-queueit-intercept="true"\n data-queueit-c ="costco"\n type="text/javascript" src="//static.queue-it.net/script/queueconfigloader.min.js">\n</script>',language:"html"},timeout:2e3,delayNext:!0}]},{id:"RLceee8d14afcb401481e243670d07ee4f",name:"hotfix: hide frozen: nav",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%is costco.com?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"<style>\n  #frozen-amts { display:none !important }\n  #mobile-frozen-amts { display:none !important }\n</style>",language:"html"},timeout:2e3,delayNext:!0}]},{id:"RLdaf7560df87540539f6409216c903ce7",name:"Hotfix: Hide Next Banner",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"aoptReady"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/CheckoutCartDisplayView"}]},timeout:2e3},{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return null===sessionStorage.getItem("disable-next-hf")}},timeout:2e3},{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return sessionStorage.getItem("adobeOptTiming")&&(window.adobeOptTiming=window.adobeOptTiming||[],window.adobeOptTiming.push(performance.now(),"hotfix:hideNextBanner:isbcus")),"bcus"==window.digitalDataEx.siteStoreCountry}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC017b403452c64ef5849f649140bc6fb2-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLdb1dd2627c41414587d79feb1885ff84",name:"01 onload#10:adobeopt.core legacy",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:10}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{
source:'let modTarget = adobeopt.module("target");\nlet modLaunch = adobeopt.module("launch");\n\nadobeopt.diagAopt = adobeopt.fncNil; // REVIEW, remove references\nadobeopt.diagTarget = adobeopt.fncNil;\nadobeopt.diagLaunch = adobeopt.fncNil;\n\nlet when = adobeopt.when = adobeopt.module("adobeopt.when");\nlet tag = adobeopt.tag = adobeopt.module("adobeopt.tag");\nlet dom = adobeopt.dom = adobeopt.module("adobeopt.dom");\nlet reco = adobeopt.reco = adobeopt.module("adobeopt.reco");\n\nif (_satellite.getVar("useAlloyTarget") == false) {\n\n    modTarget.trySafe("initMeta", function () {\n\n        window.ttMETA = window.ttMETA || [];\n\n        document.addEventListener("at-request-succeeded", function (e) {\n            var tokens = e.detail.responseTokens;\n            if (!adobeopt.isEmpty(tokens)) {\n                tokens.forEach(function (token) {\n                    var props = {\n                        \'CampaignName\': token["activity.name"],\n                        \'CampaignId\': token["activity.id"],\n                        \'RecipeName\': token["experience.name"],\n                        \'RecipeId\': token["experience.id"],\n                        \'OfferId\': token["option.id"],\n                        \'OfferName\': token["option.name"],\n                        \'LatestEMID\': token["profile.LatestEMID"],\n                        \'MboxName\': e.detail.mbox\n                    };\n                    window.ttMETA.push(props);\n                    modTarget.diag("at-request-succeeded", props);\n                });\n            }\n        });\n\n        if (adobeopt.isDiag) {\n            modTarget.events = ["at-library-loaded", "at-request-start", "at-request-succeeded", "at-request-failed", "at-content-rendering-start", "at-content-rendering-succeeded", "at-content-rendering-failed", "at-content-rendering-no-offers", "at-content-rendering-redirect"];\n            modTarget.diag("diag:is adobe inited", window.adobe !== undefined, adobeopt.deepRef(window, "adobe.target.events") !== undefined);\n\n            let ttMetaEvent = function (e) { modTarget.diag("event", e) };\n            for (var adobe_msg in modTarget.events) {\n                document.addEventListener(adobe_msg, ttMetaEvent);\n            }\n        }\n\n        return "complete";\n\n    });\n}\n\nadobeopt.alloy = function (event, data) {\n    return alloy(event, data)\n        .then(response => {\n            adobeopt.logTargetActivity(response);\n            return response;\n        })\n};\n\ndom.eventHandlers = { /* click: { delegates:[] } */ }; // click, submit, etc\n\nfunction objPropDef(obj, name, def) {\n    if (obj.hasOwnProperty(name)) {\n        return obj[name];\n    }\n    return (obj[name] = (typeof def == "function" ? def() : def));\n}\n\n// add a listener\ndom.on = adobeopt.listen = function (props) {\n    // props.event: "click/submit/etc"\n    // props.sel: "css selector"\n    // props.selTarget: "css selector - delegate"\n    // props.selContainer: "css for control area"\n    // props.fire: properties to fire to analytics\n    // props.handler: handler to call\n\n    const eventHandler = objPropDef(dom.eventHandlers, props.eventName, {});\n    let elementHandler = objPropDef(eventHandler, props.sel, function () {\n        let elements = $(props.sel);\n        if (elements.length == 0) {\n            // diag("warning: no elements found", props);\n        }\n        let handler = {\n            eventName: props.eventName,\n            delegates: []\n        }\n        handler.listener = function (event) { dom.dispatchEvent(handler, this, event) } // closure for handler (review: bind?)\n        $(elements).each((i, element) => {\n            element.addEventListener(props.eventName, handler.listener, { collect: true }); // passive:true, collect phase, we\'re not UI, just analytics\n        });\n        return handler;\n    });\n    elementHandler.delegates.push(props); // props can be dehydrated, we don\'t even look until something happens in this area\n    return elementHandler;\n};\n\ndom.elementContext = function (element, event) {\n    return {\n        event: event, // for template references\n        target: event.target || element, // for template references\n        element: element,\n        rootElement: element,\n        _cancelBeacon: false,\n        window: window\n    };\n};\n\ndom.dispatchEvent = function (handler, element, event) {\n    dom.diag("root delegrate hit", handler);\n    dom.dispatchEventDelegates(handler, dom.elementContext(element, event));\n};\n\ndom.dispatchEventDelegates = function (handler, context) {\n    const delegates = handler.delegates;\n    for (let i = 0; i < delegates.length; i++) {\n        let delegate = delegates[i];\n        if (dom.elementMatchesDelegate(context.element, delegate)) {\n            let props = $.extend({ props: delegate }, context);\n            diag("dispatchEventDelegates:matched", props);\n            try {\n                tag.applyObj(props.fire, props, tag.analyticsBeacon);\n            } catch (ex) { dom.exception(ex) }\n        }\n    }\n};\n\ndom.elementMatchesDelegate = function (element, delegate) {\n    // let props = tag.getPropHyd( context, delegates, i ); // allows hydration, otherwise reference directly\n    let props = delegate;\n    if (props.selTarget && !$(element).is(props.selTarget)) { // !event.target.matches( props._elementSelector ) // use jquery for selector extensiosn like :contains\n        // diag( "did not match selTarget", props );\n        return false;\n    }\n    if (props.selExclude && $(element).is(props.selExclude)) { // !event.target.matches( props._elementSelector ) // use jquery for selector extensiosn like :contains\n        // diag( "did not match, excluded by selExclude", props );\n        return false;\n    }\n    // diag( "matched", props );\n    return true;\n}\n\ndom.delegateFullSelector = function (delegate) {\n    return delegate.sel + " " + delegate.selTarget;\n}\n\n// .on has a syntax easy to translate from jquery\nadobeopt.on = function (eventName, sel) { // ... [selTarget], fncHandler, [data] )\n    if (typeof sel == "object" || sel == "") {\n        sel = "body"; // fully delegated listener\n    }\n    let props = {\n        eventName: eventName,\n        sel: sel\n    }\n    if (arguments.length == 3) {\n        props.selTarget = "";\n        props.fncLegacyListener = arguments[2];\n    } else if (arguments.length == 4) {\n        props.selTarget = arguments[2];\n        props.fncLegacyListener = arguments[3];\n    }\n    adobeopt.listen(props);\n}\n\nadobeopt.legacyListener = function (context, params) {\n    context._fncLegacyListener.call(context.element, context.event);\n    // now process beacon\n}\n\n// firing triggered values\ntag.analyticsBeacon = function (event, props, context) {\n    tag.diag("analyticsBeacon", context);\n    if (context._cancelBeacon == true) {\n        tag.diag("canceling per context._cancelBeacon");\n        return;\n    }\n    context.props = $.extend({}, props); // make a copy for resolving\n    tag.resolveValues(context, context.props);\n    digitalDataEvents.push(context.props);\n};\n\n// props; tools for collecting props associated with event\n\ntag.getObjRef = function (obj, ref, def) { // deep reference value in object (default:window)\n    def = (def == undefined) ? "" : def;\n    try {\n        for (var p = ref.split("."); p.length && obj != undefined;) {\n            obj = obj[p.shift()];\n        }\n    } catch (e) { return def }\n    return obj != undefined ? obj : def;\n};\n\ntag.applyObj = function (obj, params, defHandler) {\n    if (typeof obj == "function") {\n        return obj(params);\n    }\n    return tag.getObjRef(adobeopt, obj._type, defHandler || adobeopt.unknown)(obj, params);\n};\n\ntag.renderRef = function (context, ref) {\n    try {\n        return tag.resolveValue(context, tag.getObjRef(context, ref));\n    } catch (ex) { }\n    return "";\n};\n\ntag.renderTmpl = function (context, template) {\n    return template.replace(/\\${(.*?)}/g, function (match) {\n        return tag.renderRef(context, match.split(/\\${|}/).filter(Boolean)[0]);\n    });\n};\n\nfunction stringClass(context, valset) {\n    return (obj[propName] = String(val));\n}\n\ntag.resolveMethods = {\n    unknown: function (context, val, valset) {\n        return null;\n    },\n    function: function (context, val, valset) {\n        return val(context);\n    },\n    string: function (context, val, valset) {\n        if (tag.hydrate && val[0] == \'[\') {\n            // json/string resource\n            return tag.hydrate(context, val);\n        }\n        if (val.indexOf("${") > -1) {\n            return tag.renderTmpl(context, val);\n        }\n        valset.done = true;\n        return val;\n    },\n    object: function (context, val, valset) {\n        if (Array.isArray(valset.val)) {\n            return tag.findFirstValue(context, val);\n        }\n        valset.done = true;\n        return "";\n    },\n    stringClass: function (context, val, valset) {\n        valset.done = true;\n        return String(val);\n    },\n    boolean: stringClass,\n    number: stringClass,\n    bigint: stringClass\n}\n\ntag.resolveValue = function (context, val, def) {\n    let itermax = 0;\n    let valset = { val: val, done: false };\n    while (!valset.done && ++itermax < 10) {\n        (tag.resolveMethods[typeof valset.val] || tag.resolveMethods.unknown)(context, valset);\n    }\n    return def || "";\n};\ntag.resolveProp = function (context, obj, propName, def, destObj) {\n    destObj = destObj || obj;\n    let val = tag.resolveValue(context, obj[propName], def);\n    if (typeof val == "string") {\n        destObj[propName] = val;\n    }\n    return val;\n};\ntag.resolveValues = function (context, obj, destObj) {\n    destObj = destObj || obj;\n    for (let key in obj) {\n        tag.resolveProp(context, obj, key);\n    }\n};\n\ntag.hasValue = function (v) {\n    switch (typeof v) {\n        case "string":\n            return v.length > 0;\n        case "number":\n        case "boolean":\n        case "bigint":\n            return true;\n    }\n    return false;\n};\n\ntag.findValue = function (context /* ... valueExpr */) {\n    for (let iarg = 1; iarg < arguments.length; iarg++) {\n        let ret = tag.resolveValue(context, arguments[iarg]);\n        if (tag.hasValue(ret)) {\n            return ret;\n        }\n    }\n    return null;\n};\n\ntag.findFirstValue = function (context, values) {\n    for (let iarg = 0; iarg < values.length; iarg++) {\n        let ret = tag.resolveValue(context, values[iarg]);\n        if (tag.hasValue(ret)) {\n            return ret;\n        }\n    }\n    return null;\n};\n\n// dom scrape functions\n\ntag.closestWide = function (element, selector, maxParents) {\n    let max = maxParents || 7;\n    var f;\n    try {\n        do {\n            f = $(element).find(selector).first();\n            if (f.length > 0) {\n                return f;\n            }\n            element = element.parentElement;\n        } while (--max && element != null && element.nodeName != "BODY");\n    } catch (ex) { tag.exception(ex) }\n    return $().empty();\n};\n\n\n// diagnostic functions\n\ndom.diagShowDelegates = function (styleAttribs) {\n    styleAttribs = styleAttribs || \'::before { content:" "; position:absolute; width: 40px; height: 20px; background-color:orange; opacity:0.5 }\';\n    styleAttribs = "{border:1px solid orange}";\n    let styles = [];\n    for (let ev in dom.eventHandlers) {\n        for (let sel in dom.eventHandlers[ev]) {\n            dom.eventHandlers[ev][sel].delegates.forEach(function (del) {\n                styles.push(dom.delegateFullSelector(del) + styleAttribs);\n                // styles.push( del._fullSelector.trim() + styleAttribs2 );\n            });\n        }\n    }\n    $("#adobeopt-diag-css-styles").remove();\n    $("head").append(\'<style id="adobeopt-diag-css-styles">\' + styles.join("\\n") + "</style>");\n    dom.diag(styles);\n}\n\n// placeholder functions\n\nreco.addCarousel = function (response, element, selector) {\n    try {\n        var caroID = response.name + "-carousel";\n        var reco = JSON.parse(response.options[0].content);\n        reco.options.placementId = caroID;\n        adobeopt.dictFromCssStr(element.dataset.mboxphOptions, reco.options); // [data-mboxph-options]\n        $(element).append(\'<div id="\' + caroID + \'"></div>\'); // wrapper for result\n        merkle.reco.displayResults(reco);\n    } catch (ex) { }\n}\n\nreco.regionalProdId = function (prodid) {\n    if (digitalDataEx.site_store != "bd") {\n        return prodid;\n    }\n    return prodid + "-" + digitalDataEx.memberDeliveryWH;\n}\n\nadobeopt.unknown = function (o) {\n    dom.diag("unknown handler", o);\n}\n\nadobeopt.push = function (obj) {\n    if (Array.isArray(obj)) {\n        obj.forEach((aobj) => tag.applyObj(aobj));\n    }\n    tag.applyObj(obj);\n}\n\ndom.handleJsonOffer = function (response, element, selector) {\n    var content = adobeopt.deepRef(response, "options.0.content", "").trim();\n    if (content.indexOf(\'data-aopt-type="reco.addCarousel"\') == - 1) {\n        return false;\n    }\n    try {\n        var jsoncontent = JSON.parse(response.options[0].content);\n        var caroID = response.name + "-carousel";\n        reco.options.placementId = caroID;\n        adobeopt.dictFromCssStr(element.dataset.mboxphOptions, reco.options); // [data-mboxph-options]\n        $(element).append(\'<div id="\' + caroID + \'"></div>\'); // wrapper for result\n        merkle.reco.displayResults(jsoncontent);\n    } catch (ex) { adobeopt.aoptdiag(ex) }\n}\n\ndom.initContent = function (modname, props) {\n    let m = adobeopt.module(modname, props);\n    if (m.dataType == "domRecoJson" && m.recoJsonSelector !== undefined) {\n        try {\n            m.data = JSON.parse(document.querySelector(m.recoJsonSelector).textContent);\n        } catch (e) {\n            m.error("bad json response"); // report corrupt json\n            return;\n        }\n    }\n    let initContentType = true;\n    // you can pre-iniitalize the module and supply a "initContent" function\n    // to filter and/or replace the content. return false to prevent default content init\n    if (typeof m.initContent === "function") {\n        m.trySafe("m.initContent", function () {\n            initContentType = m.initContent(m);\n        });\n        if (initContentType === false) {\n            return;\n        }\n    }\n    switch (m.contentType) {\n        case "carousel":\n            merkle.reco.displayResults(m.data);\n            break;\n        default:\n            m.error("bad contentType");\n    }\n}\n\nif (_satellite.getVar("useAlloyTarget")) {\n\n    dom.processPlaceholders = function (requestGlobalMbox) {\n\n        var goreq = { request: { execute: { mboxes: [] } } };\n        var mboxes = goreq.request.execute.mboxes;\n        var mbxarr = document.querySelectorAll("[data-mboxph-name]:not([data-mboxph-status])"); // if they have [data-mboxph-status] they are already processing/processed\n\n        mbxarr.forEach(function (mbxele) {\n            let options = adobeopt.dictFromCssStr(mbxele.dataset.mboxphOptions);\n            if (options.reqdata == "yes") {\n                let datamboxargs = {\n                    index: mboxes.length,\n                    name: mbxele.dataset.mboxphName + "-data",\n                    parameters: adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams) // [data-mboxph-params]\n                };\n                if (options.exclude == "cart") {\n                    let cartprods = adobeopt.deepRef(window, "digitalData.cart.products", []).map(function (prod) { return reco.regionalProdId(prod.id) }).join(",");\n                    datamboxargs.parameters.excludedIds = cartprods;\n                }\n                if (options.catid == "linktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                if (options.catid == "statelinktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.memberState + "-" + digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                mboxes.push(datamboxargs);\n            }\n            let params = adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams);\n            mbxele.dataset.mboxphName.split(",").forEach(function (mboxname) {\n                mboxes.push({\n                    index: mboxes.length,\n                    name: mboxname,\n                    parameters: params // [data-mboxph-params]\n                });\n            });\n            mbxele.dataset.mboxphStatus = "requested";\n        });\n        if (mboxes.length == 0) {\n            return;\n        }\n        adobe.target.getOffers(goreq)\n    };\n    adobeopt.logTargetActivity = function (response) {\n        window.ttMETA = window.ttMETA || [];\n        let ttMETA = window.ttMETA;\n        if (response?.propositions && response?.propositions.length > 0) {\n            response?.propositions.forEach((proposition) => {\n                let activity = {};\n                if (proposition?.items && proposition?.items.length > 0) {\n                    proposition.items.forEach((item, i) => {\n                        if (i === 0 && item?.meta && Object.keys(item?.meta).length > 0) {\n                            activity = { ...item.meta };\n                        } else {\n                            activity.activityId = proposition?.scopeDetails?.activity?.id;\n                        }\n                    });\n                }\n                ttMETA.push(activity);\n            });\n        }\n    };\n} else { // useAlloyTarget == false\n\n    dom.processPlaceholders = function (requestGlobalMbox) {\n\n        var goreq = { request: { execute: { mboxes: [] } } };\n        var mboxes = goreq.request.execute.mboxes;\n        var mbxarr = document.querySelectorAll("[data-mboxph-name]:not([data-mboxph-status])"); // if they have [data-mboxph-status] they are already processing/processed\n\n        mbxarr.forEach(function (mbxele) {\n            let options = adobeopt.dictFromCssStr(mbxele.dataset.mboxphOptions);\n            if (options.reqdata == "yes") {\n                let datamboxargs = {\n                    index: mboxes.length,\n                    name: mbxele.dataset.mboxphName + "-data",\n                    parameters: adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams) // [data-mboxph-params]\n                };\n                if (options.exclude == "cart") {\n                    let cartprods = adobeopt.deepRef(window, "digitalData.cart.products", []).map(function (prod) { return reco.regionalProdId(prod.id) }).join(",");\n                    datamboxargs.parameters.excludedIds = cartprods;\n                }\n                if (options.catid == "linktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                if (options.catid == "statelinktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.memberState + "-" + digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                mboxes.push(datamboxargs);\n            }\n            let params = adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams);\n            mbxele.dataset.mboxphName.split(",").forEach(function (mboxname) {\n                mboxes.push({\n                    index: mboxes.length,\n                    name: mboxname,\n                    parameters: params // [data-mboxph-params]\n                });\n            });\n            mbxele.dataset.mboxphStatus = "requested";\n        });\n        if (mboxes.length == 0) {\n            return;\n        }\n        adobe.target.getOffers(goreq).then(function (response) {\n            response.execute.mboxes.forEach(function (el) {\n                let applyArgs = {\n                    response: {\n                        execute: {\n                            mboxes: [el]\n                        }\n                    }\n                };\n                let selector = \'[data-mboxph-name="\' + el.name + \'"]\';\n                let mbxele = document.querySelector(selector);\n                if (mbxele != null) {\n                    mbxele.dataset.mboxphStatus = "applied";\n                    applyArgs.selector = selector;\n                    if (dom.handleJsonOffer(el, mbxele, selector)) {\n                        mbxele.dataset.mboxphStatusDet = "jsonOffer";\n                        return;\n                    }\n                }\n                adobe.target.applyOffers(applyArgs);\n            });\n        });\n    }\n    // when all conditions are met process placeholders\n    Promise.all([\n        adobeopt.when.jQueryReady(),\n        adobeopt.when.targetReady(),\n        adobeopt.when.domReady(),\n    ]).then(() => {\n        adobeopt.dom.processPlaceholders();\n        setTimeout(adobeopt.dom.processPlaceholders, 2000); // again after dynamic content loads\n    });\n\n}\n\nadobeopt.logTargetActivity = function (response) {\n    window.ttMETA = window.ttMETA || [];\n    let ttMETA = window.ttMETA;\n    if (response?.propositions && response?.propositions.length > 0) {\n        response?.propositions.forEach((proposition) => {\n            let activity = {};\n            if (proposition?.items && proposition?.items.length > 0) {\n                proposition.items.forEach((item, i) => {\n                    if (i === 0 && item?.meta && Object.keys(item?.meta).length > 0) {\n                        activity = { ...item.meta };\n                    } else {\n                        activity.activityId = proposition?.scopeDetails?.activity?.id;\n                    }\n                });\n            }\n            ttMETA.push(activity);\n        });\n    }\n};\n\nwindow.digitalDataEx = window.digitalDataEx || {};\n\n(digitalDataEx.init = function (ddex) {\n\n    let modLaunch = adobeopt.module("launch");\n\n    modLaunch.trySafe("digitalDataEx:site", function () {\n\n        adobeopt.extend(ddex, _satellite.getVar("siteEnv"));\n\n        // let host = window.location.hostname.toLowerCase();\n\n        // ddex.siteLang = adobeopt.deepRef(window, "digitalData.siteLang") ||\n        //   adobeopt.tag.getObjRef(window, "wcs.locale", document.cookie.indexOf("selectedLanguage=-25") > -1 ? "fr" : "en").slice(0, 2);\n        // try {\n        //   ddex.memberLoggedIn = COSTCO.util.getMemberCookie().signedIn ? "yes" : "no";\n        // } catch (ex) {\n        //   ddex.memberLoggedIn = document.cookie.indexOf("hashedUserId") > -1 ? "yes" : "no";\n        // }\n\n        // let domainCountry = host.slice(-4) == ".com" ? "us" : "ca";\n\n        // ddex.siteReleaseEnv = "prod";\n        // ddex.siteCountry = domainCountry;\n        // ddex.siteStore = "unknown";\n        // if (host == "www.costco.com" || host == "www.costco.ca") {\n        //   ddex.siteStore = "bc";\n        // } else if (host == "www.costcobusinessdelivery.com" || host == "www.costcobusinesscentre.ca") {\n        //   ddex.siteStore = "bd";\n        // } else {\n        //   ddex.siteReleaseEnv = "nonprod";\n        //   let otcode = document.querySelector("script[data-domain-script]")?.getAttribute("data-domain-script"); // use One Trust Script Attribute\n        //   if (typeof otcode === "string") {\n        //     otcode = otcode.replace("-test", "");\n        //   }\n        //   switch (otcode) {\n        //     case "2653cf4b-5c84-40d7-a99b-fa6e1592503b":\n        //       ddex.siteCountry = "us";\n        //       ddex.siteStore = "bc";\n        //       break;\n        //     case "4325a455-ccf4-4ed6-854d-e9f4af4f7c2b":\n        //       ddex.siteCountry = "ca";\n        //       ddex.siteStore = "bc";\n        //       break;\n        //     case "5f812302-3833-47ab-8d40-4ee9060c2f41":\n        //       ddex.siteCountry = "us";\n        //       ddex.siteStore = "bd";\n        //       break;\n        //     case "d0af1630-fb74-4e09-969b-ae4f627acea8":\n        //       ddex.siteCountry = "ca";\n        //       ddex.siteStore = "bd";\n        //       break;\n        //   }\n        //   if (ddex.siteStore === "unknown" && window?.digitalData?.siteStore ) {\n        //     ddex.siteStore = window?.digitalData?.siteStore;\n        //   }\n        //   if (ddex.siteStore === "unknown") {\n        //     switch (host) {\n        //       case "ca-stage.ecom.costco.com":\n        //         ddex.siteCountry = "ca";\n        //         ddex.siteStore = "bc";\n        //         break;\n        //     }\n        //   }\n        // }\n        // ddex.siteStoreCountry = ddex.siteStore + ddex.siteCountry;\n        // ddex.siteStoreCountryLang = ddex.siteStore + ddex.siteCountry + ddex.siteLang;\n\n        ddex.memberLoggedIn = ddex.authStatus == "Authenticated" ? "yes" : "no";\n\n        ddex.siteTargetPreview = "no";\n        if (document.cookie.split(\';\').some(function (cookie) { return cookie.trim().startsWith(\'at_qa_mode=\'); })) {\n            ddex.siteTargetPreview = "yes";\n        }\n    });\n\n    modLaunch.trySafe("digitalDataEx:profile", function () {\n\n        ddex.siteLoc = "unknown";\n        try {\n            if (ddex.siteStore === "bd") {\n                let WC_BD_WHS = $.cookie("WC_BD_WHS");\n                if (typeof WC_BD_WHS == "string" && WC_BD_WHS.length > 0) {\n                    ddex.siteLoc = WC_BD_WHS;\n                }\n            } else {\n                ddex.siteLoc = adobeopt.jsonCookieRef("WAREHOUSEDELIVERY_WHS", "nearestWarehouse.catalog");\n            }\n        } catch (ex) { modTarget.exception("profile:store", ex) }\n\n        if (ddex.siteStore == "bd") {\n            ddex.memberDeliveryWH = _satellite.cookie.get("WC_BD_WHS");\n        } else {\n            ddex.memberDeliveryWH = adobeopt.jsonCookieRef(\'WAREHOUSEDELIVERY_WHS\', "groceryCenters.0", "unknown");\n            ddex.memberState = _satellite.cookie.get("invCheckStateCode") || "unknown";\n        }\n\n        let memberTypeMap = {\n            "Z00010,Z010": { level: "gold_star", type: "individual" }, // Gold Star (Individual Member)\n            "Z00020,Z010": { level: "executive", type: "individual" }, // Executive (Individual Member)\n            "Z00010,Z020": { level: "gold_star", type: "business" }, // Gold Star (Business)\n            "Z00020,Z020": { level: "executive", type: "business" } // Executive (Business)\n        };\n        let memberType = { level: "guest", type: "guest" };\n        let wcMember = _satellite.cookie.get("wcMember");\n        if (typeof wcMember == "string") {\n            for (type in memberTypeMap) {\n                if (wcMember.indexOf(type) > -1) {\n                    memberType = memberTypeMap[type];\n                    break;\n                }\n            }\n        }\n        ddex.memberLevel = memberType.level;\n        ddex.memberType = memberType.type;\n          \n        window.digitalDataEx.visitorECID = null;\n        alloy("getIdentity").then(function(result) {\n            window.digitalDataEx.visitorECID = result.identity.ECID;\n        });\n\n    });\n\n    modLaunch.trySafe("digitalDataEx:page", function () {\n        ddex.pageType = "Unknown";\n        if (window.location.pathname.indexOf(".product.") > -1) {\n            ddex.pageType = "Product Detail";\n\n            ddex.pagePdpProductId = adobeopt.reExtract(/\\.product\\.(.*)\\.html/, $(\'link[rel="canonical"]\').attr("href") || "");\n            if (!ddex.pagePdpProductId) {\n                ddex.pagePdpProductId = window.location.pathname.split(".product.")[1].split(".html")[0];\n            }\n            ddex.pagePdpProductIdTarget = ddex.pagePdpProductId;\n            if (ddex.siteStore === "bd") {\n                ddex.pagePdpProductIdTarget += "-" + ddex.siteLoc;\n            }\n        } else if (window.location.pathname == "/") {\n            ddex.pageType = "Home Page";\n        } else if (adobeopt.deepRef(window, "digitalData.pageType")) {\n            ddex.pageType = digitalData.pageType;\n        } else if (adobeopt.deepRef(window, "digitalData.page.pageType")) {\n            ddex.pageType = digitalData.page.pageType;\n        } else if (adobeopt.deepRef(window, "window.pageAnalyticsInfo.pageType")) {\n            ddex.pageType = window.pageAnalyticsInfo.pageType;\n        }\n        ddex.pageLinkTag = adobeopt.linkTag(window.location.pathname);\n\n    });\n\n    modLaunch.trySafe("digitalDataEx:session", function () {\n        let modSession = adobeopt.module("session");\n        modSession.msExpireAfter = 1200000; // 20 minutes, ms, 20 * 60 * 1000\n        let session = adobeopt.json(sessionStorage.getItem("aoptSession"), {});\n        if (session.sessionLastPageView === undefined || Date.now() - session.sessionLastPageView > modSession.msExpireAfter) {\n            session.initType = session.sessionStartMs === undefined ? "new" : "expired";\n            session.sessionNumber = adobeopt.deepRef(session, "sessionNumber", 0) + 1;\n            session.sessionPageCount = 1;\n            session.sessionStartMs = Date.now();\n        } else {\n            session.initType = "inc page";\n            session.sessionPageCount += 1;\n        }\n        session.sessionLastPageView = Date.now();\n        sessionStorage.setItem("aoptSession", JSON.stringify(session));\n        ddex.session = modSession.session = session;\n        modSession.diag("init", session);\n\n        let landingPageProps = adobeopt.json(sessionStorage.getItem("landingPage"));\n        if (landingPageProps === null || session.sessionPageCount === 1) {\n            landingPageProps = {\n                referrer: document.referrer,\n                href: window.location.href,\n                search: window.location.search\n            }\n            sessionStorage.setItem("landingPage", JSON.stringify(landingPageProps));\n        }\n        ddex.sessionLandingPage = landingPageProps;\n        ddex.sessionLaunchPageCt = session.sessionPageCount;\n\n        modSession.expireSession = function () {\n            modSession.session.sessionLastPageView -= modSession.msExpireAfter + 60000; // plus one minute\n            sessionStorage.setItem("aoptSession", JSON.stringify(modSession.session));\n        }\n    });\n\n    modLaunch.trySafe("digitalDataEx:favcat", function () {\n\n        let modSubCatFavs = adobeopt.module("subCatFavs");\n\n        if (digitalDataEx.sessionLaunchPageCt === 1) {\n            modSubCatFavs.diag("new session, removing subCatVisits-overall");\n            sessionStorage.removeItem("subCatVisits-overall"); // will force recalculation on first catagory view\n            sessionStorage.removeItem("subCatScores-overall");\n        }\n\n        function sortByProperty(inProp) {\n            return function (a, b) {\n                if (a[inProp] > b[inProp])\n                    return -1;\n                else if (a[inProp] < b[inProp])\n                    return 1;\n\n                return 0;\n            }\n        }\n\n        scScores = window.localStorage.getItem("subCatScores-overall");\n\n        if (!scScores) {\n            window.sessionStorage.setItem("subCatScores-overall", "no scores");\n            return "exiting : no scores";\n        }\n        window.sessionStorage.setItem("subCatScores-overall", scScores);\n        if (scScores === "no scores") {\n            return "m.scScores === no scores";\n        }\n        scScores = adobeopt.json(scScores, "no scores");\n        if (typeof scScores !== "object") {\n            return "m.scScores parse not object";\n        }\n        scSortList = [];\n        var scItem;\n        Object.keys(scScores).forEach(function (key) {\n            scItem = {};\n            scItem.subCat = key;\n            scItem.score = scScores[key];\n            if (!scItem.score || isNaN(scItem.score)) {\n                scItem.score = 0;\n            }\n            scSortList.push(scItem);\n        });\n        scSortList.sort(sortByProperty("score"));\n\n        let favCats = [];\n        let favCatsAll = [];\n        let favCatsAllLen = 0;\n\n        scSortList.forEach(function (favcat, i) {\n            if (favcat.score > 0) {\n                favCats.push(favcat.subCat);\n                ddex["memberFavSubCat" + (i > 0 ? i + 1 : "")] = favcat.subCat;\n            }\n            if (favCatsAllLen + favcat.subCat.length < 254) { // max target profile value length\n                favCatsAllLen += favcat.subCat.length + 1; // +1 for comma\n                favCatsAll.push(favcat.subCat);\n            }\n\n        });\n        ddex.memberFavSubCatsAll = favCatsAll.join(",");\n        ddex.memberFavSubCats = ddex.memberFavSubCatsAll; // same value\n\n    });\n\n    modLaunch.diag("digitalDataEx", ddex);\n\n})(window.digitalDataEx);\n\n\nmodTarget.trySafe("initMeta", function () {\n\n    window.ttMETA = window.ttMETA || [];\n\n    document.addEventListener("at-request-succeeded", function (e) {\n        var tokens = e.detail.responseTokens;\n        if (!adobeopt.isEmpty(tokens)) {\n            tokens.forEach(function (token) {\n                var props = {\n                    \'CampaignName\': token["activity.name"],\n                    \'CampaignId\': token["activity.id"],\n                    \'RecipeName\': token["experience.name"],\n                    \'RecipeId\': token["experience.id"],\n                    \'OfferId\': token["option.id"],\n                    \'OfferName\': token["option.name"],\n                    \'LatestEMID\': token["profile.LatestEMID"],\n                    \'MboxName\': e.detail.mbox\n                };\n                window.ttMETA.push(props);\n                modTarget.diag("at-request-succeeded", props);\n            });\n        }\n    });\n\n    if (adobeopt.isDiag) {\n        modTarget.events = ["at-library-loaded", "at-request-start", "at-request-succeeded", "at-request-failed", "at-content-rendering-start", "at-content-rendering-succeeded", "at-content-rendering-failed", "at-content-rendering-no-offers", "at-content-rendering-redirect"];\n        modTarget.diag("diag:is adobe inited", window.adobe !== undefined, adobeopt.deepRef(window, "adobe.target.events") !== undefined);\n\n        let ttMetaEvent = function (e) { modTarget.diag("event", e) };\n        for (var adobe_msg in modTarget.events) {\n            document.addEventListener(adobe_msg, ttMetaEvent);\n        }\n    }\n\n    return "complete";\n\n});\n\nmodTarget.trySafe("targetPageParamsAll:init", function () {\n\n    function linkTag(l) {\n        l = l.replace("https://", "").replace("http://", "");\n        var ich = l.indexOf("/");\n        if (ich === -1) {\n            return "";\n        }\n        l = l.slice(ich + 1);\n        return l.replace(".html", "");\n    }\n\n    var params = {};\n\n    params.site_country = digitalDataEx.siteCountry;\n    params.site_lang = digitalDataEx.siteLang;\n    params.site_loggedin = digitalDataEx.memberLoggedIn;\n    params.site_store = digitalDataEx.siteStore;\n    params.site_storecountry = digitalDataEx.siteStoreCountry;\n    params.site_loc = digitalDataEx.siteLoc;\n    params.server_env = digitalDataEx.siteReleaseEnv;\n    params.profile = {};\n\n    params["profile.lastLinktag"] = digitalDataEx.pageLinkTag;\n\n    if (digitalDataEx.pageType === "unknown") {\n        digitalDataEx.pageType = adobeopt.deepRef(window, "PageAnalyticsInfo.pageType", adobeopt.deepRef(window, "digitalData.pageType", "unknown"));\n    }\n\n    params.page_type = digitalDataEx.pageType;\n    if (params.page_type == "Product Detail") {\n        params["entity.id"] = digitalDataEx.pagePdpProductIdTarget;\n    } else if (digitalDataEx.pageType == "Category") {\n        // params.user.categoryId = linkTag( window.location.pathname ) };\n        // params.currentCategory = linkTag( window.location.pathname );\n    }\n\n    params.page_modernized = "no";\n\n    let favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat", "");\n    if (favCat !== "") {\n        params["profile.favSubCat"] = favCat;\n        params.favSubCat = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat2", "");\n    if (favCat !== "") {\n        params["profile.favSubCat2"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat3", "");\n    if (favCat !== "") {\n        params["profile.favSubCat3"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat4", "");\n    if (favCat !== "") {\n        params["profile.favSubCat4"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat5", "");\n    if (favCat !== "") {\n        params["profile.favSubCat5"] = favCat;\n    }\n    let favCats = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCats", "");\n    if (favCats !== "") {\n        params["profile.favSubCats"] = favCats;\n        params["profile.favSubCatsTop5"] = favCats.split(",").slice(0, 5).join(",");\n    }\n    let memberFavSubCatsAll = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCatsAll", "");\n    if (memberFavSubCatsAll !== "") {\n        params["profile.favSubCatsAll"] = memberFavSubCatsAll;\n    }\n\n    if (adobeopt.deepRef(window, "digitalDataEx.memberState", "")) {\n        params["profile.whState"] = adobeopt.deepRef(window, "digitalDataEx.memberState", "");\n        params["profile.lastStateLinktag"] = params["profile.whState"] + "-" + digitalDataEx.pageLinkTag;\n        if (params["profile.favSubCat"] !== undefined) {\n            params["profile.stateFavSubCat"] = params["profile.whState"] + "-" + params["profile.favSubCat"];\n        }\n    }\n\n    params["profile.memberPrimaryPostal"] = _satellite.cookie.get("memberPrimaryPostal");\n    params["profile.invCheckPostalCode"] = _satellite.cookie.get("invCheckPostalCode");\n    params["profile.storeCity"] = adobeopt.jsonCookieRef(\'STORELOCATION\', "storeLocation.city");\n    params["profile.storeZip"] = adobeopt.jsonCookieRef(\'STORELOCATION\', "storeLocation.zip");\n\n    params["profile.memberType"] = digitalDataEx.memberType;\n    params["profile.memberLevel"] = digitalDataEx.memberLevel;\n\n    // let aopt_atpropertyid = adobeopt.queryParam("aopt_atpropertyid");\n    // if ( typeof aopt_atpropertyid == "string" ) {\n    //   if ( aopt_atpropertyid === "default" || aopt_atpropertyid === "" ) {\n    //     localStorage.removeItem("aopt_target_property_id");\n    //   } else {\n    //     if ( aopt_atpropertyid == "contentstack" ) {\n    //       aopt_atpropertyid = "cc746140-05e7-f5cd-4b25-b9168ccaabb9";\n    //     } else if ( aopt_atpropertyid == "travel" ) {\n    //       aopt_atpropertyid = "14a17a47-1494-9a74-372c-0c75326dd887";\n    //     }\n    //     localStorage.setItem("aopt_target_property_id", aopt_atpropertyid );\n    //   }\n    // }\n    // let atPropertyIdLs = localStorage.getItem("aopt_target_property_id");\n    // if ( typeof atPropertyIdLs === "string" ) {\n    //   params.at_property = atPropertyIdLs;\n    // }\n\n    modTarget.targetPageParamsData = params;\n\n    modTarget.diag("targetPageParams:calculated", modTarget.targetPageParamsData);\n\n    window.targetPageParamsAll = function () {\n        modTarget.diag("targetPageParamsAll:call", modTarget.targetPageParamsData);\n        // only available at docReady\n        if (window.location.pathname == "/CheckoutCartDisplayView" || window.location.pathname == "/CheckoutConfirmationView_v2") {\n            let products = adobeopt.deepRef(window, "digitalData.cart.products");\n            if (Array.isArray(products)) {\n                modTarget.targetPageParamsData.cartIds = products.map(function (prod) { return prod.id }).join(",");\n            }\n        }\n        return modTarget.targetPageParamsData;\n    };\n\n});\n\nadobeopt.fixUpDigitalData = function () {\n\n    function hasValueDd(v, fncTrue) {\n        switch (typeof v) {\n            case "string":\n                if (v.length == 0 || v == "na") {\n                    return false;\n                }\n            case "number":\n            case "boolean":\n            case "bigint":\n                if (typeof fncTrue == "function") {\n                    fncTrue(v);\n                }\n                return true;\n        }\n        return false;\n    };\n\n    modTarget.trySafe("aopt:fixUpDigitalData", function () {\n\n        // fix up digitalData for backward compatibility\n\n        let dd = window.digitalData;\n        if (dd === undefined && (window.location.pathname === "/CheckoutConfirmationView_v2" || window.location.pathname === "/CheckoutConfirmationView")) {\n            // find broken digitalData script & fix it\n            modTarget.log("fixUpDigitalData:order conf missing dd");\n            let elements = document.querySelectorAll("script");\n            for (let i = 0; i < elements.length; i++) {\n                let element = elements[i];\n                let elementText = element.text;\n                if (elementText.indexOf("window.digital" + "Data = {") > 1 && elementText.indexOf("orderText" + "Opt:") > 1) {\n                    modTarget.log("fixUpDigitalData:order conf: fixing missing dd");\n                    let result = elementText.replace(/orderTextOpt: (\\S*),/gm, \'orderTextOpt: "$1",\');\n                    if (result !== elementText) {\n                        let script = document.createElement(\'script\');\n                        script.setAttribute("id", "digitalDataFixed");\n                        script.textContent = result;\n                        element.after(script);\n                        modTarget.log(result);\n                        break;\n                    }\n                }\n            }\n            dd = window.digitalData;\n        }\n\n        if (dd === undefined) {\n            return;\n        }\n        if (!hasValueDd(dd.pageType)) {\n            dd.pageType = adobeopt.deepRef(dd, "page.pageType");\n        }\n        if (!hasValueDd(dd.pageName)) {\n            dd.pageName = adobeopt.deepRef(dd, "page.pageName");\n        }\n\n        if (dd.pageName === "Product Detail | na") {\n            dd.pageName = "Product Detail | " + digitalDataEx.pagePdpProductId;\n        }\n\n        let product = dd.product; // PDP\n        if (typeof product === "object") {\n            if (Array.isArray(product)) {\n                product = product[0];\n            } else {\n                dd.product = [product]; // make an array\n            }\n            if (!hasValueDd(product.id) && !hasValueDd(product.pid)) {\n                product.id = digitalDataEx.pagePdpProductId;\n                product.pid = digitalDataEx.pagePdpProductId;\n            } else {\n                if (!hasValueDd(product.id) && hasValueDd(product.pid)) {\n                    product.id = product.pid;\n                }\n            }\n            if (!hasValueDd(product.itemNumber) && hasValueDd(product.sku)) {\n                product.itemNumber = product.sku;\n            } else {\n                product.itemNumber = product.itemNumber || \'\';\n                product.sku = product.sku || \'\';\n            }\n            if (!hasValueDd(product.name)) {\n                try {\n                    product.name = document.querySelector(\'meta[property="og:title"]\').getAttribute("content")\n                } catch (e) { };\n            }\n        }\n\n        // order conf\n        if (window.location.pathname === "/CheckoutConfirmationView_v2" || window.location.pathname === "/CheckoutConfirmationView") {\n\n            if (dd.products && adobeopt.deepRef(dd, "cart.products") === undefined) {\n                dd.cart = { transactionId: dd.transactionId, products: dd.products };\n            }\n            if (Array.isArray(dd.products)) {\n                dd.products.forEach(function (prod) {\n                    if (prod.id === undefined && prod.pid !== undefined) {\n                        prod.id = prod.pid;\n                    }\n                    if (prod.deliveryMethod === undefined && prod.cartShipMethod !== undefined) {\n                        prod.deliveryMethod = prod.cartShipMethod;\n                    }\n                });\n            }\n\n        }\n\n    });\n\n};\n\nadobeopt.fixUpDigitalData();\nadobeopt.when.domReady(adobeopt.fixUpDigitalData);\n\n// app detection\n(function () {\n    let costid = adobeopt.queryParam("COSTID");\n    if (typeof costid == "string") {\n        if (costid.startsWith("androidapp") || costid.startsWith("iosapp")) {\n            localStorage.setItem("aopt-appPlatform", costid);\n            return;\n        }\n    }\n    if (localStorage.getItem("aopt-appPlatform") !== null) {\n        return;\n    }\n    if (typeof window.Android != \'undefined\') {\n        localStorage.setItem("aopt-appPlatform", "androidapp (detected)");\n    } else if (typeof window.webkit != \'undefined\') {\n        localStorage.setItem("aopt-appPlatform", "iosapp (detected)");\n    }\n})();\n\nmodTarget.trySafe("aopt:onAoptReady", function () {\n    if (Array.isArray(window.onAoptReady)) {\n        window.onAoptReady.forEach(function (notify) { try { notify() } catch (ex) { console.error(ex) } });\n    }\n    window.onAoptReady = {\n        push: function (notify) { notify() }\n    }\n});\n_satellite.track("aoptReady");\n\nif (window.adobeOptTiming) {\n    adobeOptTiming.push("adobeopt.core:done");\n}\n',
language:"javascript"}}]},{id:"RLe2d09b2b0f544f6e9d3bbe3bec69b6b2",name:"AdButler:/CheckoutConfirmationView.*",events:[{modulePath:"core/src/lib/events/directCall.js",settings:{identifier:"launchlazydomready"},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTruthy"},leftOperand:"%OneTrust Opt In?%"},timeout:2e3},{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"startsWith"},leftOperand:"%storeCountryLang%",rightOperand:"bcus"},timeout:2e3},{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"CheckoutConfirmationView.*",valueIsRegex:!0}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC8ee13f302e5a4495953db19cf648bdd2-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLe5c89c12a5b2494080c5607a10f80043",name:"diag: private items",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/customCode.js",settings:{source:function(){return null!==sessionStorage.getItem("aopt-showprivate")}},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC16ead5187a6d4d01a32760a56ada2061-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLe7c9eb1b9e024252b9013806b4016f37",name:"02 domready#20 reco",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:20}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isFalse"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCd2c89a25631c4bdc9cbd234ee68e6cf3-source.min.js",language:"html",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLf913a5b3f17741b5a09e423c977dc7a8",name:"02 domready#50 retain attrib qsp BlankUtilView",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/BlankUtilView"}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RC02b58471ab7d46e8805a8efc74f76e00-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLfda07be590f74c629f906a613285cef1",name:"01 onload#10:adobeopt-core-modernized",events:[{modulePath:"core/src/lib/events/libraryLoaded.js",settings:{},ruleOrder:10}],conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"isTrue"},leftOperand:"%isPageModernized?%"},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{
source:'let modTarget = adobeopt.module("target");\nlet modLaunch = adobeopt.module("launch");\n\nadobeopt.diagAopt = adobeopt.fncNil; // REVIEW, remove references\nadobeopt.diagTarget = adobeopt.fncNil;\nadobeopt.diagLaunch = adobeopt.fncNil;\n\nlet when = adobeopt.when = adobeopt.module("adobeopt.when");\nlet tag = adobeopt.tag = adobeopt.module("adobeopt.tag");\nlet dom = adobeopt.dom = adobeopt.module("adobeopt.dom");\nlet reco = adobeopt.reco = adobeopt.module("adobeopt.reco");\n\nif (adobeopt.isDiag) {\n\n    adobeopt.ifConfig("launchevents", function () {\n        window._satellite._monitors = window._satellite._monitors || [];\n        window._satellite._monitors.push({\n            ruleTriggered: function (event) {\n                modLaunch.log(["rule", event.rule.name, "fired"].join(":"), event.rule);\n            },\n            ruleCompleted: function (event) {\n                modLaunch.log(["rule", event.rule.name, "completed"].join(":"), event.rule);\n            },\n            ruleConditionFailed: function (event) {\n                modLaunch.log(["rule", event.rule.name, "notmet"].join(":"), event.rule, event.condition);\n            }\n        });\n    });\n\n}\n\nif (_satellite.getVar("useAlloyTarget") == false) {\n\n    modTarget.trySafe("initMeta", function () {\n\n        window.ttMETA = window.ttMETA || [];\n\n        document.addEventListener("at-request-succeeded", function (e) {\n            var tokens = e.detail.responseTokens;\n            if (!adobeopt.isEmpty(tokens)) {\n                tokens.forEach(function (token) {\n                    var props = {\n                        \'CampaignName\': token["activity.name"],\n                        \'CampaignId\': token["activity.id"],\n                        \'RecipeName\': token["experience.name"],\n                        \'RecipeId\': token["experience.id"],\n                        \'OfferId\': token["option.id"],\n                        \'OfferName\': token["option.name"],\n                        \'LatestEMID\': token["profile.LatestEMID"],\n                        \'MboxName\': e.detail.mbox\n                    };\n                    window.ttMETA.push(props);\n                    modTarget.diag("at-request-succeeded", props);\n                });\n            }\n        });\n\n        if (adobeopt.isDiag) {\n            modTarget.events = ["at-library-loaded", "at-request-start", "at-request-succeeded", "at-request-failed", "at-content-rendering-start", "at-content-rendering-succeeded", "at-content-rendering-failed", "at-content-rendering-no-offers", "at-content-rendering-redirect"];\n            modTarget.diag("diag:is adobe inited", window.adobe !== undefined, adobeopt.deepRef(window, "adobe.target.events") !== undefined);\n\n            let ttMetaEvent = function (e) { modTarget.diag("event", e) };\n            for (var adobe_msg in modTarget.events) {\n                document.addEventListener(adobe_msg, ttMetaEvent);\n            }\n        }\n\n        return "complete";\n\n    });\n}\n\nadobeopt.alloy = function (event, data) {\n    return alloy(event, data)\n        .then(response => {\n            adobeopt.logTargetActivity(response);\n            return response;\n        })\n}\n\ndom.eventHandlers = { /* click: { delegates:[] } */ }; // click, submit, etc\n\nfunction objPropDef(obj, name, def) {\n    if (obj.hasOwnProperty(name)) {\n        return obj[name];\n    }\n    return (obj[name] = (typeof def == "function" ? def() : def));\n}\n\n// add a listener\ndom.on = adobeopt.listen = function (props) {\n    // props.event: "click/submit/etc"\n    // props.sel: "css selector"\n    // props.selTarget: "css selector - delegate"\n    // props.selContainer: "css for control area"\n    // props.fire: properties to fire to analytics\n    // props.handler: handler to call\n\n    if (!adobeopt.isJqueryLoaded()) {\n        return;\n    }\n\n    const eventHandler = objPropDef(dom.eventHandlers, props.eventName, {});\n    let elementHandler = objPropDef(eventHandler, props.sel, function () {\n        let elements = $(props.sel);\n        if (elements.length == 0) {\n            // diag("warning: no elements found", props);\n        }\n        let handler = {\n            eventName: props.eventName,\n            delegates: []\n        }\n        handler.listener = function (event) { dom.dispatchEvent(handler, this, event) } // closure for handler (review: bind?)\n        $(elements).each((i, element) => {\n            element.addEventListener(props.eventName, handler.listener, { collect: true }); // passive:true, collect phase, we\'re not UI, just analytics\n        });\n        return handler;\n    });\n    elementHandler.delegates.push(props); // props can be dehydrated, we don\'t even look until something happens in this area\n    return elementHandler;\n};\n\ndom.elementContext = function (element, event) {\n    return {\n        event: event, // for template references\n        target: event.target || element, // for template references\n        element: element,\n        rootElement: element,\n        _cancelBeacon: false,\n        window: window\n    };\n};\n\ndom.dispatchEvent = function (handler, element, event) {\n    dom.diag("root delegate hit", handler);\n    dom.dispatchEventDelegates(handler, dom.elementContext(element, event));\n};\n\ndom.dispatchEventDelegates = function (handler, context) {\n    const delegates = handler.delegates;\n    for (let i = 0; i < delegates.length; i++) {\n        let delegate = delegates[i];\n        if (dom.elementMatchesDelegate(context.element, delegate)) {\n            let props = adobeopt.extend({ props: delegate }, context);\n            diag("dispatchEventDelegates:matched", props);\n            try {\n                tag.applyObj(props.fire, props, tag.analyticsBeacon);\n            } catch (ex) { dom.exception(ex) }\n        }\n    }\n};\n\ndom.elementMatchesDelegate = function (element, delegate) {\n\n    if (!adobeopt.isJqueryLoaded()) {\n        return\n    }\n\n    // let props = tag.getPropHyd( context, delegates, i ); // allows hydration, otherwise reference directly\n    let props = delegate;\n    if (props.selTarget && !$(element).is(props.selTarget)) { // !event.target.matches( props._elementSelector ) // use jquery for selector extensiosn like :contains\n        // diag( "did not match selTarget", props );\n        return false;\n    }\n    if (props.selExclude && $(element).is(props.selExclude)) { // !event.target.matches( props._elementSelector ) // use jquery for selector extensiosn like :contains\n        // diag( "did not match, excluded by selExclude", props );\n        return false;\n    }\n    // diag( "matched", props );\n    return true;\n}\n\ndom.delegateFullSelector = function (delegate) {\n    return delegate.sel + " " + delegate.selTarget;\n}\n\nfunction createElementStyle(props) {\n    let cssParts = [];\n    Object.entries(props).forEach(([cssSelector, cssProps]) => {\n        // selector\n        if (cssSelector == "type") {\n            return;\n        }\n        let styleParts = [];\n        Object.entries(cssProps).forEach(([cssAttrib, cssValue]) => {\n            styleParts.push(cssAttrib + ":" + cssValue);\n        });\n        cssParts.push(cssSelector + " {" + styleParts.join(";") + "}\\n");\n    });\n    return cssParts.join("\\n");\n}\n\nfunction createElement(props, parentElement) {\n    if (typeof props == "function") {\n        props = props();\n    }\n    if (typeof props == "string") {\n        props = { type: "text", text: props };\n    }\n    if (typeof props !== "object") {\n        return null;\n    }\n    if (Array.isArray(props)) {\n        props.forEach((childElement) => {\n            createElement(childElement, parentElement);\n        });\n        return;\n    }\n    if (props.omit === true) { // easy way to omit w/o a function\n        return null;\n    }\n    if (typeof props.type !== "string") {\n        return null;\n    }\n    if (props.type == "text") {\n        let textElement = document.createTextNode(props.text);\n        if (parentElement) {\n            parentElement.appendChild(textElement);\n        }\n        return textElement;\n    }\n    const element = document.createElement(props.type);\n    if (parentElement) {\n        parentElement.appendChild(element);\n    }\n    Object.entries(props).forEach(([key, value]) => {\n        switch (key) {\n            case "class":\n                element.classList.add(value);\n                return;\n            case "dataset":\n                Object.entries(value).forEach(([dataKey, dataValue]) => {\n                    element.dataset[dataKey] = dataValue;\n                });\n                return;\n            case "text":\n                element.textContent = value;\n                return;\n            case "events":\n                Object.entries(props).forEach(([eventName, eventHandler]) => {\n                    element.addEventListener(eventName, eventHandler);\n                });\n                return;\n            case "children":\n                createElement(value, element);\n                return;\n            default:\n                if (typeof value == "string") {\n                    element.setAttribute(key, value);\n                }\n            case "type": // handled above\n                return;\n        }\n    });\n    return element;\n}\nfunction placeElement(placementProps, elementProps) {\n    let element = createElement(elementProps);\n    let existing = document.getElementById(elementProps.id);\n    if (existing) {\n        existing.replaceWith(element);\n    } else {\n        let placement = document.querySelector(placementProps.selector);\n        if (typeof placement[placementProps.method] == "function") {\n            // before, after, append, prepend\n            placement[placementProps.method](element);\n        }\n    }\n    return element;\n}\ndom.createElement = createElement;\n\n// .on has a syntax easy to translate from jquery\nadobeopt.on = function (eventName, sel) { // ... [selTarget], fncHandler, [data] )\n    if (typeof sel == "object" || sel == "") {\n        sel = "body"; // fully delegated listener\n    }\n    let props = {\n        eventName: eventName,\n        sel: sel\n    }\n    if (arguments.length == 3) {\n        props.selTarget = "";\n        props.fncLegacyListener = arguments[2];\n    } else if (arguments.length == 4) {\n        props.selTarget = arguments[2];\n        props.fncLegacyListener = arguments[3];\n    }\n    adobeopt.listen(props);\n}\n\nadobeopt.legacyListener = function (context, params) {\n    context._fncLegacyListener.call(context.element, context.event);\n    // now process beacon\n}\n\n// firing triggered values\ntag.analyticsBeacon = function (event, props, context) {\n    tag.diag("analyticsBeacon", context);\n    if (context._cancelBeacon == true) {\n        tag.diag("canceling per context._cancelBeacon");\n        return;\n    }\n    context.props = adobeopt.extend({}, props); // make a copy for resolving\n    tag.resolveValues(context, context.props);\n    digitalDataEvents.push(context.props);\n};\n\n// props; tools for collecting props associated with event\n\ntag.getObjRef = function (obj, ref, def) { // deep reference value in object (default:window)\n    def = (def == undefined) ? "" : def;\n    try {\n        for (var p = ref.split("."); p.length && obj != undefined;) {\n            obj = obj[p.shift()];\n        }\n    } catch (e) { return def }\n    return obj != undefined ? obj : def;\n};\nlet getObjRef = tag.getObjRef;\n\ntag.applyObj = function (obj, params, defHandler) {\n    if (typeof obj == "function") {\n        return obj(params);\n    }\n    return tag.getObjRef(adobeopt, obj._type, defHandler || adobeopt.unknown)(obj, params);\n};\n\ntag.renderRef = function (context, ref) {\n    try {\n        return tag.resolveValue(context, tag.getObjRef(context, ref));\n    } catch (ex) { }\n    return "";\n};\ntag.renderTmpl = function (context, template) {\n    return template.replace(/\\${(.*?)}/g, function (match) {\n        return tag.renderRef(context, match.split(/\\${|}/).filter(Boolean)[0]);\n    });\n};\n\ntag.resolveValue = function (context, val) {\n    let itermax = 0;\n    try {\n        do {\n            switch (typeof val) {\n                case "function":\n                    val = val(context);\n                    continue;\n                case "string":\n                    if (val.indexOf("${") == -1) {\n                        return val;\n                    }\n                    val = tag.renderTmpl(context, val);\n                    continue;\n                case "boolean":\n                case "number":\n                case "bigint":\n                    return obj[propName] = String(val);\n                case "undefined":\n                case "object":\n                    if (Array.isArray(val)) {\n                        return tag.findValue.apply(context,)\n                    }\n                    return "";\n            }\n        } while (++itermax < 10); // itermax for circular refs\n    } catch (ex) {\n        tag.log(ex);\n    };\n    return "";\n};\ntag.resolveProp = function (context, obj, propName, def) {\n    let val = tag.resolveValue(context, obj[propName]);\n    if (typeof val == "string") {\n        obj[propName] = val;\n    }\n    return obj[propName];\n};\ntag.resolveValues = function (context, obj, destObj) {\n    destObj = destObj || obj;\n    for (let key in obj) {\n        tag.resolveProp(context, obj, key);\n    }\n};\n\ntag.hasValue = function (v) {\n    switch (typeof v) {\n        case "string":\n            return v.length > 0;\n        case "number":\n        case "boolean":\n        case "bigint":\n            return true;\n    }\n    return false;\n};\n\ntag.findValue = function (context) {\n    for (let iarg = 1; iarg < arguments.length; iarg++) {\n        let ret = tag.resolveValue(context, arguments[iarg]);\n        if (tag.hasValue(ret)) {\n            return ret;\n        }\n    }\n    return null;\n};\n\ntag.findFirstValue = function (context, values) {\n    for (let iarg = 0; iarg < values.length; iarg++) {\n        let ret = tag.resolveValue(context, values[iarg]);\n        if (tag.hasValue(ret)) {\n            return ret;\n        }\n    }\n    return null;\n};\n\n\n// dom scrape functions\n\ntag.closestWide = function (element, selector, maxParents) {\n    if (!adobeopt.isJqueryLoaded()) {\n        return\n    }\n\n    let max = maxParents || 7;\n    var f;\n    try {\n        do {\n            f = $(element).find(selector).first();\n            if (f.length > 0) {\n                return f;\n            }\n            element = element.parentElement;\n        } while (--max && element != null && element.nodeName != "BODY");\n    } catch (ex) { tag.exception(ex) }\n    return $().empty();\n};\n\n\n// diagnostic functions\n\ndom.diagShowDelegates = function (styleAttribs) {\n    if (!adobeopt.isJqueryLoaded()) {\n        return\n    }\n\n    styleAttribs = styleAttribs || \'::before { content:" "; position:absolute; width: 40px; height: 20px; background-color:orange; opacity:0.5 }\';\n    styleAttribs = "{border:1px solid orange}";\n    let styles = [];\n    for (let ev in dom.eventHandlers) {\n        for (let sel in dom.eventHandlers[ev]) {\n            dom.eventHandlers[ev][sel].delegates.forEach(function (del) {\n                styles.push(dom.delegateFullSelector(del) + styleAttribs);\n                // styles.push( del._fullSelector.trim() + styleAttribs2 );\n            });\n        }\n    }\n    $("#adobeopt-diag-css-styles").remove();\n    $("head").append(\'<style id="adobeopt-diag-css-styles">\' + styles.join("\\n") + "</style>");\n    dom.diag(styles);\n}\n\n\ntag.delegateHandlers = { /* click: { delegates:[] } */ }; // click, submit, etc\n\nlet elementsWithProps = [];\nlet elementProps = [];\nlet elementPropsAll = [];\nconst dynamicSelectorOperator = "~~";\n\n// dynamic selectors; uses delimiter (~~) to denote static selector, delegate container selector and delegate target selector\ntag.selectorFromDynSelector = function (dynSelector) {\n    return dynSelector.split(dynamicSelectorOperator).join(" ");\n};\n\ntag.parseDynSelector = function (dynSelector, props) {\n    let selectorParts = dynSelector.split(dynamicSelectorOperator);\n    props._fullSelector = tag.selectorFromDynSelector(dynSelector);\n    props._rootSelector = selectorParts.shift().trim() || "body"; // review: should be attached to child whenever possible\n    if (selectorParts.length == 2) {\n        props._containerSelector = selectorParts.shift().trim();\n        props._elementSelector = props._containerSelector + " " + selectorParts.shift().trim();\n    } else if (selectorParts.length == 1) {\n        props._elementSelector = selectorParts.shift().trim();\n    }\n}\n\n// delegate listener support\n\ntag.addListener = tag.listen = function (eventName, dynSelector, props) {\n    props = adobeopt.extend({}, props); // make a copy\n    tag.parseDynSelector(dynSelector, props);\n    let rootDelegate = tag.addListenerRoot(eventName, props._rootSelector);\n    if (rootDelegate) {\n        rootDelegate.delegates.push(props);\n    }\n};\n\ntag.addListenerRoot = function (eventName, selector) {\n    if (!tag.delegateHandlers.hasOwnProperty(eventName)) {\n        tag.delegateHandlers[eventName] = {};\n    }\n    let rootDelegate = tag.delegateHandlers[eventName][selector];\n    if (rootDelegate == undefined) {\n        let attach = document.querySelectorAll(selector);\n        if (attach.length == 0) {\n            tag.log("warning: not elements found", selector);\n            return null;\n        }\n        tag.delegateHandlers[eventName][selector] = rootDelegate = {\n            eventName: eventName,\n            delegates: [],\n            listener: function (event) { tag.dispatchDelegate(this, event, rootDelegate) } // closure for this delegate root\n        }\n        attach.forEach((element) => {\n            element.addEventListener(eventName, rootDelegate.listener, { collect: true }); // passive:true, \n        });\n    }\n    return rootDelegate;\n}\n\ntag.dispatchDelegate = function (element, event, delegateSet) {\n    tag.log("root delegate hit", delegateSet.eventName);\n\n    delegateSet.delegates.forEach(function (props) {\n        let container = null;\n        let delegateElement = element;\n        if (props._elementSelector) {\n            delegateElement = dom.query(event.target).closest(props._elementSelector).firstNode();\n            if (delegateElement == undefined) {\n                tag.log("did not match elementSelector", props);\n                return;\n            }\n        }\n        if (typeof props._containerSelector === "string") {\n            container = event.target.closest(props._containerSelector);\n            if (container == null) {\n                tag.log("did not match parentSelector", props); // shouldn\'t be possible\n                container = delegateElement;\n            }\n            props._container = container;\n        }\n        var context = {\n            props: props,\n            event: event, // for template references\n            target: event.target, // for template references\n            root: element,\n            container: container,\n            element: delegateElement,\n            _cancelBeacon: false\n        };\n        tag.log("matched elementSelector", props);\n        try {\n            (context.props._fire || tag.fireContextProps)(props, context);\n        } catch (ex) { tag.log(ex) }\n    });\n};\n\n// firing triggered values\ntag.fireContextProps = function (props, context) {\n    tag.log("fireContextProps", context);\n    if (context._cancelBeacon == true) {\n        tag.log("canceling per context._cancelBeacon");\n        return;\n    }\n    context.props = adobeopt.extend({}, props); // make a copy for resolving\n    tag.resolveValues(context, context.props);\n    context.props.event = context.event;\n    context.props.element = context.element;\n    digitalDataEvents.push(context.props);\n};\n\ntag.closestAttr = function (element, attrName, def) {\n    if (!adobeopt.isJqueryLoaded()) {\n        return\n    }\n    let selector = "[" + sttrName + "]";\n    try {\n        return $(element).closest(selector).attr(attrName) || def;\n    } catch (ex) { tag.log(ex) }\n};\n\n// diagnostic functions\n\ntag.diagShowTagging = function () {\n    let css = elementPropsAll.forEach((props) => { $(props._fullSelector).css("border", "1px solid red").css("background-color", "red").css("padding", "2px") });\n};\n\n\n// placeholder functions\n\nreco.addCarousel = function (response, element, selector) {\n    try {\n        var caroID = response.name + "-carousel";\n        var reco = JSON.parse(response.options[0].content);\n        reco.options.placementId = caroID;\n        adobeopt.dictFromCssStr(element.dataset.mboxphOptions, reco.options); // [data-mboxph-options]\n        $(element).append(\'<div id="\' + caroID + \'"></div>\'); // wrapper for result\n        merkle.reco.displayResults(reco);\n    } catch (ex) { }\n}\n\nreco.regionalProdId = function (prodid) {\n    if (digitalDataEx.site_store != "bd") {\n        return prodid;\n    }\n    return prodid + "-" + digitalDataEx.memberDeliveryWH;\n}\n\nadobeopt.unknown = function (o) {\n    dom.diag("unknown handler", o);\n}\n\nadobeopt.push = function (obj) {\n    if (Array.isArray(obj)) {\n        obj.forEach((aobj) => tag.applyObj(aobj));\n    }\n    tag.applyObj(obj);\n}\n\ndom.handleJsonOffer = function (response, element, selector) {\n    var content = adobeopt.deepRef(response, "options.0.content", "").trim();\n    if (content.indexOf(\'data-aopt-type="reco.addCarousel"\') == - 1) {\n        return false;\n    }\n    try {\n        var jsoncontent = JSON.parse(response.options[0].content);\n        var caroID = response.name + "-carousel";\n        reco.options.placementId = caroID;\n        adobeopt.dictFromCssStr(element.dataset.mboxphOptions, reco.options); // [data-mboxph-options]\n        $(element).append(\'<div id="\' + caroID + \'"></div>\'); // wrapper for result\n        merkle.reco.displayResults(jsoncontent);\n    } catch (ex) { adobeopt.aoptdiag(ex) }\n}\n\ndom.initContent = function (modname, props) {\n    let m = adobeopt.module(modname, props);\n    if (m.dataType == "domRecoJson" && m.recoJsonSelector !== undefined) {\n        try {\n            m.data = JSON.parse(document.querySelector(m.recoJsonSelector).textContent);\n        } catch (e) {\n            m.error("bad json response"); // report corrupt json\n            return;\n        }\n    }\n    let initContentType = true;\n    // you can pre-iniitalize the module and supply a "initContent" function\n    // to filter and/or replace the content. return false to prevent default content init\n    if (typeof m.initContent === "function") {\n        m.trySafe("m.initContent", function () {\n            initContentType = m.initContent(m);\n        });\n        if (initContentType === false) {\n            return;\n        }\n    }\n    switch (m.contentType) {\n        case "carousel":\n            merkle.reco.displayResults(m.data);\n            break;\n        default:\n            m.error("bad contentType");\n    }\n}\n\n\nif (_satellite.getVar("useAlloyTarget")) {\n\n    dom.processPlaceholders = function (requestGlobalMbox) {\n\n        var goreq = { request: { execute: { mboxes: [] } } };\n        var mboxes = goreq.request.execute.mboxes;\n        var mbxarr = document.querySelectorAll("[data-mboxph-name]:not([data-mboxph-status])"); // if they have [data-mboxph-status] they are already processing/processed\n\n        mbxarr.forEach(function (mbxele) {\n            let options = adobeopt.dictFromCssStr(mbxele.dataset.mboxphOptions);\n            if (options.reqdata == "yes") {\n                let datamboxargs = {\n                    index: mboxes.length,\n                    name: mbxele.dataset.mboxphName + "-data",\n                    parameters: adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams) // [data-mboxph-params]\n                };\n                if (options.exclude == "cart") {\n                    let cartprods = adobeopt.deepRef(window, "digitalData.cart.products", []).map(function (prod) { return reco.regionalProdId(prod.id) }).join(",");\n                    datamboxargs.parameters.excludedIds = cartprods;\n                }\n                if (options.catid == "linktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                if (options.catid == "statelinktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.memberState + "-" + digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                mboxes.push(datamboxargs);\n            }\n            let params = adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams);\n            mbxele.dataset.mboxphName.split(",").forEach(function (mboxname) {\n                mboxes.push({\n                    index: mboxes.length,\n                    name: mboxname,\n                    parameters: params // [data-mboxph-params]\n                });\n            });\n            mbxele.dataset.mboxphStatus = "requested";\n        });\n        if (mboxes.length == 0) {\n            return;\n        }\n        adobe.target.getOffers(goreq)\n    };\n    adobeopt.logTargetActivity = function (response) {\n        window.ttMETA = window.ttMETA || [];\n        let ttMETA = window.ttMETA;\n        if (response?.propositions && response?.propositions.length > 0) {\n            response?.propositions.forEach((proposition) => {\n                let activity = {};\n                if (proposition?.items && proposition?.items.length > 0) {\n                    proposition.items.forEach((item, i) => {\n                        if (i === 0 && item?.meta && Object.keys(item?.meta).length > 0) {\n                            activity = { ...item.meta };\n                        } else {\n                            activity.activityId = proposition?.scopeDetails?.activity?.id;\n                        }\n                    });\n                }\n                ttMETA.push(activity);\n            });\n        }\n    };\n} else { // useAlloyTarget == false\n\n    dom.processPlaceholders = function (requestGlobalMbox) {\n\n        var goreq = { request: { execute: { mboxes: [] } } };\n        var mboxes = goreq.request.execute.mboxes;\n        var mbxarr = document.querySelectorAll("[data-mboxph-name]:not([data-mboxph-status])"); // if they have [data-mboxph-status] they are already processing/processed\n\n        mbxarr.forEach(function (mbxele) {\n            let options = adobeopt.dictFromCssStr(mbxele.dataset.mboxphOptions);\n            if (options.reqdata == "yes") {\n                let datamboxargs = {\n                    index: mboxes.length,\n                    name: mbxele.dataset.mboxphName + "-data",\n                    parameters: adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams) // [data-mboxph-params]\n                };\n                if (options.exclude == "cart") {\n                    let cartprods = adobeopt.deepRef(window, "digitalData.cart.products", []).map(function (prod) { return reco.regionalProdId(prod.id) }).join(",");\n                    datamboxargs.parameters.excludedIds = cartprods;\n                }\n                if (options.catid == "linktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                if (options.catid == "statelinktag") {\n                    datamboxargs.parameters[\'entity.categoryId\'] = digitalDataEx.memberState + "-" + digitalDataEx.pageLinkTag;\n                    datamboxargs.parameters[\'entity.event.detailsOnly\'] = true;\n                }\n                mboxes.push(datamboxargs);\n            }\n            let params = adobeopt.dictFromCssStr(mbxele.dataset.mboxphParams);\n            mbxele.dataset.mboxphName.split(",").forEach(function (mboxname) {\n                mboxes.push({\n                    index: mboxes.length,\n                    name: mboxname,\n                    parameters: params // [data-mboxph-params]\n                });\n            });\n            mbxele.dataset.mboxphStatus = "requested";\n        });\n        if (mboxes.length == 0) {\n            return;\n        }\n        adobe.target.getOffers(goreq).then(function (response) {\n            response.execute.mboxes.forEach(function (el) {\n                let applyArgs = {\n                    response: {\n                        execute: {\n                            mboxes: [el]\n                        }\n                    }\n                };\n                let selector = \'[data-mboxph-name="\' + el.name + \'"]\';\n                let mbxele = document.querySelector(selector);\n                if (mbxele != null) {\n                    mbxele.dataset.mboxphStatus = "applied";\n                    applyArgs.selector = selector;\n                    if (dom.handleJsonOffer(el, mbxele, selector)) {\n                        mbxele.dataset.mboxphStatusDet = "jsonOffer";\n                        return;\n                    }\n                }\n                adobe.target.applyOffers(applyArgs);\n            });\n        });\n    }\n    // when all conditions are met process placeholders\n    Promise.all([\n        adobeopt.when.jQueryReady(),\n        adobeopt.when.targetReady(),\n        adobeopt.when.domReady(),\n    ]).then(() => {\n        adobeopt.dom.processPlaceholders();\n        setTimeout(adobeopt.dom.processPlaceholders, 2000); // again after dynamic content loads\n    });\n\n}\n\nwindow.digitalDataEx = window.digitalDataEx || {};\n\n(digitalDataEx.init = function (ddex) {\n\n    let modLaunch = adobeopt.module("launch");\n\n    modLaunch.trySafe("digitalDataEx:site", function () {\n\n        adobeopt.extend(ddex, _satellite.getVar("siteEnv"));\n\n        // let host = window.location.hostname.toLowerCase();\n\n        // ddex.siteLang = adobeopt.deepRef(window, "digitalData.siteLang") ||\n        //   adobeopt.tag.getObjRef(window, "wcs.locale", document.cookie.indexOf("selectedLanguage=-25") > -1 ? "fr" : "en").slice(0, 2);\n        // try {\n        //   ddex.memberLoggedIn = COSTCO.util.getMemberCookie().signedIn ? "yes" : "no";\n        // } catch (ex) {\n        //   ddex.memberLoggedIn = document.cookie.indexOf("hashedUserId") > -1 ? "yes" : "no";\n        // }\n\n        // let domainCountry = host.slice(-4) == ".com" ? "us" : "ca";\n\n        // ddex.siteReleaseEnv = "prod";\n        // ddex.siteCountry = domainCountry;\n        // ddex.siteStore = "unknown";\n        // if (host == "www.costco.com" || host == "www.costco.ca") {\n        //   ddex.siteStore = "bc";\n        // } else if (host == "www.costcobusinessdelivery.com" || host == "www.costcobusinesscentre.ca") {\n        //   ddex.siteStore = "bd";\n        // } else {\n        //   ddex.siteReleaseEnv = "nonprod";\n        //   let otcode = document.querySelector("script[data-domain-script]")?.getAttribute("data-domain-script"); // use One Trust Script Attribute\n        //   if (typeof otcode === "string") {\n        //     otcode = otcode.replace("-test", "");\n        //   }\n        //   switch (otcode) {\n        //     case "2653cf4b-5c84-40d7-a99b-fa6e1592503b":\n        //       ddex.siteCountry = "us";\n        //       ddex.siteStore = "bc";\n        //       break;\n        //     case "4325a455-ccf4-4ed6-854d-e9f4af4f7c2b":\n        //       ddex.siteCountry = "ca";\n        //       ddex.siteStore = "bc";\n        //       break;\n        //     case "5f812302-3833-47ab-8d40-4ee9060c2f41":\n        //       ddex.siteCountry = "us";\n        //       ddex.siteStore = "bd";\n        //       break;\n        //     case "d0af1630-fb74-4e09-969b-ae4f627acea8":\n        //       ddex.siteCountry = "ca";\n        //       ddex.siteStore = "bd";\n        //       break;\n        //   }\n        //   if (ddex.siteStore === "unknown" && window?.digitalData?.siteStore ) {\n        //     ddex.siteStore = window?.digitalData?.siteStore;\n        //   }\n        //   if (ddex.siteStore === "unknown") {\n        //     switch (host) {\n        //       case "ca-stage.ecom.costco.com":\n        //         ddex.siteCountry = "ca";\n        //         ddex.siteStore = "bc";\n        //         break;\n        //     }\n        //   }\n        // }\n        // ddex.siteStoreCountry = ddex.siteStore + ddex.siteCountry;\n        // ddex.siteStoreCountryLang = ddex.siteStore + ddex.siteCountry + ddex.siteLang;\n\n        ddex.memberLoggedIn = ddex.authStatus == "Authenticated" ? "yes" : "no";\n\n        ddex.siteTargetPreview = "no";\n        if (document.cookie.split(\';\').some(function (cookie) { return cookie.trim().startsWith(\'at_qa_mode=\'); })) {\n            ddex.siteTargetPreview = "yes";\n        }\n    });\n\n    modLaunch.trySafe("digitalDataEx:profile", function () {\n\n        ddex.siteLoc = "unknown";\n        try {\n            if (ddex.siteStore === "bd") {\n                let WC_BD_WHS = _satellite.cookie.get("WC_BD_WHS");\n                if (typeof WC_BD_WHS == "string" && WC_BD_WHS.length > 0) {\n                    ddex.siteLoc = WC_BD_WHS;\n                }\n            } else {\n                ddex.siteLoc = adobeopt.jsonCookieRef("WAREHOUSEDELIVERY_WHS", "nearestWarehouse.catalog");\n            }\n        } catch (ex) { modTarget.exception("profile:store", ex) }\n\n        if (ddex.siteStore == "bd") {\n            ddex.memberDeliveryWH = _satellite.cookie.get("WC_BD_WHS");\n        } else {\n            ddex.memberDeliveryWH = adobeopt.jsonCookieRef(\'WAREHOUSEDELIVERY_WHS\', "groceryCenters.0", "unknown");\n            ddex.memberState = _satellite.cookie.get("invCheckStateCode") || "unknown";\n        }\n\n        let memberTypeMap = {\n            "Z00010,Z010": { level: "gold_star", type: "individual" }, // Gold Star (Individual Member)\n            "Z00020,Z010": { level: "executive", type: "individual" }, // Executive (Individual Member)\n            "Z00010,Z020": { level: "gold_star", type: "business" }, // Gold Star (Business)\n            "Z00020,Z020": { level: "executive", type: "business" } // Executive (Business)\n        };\n        let memberType = { level: "guest", type: "guest" };\n        let wcMember = _satellite.cookie.get("wcMember");\n        if (typeof wcMember == "string") {\n            for (type in memberTypeMap) {\n                if (wcMember.indexOf(type) > -1) {\n                    memberType = memberTypeMap[type];\n                    break;\n                }\n            }\n        }\n        ddex.memberLevel = memberType.level;\n        ddex.memberType = memberType.type;\n\n        window.digitalDataEx.visitorECID = null;\n        alloy("getIdentity").then(function(result) {\n         window.digitalDataEx.visitorECID = result.identity.ECID;\n       });\n    \n    });\n\n    modLaunch.trySafe("digitalDataEx:page", function () {\n        ddex.pageType = adobeopt.deepRef(window, "digitalData.pageType", "Unknown");\n\n        if (ddex.pageType == "Unknown") {\n            if (window.location.pathname.indexOf(".product.") > -1) {\n                ddex.pageType = "Product Detail";\n            } else if (window.location.pathname == "/") {\n                ddex.pageType = "Home Page";\n            } else if (adobeopt.deepRef(window, "digitalData.pageType")) {\n                ddex.pageType = digitalData.pageType;\n            } else if (adobeopt.deepRef(window, "digitalData.page.pageType")) {\n                ddex.pageType = digitalData.page.pageType;\n            } else if (adobeopt.deepRef(window, "pageAnalyticsInfo.pageType")) {\n                ddex.pageType = window.pageAnalyticsInfo.pageType;\n            }\n        }\n        if (ddex.pageType == "Product Detail") {\n            ddex.pagePdpProductId = digitalData?.product?.pid; // adobeopt.reExtract(/\\.product\\.(.*)\\.html/, document.querySelector(\'link[rel="canonical"]\')?.getAttribute("href") || "");\n            if (!ddex.pagePdpProductId) {\n                ddex.pagePdpProductId = window.location.pathname.split(".product.")[1].split(".html")[0];\n            }\n            ddex.pagePdpProductIdTarget = ddex.pagePdpProductId;\n            if (ddex.siteStore === "bd") {\n                ddex.pagePdpProductIdTarget += "-" + ddex.siteLoc;\n            }\n        }\n        ddex.pageLinkTag = adobeopt.linkTag(window.location.pathname);\n\n    });\n\n    modLaunch.trySafe("digitalDataEx:session", function () {\n        let modSession = adobeopt.module("session");\n        modSession.msExpireAfter = 1200000; // 20 minutes, ms, 20 * 60 * 1000\n        let session = adobeopt.json(sessionStorage.getItem("aoptSession"), {});\n        if (session.sessionLastPageView === undefined || Date.now() - session.sessionLastPageView > modSession.msExpireAfter) {\n            session.initType = session.sessionStartMs === undefined ? "new" : "expired";\n            session.sessionNumber = adobeopt.deepRef(session, "sessionNumber", 0) + 1;\n            session.sessionPageCount = 1;\n            session.sessionStartMs = Date.now();\n        } else {\n            session.initType = "inc page";\n            session.sessionPageCount += 1;\n        }\n        session.sessionLastPageView = Date.now();\n        sessionStorage.setItem("aoptSession", JSON.stringify(session));\n        ddex.session = modSession.session = session;\n        modSession.diag("init", session);\n\n        let landingPageProps = adobeopt.json(sessionStorage.getItem("landingPage"));\n        if (landingPageProps === null || session.sessionPageCount === 1) {\n            landingPageProps = {\n                referrer: document.referrer,\n                href: window.location.href,\n                search: window.location.search\n            }\n            sessionStorage.setItem("landingPage", JSON.stringify(landingPageProps));\n        }\n        ddex.sessionLandingPage = landingPageProps;\n        ddex.sessionLaunchPageCt = session.sessionPageCount;\n\n        modSession.expireSession = function () {\n            modSession.session.sessionLastPageView -= modSession.msExpireAfter + 60000; // plus one minute\n            sessionStorage.setItem("aoptSession", JSON.stringify(modSession.session));\n        }\n    });\n\n    modLaunch.trySafe("digitalDataEx:favcat", function () {\n\n        let modSubCatFavs = adobeopt.module("subCatFavs");\n\n        if (digitalDataEx.sessionLaunchPageCt === 1) {\n            modSubCatFavs.diag("new session, removing subCatVisits-overall");\n            sessionStorage.removeItem("subCatVisits-overall"); // will force recalculation on first catagory view\n            sessionStorage.removeItem("subCatScores-overall");\n        }\n\n        function sortByProperty(inProp) {\n            return function (a, b) {\n                if (a[inProp] > b[inProp])\n                    return -1;\n                else if (a[inProp] < b[inProp])\n                    return 1;\n\n                return 0;\n            }\n        }\n\n        scScores = window.localStorage.getItem("subCatScores-overall");\n\n        if (!scScores) {\n            window.sessionStorage.setItem("subCatScores-overall", "no scores");\n            return "exiting : no scores";\n        }\n        window.sessionStorage.setItem("subCatScores-overall", scScores);\n        if (scScores === "no scores") {\n            return "m.scScores === no scores";\n        }\n        scScores = adobeopt.json(scScores, "no scores");\n        if (typeof scScores !== "object") {\n            return "m.scScores parse not object";\n        }\n        scSortList = [];\n        var scItem;\n        Object.keys(scScores).forEach(function (key) {\n            scItem = {};\n            scItem.subCat = key;\n            scItem.score = scScores[key];\n            if (!scItem.score || isNaN(scItem.score)) {\n                scItem.score = 0;\n            }\n            scSortList.push(scItem);\n        });\n        scSortList.sort(sortByProperty("score"));\n\n        let favCats = [];\n        let favCatsAll = [];\n        let favCatsAllLen = 0;\n\n        scSortList.forEach(function (favcat, i) {\n            if (favcat.score > 0) {\n                favCats.push(favcat.subCat);\n                ddex["memberFavSubCat" + (i > 0 ? i + 1 : "")] = favcat.subCat;\n            }\n            if (favCatsAllLen + favcat.subCat.length < 254) { // max target profile value length\n                favCatsAllLen += favcat.subCat.length + 1; // +1 for comma\n                favCatsAll.push(favcat.subCat);\n            }\n\n        });\n        ddex.memberFavSubCatsAll = favCatsAll.join(",");\n        ddex.memberFavSubCats = ddex.memberFavSubCatsAll; // same value\n\n    });\n\n    modLaunch.diag("digitalDataEx", ddex);\n\n})(window.digitalDataEx);\n\n\nmodTarget.trySafe("initMeta", function () {\n\n    window.ttMETA = window.ttMETA || [];\n\n    document.addEventListener("at-request-succeeded", function (e) {\n        var tokens = e.detail.responseTokens;\n        if (!adobeopt.isEmpty(tokens)) {\n            tokens.forEach(function (token) {\n                var props = {\n                    \'CampaignName\': token["activity.name"],\n                    \'CampaignId\': token["activity.id"],\n                    \'RecipeName\': token["experience.name"],\n                    \'RecipeId\': token["experience.id"],\n                    \'OfferId\': token["option.id"],\n                    \'OfferName\': token["option.name"],\n                    \'LatestEMID\': token["profile.LatestEMID"],\n                    \'MboxName\': e.detail.mbox\n                };\n                window.ttMETA.push(props);\n                modTarget.diag("at-request-succeeded", props);\n            });\n        }\n    });\n\n    if (adobeopt.isDiag) {\n        modTarget.events = ["at-library-loaded", "at-request-start", "at-request-succeeded", "at-request-failed", "at-content-rendering-start", "at-content-rendering-succeeded", "at-content-rendering-failed", "at-content-rendering-no-offers", "at-content-rendering-redirect"];\n        modTarget.diag("diag:is adobe inited", window.adobe !== undefined, adobeopt.deepRef(window, "adobe.target.events") !== undefined);\n\n        let ttMetaEvent = function (e) { modTarget.diag("event", e) };\n        for (var adobe_msg in modTarget.events) {\n            document.addEventListener(adobe_msg, ttMetaEvent);\n        }\n    }\n\n    return "complete";\n\n});\n\nmodTarget.trySafe("targetPageParamsAll:init", function () {\n\n    function linkTag(l) {\n        l = l.replace("https://", "").replace("http://", "");\n        var ich = l.indexOf("/");\n        if (ich === -1) {\n            return "";\n        }\n        l = l.slice(ich + 1);\n        return l.replace(".html", "");\n    }\n\n    var params = {};\n\n    params.site_country = digitalDataEx.siteCountry;\n    params.site_lang = digitalDataEx.siteLang;\n    params.site_loggedin = digitalDataEx.memberLoggedIn;\n    params.site_store = digitalDataEx.siteStore;\n    params.site_storecountry = digitalDataEx.siteStoreCountry;\n    params.site_loc = digitalDataEx.siteLoc;\n    params.server_env = digitalDataEx.siteReleaseEnv;\n    params.profile = {};\n\n    params["profile.lastLinktag"] = digitalDataEx.pageLinkTag;\n\n    if (digitalDataEx.pageType === "unknown") {\n        digitalDataEx.pageType = adobeopt.deepRef(window, "PageAnalyticsInfo.pageType", adobeopt.deepRef(window, "digitalData.pageType", "unknown"));\n    }\n\n    params.page_type = digitalDataEx.pageType;\n    if (params.page_type == "Product Detail") {\n        params["entity.id"] = digitalDataEx.pagePdpProductIdTarget;\n    } else if (digitalDataEx.pageType == "Category") {\n        // params.user.categoryId = linkTag( window.location.pathname ) };\n        // params.currentCategory = linkTag( window.location.pathname );\n    }\n    params.page_modernized = "yes";\n\n    let favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat", "");\n    if (favCat !== "") {\n        params["profile.favSubCat"] = favCat;\n        params.favSubCat = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat2", "");\n    if (favCat !== "") {\n        params["profile.favSubCat2"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat3", "");\n    if (favCat !== "") {\n        params["profile.favSubCat3"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat4", "");\n    if (favCat !== "") {\n        params["profile.favSubCat4"] = favCat;\n    }\n    favCat = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCat5", "");\n    if (favCat !== "") {\n        params["profile.favSubCat5"] = favCat;\n    }\n    let favCats = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCats", "");\n    if (favCats !== "") {\n        params["profile.favSubCats"] = favCats;\n        params["profile.favSubCatsTop5"] = favCats.split(",").slice(0, 5).join(",");\n    }\n    let memberFavSubCatsAll = adobeopt.deepRef(window, "digitalDataEx.memberFavSubCatsAll", "");\n    if (memberFavSubCatsAll !== "") {\n        params["profile.favSubCatsAll"] = memberFavSubCatsAll;\n    }\n\n    if (adobeopt.deepRef(window, "digitalDataEx.memberState", "")) {\n        params["profile.whState"] = adobeopt.deepRef(window, "digitalDataEx.memberState", "");\n        params["profile.lastStateLinktag"] = params["profile.whState"] + "-" + digitalDataEx.pageLinkTag;\n        if (params["profile.favSubCat"] !== undefined) {\n            params["profile.stateFavSubCat"] = params["profile.whState"] + "-" + params["profile.favSubCat"];\n        }\n    }\n\n    params["profile.memberPrimaryPostal"] = _satellite.cookie.get("memberPrimaryPostal");\n    params["profile.invCheckPostalCode"] = _satellite.cookie.get("invCheckPostalCode");\n    params["profile.storeCity"] = adobeopt.jsonCookieRef(\'STORELOCATION\', "storeLocation.city");\n    params["profile.storeZip"] = adobeopt.jsonCookieRef(\'STORELOCATION\', "storeLocation.zip");\n\n    params["profile.memberType"] = digitalDataEx.memberType;\n    params["profile.memberLevel"] = digitalDataEx.memberLevel;\n\n\n\n    // let aopt_atpropertyid = adobeopt.queryParam("aopt_atpropertyid");\n    // if ( typeof aopt_atpropertyid == "string" ) {\n    //   if ( aopt_atpropertyid === "default" || aopt_atpropertyid === "" ) {\n    //     localStorage.removeItem("aopt_target_property_id");\n    //   } else {\n    //     if ( aopt_atpropertyid == "contentstack" ) {\n    //       aopt_atpropertyid = "cc746140-05e7-f5cd-4b25-b9168ccaabb9";\n    //     } else if ( aopt_atpropertyid == "travel" ) {\n    //       aopt_atpropertyid = "14a17a47-1494-9a74-372c-0c75326dd887";\n    //     }\n    //     localStorage.setItem("aopt_target_property_id", aopt_atpropertyid );\n    //   }\n    // }\n    // let atPropertyIdLs = localStorage.getItem("aopt_target_property_id");\n    // if ( typeof atPropertyIdLs === "string" ) {\n    //   params.at_property = atPropertyIdLs;\n    // }\n\n    modTarget.targetPageParamsData = params;\n\n    modTarget.diag("targetPageParams:calculated", modTarget.targetPageParamsData);\n\n    window.targetPageParamsAll = function () {\n        modTarget.diag("targetPageParamsAll:call", modTarget.targetPageParamsData);\n        // only available at docReady\n        if (window.location.pathname == "/CheckoutCartDisplayView" || window.location.pathname == "/CheckoutConfirmationView_v2") {\n            let products = adobeopt.deepRef(window, "digitalData.cart.products");\n            if (Array.isArray(products)) {\n                modTarget.targetPageParamsData.cartIds = products.map(function (prod) { return prod.id }).join(",");\n            }\n        }\n        return modTarget.targetPageParamsData;\n    };\n\n});\n\nadobeopt.fixUpDigitalData = function () {\n\n    function hasValueDd(v, fncTrue) {\n        switch (typeof v) {\n            case "string":\n                if (v.length == 0 || v == "na") {\n                    return false;\n                }\n            case "number":\n            case "boolean":\n            case "bigint":\n                if (typeof fncTrue == "function") {\n                    fncTrue(v);\n                }\n                return true;\n        }\n        return false;\n    };\n\n    modTarget.trySafe("aopt:fixUpDigitalData", function () {\n\n        // fix up digitalData for backward compatibility\n\n        let dd = window.digitalData;\n        if (dd === undefined && (window.location.pathname === "/CheckoutConfirmationView_v2" || window.location.pathname === "/CheckoutConfirmationView")) {\n            // find broken digitalData script & fix it\n            modTarget.log("fixUpDigitalData:order conf missing dd");\n            let elements = document.querySelectorAll("script");\n            for (let i = 0; i < elements.length; i++) {\n                let element = elements[i];\n                let elementText = element.text;\n                if (elementText.indexOf("window.digital" + "Data = {") > 1 && elementText.indexOf("orderText" + "Opt:") > 1) {\n                    modTarget.log("fixUpDigitalData:order conf: fixing missing dd");\n                    let result = elementText.replace(/orderTextOpt: (\\S*),/gm, \'orderTextOpt: "$1",\');\n                    if (result !== elementText) {\n                        let script = document.createElement(\'script\');\n                        script.setAttribute("id", "digitalDataFixed");\n                        script.textContent = result;\n                        element.after(script);\n                        modTarget.log(result);\n                        break;\n                    }\n                }\n            }\n            dd = window.digitalData;\n        }\n\n        if (dd === undefined) {\n            return;\n        }\n        if (!hasValueDd(dd.pageType)) {\n            dd.pageType = adobeopt.deepRef(dd, "page.pageType");\n        }\n        if (!hasValueDd(dd.pageName)) {\n            dd.pageName = adobeopt.deepRef(dd, "page.pageName");\n        }\n\n        if (dd.pageName === "Product Detail | na") {\n            dd.pageName = "Product Detail | " + digitalDataEx.pagePdpProductId;\n        }\n\n        let product = dd.product; // PDP\n        if (typeof product === "object") {\n            if (Array.isArray(product)) {\n                product = product[0];\n            } else {\n                dd.product = [product]; // make an array\n            }\n            if (!hasValueDd(product.id) && !hasValueDd(product.pid)) {\n                product.id = digitalDataEx.pagePdpProductId;\n                product.pid = digitalDataEx.pagePdpProductId;\n            } else {\n                if (!hasValueDd(product.id) && hasValueDd(product.pid)) {\n                    product.id = product.pid;\n                }\n            }\n            if (!hasValueDd(product.itemNumber) && hasValueDd(product.sku)) {\n                product.itemNumber = product.sku;\n            } else {\n                product.itemNumber = product.itemNumber || \'\';\n                product.sku = product.sku || \'\';\n            }\n            if (!hasValueDd(product.name)) {\n                try {\n                    product.name = document.querySelector(\'meta[property="og:title"]\').getAttribute("content")\n                } catch (e) { };\n            }\n        }\n\n        // order conf\n        if (window.location.pathname === "/CheckoutConfirmationView_v2" || window.location.pathname === "/CheckoutConfirmationView") {\n\n            if (dd.products && adobeopt.deepRef(dd, "cart.products") === undefined) {\n                dd.cart = { transactionId: dd.transactionId, products: dd.products };\n            }\n            if (Array.isArray(dd.products)) {\n                dd.products.forEach(function (prod) {\n                    if (prod.id === undefined && prod.pid !== undefined) {\n                        prod.id = prod.pid;\n                    }\n                    if (prod.deliveryMethod === undefined && prod.cartShipMethod !== undefined) {\n                        prod.deliveryMethod = prod.cartShipMethod;\n                    }\n                });\n            }\n\n        }\n\n    });\n\n};\n\n// app detection\n(function () {\n    let costid = adobeopt.queryParam("COSTID");\n    if (typeof costid == "string") {\n        if (costid.startsWith("androidapp") || costid.startsWith("iosapp")) {\n            localStorage.setItem("aopt-appPlatform", costid);\n            return;\n        }\n    }\n    if (localStorage.getItem("aopt-appPlatform") !== null) {\n        return;\n    }\n    if (typeof window.Android != \'undefined\') {\n        localStorage.setItem("aopt-appPlatform", "androidapp (detected)");\n    } else if (typeof window.webkit != \'undefined\') {\n        localStorage.setItem("aopt-appPlatform", "iosapp (detected)");\n    }\n})();\n\nif (!_satellite.getVar("isPageModernized?")) {\n    adobeopt.fixUpDigitalData();\n    adobeopt.when.domReady(adobeopt.fixUpDigitalData);\n}\n\nmodTarget.trySafe("aopt:onAoptReady", function () {\n    if (Array.isArray(window.onAoptReady)) {\n        window.onAoptReady.forEach(function (notify) { try { notify() } catch (ex) { console.error(ex) } });\n    }\n    window.onAoptReady = {\n        push: function (notify) { notify() }\n    }\n});\n_satellite.track("aoptReady");\n\n/** MODULE datalayer_adobeopt **/\n\n// ================================================\n// >>> DOCUMENT READY\n\n\n\n/** ENDMODULE datalayer_adobeopt **/\n\n/** MODULE datalayer_ecom **/\n\nlet amod = adobeopt.module("analytics");\nlet pmc = amod;\nlet pcl = amod;\n\n// ---------------------------------------------\n// PCL -- COMMON LIBRARY\nadobeopt.extend(pcl, {\n\n    beacon: {},\n\n    firedBeacons: [],\n    diagnostic: [],\n\n    // pcl.initalize\n    initalize: function (oEvt) {\n        pcl.oEvt = oEvt;\n        pcl.currentURL = window.location.href;\n        pcl.scriptName = pcl.scriptNameFromURL();\n    },\n\n    // pcl.addEvent\n    addEvent: function (num, eVars, eProps) { // ( event number, [evar list object] )\n        var evStr = "";\n        if (typeof (num) === "string") { // supplied a string (for purchase, etc)\n            evStr = num;\n        } else { // number\n            evStr = "event" + num;\n        }\n        if (evStr == "event1") {\n            pcl.beacon.isPageView = true;\n        }\n        /** IFDEF X_LAUNCH **/\n        // eventnum = evStr.replace("event","");\n        // if ( pmc.eventMap.hasOwnProperty( eventnum ) ) {\n        // \tvar e = pmc.eventMap[eventnum];\n        // \t_satellite.setVar( e.n, "true" );\n        // \tpmc.trackParams[ e.n ] = "true";\n        // \tif ( e.rule ) {\n        // \t\tpmc.trackParams[ "track" ] = e.n;\n        // \t\treturn; // don\'t add to sobject\n        // \t}\n        // }\n        /** ENDIF **/\n\n        if (typeof eVars === "number" || typeof eVars === "string") { // override, allows event value\n            evStr += "=" + eVars.toString();\n            eVars = undefined;\n        }\n\n        if (pcl.isUndef(pcl.beacon.events)) {\n            pcl.beacon.events = evStr;\n            // pcl.beacon.linkTrackEvents = evStr;\n        } else {\n            pcl.beacon.events += "," + evStr;\n            // pcl.beacon.linkTrackEvents += "," + evStr;\n        }\n\n        pcl.processEProps(eProps);\n        pcl.addEvars(eVars);\n    },\n    // pcl.processEProps\n    processEProps: function (eProps) { // add attributes from eProp block, only pageName for now\n        var eventID = 0;\n        if (!(pcl.isObj(eProps) && pcl.isStr(eProps.pageName)))\n            return;\n        pcl.oEvt.pageName = val;\n        pcl.oEvt.siteSection = val.substring(0, val.indexOf("|") - 1);\n    },\n    // pcl.addEvars\n    addEvars: function (evars) {\n        if (pcl.isObj(evars))\n            for (var key in evars)\n                pcl.addEvar(key, evars[key]);\n    },\n    // pcl.addEvar\n    addEvar: function (id, sValue) {\n        if (pcl.isNum(id))\n            id = "eVar" + id;\n        /** IFDEF LAUNCH **/\n        // evarnum = id.replace("eVar","");\n        // if ( pmc.evarMap.hasOwnProperty( evarnum ) ) {\n        // \t_satellite.setVar( pmc.evarMap[evarnum], sValue );\n        // \tpmc.trackParams[ pmc.evarMap[evarnum] ] = sValue;\n        // }\n        /** ENDIF **/\n        pcl.beacon[id] = sValue;\n        // if ( pcl.beacon.linkTrackVars === \'None\' )\n        // \tpcl.beacon.linkTrackVars = id;\n        // else\n        // \tpcl.beacon.linkTrackVars += "," + id;\n\n    },\n    // pcl.addEvar\n    addProp: function (id, sValue) {\n        if (pcl.isNum(id))\n            id = "prop" + id;\n        /** IFDEF LAUNCH **/\n        // evarnum = id.replace("prop","");\n        // if ( pmc.propMap.hasOwnProperty( evarnum ) ) {\n        // \t_satellite.setVar( pmc.propMap[evarnum], sValue );\n        // \tpmc.trackParams[ pmc.propMap[evarnum] ] = sValue;\n        // }\n        /** ENDIF **/\n        pcl.beacon[id] = sValue;\n        // if ( pcl.beacon.linkTrackVars === \'None\' )\n        // \tpcl.beacon.linkTrackVars = id;\n        // else\n        // \tpcl.beacon.linkTrackVars += "," + id;\n\n    },// pcl.setProductString\n    setProductString: function (prodStr, fixUp) {\n        // if ( pcl.beacon.linkTrackVars === \'None\' )\n        // \tpcl.beacon.linkTrackVars = "products";\n        // else\n        // \tpcl.beacon.linkTrackVars += ",products";\n        if (fixUp == true) {\n            prodStr = pmc.fixUpProdString(prodStr);\n        }\n        pcl.beacon.products = prodStr;\n    },\n    setProducts: function (prodArray) {\n        // if ( pcl.beacon.linkTrackVars === \'None\' )\n        // \tpcl.beacon.linkTrackVars = "products";\n        // else\n        // \tpcl.beacon.linkTrackVars += ",products";\n        pcl.beacon.products = prodStr;\n    },\n    addProduct: function (prodProps, evars) {\n        var prodString = pcl.strOrBlank(prodProps.category); // REVIEW\n        prodString += ";" + pcl.strOrBlank(prodProps.product);\n        prodString += ";" + pcl.strOrBlank(prodProps.quantity);\n        prodString += ";" + pcl.strOrBlank(prodProps.totalPrice);\n        prodString += ";" + pcl.strOrBlank(prodProps.incrementor);\n        prodString += ";" + pcl.strOrBlank(prodProps.merchandising);\n        // REVIEW -- how about a debug function to look for unused properties to find typos?\n        // REVIEW -- process evar block\n\n        if (!pcl.isStr(pcl.beacon.products))\n            pcl.beacon.products = "";\n        else if (pcl.beacon.products !== "")\n            prodString = ";" + prodString;\n        pcl.beacon.products += prodString;\n    },\n    // pcl.submitToAnalytics\n    fireDeferred: function () {\n        let deferred = sessionStorage.getItem("aopt-analytics-deferred");\n        if (typeof deferred == "string") {\n            sessionStorage.removeItem("aopt-analytics-deferred");\n            let deferedEvents = JSON.parse(deferred);\n            deferedEvents.forEach(function (beacon) {\n                pcl.beacon = beacon;\n                pcl.submitToAnalytics();\n            });\n\n        }\n    },\n    // pcl.submitToAnalytics\n    submitToAnalytics: function () {\n        // if ( pcl.beacon.linkTrackVars === "None" )\n        // \tpcl.beacon.linkTrackVars = \'events\';\n        // else\n        // \tpcl.beacon.linkTrackVars += \',events\';\n        var msg = "";\n        // pcl.beacon.sa(pmcPlatform.getProp("account"));\n\n        if (pcl.beacon.defer === true) {\n            delete pcl.beacon.defer;\n            sessionStorage.setItem("aopt-analytics-deferred", JSON.stringify([pcl.beacon]));\n            pcl.clearSObj();\n            return;\n        }\n\n        if (pcl.beacon.isPageView === true) {\n            pmc.fixUpReferrer(true);\n            if (_satellite.getVar("useAlloy")) {\n                let alloyEvent = {\n                    data: {\n                        __adobe: {\n                            analytics: pcl.beacon\n                        }\n                    }\n                };\n                adobeopt.alloyFixUpXdmFromAnalytics(alloyEvent)\n                alloy("sendEvent", alloyEvent);\n            } else {\n                msg = s.t(pcl.beacon);\n            }\n            pmc.pageLoadFired = true;\n        } else {\n            pmc.fixUpReferrer(false);\n\n            if (_satellite.getVar("useAlloy")) {\n                pcl.beacon.linkType = "o";\n                pcl.beacon.linkName = arguments[2] || "";\n                pcl.beacon.linkUrl = window.location.href;\n                let alloyEvent = {\n                    data: {\n                        __adobe: {\n                            analytics: pcl.beacon\n                        }\n                    }\n                };\n                adobeopt.alloyFixUpXdmFromAnalytics(alloyEvent)\n                alloy("sendEvent", alloyEvent);\n            } else {\n                msg = s.tl(arguments[0] || true, \'o\', arguments[2] || "", pcl.beacon);\n            }\n        }\n        pcl.firedBeacons.push(pcl.beacon);\n        adobeopt.logBeacon(pcl.beacon, arguments.length === 2);\n        pcl.clearSObj();\n    },\n    // pcl.clearSObj\n    clearSObj: function () {\n        pcl.beacon = {};\n        // pcl.beacon.linkTrackEvents = "None";\n        // pcl.beacon.linkTrackVars = "None";\n        // pcl.beacon.events = "None";\n        // pcl.beacon.products = "";\n        // for ( var i = 0 ; i <= 99 ; i++ )\n        // \ts["eVar"+i] = undefined;\n    },\n    strOrBlank: function (o) {\n        // if the argument is a string or int, return it, otherwise an empty string\n        if (!(pcl.isStr(o) || pcl.isNum(o)))\n            return "";\n        return o;\n    },\n    strBlank: function (s) { // non-string and "" will BOTH return true, number returns false\n        if (pcl.isNum(s))\n            return false; // a number will always equal a non-blank string\n        if (!pcl.isStr(s))\n            return true;\n        return s.length === 0;\n    },\n    strNotBlank: function (s) { // non string and "" will BOTH return false, number returns true\n        if (pcl.isNum(s))\n            return true; // a number will always equal a non-blank string\n        if (!pcl.isStr(s))\n            return false;\n        return s.length !== 0;\n    },\n    // pcl.scriptNameFromURL\n    scriptNameFromURL: function () {\n        var t = window.location.pathname;\n        return t.substring(t.lastIndexOf(\'/\') + 1);\n    },\n    sStart: function (strin, str) { return strin.slice(0, str.length) == str; },\n    sEnd: function (strin, str) { return strin.slice(-str.length) == str; },\n    sContains: function (strin, str) { return strin.indexOf(str) > -1; },\n    sRemove: function (strin, str) { return strin.replace(str, "") },\n\n    isUndef: function (o) { return typeof (o) === "undefined"; },\n    isBool: function (o) { return typeof (o) === "boolean"; },\n    isNum: function (o) { return typeof (o) === "number"; },\n    isStr: function (o) { return typeof (o) === "string"; },\n    isFunc: function (o) { return typeof (o) === "function"; },\n    isObj: function (o) { return typeof (o) === "object"; }\n});\n\n// ANALYTICS BEACON\n\n// ================================================\n// >>> PRODUCT STRING MANAGEMENT\n\nlet escapeProdStringVal = pmc.escapeProdStringVal = function (s) {\n    // replace all | ; ,  with _\n    return (s.toString().substring(0, 30).replace(/[|;,]/g, "_"));\n}\nlet pstrProdBldr = pmc.pstrProdBldr = function (props) {\n    this.args = [\n        "", // 0 category\n        "", // 1 pid\n        "1", // 2 quantity\n        "", // 3 price\n        "", // events 4\n        "" // evars 5\n    ];\n    this.events = [];\n    this.evars = [];\n}\npstrProdBldr.prototype.addEvent = function (number, value) {\n    this.events.push("event" + number + (value ? "=" + value : ""));\n};\npstrProdBldr.prototype.addEvar = function (number, value) {\n    this.evars.push("eVar" + number + "=" + escapeProdStringVal(value));\n};\npstrProdBldr.prototype.category = function (v) { return v ? this.args[0] = v : this.args[0] };\npstrProdBldr.prototype.sku = function (v) { this.addEvar(55, v) };\npstrProdBldr.prototype.quantity = function (v) { return v ? this.args[2] = v : this.args[2] };\npstrProdBldr.prototype.price = function (v) { return v ? this.args[3] = v : this.args[3] };\npstrProdBldr.prototype.pid = function (v) { this.addEvar(52, v); v ? this.args[1] = v : this.args[1] };\npstrProdBldr.prototype.prodId = pstrProdBldr.prototype.pid;\npstrProdBldr.prototype.prodName = function (v) { }; // we no longer use v53, use v52 classification instead\npstrProdBldr.prototype.pstr = function () {\n    // "Category;Product;Quantity;Price;eventN=X[|eventN2=X2];eVarN=merch_category[|eVarN2=merch_category2]"\n    this.args[4] = this.events.join("|");\n    this.args[5] = this.evars.join("|");\n    return this.args.join(";")\n};\n\nfunction oneOf(v, strOrArray) { // \n    return strOrArray.indexOf(v) > -1;\n}\n\npmc.prodsFromDataLayerObj = function (data, products, varient) {\n\n    products = products || [];\n    if (Array.isArray(data.products)) {\n        data.products.forEach(function (prod) {\n            pmc.prodsFromDataLayerObj(prod, products, varient);\n        });\n    } else if (Array.isArray(data.product)) {\n        data.product.forEach(function (prod) {\n            pmc.prodsFromDataLayerObj(prod, products, varient);\n        });\n    } else if (typeof data == "object" && typeof data.pid === "string") {\n        // single product directly in data\n        let prod = new pstrProdBldr();\n        if (typeof data.pid === "string") {\n            prod.pid(data.pid);\n        }\n        if (typeof data.sku === "string") {\n            prod.sku(data.sku);\n        }\n        if (oneOf(typeof data.price, ["string", "number"])) {\n            prod.price(data.price.toString());\n        }\n        if (oneOf(varient, ["purchase", "addToCart"]) && oneOf(typeof data.quantity, ["string", "number"])) {\n            prod.quantity(data.quantity.toString());\n            if (varient == "addToCart") {\n                prod.addEvar(28, data.quantity.toString());\n            }\n        }\n        if (varient == "searchPageView") {\n            if (oneOf(typeof data.searchDisplayRank, ["string", "number"])) {\n                prod.addEvar(59, data.searchDisplayRank.toString());\n            }\n        }\n        if (varient == "searchClick") {\n            if (oneOf(typeof data.searchIndex, ["string", "number"])) {\n                prod.addEvar(59, data.searchIndex.toString());\n            }\n        }\n        if (varient == "loadBundle") {\n            if ( typeof data.bundleStock == "string" ) {\n                prod.addEvar(47, data.bundleStock );\n            }\n        }\n        products.push(prod);\n    };\n    return products;\n}\n\n\npmc.prodStrFromProds = function (prods) {\n    return prods.map(function (prod) {\n        return prod.pstr();\n    }).join(",");\n}\n\npmc.prodStrFromDataLayerObj = function (data, varient) {\n    return pmc.prodStrFromProds(pmc.prodsFromDataLayerObj(data, [], varient));\n}\n\n// let beacon = adobeopt.beacon = adobeopt.module( "beacon", {\n//   events: {},\n//   evars: {},\n//   products: [],\n//   event: function ( eventName, eventVal ) { // ( event number, [evar list object] )\n//       if ( typeof eventName === "number" ) {\n//           eventName = "event" + eventName;\n//       }\n//       beacon.events[eventName] = eventVal || 1;\n//   },\n//   evar: function ( evarId, evarVal ) {\n//       beacon.evars[evarId] = evarVal;\n//   },\n//   fire: function() {\n//       // [Link object],[Link name]\n//       if ( typeof beacon.varsForAllEvents == "function" ) {\n//           beacon.varsForAllEvents();\n//       }\n\n//       let eventsStr = [];\n//       let sprops = {};\n//       adobeopt.eachProp( beacon.events, function( eventName, eventVal ) {\n//           eventsStr.push( eventName + ( eventVal != 1 ? "=" + eventVal : "") );\n//       });\n//       sprops.events = eventsStr.join(",");\n//       adobeopt.eachProp( beacon.evars, function( evarId, evarVal ) {\n//           sprops["eVar" + evarId] = evarVal;\n//       });\n\n//       let msg = "";\n//       adobeopt.extend( s, sprops );\n//       beacon.diag( "fire", sprops );\n//       if ( arguments.length === 0 ) {\n//           msg = s.t();\n//           beacon.pageLoadFired = true;\n//       } else if ( arguments.length === 2 ) {\n//           msg = s.tl( arguments[0], \'o\', arguments[1] );\n//       }\n//       beacon.clear();\n//   },\n//   // pcl.clear\n//   clear: function() {\n//       s.linkTrackEvents = "";\n//       s.linkTrackVars = "";\n//       s.events = "";\n//       s.products = "";\n//       for ( var i = 0 ; i <= 99 ; i++ ) {\n//           s["eVar"+i] = undefined;\n//       }\n//       beacon.events = {};\n//       beacon.evars = {};\n//       beacon.products = [];\n//   }\n\n// } );\n// beacon.clear();\n\npmc.inPrivateElement = false;\npmc.detectPrivateElement = function (event) {\n    try {\n        pmc.inPrivateElement = event.target.closest("[data-bi-private]") !== null;\n        if (pmc.inPrivateElement) {\n            amod.log("inPrivateElement: entering");\n        }\n    } catch (e) {\n        amod.exception(e);\n    }\n}\npmc.releasePrivateElementDebounced = adobeopt.debounce(function (event) {\n    if (pmc.inPrivateElement) {\n        amod.log("inPrivateElement: releasing");\n        pmc.inPrivateElement = false;\n    }\n}, 500);\npmc.releasePrivateElement = function (event) {\n    if (pmc.inPrivateElement) {\n        pmc.releasePrivateElementDebounced();\n    }\n}\n\ndocument.addEventListener("mousedown", pmc.detectPrivateElement, { capture: true, passive: true });\ndocument.addEventListener("mouseup", pmc.releasePrivateElement, { capture: true, passive: true });\ndocument.addEventListener("click", pmc.releasePrivateElement, { capture: true, passive: true });\n\npmc.pagesByType = {};\npmc.pagesByPath = [];\nlet addPageHandler = pmc.addPageHandler = function (o) {\n    pmc.pagesByPath.push(o);\n};\npmc.onPageViewProcs = [];\npmc.onPageView = function (name, fnc) {\n    pmc.onPageViewProcs.push({ name: name, fnc: fnc });\n};\npmc.pageTaggingProcs = [];\npmc.addPageTagging = function (name, fnc) {\n    pmc.pageTaggingProcs.push({ name: name, fnc: fnc });\n};\n\npmc.getDebugValue = function (name) {\n    var r = adobeopt.queryParam(name);\n    if (pcl.strNotBlank(r))\n        return r;\n    return pcl.strOrBlank(localStorage.getItem(name));\n};\n\n\npmc.documentReady = function () {\n\n    pmc.fDebug = pmc.fDebugExceptions = pmc.getDebugValue(\'pointmarcDebug\') === "yes"; // localStorage.setItem(\'pointmarcDebug\',\'yes\')\n\n    pcl.initalize();\n\n    var fDisableEvents = false;\n\n    // if ( window.location.pathname === "/SinglePageCheckoutView" ) {\n    //     // this page has bugs where the data layer was implemented incorrectly\n    //     // so we\'re disabling for now\n    //     fDisableEvents = true;\n    // }\n\n    var eventBacklog = [];\n    if (!fDisableEvents) {\n        if (Array.isArray(window.digitalDataEvents)) {\n            // the page was intialized with a data layer page view event so process that\n            // assert that if ( typeof window.digitalDataEvents.eventHistory !== "undefined" ) { \n            // if digitalDataEvents undefined or does not include the property "eventHistory" \n            // then datalayer has not been initialized\n            eventBacklog = window.digitalDataEvents; // array backlog of events that fired before tag manager loaded\n            delete window["digitalDataEvents"];\n        }\n        if (window.digitalDataEvents === undefined) {\n            window.digitalDataEvents = {\n                eventHistory: [],\n                push: function (newEvent, element) {\n                    if (typeof newEvent == "string") {\n                        newEvent = pmc.parseDdeProps(newEvent, element);\n                    }\n                    pmc.processDataLayerEventBlock(newEvent); // call DTM/any tag manager\n                }\n            }\n        }\n    }\n    // if ( eventBacklog.length === 0 || eventBacklog[0].pageView  === undefined ) {\n    //     // if there is an empty eventBacklog or the first event in the backlog is not a pageview\n    //     // fire our default page view\n    //     if ( pmc.pageViewLegacy ) {\n    //       pmc.pageViewLegacy();\n    //     }\n    //     else {\n    //       digitalDataEvents.push( { pageView:1 } );\n    //     }\n    // } else if ( pmc.debugDataLayerEvents ) {\n    //     amod.log( "digitalDataEvent: window.digitalDataEvents contains pageView, skipped default page view" );\n    // }\n    // post backlog of events\n    eventBacklog.forEach(function (evt) {\n        window.digitalDataEvents.push(evt);\n    });\n\n    adobeopt.tag.addListener("click", \'body ~~ [data-bi-tc] a, a[data-bi-tc], button[data-bi-tc], [data-bi-tc] button, input[type="button"][data-bi-tc], [data-bi-tc] input[type="button"], \' +\n        \'input[type="checkbox"][data-bi-tc], [data-bi-tc] input[type="checkbox"], input[type="submit"][data-bi-tc], [data-bi-tc] input[type="submit"]\',\n        { trAttr: "data-bi-tc" }\n    );\n    adobeopt.tag.addListener("click", \'body ~~ [data-bi-tca]\', { trAttr: "data-bi-tca" });\n    adobeopt.tag.addListener("change", \'body ~~ [data-bi-tchange]\', { trAttr: "data-bi-tchange" });\n\n    let isInViewport = function (el) {\n        try {\n            var rect = el.getBoundingClientRect();\n            return (\n                rect.top >= 0 &&\n                rect.left >= 0 &&\n                rect.bottom > 0 &&\n                rect.right > 0 &&\n                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n                rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n            );\n        } catch (ex) { amod.log("isInViewport", ex) }\n        return false;\n    }\n\n    if (adobeopt.isJqueryLoaded()) {\n        $(window).on(\'DOMContentLoaded load resize scroll\', adobeopt.debounce(function () {\n            amod.log("checking visibility");\n            var elements = $("[data-bi-timp]:not([data-bi-timpfired])").each(function () {\n                amod.log("checking visibility element");\n                if (isInViewport(this)) {\n                    amod.log("checking visibility element isInViewport");\n                    $(this).attr("data-bi-timpfired", "true");\n                    digitalDataEvents.push({ trAttr: "data-bi-timp", element: this });\n                }\n            });\n        }, 1000, false));\n\n    }\n\n    function dispatch(handlers) {\n        if (false) {\n            for (var key in handlers) {\n                // when debugging, allow exceptions to halt execution\n                handlers[key].fnc();\n            }\n        } else {\n            for (var key in handlers) {\n                try {\n                    handlers[key].fnc();\n                } catch (ex) {\n                    amod.exception(ex, "in " + key);\n                }\n            }\n        }\n    }\n\n    dispatch(pmc.onPageViewProcs);\n\n    // fire page view\n    // global variable can be sent to supress events from firing\n    // this is set when redirecting\n    if (window.pmcSuppressPageLoadEvent === true) {\n        /** DEBUG PDB( "Suppressing Page Load Event" ); **/\n        pcl.clearSObj();\n    } else {\n\n        // temporary tagging for search initiation\n        // REVIEW this should come from data layer call\n        function searchInitiation() {\n            digitalDataEvents.push({\n                search: adobeopt.dom.query(\'[data-testid="SearchBarUI"] input[aria-label="Search"]\').firstNode()?.value,\n                searchType: "typed"\n            });\n        }\n\n        adobeopt.dom.query(\'[data-testid="SearchBarUI"] input[aria-label="Search"]\').firstNode()?.addEventListener(\'keypress\', function (e) {\n            if (e.key === \'Enter\') {\n                searchInitiation();\n            }\n        }, { capture: true, passive: true });\n        adobeopt.dom.query(\'[data-testid="SearchBarUI"] button[aria-label="Search"]\').firstNode()?.addEventListener(\'click\', searchInitiation, { capture: true, passive: true });\n\n        digitalDataEvents.push({ pageView: 1 });\n\n    }\n\n    // execute pageListener tagging\n    dispatch(pmc.pageTaggingProcs);\n\n}\n\n/** ENDMODULE datalayer **/\n\n/** MODULE datalayer_ecom **/\n\nlet stripCanonicalPath = pmc.stripCanonicalPath = function (path) {\n    if (path.indexOf(".product.") > -1) {\n        // strip canonical portion of path to keep v74 uniform\n        var myRegexp = /(\\.product\\..*\\.html)/g;\n        var match = myRegexp.exec(path);\n        if (match) {\n            path = "/" + match[1];\n        }\n    }\n    return path;\n}\n\npmc.varsForAllEvents = function () {\n\n    try {\n\n        let buildinfo = "";\n\n        if (_satellite.getVar("isPageModernized?")) {\n            try {\n                buildinfo = "modernized L:" + _satellite.buildInfo.buildDate + _satellite.environment.stage.slice(0, 3);\n            } catch (e) { };\n            pcl.addEvar(1, window?.digitalData?.pageName);\n            pcl.addEvar(2, window?.digitalData?.pageType);\n            pcl.addEvar(3, window?.digitalData?.pagePlatform || "Unknown");\n            pcl.addEvar(4, window?.digitalData?.siteLang);\n            pcl.addEvar(7, window?.digitalData?.pageCMS || "Unknown");\n\n            pcl.addEvar(26, window?.digitalData?.authStatus || "Unknown");\n\n            let crumbs = window?.digitalData?.pageCrumbs;\n            if (Array.isArray(crumbs) && crumbs.length > 0) {\n                pcl.addEvar(63, crumbs[0]);\n                pcl.addEvar(64, crumbs.join(" | "));\n            }\n\n            pcl.addEvar(75, buildinfo);\n\n        } else {\n\n            pcl.addEvar(1, pmc.pageName + pmc.pageNameExt);\n            pcl.addEvar(2, pmc.pageType);\n            pcl.addEvar(4, pmc.lang);\n            pcl.addEvar(63, pmc?.V63BreadCrumbs?.trim());\n            pcl.addEvar(64, pmc?.V64BreadCrumbs?.trim());\n            try {\n                buildinfo = document.querySelector("meta[name=\'currentBuildNumber\']")?.getAttribute(\'content\');\n                buildinfo += " A:" + pmc.ver;\n                buildinfo += " L:" + _satellite.buildInfo.buildDate + _satellite.environment.stage.slice(0, 3);\n            } catch (e) { };\n            if (_satellite.getVar("useAlloy")) {\n                buildinfo += " websdk";\n            }\n            pcl.addEvar(75, buildinfo);\n\n        }\n\n        let kmsiCookie = _satellite.cookie.get(\'kmsi\');\n        let kmsi = !(typeof kmsiCookie == \'undefined\' || kmsiCookie == null || kmsiCookie == \'false\');\n        pcl.addEvar(36, kmsi ? "true" : "false");\n\n        let appPlatform = localStorage.getItem("aopt-appPlatform");\n        if (typeof appPlatform == "string") {\n            pcl.addEvar(46, appPlatform);\n        }\n\n        if (digitalDataEx.memberLoggedIn == "yes" && digitalDataEx.siteStoreCountry == "bcus") {\n            let costcoHashId = _satellite.cookie.get("costcoHashId");\n            if (typeof costcoHashId === "string") {\n                pcl.addEvar(21, costcoHashId)\n            }\n        }\n\n        if ( digitalDataEx.visitorECID !== undefined ) {\n            pcl.addEvar( 62, digitalDataEx.visitorECID );\n        }\n\n        layoutMode = "desktop"; // desktop | tablet | mobile\n\n        try {\n            let getScreenType = adobeopt.deepRef(window, "COSTCO.util.getScreenType");\n            if (getScreenType) {\n                var lm = getScreenType();\n\n                if (lm.indexOf("PHONE") > -1) {\n                    layoutMode = "mobile";\n                } else if (lm.indexOf("TABLET") > -1) {\n                    layoutMode = "tablet";\n                } // else DESKTOP\n            }\n        } catch (e) {\n            pmc.diagnostic.push("vfav:gst")\n        }\n\n        pcl.addEvar(70, layoutMode); // eVar70\n        pcl.addEvar(71, window.location.host);\n        // pcl.addEvar( 73, pmc.GetPSTDateString() );\n\n        pcl.addEvar(74, stripCanonicalPath(window.location.pathname));\n\n        try {\n            pmc.automatedTestId = adobeopt.queryParam("qaTestID") || adobeopt.queryParam("testID");\n            if (pmc.automatedTestId !== undefined) {\n                localStorage.setItem("automatedTestId", pmc.automatedTestId);\n            } else {\n                pmc.automatedTestId = localStorage.getItem("automatedTestId");\n            }\n            if (pcl.strNotBlank(pmc.automatedTestId)) {\n                pcl.addEvar(100, pmc.automatedTestId);\n            }\n        } catch (ex) { }\n\n        if (pmc.isBusDel) {\n            var WC_BD_WHS = _satellite.cookie.get("WC_BD_WHS");\n            if (typeof WC_BD_WHS == "string" && WC_BD_WHS.length > 0) {\n                pcl.addEvar(84, WC_BD_WHS);\n            }\n            var WC_BD_ZIP = _satellite.cookie.get("WC_BD_ZIP");\n            if (typeof WC_BD_ZIP == "string" && WC_BD_ZIP.length > 0) {\n                pcl.addEvar(49, WC_BD_ZIP);\n            }\n        } else {\n            try {\n                var whdata = JSON.parse(_satellite.cookie.get(\'WAREHOUSEDELIVERY_WHS\'));\n                pcl.addEvar(84, whdata.groceryCenters[0]);\n            } catch (e) { }\n            try {\n                var storedata = JSON.parse(_satellite.cookie.get(\'STORELOCATION\'));\n                pcl.addEvar(86, storedata.storeLocation.city);\n            } catch (e) { }\n            try {\n                var zipcode = _satellite.cookie.get(\'invCheckPostalCode\');\n                pcl.addEvar(49, zipcode != undefined ? zipcode : "");\n            } catch (e) { }\n        }\n\n        let urlParams = new URLSearchParams(window.location.search);\n        let urlParamsFiltered = [];\n        urlParams.forEach(function (value, key) {\n            if (key !== "krypto") {\n                urlParamsFiltered.push(key + \'=\' + encodeURIComponent(value));\n            }\n        });\n        var pageurl = window.location.href.split("?")[0]; // review: hash\n        if (urlParamsFiltered.length > 0) {\n            pageurl += \'?\' + urlParamsFiltered.join("&");\n        }\n        // REVIEW is pageUrl used?\n        // ADO #349755\n        pcl.addEvar(69, adobeopt.cleanUrl(window.location));\n\n    } catch (e) {\n        amod.exception(e);\n        pmc.diagnostic.push("vfav");\n    }\n\n};\n\n// fire event\npmc.fireEvt = function (a1, a2, a3) {\n    pmc.varsForAllEvents();\n    if (pmc.diagnostic.length > 0) {\n        pcl.addEvent(66);\n        pcl.addEvar(66, pmc.diagnostic.join("|").slice(0, 200));\n        pmc.diagnostic = [];\n    }\n    pmc.fixUpReferrer(false);\n\n    if (pmc.inPrivateElement) {\n        amod.log("inPrivateElement: suppressing event");\n        pcl.beacon.suppressedPrivate = true;\n        pcl.clearSObj();\n    } else {\n        pcl.submitToAnalytics(a1, a2, a3);\n    }\n\n    pmc.trackParams = {};\n    pmc.diagnostic = [];\n};\n\npmc.fixUpReferrer = amod.tryWrap("fixUpReferrer", function (isPageView) {\n    digitalDataEx.sessionAnalyticsBeaconCt = adobeopt.sessionIncCounter("biBeaconCt");\n    if (isPageView) {\n        digitalDataEx.sessionAnalyticsPageViewCt = adobeopt.sessionIncCounter("biPageViewCt");\n    }\n    let referrer = document.referrer;\n    if (typeof referrer === "string" && referrer.length > 0) {\n        if (referrer.indexOf("signin.costco.com") > -1) {\n            pcl.beacon.referrer = window.location.origin + "/signin_costco_com";\n            return "fixing signin";\n        }\n    }\n    if (isPageView && digitalDataEx.sessionAnalyticsPageViewCt === 1) {\n        let savedReferrer = adobeopt.deepRef(digitalDataEx, "sessionLandingPage.referrer");\n        if (savedReferrer !== referrer) {\n            amod.diag("fixUpReferrer:using session referrer", savedReferrer);\n            pcl.beacon.referrer = savedReferrer;\n            return "using sessionLandingPage.referrer";\n        }\n    }\n    return "no change";\n});\n\n/** ENDMODULE datalayer_ecom **/\n',
language:"javascript"}}]},{id:"RLfe9a77c2df9b42ee9333316ab1778722",name:"SubCategory Favorite Scoring",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{global:!0,source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCcc5d34179c5b4cb18ee49f1832182077-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]},{id:"RLfed098d1cfcc4e7cabc081286a37f66d",name:"Analytics:My Account:OrdersPurchases",events:[{modulePath:"core/src/lib/events/domReady.js",settings:{},ruleOrder:50}],conditions:[{modulePath:"core/src/lib/conditions/path.js",settings:{paths:[{value:"/OrderStatusCmd"}]},timeout:2e3}],actions:[{modulePath:"core/src/lib/actions/customCode.js",settings:{source:"https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCf8aafd8b79ee4c8688a607c00d6a7838-source.min.js",language:"javascript",isExternal:!0},timeout:2e3,delayNext:!0}]}]};var _satellite=function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){var t,r;return!1!==n(e)&&(void 0===(t=e.constructor)||!1!==n(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf"))}function r(e){return"string"==typeof e&&-1!==e.indexOf("[")&&-1!==e.indexOf("]")}function o(e){return e.substr(0,e.indexOf("["))}function a(e,n,t){if(e.length&&pn(n)){var i=e[0];if(1!==e.length){var s=e.slice(1);if(!r(i))return a(s,n[i],t);var c=n[i=o(i)];Array.isArray(c)&&c.forEach((function(e){return a(s,e,t)}))}else n.hasOwnProperty(i)&&"string"==typeof n[i]&&(n[i]=t(n[i]))}}if(window.atob){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s=document,c=Object.assign,d=window,l=d,u=function(e,n,t,r){var o,a=Boolean(n&&Array.isArray(t)),i=Boolean(a&&e),s=document.createElement("a");if(a){var c=function(){var e=new Error("Unable to find the Library Embed Code for Dynamic Host Resolution.");throw e.code="dynamic_host_resolver_constructor_error",e};if(e&&(/^((https?:)?\/\/).+/.test(e)||c(),/^\/\/.+/.test(e)?s.href=l.location.protocol+e:s.href=e),s.hostname||c(),-1===t.indexOf(s.hostname)){var d=new Error("This library is not authorized for this domain. Please contact your CSM for more information.");throw d.code="dynamic_host_not_allowed",d}}var u=function(){if(null!=o)return o;if(i){var e=s.host;/:80$/.test(e)?e=e.replace(":80",""):/:80\/$/.test(e)?e=e.replace(":80/",""):/:443$/.test(e)?e=e.replace(":443",""):/:443\/$/.test(e)&&(e=e.replace(":443/","")),o=s.protocol+"//"+e}else o="";return o},p=function(e){return i&&"string"==typeof e?[u(),"/"===e.charAt(0)?e.slice(1):e].join("/"):e},f={getTurbineHost:u,decorateWithDynamicHost:p,get isDynamicEnforced(){return a}};return l&&r.onDebugChanged((function(e){e?l.dynamicHostResolver=f:delete l.dynamicHostResolver})),f},p=function(e){var n=[];return e.forEach((function(e){e.events&&e.events.forEach((function(t){n.push({rule:e,event:t})}))})),n.sort((function(e,n){return e.event.ruleOrder-n.event.ruleOrder}))},f="debug",m=function(e,n){var t=function(){return"true"===e.getItem(f)},r=function(n){e.setItem(f,n)},o=[],a=function(e){o.push(e)};return n.outputEnabled=t(),{onDebugChanged:a,getDebugEnabled:t,setDebugEnabled:function(e){t()!==e&&(r(e),n.outputEnabled=e,o.forEach((function(n){n(e)})))}}},g="Module did not export a function.",v=function(e,n,t){return function(r,o,a){a=a||[];var i=e.getModuleExports(r.modulePath);if("function"!=typeof i)throw new Error(g);var s=e.getModuleDefinition(r.modulePath),c=r.settings||{};!r.hasTransformedFilePaths&&s.filePaths&&(t(c,s.filePaths,r.modulePath),r.hasTransformedFilePaths=!0);var d=n(c,o);return i.bind(null,d).apply(null,a)}},h=function(e){return"string"==typeof e?e.replace(/\s+/g," ").trim():e},y={LOG:"log",INFO:"info",DEBUG:"debug",WARN:"warn",ERROR:"error"},b="\ud83d\ude80",w=10===parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])?"[Launch]":b,E=!1,S=function(e){if(E&&window.console){var n=Array.prototype.slice.call(arguments,1);n.unshift(w),e!==y.DEBUG||window.console[e]||(e=y.INFO),window.console[e].apply(window.console,n)}},x=S.bind(null,y.LOG),C=S.bind(null,y.INFO),P=S.bind(null,y.DEBUG),I=S.bind(null,y.WARN),k=S.bind(null,y.ERROR),D=function(){var e=E;E=!0,S.apply(null,Array.prototype.concat(y.WARN,Array.prototype.slice.call(arguments))),e||(E=!1)},T={log:x,info:C,debug:P,warn:I,error:k,deprecation:D,get outputEnabled(){return E},set outputEnabled(e){E=e},createPrefixedLogger:function(e){var n="["+e+"]";return{log:x.bind(null,n),info:C.bind(null,n),debug:P.bind(null,n),warn:I.bind(null,n),error:k.bind(null,n)}}},O=d,N="com.adobe.reactor.",R=function(e,n){var t=N+(n||"");return{getItem:function(n){try{return O[e].getItem(t+n)}catch(e){return null}},setItem:function(n,r){try{return O[e].setItem(t+n,r),!0}catch(e){return!1}}}},j=R,A="dataElements.",_=j("sessionStorage",A),L=j("localStorage",A),V={PAGEVIEW:"pageview",SESSION:"session",VISITOR:"visitor"},M={},U=function(e){var n;try{n=JSON.stringify(e)}catch(e){}return n},q=h,F=T,B={setValue:function(e,n,t){var r;switch(n){case V.PAGEVIEW:return void(M[e]=t);case V.SESSION:return void((r=U(t))&&_.setItem(e,r));case V.VISITOR:return void((r=U(t))&&L.setItem(e,r))}},getValue:function(e,n){var t;switch(n){case V.PAGEVIEW:return M.hasOwnProperty(e)?M[e]:null;case V.SESSION:return null===(t=_.getItem(e))?t:JSON.parse(t);case V.VISITOR:return null===(t=L.getItem(e))?t:JSON.parse(t)}}},H=function(e,n,t,r){return"Failed to execute data element module "+e.modulePath+" for data element "+n+". "+t+(r?"\n"+r:"")},W=function(e,n,t,r,o){return function(a,i){var s=n(a);if(!s)return r?"":void 0;var c,d,l=s.storageDuration;try{c=e.getModuleExports(s.modulePath),d=e.getModuleDefinition(s.modulePath)}catch(e){return void F.error(H(s,a,e.message,e.stack))}if("function"==typeof c){var u,p=s.settings||{};!s.hasTransformedFilePaths&&d.filePaths&&(o(p,d.filePaths,s.modulePath),s.hasTransformedFilePaths=!0);try{u=c(t(p,i),i)}catch(e){return void F.error(H(s,a,e.message,e.stack))}return l&&(null!=u?B.setValue(a,l,u):u=B.getValue(a,l)),null==u&&null!=s.defaultValue&&(u=s.defaultValue),"string"==typeof u&&(s.cleanText&&(u=q(u)),s.forceLowerCase&&(u=u.toLowerCase())),u}F.error(H(s,a,"Module did not export a function."))}},z=h,Q={text:function(e){return e.textContent},cleanText:function(e){return z(e.textContent)}},J=function(e,n,t){for(var r,o=e,a=0,i=n.length;a<i;a++){if(null==o)return;var s=n[a];if(t&&"@"===s.charAt(0)){var c=s.slice(1);o=Q[c](o)}else if(o.getAttribute&&(r=s.match(/^getAttribute\((.+)\)$/))){var d=r[1];o=o.getAttribute(d)}else o=o[s]}return o},$=function(e,n,t){return function(r,o){var a;if(n(r))a=t(r,o);else{var i=r.split("."),s=i.shift();"this"===s?o&&(a=J(o.element,i,!0)):"event"===s?o&&(a=J(o,i)):"target"===s?o&&(a=J(o.target,i)):a=J(e[s],i)}return a}},G=function(e,n){return function(t){var r=t.split(".")[0];return Boolean(n(t)||"this"===r||"event"===r||"target"===r||e.hasOwnProperty(r))}},K=function(e,n,t){var r={exports:{}};return e.call(r.exports,r,r.exports,n,t),r.exports},X=K,Y=T,Z=function(){var e={},n=function(n){var t=e[n];if(!t)throw new Error("Module "+n+" not found.");return t},t=function(){Object.keys(e).forEach((function(e){try{r(e)}catch(t){var n="Error initializing module "+e+". "+t.message+(t.stack?"\n"+t.stack:"");Y.error(n)}}))},r=function(e){var t=n(e);return t.hasOwnProperty("exports")||(t.exports=X(t.definition.script,t.require,t.turbine)),t.exports};return{registerModule:function(n,t,r,o,a){var i={definition:t,extensionName:r,require:o,turbine:a};i.require=o,e[n]=i},hydrateCache:t,getModuleExports:r,getModuleDefinition:function(e){return n(e).definition},getModuleExtensionName:function(e){return n(e).extensionName}}},ee=T,ne=!1,te=function(e){return function(n,t){var r=e._monitors;r&&(ne||(ee.warn("The _satellite._monitors API may change at any time and should only be used for debugging."),ne=!0),r.forEach((function(e){e[n]&&e[n](t)})))}},re=T,oe=function(e,n,t){var r,o,a,i,s=[],c=function(r,o,a){if(!e(o))return r;s.push(o);var i=n(o,a);return s.pop(),null==i&&t?"":i};return r=function(e,n){var t=/^%([^%]+)%$/.exec(e);return t?c(e,t[1],n):e.replace(/%(.+?)%/g,(function(e,t){return c(e,t,n)}))},o=function(e,n){for(var t={},r=Object.keys(e),o=0;o<r.length;o++){var a=r[o],s=e[a];t[a]=i(s,n)}return t},a=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++)t.push(i(e[r],n));return t},i=function(e,n){return"string"==typeof e?r(e,n):Array.isArray(e)?a(e,n):"object"==typeof e&&null!==e?o(e,n):e},function(e,n){return s.length>10?(re.error("Data element circular reference detected: "+s.join(" -> ")),e):i(e,n)}},ae=function(e){return function(){if("string"==typeof arguments[0])e[arguments[0]]=arguments[1];else if(arguments[0]){var n=arguments[0];for(var t in n)e[t]=n[t]}}},ie="undefined"!=typeof window&&window.Promise||void 0!==i&&i.Promise,se=ie,ce=function(e,n,t){return function(r,o,a,i){return i.then((function(){var i,s=r.delayNext;return new se((function(n,t){var o=e(r,a,[a]);if(!s)return n();var c=r.timeout,d=new se((function(e,n){i=setTimeout((function(){n(new Error("A timeout occurred because the action took longer than "+c/1e3+" seconds to complete. "))}),c)}));se.race([o,d]).then(n,t)})).catch((function(e){return clearTimeout(i),e=n(e),t(r,o,e),se.reject(e)})).then((function(){clearTimeout(i)}))}))}},de=ie,le=function(e,n,t,r,o){return function(a,i,s,c){return c.then((function(){var c;return new de((function(n,t){var r=e(a,s,[s]),o=a.timeout,i=new de((function(e,n){c=setTimeout((function(){n(new Error("A timeout occurred because the condition took longer than "+o/1e3+" seconds to complete. "))}),o)}));de.race([r,i]).then(n,t)})).catch((function(e){return clearTimeout(c),e=n(e),r(a,i,e),de.reject(e)})).then((function(e){if(clearTimeout(c),!t(a,e))return o(a,i),de.reject()}))}))}},ue=ie.resolve(),pe=function(e,n,t){return function(r,o){return r.conditions&&r.conditions.forEach((function(n){ue=e(n,r,o,ue)})),r.actions&&r.actions.forEach((function(e){ue=n(e,r,o,ue)})),ue=(ue=ue.then((function(){t(r)}))).catch((function(){}))}},fe=function(e){return Boolean(e&&"object"==typeof e&&"function"==typeof e.then)},me=function(e,n,t,r){return function(o,a){var i;if(o.conditions)for(var s=0;s<o.conditions.length;s++){i=o.conditions[s];try{var c=e(i,a,[a]);if(fe(c))throw new Error("Rule component sequencing must be enabled on the property for this condition to function properly.");if(!n(i,c))return t(i,o),!1}catch(e){return r(i,o,e),!1}}return!0}},ge=function(e,n){return function(t,r){e(t,r)&&n(t,r)}},ve=function(e){return function(n){var t=e.getModuleDefinition(n.modulePath);return t&&t.displayName||n.modulePath}},he=function(e){return function(n){var t=n.rule,r=n.event,o=e.getModuleDefinition(r.modulePath).name;return{$type:e.getModuleExtensionName(r.modulePath)+"."+o,$rule:{id:t.id,name:t.name}}}},ye=function(e,n,t,r,o,a){return function(i,s){var c=s.rule,d=s.event;d.settings=d.settings||{};try{var l=o(s);n(d,null,[function(n){var r=t(l,n);i((function(){e(r,c)}))}])}catch(e){a.error(r(d,c,e))}}},be=function(e,n,t,r){return function(o,a,i){var s=n(o);t.error(e(s,a.name,i)),r("ruleActionFailed",{rule:a,action:o})}},we=function(e,n,t,r){return function(o,a,i){var s=n(o);t.error(e(s,a.name,i)),r("ruleConditionFailed",{rule:a,condition:o})}},Ee=function(e,n,t){return function(r,o){var a=e(r);n.log('Condition "'+a+'" for rule "'+o.name+'" was not met.'),t("ruleConditionFailed",{rule:o,condition:r})}},Se=function(e,n){return function(t){e.log('Rule "'+t.name+'" fired.'),n("ruleCompleted",{rule:t})}},xe=function(e,n,t){return function(r,o){var a;if(r.actions)for(var i=0;i<r.actions.length;i++){a=r.actions[i];try{e(a,o,[o])}catch(e){return void n(a,r,e)}}t(r)}},Ce=function(e,n,t,r){return function(o,a){r("ruleTriggered",{rule:a}),e?t(a,o):n(a,o)}},Pe=function(e,n,t){return'Failed to execute "'+e+'" for "'+n+'" rule. '+t.message+(t.stack?"\n"+t.stack:"")},Ie=function(e,n){return n&&!e.negate||!n&&e.negate},ke=[],De=!1,Te=function(e){De?e():ke.push(e)},Oe=function(e,n,t){e(n).forEach((function(e){t(Te,e)})),De=!0,ke.forEach((function(e){e()})),ke=[]},Ne=function(e){if(e||(e=new Error("The extension triggered an error, but no error information was provided.")),!(e instanceof Error)){var n="object"==typeof e?JSON.stringify(e):String(e);e=new Error(n)}return e},Re={};Object.defineProperty(Re,"__esModule",{value:!0}),Re.isPlainObject=t;var je,Ae=T,_e=c,{isPlainObject:Le}=Re,Ve=function(e,n){return Le(n=n||{})?n=_e({},n,e):_e(n,e),n.hasOwnProperty("type")||Object.defineProperty(n,"type",{get:function(){return Ae.deprecation("Accessing event.type in Adobe Launch has been deprecated and will be removed soon. Please use event.$type instead."),n.$type}}),n},Me=function(e,n){return function(t,r){var o=e[t];if(o){var a=o.modules;if(a)for(var i=Object.keys(a),s=0;s<i.length;s++){var c=i[s],d=a[c];if(d.shared&&d.name===r)return n.getModuleExports(c)}}}},Ue=function(e,n){return function(){return n?e(n):{}}},qe=function(e,n,t){return function(r){if(t){var o=r.split(".");o.splice(o.length-1||1,0,"min"),r=o.join(".")}return e(n)+r}},Fe=".js",Be=function(e){return e.substr(0,e.lastIndexOf("/"))},He=function(e,n){return-1!==e.indexOf(n,e.length-n.length)},We=function(e,n){He(n,Fe)||(n+=Fe);var t=n.split("/"),r=Be(e).split("/");return t.forEach((function(e){e&&"."!==e&&(".."===e?r.length&&r.pop():r.push(e))})),r.join("/")},ze={exports:{}};je=function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var r in t)n[r]=t[r]}return n}function n(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function t(r){function o(){}function a(n,t,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},o.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var i=JSON.stringify(t);/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=r.write?r.write(t,n):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in a)a[c]&&(s+="; "+c,!0!==a[c]&&(s+="="+a[c].split(";")[0]));return document.cookie=n+"="+t+s}}function i(e,t){if("undefined"!=typeof document){for(var o={},a=document.cookie?document.cookie.split("; "):[],i=0;i<a.length;i++){var s=a[i].split("="),c=s.slice(1).join("=");t||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=n(s[0]);if(c=(r.read||r)(c,d)||n(c),t)try{c=JSON.parse(c)}catch(e){}if(o[d]=c,e===d)break}catch(e){}}return e?o[e]:o}}return o.set=a,o.get=function(e){return i(e,!1)},o.getJSON=function(e){return i(e,!0)},o.remove=function(n,t){a(n,"",e(t,{expires:-1}))},o.defaults={},o.withConverter=t,o}return t((function(){}))},ze.exports=je();var Qe=ze.exports,Je={get:Qe.get,set:Qe.set,remove:Qe.remove},$e=ie,Ge=function(e,n){return new $e((function(t,r){n.onload=function(){t(n)},n.onerror=function(){r(new Error("Failed to load script "+e))}}))},Ke=function(e){var n={};if(!e||"string"!=typeof e)return n;var t=e.trim().replace(/^[?#&]/,""),r=new URLSearchParams(t),o=r.keys();do{var a=o.next(),i=a.value;if(i){var s=r.getAll(i);1===s.length?n[i]=s[0]:n[i]=s}}while(!1===a.done);return n},Xe=function(e){var n="{{space}}",t=new URLSearchParams;return Object.keys(e).forEach((function(r){var o=e[r];"string"==typeof e[r]?o=o.replace(/ /g,n):["object","undefined"].includes(typeof o)&&!Array.isArray(o)&&(o=""),Array.isArray(o)?o.forEach((function(e){t.append(r,e)})):t.append(r,o)})),t.toString().replace(new RegExp(encodeURIComponent(n),"g"),"%20")},Ye="@adobe/reactor-",Ze={cookie:Je,document:s,"load-script":function(e){var n=document.createElement("script");n.src=e,n.async=!0;var t=Ge(e,n);return document.getElementsByTagName("head")[0].appendChild(n),t},"object-assign":c,promise:ie,"query-string":{parse:function(e){return Ke(e)},stringify:function(e){return Xe(e)}},window:d},en=function(e){return function(n){if(0===n.indexOf(Ye)){var t=n.substr(Ye.length),r=Ze[t];if(r)return r}if(0===n.indexOf("./")||0===n.indexOf("../"))return e(n);throw new Error('Cannot resolve module "'+n+'".')}},nn=Me,tn=Ue,rn=qe,on=T,an=We,sn=en,cn=function(e,n,t,r,o,a,i){var s=e.extensions,c=e.buildInfo,d=e.environment,l=e.property.settings;if(s){var u=nn(s,n);Object.keys(s).forEach((function(p){var f=s[p],m=f.settings;Array.isArray(f.filePaths)&&(m=a(m,f.filePaths));var g=tn(r,m);if(f.modules){var v=on.createPrefixedLogger(f.displayName),h=rn(i,f.hostedLibFilesBaseUrl,c.minified),y={buildInfo:c,environment:d,property:{name:e.property.name,id:e.property.id},getDataElementValue:o,getExtensionSettings:g,getHostedLibFileUrl:h,getSharedModule:u,logger:v,propertySettings:l,replaceTokens:r,onDebugChanged:t.onDebugChanged,get debugEnabled(){return t.getDebugEnabled()}};Object.keys(f.modules).forEach((function(e){var t=f.modules[e],r=sn((function(t){var r=an(e,t);return n.getModuleExports(r)}));n.registerModule(e,t,p,r,y)}))}})),n.hydrateCache()}return n},dn=Je,ln=T,un=function(e,n,t,r,o){var a=ln.createPrefixedLogger("Custom Script");e.track=function(e){ln.log('"'+e+'" does not match any direct call identifiers.')},e.getVisitorId=function(){return null},e.property={name:n.property.name,id:n.property.id},e.company=n.company,e.buildInfo=n.buildInfo,e.environment=n.environment,e.logger=a,e.notify=function(e,n){switch(ln.deprecation("_satellite.notify is deprecated. Please use the `_satellite.logger` API."),n){case 3:a.info(e);break;case 4:a.warn(e);break;case 5:a.error(e);break;default:a.log(e)}},e.getVar=r,e.setVar=o,e.setCookie=function(e,n,t){var r="",o={};t&&(r=", { expires: "+t+" }",o.expires=t);var a='_satellite.setCookie is deprecated. Please use _satellite.cookie.set("'+e+'", "'+n+'"'+r+").";ln.deprecation(a),dn.set(e,n,o)},e.readCookie=function(e){return ln.deprecation('_satellite.readCookie is deprecated. Please use _satellite.cookie.get("'+e+'").'),dn.get(e)},e.removeCookie=function(e){ln.deprecation('_satellite.removeCookie is deprecated. Please use _satellite.cookie.remove("'+e+'").'),dn.remove(e)},e.cookie=dn,e.pageBottom=function(){},e.setDebug=t;var i=!1;Object.defineProperty(e,"_container",{get:function(){return i||(ln.warn("_satellite._container may change at any time and should only be used for debugging."),i=!0),n}})},{isPlainObject:pn}=Re,fn=s,mn=c,gn=u,vn=p,hn=m,yn=v,bn=W,wn=$,En=G,Sn=Z,xn=te,Cn=oe,Pn=ae,In=ce,kn=le,Dn=pe,Tn=me,On=ge,Nn=ve,Rn=he,jn=ye,An=be,_n=we,Ln=Ee,Vn=Se,Mn=xe,Un=Ce,qn=Pe,Fn=Ie,Bn=Oe,Hn=Ne,Wn=Ve,zn=R,Qn=cn,Jn=un,$n=function(e,n){return function(t,r,o){return e&&pn(t)&&Object.keys(t).length&&Array.isArray(r)&&r.length?(r.forEach((function(e){Boolean(null!=o&&/^core\/.*actions.*\/customCode\.js$/.test(o))&&"source"===e&&!t.isExternal||a(e.split("."),t,n)})),t):t}},Gn=T,Kn=window._satellite;if(Kn&&!window.__satelliteLoaded){window.__satelliteLoaded=!0;var Xn=Kn.container;delete Kn.container;var Yn=mn({},Xn.buildInfo);Object.defineProperty(Yn,"environment",{get:function(){return Gn.deprecation("container.buildInfo.environment is deprecated.Please use `container.environment.stage` instead"),Xn.environment.stage}}),Xn.buildInfo=Yn;var Zn,et=hn(zn("localStorage"),Gn),nt="";fn.currentScript&&fn.currentScript.getAttribute("src")&&(nt=fn.currentScript.getAttribute("src"));try{Zn=gn(nt,Boolean(Xn.company.dynamicCdnEnabled),Xn.company.cdnAllowList,et)}catch(e){throw Gn.warn("Please review the following error:"),e}var tt,rt=$n(Zn.isDynamicEnforced,Zn.decorateWithDynamicHost),ot=Sn(),at=Xn.property.settings.undefinedVarsReturnEmpty,it=Xn.property.settings.ruleComponentSequencingEnabled,st=Xn.dataElements||{},ct=function(e){return st[e]},dt=function(){return tt.apply(null,arguments)},lt=bn(ot,ct,dt,at,rt),ut={},pt=Pn(ut),ft=En(ut,ct),mt=wn(ut,ct,lt);tt=Cn(ft,mt,at),Jn(Kn,Xn,et.setDebugEnabled,mt,pt),Qn(Xn,ot,et,tt,lt,rt,Zn.decorateWithDynamicHost);var gt=xn(Kn),vt=yn(ot,tt,rt),ht=Nn(ot),yt=Ln(ht,Gn,gt),bt=_n(qn,ht,Gn,gt),wt=An(qn,ht,Gn,gt),Et=Vn(Gn,gt),St=jn(Un(it,On(Tn(vt,Fn,yt,bt),Mn(vt,wt,Et)),Dn(kn(vt,Hn,Fn,bt,yt),In(vt,Hn,wt),Et),gt),vt,Wn,qn,Rn(ot),Gn);Bn(vn,Xn.rules||[],St)}return e(Kn)}console.warn("Adobe Launch is unsupported in IE 9 and below.")}();