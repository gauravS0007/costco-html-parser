// For license information, see `https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCd2c89a25631c4bdc9cbd234ee68e6cf3-source.js`.
_satellite.__registerScript('https://assets.adobedtm.com/db2abc551d12/237ca126a76b/de5d1a48add7/RCd2c89a25631c4bdc9cbd234ee68e6cf3-source.min.js', "<style id=\"adobe-target-reco-css\">\n@media (max-width: 767px) {\n    #target-rightrail-div {\n        float : none;\n    }\n}\n@media (min-width: 768px) {\n    #target-rightrail-div {\n        float : right;\n        width : 66%;\n    }\n    #target-rightrail-div .ratings-number {\n        float : none;\n    }\n    #target-rightrail-div hr {\n        margin-top : 40px;\n        margin-bottom : 40px;\n    }\n    #target-rightrail-div .thumbnail .caption p.description {\n        max-height : 120px;\n        -webkit-line-clamp : 6;\n    }\n}\n.mkl-carousel .slick-track { margin-left: 0px }\n</style>\n<script>\nif ( sessionStorage.getItem(\"adobeOptTiming\") ) {\n  window.adobeOptTiming = window.adobeOptTiming || {log:[],push:function(){adobeOptTiming.log.push([performance.now(), ...arguments])}};\n  adobeOptTiming.push( \"reco.core\" );\n}\n\nwindow.adobeopt = window.adobeopt || { };\n\n(function ($, w, ao) {\n  \n  let modreco = adobeopt.module(\"ttreco\");\n\n    window.biInspectEnabled = typeof window.biInspectEnabled == \"boolean\" ? biInspectEnabled : localStorage.getItem(\"biInspectEnabled\") !== null;\n    if (biInspectEnabled) {\n        window.biInspectEvents = window.biInspectEvents || [];\n    }\n\n    var fncnil = function () { };\n    var dbBiPushCopy = !biInspectEnabled ? fncnil : function (o, type) {\n        var copy = { _type: type ? \"reco-\" + type : \"reco-debug\" };\n        for (var k in o) {\n            if (typeof o[k] == \"function\" || k == \"event\" || k == \"element\") {\n                continue;\n            }\n            copy[k] = o[k];\n        }\n        biInspectEvents.push(copy);\n    };\n    var dbException = !biInspectEnabled ? fncnil : function (e, msg) {\n        dbBiPushCopy(e, \"exception\");\n    };\n    var dbGetOfferFailed = !biInspectEnabled ? fncnil : function (status, error) {\n        biInspectEvents.push({ _type: \"reco-debug-getofferfailed\", status: status, error: error });\n    };\n\n    function strHasValue(s) {\n        return typeof s == \"string\" && s.length > 0 && s !== \"&nbsp;\";\n    }\n\n    $(\"head\").append('<style id=\"mrkl-reco-styles\">.mkl-carousel .member-only { font-size:16px !important } </style>');\n  \n    window.merkle = window.merkle || {\n        log: function () { }\n    };\n    ao.reco = merkle.reco = merkle.reco || {}; // REVIEW\n    ao.util = merkle; // REVIEW\n    window.pmcRecc = merkle.reco; // REVIEW\n\n    merkle.isMobileLayout = function () {\n        return window.innerWidth < 668;\n    }\n\n    merkle.isInViewport = function (el) {\n        // jquery object\n        if (typeof jQuery === \"function\" && el instanceof jQuery) {\n            el = el[0];\n        }\n        var rect = el.getBoundingClientRect();\n        return (\n            rect.top >= 0 &&\n            rect.left >= 0 &&\n            rect.bottom > 0 &&\n            rect.right > 0 &&\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n        );\n    }\n\n    merkle.visibilityListenerReg = false;\n    merkle.visibilityTimerId = 0;\n\n    merkle.checkVisibleTimer = function () {\n        // wait for 1000ms after the last scroll message is received\n        // before checking.\n        if (merkle.visibilityTimerId != 0) {\n            // hasn't been long enough yet\n            clearTimeout(merkle.visibilityTimerId);\n        }\n        merkle.visibilityTimerId = setTimeout(merkle.checkVisibleHandler, 1000);\n    }\n\n    merkle.checkVisibleHandler = function () {\n        var elements = $(\"[on-visible]\"); // list of elements to trigger when they are visible \n        if (elements.length == 0) {\n            // all items are visible so we can stop listening\n            $(window).off('DOMContentLoaded load resize scroll', merkle.checkVisibleTimer);\n            merkle.visibilityListenerReg = false;\n            return;\n        }\n        $(elements).each(function () {\n            if (merkle.isInViewport(this)) {\n                $(this).trigger(\"firstVisible\");\n                $(this).removeAttr(\"on-visible\");\n            }\n        })\n    }\n\n    merkle.onFirstTimeVisible = function ( $node, callback) {\n        if (!merkle.visibilityListenerReg) {\n            // starting watching for window scrolling\n            $(window).on('DOMContentLoaded load resize scroll', merkle.checkVisibleTimer);\n            merkle.visibilityListenerReg = true;\n        }\n        $node.attr(\"on-visible\", \"true\");\n        $node.on(\"firstVisible\", function (e) {\n            // callback comes from closure\n            callback.call(this, e);\n        });\n    }\n\n    merkle.adjustPdpVisible = function () {\n        function showIfPresent(sel) {\n            var div = $(sel);\n            if (div.length == 0) {\n                return false;\n            }\n            $(div).css(\"display\", \"block\");\n            return true;\n        }\n        $(\"#merkle-recommendations > div\").css(\"display\", \"none\");\n        if (showIfPresent(\"#mbox-reco-complete-the-look-container\")) { // complete the look\n            return;\n        }\n        if (showIfPresent(\"#mbox-recommend-collections\")) { // furniture collections\n            return;\n        }\n        if (showIfPresent(\"#mbox-reco-accessories\")) { // related products\n            return;\n        }\n        if (showIfPresent(\"#mbox-similar-samebrand\")) { // same brand similar products\n            return;\n        }\n        $(\"#mbox-recommend\").show(); // similiar\n    }\n\n    merkle.pidFromUrl = function (url) {\n        var myRegexp = /\\.product\\.(.*)\\.html/g;\n        var match = myRegexp.exec(url);\n        return match ? match[1] : \"\";\n    }\n\n    // custom initialization code\n    merkle.reco.custominit = {\n        treasureHunt: function (reco) {\n            reco.cfg[\"criteria.title\"] = '<a href=\"https://www.costco.com/CatalogSearch?dept=All&pageSize=96&keyword=whilesupplieslast\">Treasure Hunt</a> Featured Items';\n        },\n        randomize: function (reco) {\n            try {\n                var ar = reco.rcmd;\n                for (var i = 0; i < reco.rcmd.length; i++) {\n                    reco.rcmd[i].order = Math.random();\n                }\n                reco.rcmd.sort(function (a, b) {\n                    return a.order - b.order;\n                });\n            } catch (e) { dbException(e) } // OK to fail\n        },\n        interleaveCats: function (reco) {\n            try {\n\n                var seen = {}; // keep an integer for count of each category we’ve seen\n                for (var i = 0; i < reco.rcmd.length; i++) {\n                    var p = reco.rcmd[i];\n                    p.order = ++seen[p.newCat]; // increment the number of times we’ve seen this cateegory\n                    if (isNaN(p.order)) { // if it’s the first time we get NaN...\n                        p.order = seen[p.newCat] = 0; // ...so start at 0\n                    }\n                }\n                reco.rcmd.sort(function (a, b) { // now sort objects array by the order it appeared within each category\n                    return a.order - b.order;\n                });\n\n            } catch (e) { dbException(e) } // OK to fail\n        }\n    }\n\n    merkle.reco.formatItem = function (prod, idindex, options, reco) {\n\n        if (pmcRecc.thisIsCAFr) {\n            prod.name = prod.frName;\n            prod.merch_desc = prod.frMessage;\n        }\n        prod.ratingClip = 18 * prod.rating.trim();\n        prod.reviews = prod.reviews.length ? prod.reviews.trim() : 0;\n\n        // if there is no URL or name, skip it\n        // this is particulary important in FR, in case there is no translation\n        if (prod.linkURL.trim() == \"\" || prod.name.trim() == \"\")\n            return \"\"; // skip empty entry\n\n        prod.price = \"$\" + prod.price;\n\n        // template uses: \n        // linkURL\n        // imageURL\n        // price\n        // merch_desc\n        // name\n        // ratingClip\n        // reviews\n        // rating\n        // reviews\n        var t = prod;\n      \n        var o = '<div class=\"hl-product thumbnail\" data-bi-sku=\"' + t.sku + '\" style=\"' + options.style + '\" >';\n\n        if ( options.showPills && options.pillsPresent ) { // if any of the items have pills we need to reserve empty space in all of them\n            var pills = pmcRecc.thisIsCAFr ? t.pills_fr : t.pills;\n            if ( pills != undefined && pills != \"\" && pills != \"&nbsp;\" ) {\n                o += '\\n<div class=\"pills-section\">';\n                $.each( pills.split(\",\"), function( i, pillname) {\n                    o += '<div class=\"pill\"><span>' + pillname + '</span></div>';\n                });\n                o += '</div>\\n';\n            } else {\n                o += '<div class=\"pills-section\" style=\"visibility:hidden\"><div class=\"pill\"><span>&nbsp;</span></div></div>';\n            }\n        }\n\n        try {\n          if ( window.pmcRecc && pmcRecc.isStaging() ) {\n            t.imageURL = t.imageURL.replace(\"images.costco-static\", \"images-qa.costco-static\")\n          }\n        } catch(e){}\n      \n        o += '<a href=\"' + t.linkURL + '\">';\n        o += '<img height=\"350\" width=\"350\" class=\"hl-image img-responsive\" id=\"image' + idindex + '\" alt=\"' + t.name + '\" src=\"' + t.imageURL + '\" />';\n        o += \"</a>\";\n\n        o += '<div class=\"caption\"> <div class=\"hl-price-container\">';\n\n        if (options.fBadgeSponsored === true && prod.sponsored == \"1\") {\n            // modify the template with sponsored designation before promo message\n            o += '<p class=\"promo\">Sponsored</p>';\n        }\n\n        var isMemberOnly = t.product_type == \"member-only\" || t.member_only == \"True\"; // REVIEW: Transition\n        var isMemberOnlyMap = isMemberOnly || t.product_type == \"map\"; // REVIEW: Transition\n\n        if (isMemberOnly) {\n            if (pmcRecc.thisIsCAFr) {\n                o += ' <p class=\"member-only\"><span class=\"co-c\"></span>Membres seulement</p>';\n            } else {\n                o += ' <p class=\"member-only\"><span class=\"co-c\"></span>Member Only Item</p>';\n            }\n        }\n\n        if (options.showPricePromo && (!isMemberOnlyMap || options.isUserMember)) {\n\n            var dprice = \"\";\n\n            if (strHasValue(t.dprice)) {\n                if (window.COSTCO !== undefined && COSTCO.util.getRegion() == \"CAQC\" && strHasValue(t.dprice_qc)) {\n                    dprice = pmcRecc.formatDPrice(t.dprice_qc);\n                } else {\n                    dprice = pmcRecc.formatDPrice(t.dprice);\n                }\n            } else {\n                dprice = t.displayPrice;\n                if (window.COSTCO !== undefined && COSTCO.util.getRegion() == \"CAQC\") {\n                    dprice = t.displayPriceCAQC;\n                }\n                if (pmcRecc.thisIsCAFr) {\n                    dprice = dprice.replace(\"$\", \"\").replace(\",\", \" \").replace(\".\", \",\") + \" $\";\n                }\n                if (dprice.indexOf(\"Starting at\") == 0) {\n                    if (pmcRecc.thisIsCAFr) {\n                        o += '<div>À partir de</div>';\n                    } else {\n                        o += '<div>Starting at</div>';\n                    }\n                    dprice = dprice.slice(12);\n                }\n            }\n\n            o += ' <span class=\"h3 hl-price price\">' + dprice + '</span> ';\n        }\n        o += \" </div> \";\n\n        if (options.showPricePromo && !pmcRecc.thisIsCAFr) {\n            if (t.dmerch && t.dmerch != \"&nbsp;\") {\n                o += ' <p class=\"promo\">' + t.dmerch + \"</p> \";  // REVIEW: french\n            } else if (t.merch_desc && t.merch_desc != \"&nbsp;\") {\n                o += ' <p class=\"promo\">' + t.merch_desc + \"</p> \";  // REVIEW: french\n            }\n        }\n        o += '<p class=\"description\"> <a href=\"' + t.linkURL + '\">' + t.name + '</a></p>'\n        try {\n            if (options.showItemNumber && t.sku.length > 0) {\n                o += '<div class=\"body-copy\">' + pmcRecc.locItem + t.sku + '</div>';\n            }\n        } catch (e) { dbException(e) }\n        o += '</div>';\n\n        if ( digitalDataEx.siteStore !== \"bd\" && options.showReviews && t.id != \"100351566\" ) { // travel\n            flRating = parseFloat(t.rating);\n            if (flRating == NaN) {\n                flRating = 0;\n            }\n\n            o += '<img style=\"display: none;\" alt=\"\" /> <div class=\"ratings\">';\n            var rating = 0;\n            if (flRating > 0) {\n                try {\n                    rating = Math.round(flRating * 10) / 10;\n                    o += '<span class=\"offscreen\">' + rating + ' out of 5 stars</span>';\n                } catch (e) { dbException(e) }\n            }\n            o += '<div class=\"stars\" aria-hidden=\"true\"> <ul class=\"stars overlay\" style=\"clip-path: inset(0 ';\n            o += (t.reviews !== \"0\" && rating > 0) ? Math.round( 100 - rating*2*10 ) : \"0\";\n            o += '% 0 0)\"> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> </ul> <ul class=\"stars underlay\"> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> <li><span class=\"fi-star\"></span></li> </ul> </div>';\n            o += '<div class=\"ratings-number\">(' + (t.reviews || 0) + ')<span class=\"offscreen\">reviews</span></div> </div>';\n        }\n\n        o += '</div>';\n\n        return o;\n    }\n\n    merkle.reco.displayResults = function (reco) {\n\n\n        var isUserMember = false;\n\n        try {\n            if (COSTCO.util.getMemberCookie) {\n                var mi = COSTCO.util.getMemberCookie();\n                isUserMember = mi.costcoMember == true;\n            }\n        } catch (e) { dbException(e) }\n\n        //sean: update titleHtml class from h2-style-guide to t2-style per Trina Saunders request\n        var options = {\n            placementId: \"mbox-recommend\",\n            slidesToShow: 5,\n            responsiveSlidesToShow: 2,\n            showPricePromo: true,\n            isUserMember: isUserMember,\n            showReviews: true,\n            titleHtml: '<div class=\"t2-style\" style=\"font-size:22px;padding-top:10px;margin-top:10px;border-top:1px solid #ddd;\">$title$</div>',\n            title: reco.cfg[\"criteria.title\"],\n            makeCarousel: true,\n            minDesktop: 5,\n            minMobile: 2,\n            maxItems: 15,\n            showDots: true,\n            style: \"\",\n            showItemNumber: _satellite.getVar(\"Is BD?\"),\n            showPills: _satellite.getVar(\"Is BD?\"),\n            pillsPresent: false,\n            trackImpression: true,\n            filterDuplicates: false,\n            duplicateHandeling: \"remove\",\n        };\n\n        dbBiPushCopy(reco, \"displayResults\");\n\n        if (reco.options) {\n            $.extend(options, reco.options);\n        }\n\n        if (reco.optionsOverride) { // from design, overrides any option changes made by caller\n            $.extend(options, reco.optionsOverride);\n        }\n\n        if (!window.adobeopt.reco.existingRecs) {\n            window.adobeopt.reco.existingRecs = new Set()\n        }\n        if (options.filterDuplicates) {\n          //find duplicates\n          let duplicateItems = reco.rcmd.filter(function (rec) {\n            return window.adobeopt.reco.existingRecs.has(rec.id);\n          });\n\n          if (options.duplicateHandeling == \"end\") {\n            //move duplicates to end\n            reco.rcmd = reco.rcmd\n              .filter(function (rec) {\n                return !duplicateItems.includes(rec);\n              })\n              .concat(duplicateItems);\n          } else {\n              reco.rcmd = reco.rcmd.filter(function (rec) {\n              return !window.adobeopt.reco.existingRecs.has(rec.id);\n            });\n          }\n        }\n\n        reco.rcmd = reco.rcmd.slice(0, options.maxItems);\n        // track newly added reccomendations in window variable\n        reco.rcmd.forEach(function (rec) {\n          window.adobeopt.reco.existingRecs.add(rec.id);\n        });\n\n        // do we have the minimum number of items to display?\n        if (reco.rcmd.length < (merkle.isMobileLayout() ? options.minMobile : options.minDesktop)) {\n            return false;\n        }\n        if (merkle.isMobileLayout()) {\n            if (reco.rcmd.length <= options.responsiveSlidesToShow) {\n                options.showDots = false;\n            }\n        } else {\n            if (reco.rcmd.length <= options.slidesToShow) {\n                options.showDots = false;\n            }\n        }\n      \n        var cin = options.cin; // custom init function\n        if (typeof cin == \"string\" && cin != \"\") {\n            var cins = cin.split(\",\"); // can be csv\n            for (var icin = 0; icin < cins.length; icin++) {\n                var fn = merkle.reco.custominit[cins[icin]];\n                if (typeof fn == \"function\") {\n                    fn(reco);\n                }\n            }\n        }\n\n        var plaId = options.placementId;\n        var plaSel = \"#\" + plaId;\n\n        if ( options.showPills ) { // if any of the items have pills we need to reserve empty space in all of them, calc pillsPresent\n            for ( var i = 0 ; i < reco.rcmd.length ; i++ ) {\n                var p = reco.rcmd[i][\"pills\"];\n                if ( p != undefined && p !== \"\" && p !== \"&nbsp\" ) {\n                    options.pillsPresent = true;\n                    break;\n                }\n            }\n        }\n\n        var title = options.title;\n        if (pmcRecc.thisIsCAFr) {\n            if (options.frt) { // french title\n                title = options.frt;\n            } else {\n                var titleMap = {\n                    \"Similar Products\": \"Articles similaires\",\n                    \"Recently Viewed Products\": \"Consulté(s) récemment\",\n                    \"Complete The Look\": \"Complétez le style\",\n                    \"Related Products\": \"Articles connexes\",\n                    \"Members Also Considered\": \"Aussi considérés par les membres\",\n                    \"Top Selling Products\": \"Articles les plus vendus\",\n                    \"Top Sellers\": \"Articles les plus vendus\",\n                    \"Ultimately Purchased\": \"Acheté(s) en définitive\",\n                    \"Members Ultimately Purchased\": \"Acheté(s) en définitive par les membres\",\n                    \"Pick Up Where You Left Off\": \"Reprenez votre magasinage là où vous étiez\",\n                    \"More Items To Consider\": \"Autres articles à considérer\"\n                };\n                if (titleMap[title] != undefined) {\n                    title = titleMap[title];\n                }\n            }\n        }\n\n        var titleHtml = options.titleHtml.replace(\"$title$\", title);\n\n        var c = $(plaSel);\n        var f = [];\n\n        $(c).hide();\n\n        f.push(titleHtml);\n\n        try {\n            if (!options.showPricePromo) {\n                options.showPricePromo = sessionStorage.getItem(\"merkle-show-pp\") == \"yes\";\n            }\n        } catch (e) { dbException(e) }\n\n        for (var i = 0; i < reco.rcmd.length; i++) {\n\n            prod = reco.rcmd[i];\n            if (prod == undefined) { // REVIEW: randomize?\n                continue;\n            }\n            f.push(merkle.reco.formatItem(prod, i, options, reco));\n        }\n\n        c.prepend(f.join(\"\"));\n\n        if (options.makeCarousel) {\n\n            if ($(\"#merkle-carousel-css\").length == 0) {\n                $(\"head\").append('<style id=\"merkle-carousel-css\" type=\"text/css\">  .mkl-carousel { display:none } .mkl-carousel.slick-initialized { display:block }  </style>');\n            }\n            c.find(\".hl-product\").wrapAll('<div class=\"mkl-carousel feature-carousel\" id=\"' + plaId + '-carousel\" />');\n        }\n\n        c.addClass(\"fixed-container product-list feature-carousel-container\");\n\n        if (options.makeCarousel) {\n            COSTCO.util.carousel(plaSel + \"-carousel\", {\n                dots: options.showDots,\n                arrows: !0,\n                infinite: !1,\n                slidesToShow: options.slidesToShow,\n                slidesToScroll: options.slidesToShow,\n                autoplay: !1,\n                lazyLoad: \"ondemand\",\n                responsive: [{\n                    breakpoint: 668,\n                    settings: {\n                        slidesToShow: options.responsiveSlidesToShow,\n                        slidesToScroll: options.responsiveSlidesToShow,\n                        dots: options.showDots,\n                        infinite: !1,\n                        arrows: !1\n                    }\n                }]\n            });\n        } else {\n            // no carousel - this allows impression tracking to work without the carousel\n            $(\".hl-product\").addClass(\"slick-active\");\n        }\n        // COSTCO.util.display_member_prices();\n\n        $(plaSel).css(\"display\", 'block');\n\n        var $placement = $(plaSel);\n        $placement.attr(\"data-bi-track\", \"reco\");\n        // $(plaSel).attr(\"data-reco-act\", reco.cfg[\"campaign.name\"] );\n        // $(plaSel).attr(\"data-reco-exp\", reco.cfg[\"algorithm.name\"] );\n        // use ID\n        $placement.attr(\"data-reco-act\", reco.cfg[\"campaign.id\"]);\n        $placement.attr(\"data-reco-exp\", reco.cfg[\"offer.id\"]);\n        $placement.find(\".hl-product\").attr(\"data-reco-impression\", \"yes\");\n\n        function fireImpressions(reconode) {\n            try {\n                var $carousel = $(reconode).closest(\"[data-bi-track]\");\n                if ( $carousel.length == 0 ) {\n                    return;\n                }\n                var $elements = $carousel.find(\".slick-active[data-reco-impression]\");\n                if ($elements.length > 0) {\n                    merkleAnalytics.pmc.targetRecoImpression($carousel[0], $elements);\n                    $elements.removeAttr(\"data-reco-impression\");\n                }\n            } catch (e) { dbException(e) }\n        }\n\n        if ( options.trackImpression ) {\n          merkle.onFirstTimeVisible( $(plaSel).find(\".hl-product\").first(), function () { fireImpressions( this ) });\n          $(plaSel + \"-carousel\").on(\"afterChange\", function () { fireImpressions( this ) });\n        }\n      \n        if (options.makeCarousel) {\n            try {\n                // triggerResize(); // debounced; waits at least 500ms,  or longer if called multiple times\n                $(plaSel + \"-carousel\").slick('setPosition');\n            } catch (e) { dbException(e) }\n        }\n\n        return true; // successfully displayed\n\n    }\n\n    // loaded at top of page, we should be able to disable RR\n    if (typeof rrData != \"undefined\") {\n        // disable the RR results\n        rrData.rrEnabled = false;\n    }\n\n    pmcRecc.isStaging = function () {\n        return !(\"www.costco.com|www.costco.ca|www.costcobusinessdelivery.com|www.costcobusinesscentre.ca\".indexOf(window.location.hostname) > -1);\n    }\n\n    pmcRecc.thisIsPDP = window.location.pathname.indexOf(\".product.\") > -1;\n    pmcRecc.thisIsCategory = (typeof PageAnalyticsInfo == \"object\" && PageAnalyticsInfo.pageType == \"Category\")\n    pmcRecc.thisIsCA = window.location.host.indexOf(\".ca\") > -1;\n    pmcRecc.thisIsCAFr = false;\n\n    pmcRecc.formatSlickSlide = function () {\n\n        // review: previous calls of this function used two arguments, no longer needed\n\n        var rd = $(\"#reccData\");\n        if (rd.length == 0)\n            return;\n\n        var title = $(\"#reccData\").attr(\"data-criteria-title\")\n\n        if (title.toLowerCase().indexOf(\"richrelevance\") > -1) {\n            pmcRecc.showRichRelevance();\n            return;\n        }\n\n        var c = $(\"#atr-placement\");\n        var f = [];\n\n        $(c).hide();\n\n        if (pmcRecc.thisIsCAFr) {\n            var titleMap = {\n                \"Similar Products\": \"Articles similaires\",\n                \"Recently Viewed Products\": \"Consulté(s) récemment\",\n                \"Complete The Look\": \"Complétez le style\",\n                \"Related Products\": \"Articles connexes\",\n                \"Members Also Considered\": \"Aussi considérés par les membres\",\n                \"Top Selling Products\": \"Articles les plus vendus\",\n                \"Ultimately Purchased\": \"Acheté(s) en définitive\",\n                \"Members Ultimately Purchased\": \"Acheté(s) en définitive par les membres\"\n            };\n            if (titleMap[title] != undefined) {\n                title = titleMap[title];\n            }\n        }\n\n        f.push('<div style=\"h3-style-guide\" style=\"padding-top:10px;margin-top:10px;border-top:1px solid #ddd;\">' + title + '</div>');\n        $(\"#mbox-recommend\").css(\"border-bottom\", \"1px solid #ddd\")\n\n        $(rd).find(\"> div\").each(function (i) {\n\n            prod = {};\n            prod.id = $(this).find(\".reccId\").html();\n            if (pmcRecc.thisIsCAFr) {\n                prod.name = $(this).find(\".reccFrName\").html();\n                prod.msg = $(this).find(\".reccFrMsg\").html();\n            } else {\n                prod.name = $(this).find(\".reccName\").html();\n                prod.msg = $(this).find(\".reccMsg\").html();\n            }\n            prod.pageUrl = $(this).find(\".reccPageUrl\").html();\n            if (window.location.hostname.indexOf(\"m.costco\") > -1) {\n                prod.pageUrl = prod.pageUrl.replace(\"www.costco\", \"m.costco\");\n            } else {\n                prod.pageUrl = prod.pageUrl.replace(\"m.costco\", \"www.costco\"); // just in case\n            }\n            prod.pageUrl = prod.pageUrl; //.split('\"').join(\"&quot;\"); // escape quotation marks - cat sould already be encoded\n            prod.thumbUrl = $(this).find(\".reccThumbUrl\").html();\n            prod.memberOnly = $(this).find(\".reccMemberOnly\").html();\n            prod.rating = $(this).find(\".reccRating\").html();\n            prod.reviews = $(this).find(\".reccReviews\").html();\n\n            // if there is no URL or name, skip it\n            // this is particulary important in FR, in case there is no translation\n            if (prod.pageUrl.trim() == \"\" || prod.name.trim() == \"\")\n                return; // skip blank entries\n\n            var linkURL = prod.pageUrl.trim();\n\n            var g = $(COSTCO.util.tmpl(\"tmpl_product_tile\", {\n                linkURL: linkURL,\n                imageURL: prod.thumbUrl,\n                price: \"\",\n                merch_desc: \"\", //prod.msg.trim(),\n                name: prod.name.trim(),\n                rating: prod.rating.trim(),\n                ratingClip: 18 * prod.rating.trim(),\n                reviews: prod.reviews.length ? prod.reviews.trim() : 0\n            }));\n            g.addClass(\"rrTile\");\n            f.push(g.prop(\"outerHTML\"))\n\n        })\n\n        slidesToShow = 5;\n        slidesToScroll = 5;\n        responsiveSlidesToShow = 2;\n        responseSlidesToScroll = 2;\n\n        c.prepend(f.join(\"\"));\n        c.find(\".rrTile\").wrapAll('<div class=\"feature-carousel\" id=\"atr-carousel\" />');\n        c.addClass(\"fixed-container product-list feature-carousel-container\");\n\n        COSTCO.util.carousel(\"#atr-carousel\", {\n            dots: !0,\n            arrows: !0,\n            infinite: !1,\n            slidesToShow: slidesToShow,\n            slidesToScroll: slidesToScroll,\n            autoplay: !1,\n            lazyLoad: \"ondemand\",\n            responsive: [{\n                breakpoint: 668,\n                settings: {\n                    slidesToShow: responsiveSlidesToShow,\n                    slidesToScroll: responseSlidesToScroll,\n                    dots: !0,\n                    infinite: !1,\n                    arrows: !1\n                }\n            }]\n        });\n        COSTCO.util.display_member_prices();\n\n        $(\"#atr-placement\").css(\"display\", 'block');\n        $(window).trigger('resize'); // the div doesn't seem to always be in the correct layout until it is displayed\n    };\n\n    pmcRecc.fixUpPDPOOS = function () {\n\n        var t = $(\"#recoTitle\").first().html(); // works even if there are two\n        if (t.indexOf(\"$key.id\") > -1) {\n            var prodId = window.location.pathname.split(\".product.\")[1].split(\".html\")[0];\n            t = \"Item #\" + prodId + \" Not Found\";\n        }\n        $(\"h1\").first().html($(\"#recoTitle\").html());\n        $(\".server-error\").removeClass(\"server-error\");\n        // $(\"#main_content_wrapper\").css(\"visibility\", \"visible\");\n    };\n\n    pmcRecc.locStartingAt = \"Starting at \";\n    pmcRecc.locItem = 'Item ';\n    pmcRecc.currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });\n    if ( digitalDataEx.siteCountry == \"ca\" ) {\n      if ( digitalDataEx.siteLang == \"fr\" ) {\n            pmcRecc.currencyFormatter = new Intl.NumberFormat('fr-CA', { style: 'currency', currency: 'CAD' });\n            pmcRecc.locStartingAt = \"À partir de \";\n            pmcRecc.locItem = \"N° d'article \";        \n      } else {\n         pmcRecc.currencyFormatter = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' });\n      }\n    }\n\n    pmcRecc.formatDPrice = function (pricestr) {\n        if (pricestr == \"\" || pricestr == \"&nbsp;\" || !pmcRecc.currencyFormatter) {\n            return \"\";\n        }\n        var prefix = \"\";\n        if (pricestr.slice(-1) == \"+\") {\n            prefix = pmcRecc.locStartingAt;\n            pricestr = pricestr.slice(0, -1);\n        }\n        return prefix + pmcRecc.currencyFormatter.format(parseFloat(pricestr)).replace(\" CA\", \"\"); // remove \"CA\" in fr_CA\n    }\n\npmcRecc.envMboxParams = function (mboxparams, addPriceInfo) {\n\n    if ( !addPriceInfo ) {\n        return; // everything else is in targetPageParams\n    }\n\n    modreco.trySafe( \"envMboxParams\", function(){\n\n        let merchmsg = $(\"#product-details .merchandisingText\").first().html();\n        if (merchmsg === \"\") {\n            merchmsg = \"&nbsp;\"\n        }\n        if (window.wcs && wcs.locale) {\n            if (wcs.locale == 'fr_CA') {\n                digitalDataEx.productPdpFrMerchMsg = merchmsg;\n                mboxparams['entity.dmerch_fr'] = merchmsg;\n            } else {\n                digitalDataEx.productPdpMerchMsg = merchmsg;\n                mboxparams['entity.dmerch'] = merchmsg;\n            }\n        }\n\n        var range = new PriceRange();\n        var isca = digitalDataEx.site_country == \"ca\";\n        var range_qc = new PriceRange();\n        if ( digitalDataEx.siteCountry === \"ca\" ) {\n            range_qc.addFee( $(\".fees.CAQC[data-feeamt]\").attr(\"data-feeamt\") );\n            digitalDataEx.productPdpCAEcoFee = range_qc.fee;\n        }\n\n        let scripts = document.querySelectorAll('.col-xs-12 > script');\n        for ( let i = 0 ; i < scripts.length ; i ++ ) {\n            let text = scripts[i].textContent;\n            if ( text.indexOf(\"analytics.track('Viewed Product'\") > -1 ) {\n                let inv = adobeopt.reExtract( /available: '(.*?)',/, text );\n                let priceMin = adobeopt.reExtract( /priceMin: '([\\d\\.]+)',/, text );\n                let priceMax = adobeopt.reExtract( /priceMax: '([\\d\\.]+)',/, text );\n                range.add( priceMin, inv );\n                range.add( priceMax, inv );\n                mboxparams['entity.inventory'] = range.inventory;\n                if (range.price !== \"\") {\n                    mboxparams['entity.dprice'] = range.price\n                    digitalDataEx.productPdpPrice = range.price;\n                }\n                if ( digitalDataEx.siteCountry === \"ca\" ) {\n                    range_qc.add( priceMin, inv );\n                    range_qc.add( priceMax, inv );\n                    if (range_qc.price != \"\") {\n                        mboxparams['entity.dprice_qc'] = range_qc.price;\n                        digitalDataEx.productPdpQCPrice = range_qc.price;\n                    }\n                }\n                break;\n            }\n        }\n\n        modreco.diag(\"envMboxParams\",mboxparams);\n\n    });\n\n    return mboxparams;\n\n    function priceFromStr(pr) {\n        if (pr == undefined || pr == \"\") {\n            return 0.00;\n        }\n        if ( pr.slice(-1) === \"=\" ) {\n            pr = dc(pr);\n        }\n        var pr = parseFloat(pr.replace(/,/g, ''));\n        return pr !== NaN ? pr : 0.0;\n    }\n\n    function PriceRange(fee) {\n        this.inventory = 0;\n        this.minPrice = 0.0;\n        this.price = \"\";\n        this.range = '';\n        this.fee = 0.00;\n        this.disc = 0.00;\n        this.addFee = function (amt) {\n            this.fee += priceFromStr(amt);\n        }\n        this.addDisc = function (amt) {\n            this.disc += priceFromStr(amt);\n        }\n        this.add = function (p, instock) {\n            if (instock == \"IN_STOCK\" || instock == \"In stock\") {\n                this.inventory = 1;\n            }\n            var pfl = priceFromStr(p) + this.fee - this.disc;\n            if (pfl > 0.0) {\n                if (this.minPrice > 0.0 && pfl != this.minPrice) {\n                    this.range = \"+\";\n                }\n                this.minPrice = this.minPrice > 0 ? Math.min(pfl, this.minPrice) : pfl;\n                this.price = this.minPrice.toFixed(2) + this.range;\n            }\n        }\n    }\n\n    function dc(input) {\n        function dc8(utftext) {\n            var string = '';\n            var i = 0;\n            var c = c1 = c2 = 0;\n            while (i < utftext.length) {\n                c = utftext.charCodeAt(i);\n                if (c < 128) {\n                    string += String.fromCharCode(c);\n                    i++;\n                } else if ((c > 191) && (c < 224)) {\n                    c2 = utftext.charCodeAt(i + 1);\n                    string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                    i += 2;\n                } else {\n                    c2 = utftext.charCodeAt(i + 1);\n                    c3 = utftext.charCodeAt(i + 2);\n                    string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                    i += 3;\n                }\n            }\n            return string;\n        }\n        var _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"\n        var output = '';\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '');\n        while (i < input.length) {\n            enc1 = _keyStr.indexOf(input.charAt(i++));\n            enc2 = _keyStr.indexOf(input.charAt(i++));\n            enc3 = _keyStr.indexOf(input.charAt(i++));\n            enc4 = _keyStr.indexOf(input.charAt(i++));\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n            output = output + String.fromCharCode(chr1);\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n        }\n        output = dc8(output);\n        return output;\n    }\n};\n\n    pmcRecc.initRecos = function () {\n        \n        // fix up an error in the tile template\n        var scriptTmpl = $(\"#tmpl_product_tile\");\n        var htmlTmpl = scriptTmpl.text();\n        htmlTmpl = htmlTmpl.replace('onerror=\\\"this.onerror=\\\\\\\"\\\\\\\";this.src=\\\\\\\"\\/wcsstore\\/CostcoGLOBALSAS\\/images\\/unavailable_350.png\\\\\\\"\\\"',\n            'onerror=\"this.onerror=&#39;&#39;;this.src=&#39;/wcsstore/CostcoGLOBALSAS/images/unavailable_350.png\\&#39;\"'\n        );\n        scriptTmpl.text(htmlTmpl);\n\n        // in case it wasn't available on page load\n        pmcRecc.thisIsCategory = (typeof PageAnalyticsInfo == \"object\" && PageAnalyticsInfo.pageType == \"Category\");\n        var shoppedCategoryTop = \"\";\n        var shoppedCategorySecondary = \"\";\n        var shoppedCategoryFull = \"\";\n\n        function linkTag(l) {\n            l = l.replace(\"https://\", \"\").replace(\"http://\", \"\");\n            var ich = l.indexOf(\"/\");\n            if (ich == -1)\n                return \"\";\n            l = l.slice(ich + 1);\n            return l.replace(\".html\", \"\");\n        }\n\n        function getCategories() {\n\n            var bc = $(\".crumbs li a\");\n            var cats = [];\n            $.each(bc, function (i) {\n                if (i > 0)\n                    cats.push(linkTag($(this).attr(\"href\")));\n            });\n            if (pmcRecc.thisIsCategory) {\n                cats.push(linkTag(window.location.pathname));\n            }\n            if (cats.length > 0)\n                shoppedCategoryTop = cats[0];\n            if (cats.length > 1)\n                shoppedCategorySecondary = cats[1];\n            shoppedCategoryFull = cats.join(\":\");\n        }\n\n        pmcRecc.thisIsCAFr = wcs.locale == 'fr_CA';\n      \n        function catAffinity() {\n            function reExtract(s, re) {\n                return s.match(re)[1]; // undefined if not found\n            }\n            var cat = \"\";\n            var href = $(\"#crumbs_ul li:nth-child(3) a\").attr(\"href\");\n            if (href != undefined)\n                cat = reExtract(href, /[com|ca]\\/(.*)\\.html/);\n            return cat ? cat : \"\";\n        }\n\n        var cty = window.location.host.indexOf(\".ca\") > -1 ? \"-ca\" : \"\";\n\n        // ZERO SEARCH RESULTS\n\n        if (window.location.pathname == \"/CatalogSearch\") {\n\n            if ($('#no-results-suggestions').length == 1) {\n                adobe.target.getOffer({\n                    mbox: 'mbox_recommend_zsr' + cty,\n                    success: function (response) {\n                        if (response.length != 1)\n                            return;\n                        var reco = JSON.parse(response[0].content);\n\n                        var rcmd = reco.rcmd;\n\n                        reco.rcmd = reco.rcmd.slice(0, 12);\n                        // reco.options = $.extend(reco.options || {}, {\n                        //     titleHtml: '<h3 style=\"font-weight:bold\">Recently Viewed Products</h3>'\n                        // });\n\n                        //                      $(\"#rr-placement\").before('<div style=\"border-top:1px solid #ddd;margin-top:20px\" id=\"mbox-recommend\"></div>');\n                        $(\"#no-results-espot,#no-results-find-warehouse\").last().after('<div id=\"mbox-recommend\"></div>');\n\n                        merkle.reco.displayResults(reco);\n                    },\n                    error: dbGetOfferFailed\n                });\n\n                return;\n            }\n        }\n    }\n})($, window, window.adobeopt);\n</script>\n");